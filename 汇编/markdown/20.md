+ [author](https://github.com/3293172751)

# ç¬¬20èŠ‚ callå’ŒretæŒ‡ä»¤

+ [å›åˆ°ç›®å½•](../README.md)
+ [å›åˆ°é¡¹ç›®é¦–é¡µ](../../README.md)
+ [ä¸Šä¸€èŠ‚](19.md)
> â¤ï¸ğŸ’•ğŸ’•æ±‡ç¼–è¯­è¨€ç›®å‰ä»åœ¨å‘æŒ¥ç€ä¸å¯æ›¿ä»£çš„ä½œç”¨ï¼Œåœ¨æ•ˆç‡ä¸Šæ— å¯æ›¿ä»£ï¼Œåœ¨åº•å±‚ï¼Œå­¦ä¹ linuxå†…æ ¸ï¼Œè®¡ç®—æœºå¤–å›´è®¾å¤‡å’Œé©±åŠ¨ï¼Œéƒ½ç¦»ä¸å¼€æ±‡ç¼–ã€‚Myblog:[http://nsddd.top](http://nsddd.top/)
---
[TOC]

## callæŒ‡ä»¤  

CPUæ‰§è¡Œ**call**æŒ‡ä»¤æ—¶ï¼Œè¿›è¡Œä¸¤æ­¥æ“ä½œï¼š

1. å°†å½“å‰çš„**IP**æˆ–**CSå’ŒIP**å‹å…¥æ ˆä¸­

2. è½¬ç§»åˆ°æ ‡å·å¤„æ‰§è¡ŒæŒ‡ä»¤

**callæŒ‡ä»¤ä¸èƒ½å®ç°çŸ­è½¬ç§»ï¼Œé™¤æ­¤ä¹‹å¤–ï¼ŒcallæŒ‡ä»¤å®ç°è½¬ç§»çš„æ–¹æ³•å’Œjmpçš„åŸç†ç›¸åŒã€‚**

**å‹æ ˆä¸€æ¬¡å­˜æ”¾2ä¸ªå­—èŠ‚ï¼Œä¹Ÿå°±æ˜¯ç”¨2ä¸ªå­—èŠ‚æ¥å­˜æ”¾IPæˆ–ç€CSï¼ŒåŒæ—¶å­˜æ”¾IPå’ŒCSä¸€å…±å 4ä¸ªå­—èŠ‚ã€‚ä¸€èˆ¬éƒ½ä¿å­˜åœ¨ä½åœ°å€ä½ã€‚**

æ¯”å¦‚ï¼š

```
push IP
```

æ­¤æ—¶æ ˆå†…ss:[0EH]ä¿å­˜IPçš„æ•°æ®ã€‚

```
push CS
push IP
```

æ­¤æ—¶æ ˆå†…ss:[0EH]ä¿å­˜IPï¼Œss:[0CH]çš„æ•°æ®ã€‚



## ä¾æ®ä½ç§»è¿›è¡Œè½¬ç§»çš„callæŒ‡ä»¤

**call æ ‡å·** ï¼ˆ**å°†å½“å‰çš„IPï¼ˆä¸‹ä¸€æ¡æŒ‡ä»¤çš„IPï¼‰å‹æ ˆå**ï¼Œè½¬åˆ°æ ‡å·å¤„æ‰§è¡Œï¼‰

â€ƒ1ï¼‰(sp) = (sp) - 2

â€ƒ2ï¼‰((ss) * 16 + (sp)) = IP 

> æ³¨æ„å½“callä¸€å¼€å§‹æ‰§è¡Œæ—¶ï¼ŒIPå°±æŒ‡å‘ä¸‹ä¸€æ¡æŒ‡ä»¤äº†ï¼Œæ‰€ä»¥IPçš„åœ°å€ä¸ºä¸‹ä¸€æ¡æŒ‡ä»¤çš„åœ°å€ã€‚

â€ƒ3ï¼‰(IP) = (IP) + 16ä½ä½ç§» (ä¸èƒ½å®ç°çŸ­è½¬ç§»)

> - 16ä½ä½ç§» = æ ‡å·å¤„çš„åœ°å€ - callæŒ‡ä»¤åçš„ç¬¬ä¸€ä¸ªå­—èŠ‚çš„åœ°å€ï¼›
> - 16ä½ä½ç§»çš„èŒƒå›´ä¸º-32768 ~ 32767ï¼Œç”¨è¡¥ç è¡¨ç¤ºã€‚
> - 16ä½ä½ç§»ç”±ç¼–è¯‘å™¨ç¨‹åºåœ¨ç¼–è¯‘æ—¶ç®—å‡ºã€‚

CPUæ‰§è¡Œâ€œ**call æ ‡å·**â€æ—¶ï¼Œç›¸å½“äºï¼š

```
push IP
jmp near æ ‡å·
```

ä¾‹ï¼šaxçš„æ•°å€¼ï¼Ÿ

```
å†…å­˜åœ°å€              æœºå™¨ç                æ±‡ç¼–æŒ‡ä»¤
1000:0               B8 00 00            mov ax, 0
1000:3               E8 01 00            call s    //1000H
1000:6               40                  inc ax
1000:7               58                  s:pop ax
//æ³¨æ„å½“callä¸€å¼€å§‹æ‰§è¡Œæ—¶IPå°±æŒ‡å‘ä¸‹ä¸€æ¡æŒ‡ä»¤äº†ï¼Œæ‰€ä»¥IPçš„åœ°å€ä¸ºä¸‹ä¸€æ¡æŒ‡ä»¤çš„åœ°å€ã€‚
```

ax ä¸º 6



## è½¬ç§»çš„ç›®çš„åœ°å€åœ¨æŒ‡ä»¤ä¸­çš„callæŒ‡ä»¤ï¼ˆæ®µé—´ï¼‰

**â€œcall far pty æ ‡å·â€å®ç°çš„æ—¶æ®µé—´è½¬ç§»ã€‚**

```
call far pty æ ‡å·
```

ç¬¬ä¸€æ­¥ï¼š

```
(sp) = (sp) - 2
((ss) * 16 + (sp)) = (CS)
(sp) = (sp) - 2
((ss) * 16 + (sp)) = (IP)
```

ç¬¬äºŒæ­¥ï¼š

```
(CS) = æ ‡å·æ‰€åœ¨çš„æ®µåœ°å€
(IP) = æ ‡å·æ‰€åœ¨çš„åç§»åœ°å€
```

**é«˜ä½å­˜æ”¾çš„æ˜¯æ®µåœ°å€(CS)ï¼Œä½ä½å­˜æ”¾çš„æ˜¯åç§»åœ°å€(IP)ã€‚**

CPUæ‰§è¡Œâ€œ**call far ptr æ ‡å·**â€æ—¶ï¼Œç›¸å½“äºè¿›è¡Œï¼š

```
push CS
push IP
jmp far ptr æ ‡å·
```

ä¾‹ï¼šaxä¸­çš„æ•°å€¼ï¼Ÿ

```
å†…å­˜åœ°å€          æœºå™¨ç              æ±‡ç¼–æŒ‡ä»¤
1000:0           B8 00 00          mov ax, 0
1000:3           9A 09 00 00 10    call far ptr s   //cs = 1000  IP = 0008 å‹å…¥æ ˆ
1000:8           40                inc ax           
1000:9           58                s: pop ax        //0008H			
							   add ax, ax       //0010H
							   pop bx          //1000
							   add ax, bx      //1010H
//æ³¨æ„å½“callä¸€å¼€å§‹æ‰§è¡Œæ—¶IPå°±æŒ‡å‘ä¸‹ä¸€æ¡æŒ‡ä»¤äº†ï¼Œæ‰€ä»¥IPçš„åœ°å€ä¸ºä¸‹ä¸€æ¡æŒ‡ä»¤çš„åœ°å€ã€‚
```

ax = 1010H



## è½¬ç§»åœ°å€åœ¨å¯„å­˜å™¨ä¸­çš„callæŒ‡ä»¤ï¼ˆæ®µå†…ï¼‰

æŒ‡ä»¤æ ¼å¼ï¼š

```
call 16ä½reg
```

åŠŸèƒ½ï¼š

```
(sp) = (sp) - 2
((ss) * 16 + sp) = (ip)
(ip) = 16ä½reg
```

ç›¸å½“äºï¼š

```
push ip
jmp 16ä½å¯„å­˜å™¨
```

ä¾‹ï¼šaxä¸­çš„æ•°å€¼ï¼Ÿ

```c
å†…å­˜åœ°å€             æœºå™¨ç                     æ±‡ç¼–æŒ‡ä»¤
1000:0              B8 06 00                 mov ax, 6
1000:2              FF d0                    call ax   ip = 0005
1000:5              40                       inc ax   //è·³è¿‡
1000:6                                       mov bp, sp //æ­¤æ—¶spæŒ‡å‘æ ˆé¡¶
                                             add ax, [bp] //æ ˆé¡¶ä½ç½®æ•°æ® + ax 
```

ax = 11





## ret å’Œ retf

**ret** æŒ‡ä»¤ç”¨æ ˆä¸­çš„æ•°æ®ï¼Œä¿®æ”¹IPçš„å†…å®¹ï¼Œä»è€Œå®ç°è¿‘è½¬ç§»ã€‚

**retf** æŒ‡ä»¤ç”¨æ ˆä¸­çš„æ•°æ®ï¼Œä¿®æ”¹**CSå’ŒIP**çš„å†…å®¹ï¼Œä»è€Œå®ç°è¿œè½¬ç§»ã€‚é«˜ä½ä¸ºCSï¼ˆæ®µåœ°å€ ï¼‰ï¼Œä½ä½ä¸ºIPï¼ˆåç§»åœ°å€ï¼‰ã€‚**å…¥æ ˆè¦å…ˆå…¥CSçš„åœ°å€ã€‚**

CPUæ‰§è¡ŒretæŒ‡ä»¤æ—¶ï¼š

```
(IP) = ((ss) * 16 + (sp))

(sp) = (sp) + 2
```

ç›¸å½“äºï¼š

```
pop IP
```

CPUæ‰§è¡ŒretfæŒ‡ä»¤æ—¶ï¼š

```
(IP) = ((SS) * 16 + (SP))

(SP) = (SP) + 2

(CS) = ((SS) * 16 + (SP))

(SP) = (SP) + 2
```

ç›¸å½“äºï¼š

```
pop IP

pop CS
```

**ä¾‹ï¼š**

```assembly
assume cs:code, ss:stack

stack segment 
	db 16 dup (0)
stack ends

code segment

			mov ax, 4c00H
			int 21H

	start:	mov ax, stack
			mov ss, ax	;ç»™æ ˆçš„æ®µåœ°å€èµ‹å€¼
			mov sp, 16	;æ ˆé¡¶æŒ‡é’ˆèµ‹å€¼
			mov ax, 0	;axèµ‹å€¼ç»™0   å…¥æ ˆ
			push ax
			mov bx, 0	
			ret		;è¿™ä¸ªåœ°æ–¹æ²¡æœ‰ç”¨callï¼Œä¹Ÿæ˜¯å¯ä»¥ç”¨ret
code ends

end start
```

**ç¨‹åºä¸­retæ‹¿åˆ°çš„IPçš„å€¼ä¸º0ï¼Œæ‰€ä»¥ä»ç¨‹åºçš„ç¬¬ä¸€è¡Œå¼€å§‹æ‰§è¡Œã€‚**



**retfæŒ‡ä»¤**

+ å…ˆpop IP
+ å†pop CS

```assembly
assume cs:code, ss:stack
stack segment
	db 16 dup (0)
stack ends

code segment 
			
			mov ax, 4C00H
			int 21H
			
	start:  mov ax, stack
			mov ss, ax
			mov sp, 16
		
			mov ax, code
			push ax	;å…ˆå‹å…¥cs
			
			mov ax, 0
			push ax	;å†å‹å…¥ipï¼š0
			mov bx
			retf
code ends

end start
```

**ç¨‹åºä¸­IPä¹Ÿæ˜¯0ï¼Œå›åˆ°å¼€å¤´**



**ä¾‹ï¼š ä»å†…å­˜1000ï¼š0000å¤„å¼€å§‹æ‰§è¡Œç¨‹åº**

```assembly
assume cs:dode, ss:stack

stack segment

	db 16 dup (0)

stack ends

code segment

	stack:  mov ax, stack
			mov ss, ax
			mov sp, 16

			mov ax, 1000H    //è®¾CS = 1000H
			push ax

			mov ax, 0      //è®¾IP = 0000H
			push ax

			retf

			mov ax, 4c00H
			int 21H

code ends

end start
```



## è½¬ç§»åœ°å€åœ¨å†…å­˜ä¸­çš„callæŒ‡ä»¤

1. **call word ptr å†…å­˜å•å…ƒåœ°å€**

ç›¸å½“äºï¼š

```
push ip

jmp word ptr å†…å­˜å•å…ƒåœ°å€
```

ä¾‹ï¼š

```ass
mov sp, 10H
mov ax, 0123H
mov ds:[0], ax
call word ptr ds:[0]
(IP) = 0123H (sp) = 0EH
```

2) **call dword ptr å†…å­˜å•å…ƒåœ°å€**

ç›¸å½“äºï¼š

```
push cs

push ip

jmp dword ptr å†…å­˜å•å…ƒ
```

ä¾‹ï¼š

```assembly
mov sp, 10H

mov ax, 0123H

mov ds:[0], ax

mov word ptr ds:[2], 0

mov dword ptr ds:[0]

(cs) = 0000H (sp) = 0CH (ip) = 0123H
```

ä¾‹1ï¼šaxçš„æ•°å€¼ä¸ºå¤šå°‘ï¼Ÿ

```assembly
assume cs:code

stack segment

	dw 8 dup (0)

stack ends

code segment

	start:  mov ax, stack
			mov ss, ax
			mov sp, 16
			
			mov ds, ax
			mov ax, 0

			call word ptr ds:[0EH] 

			inc ax
			inc ax
			inc ax
			
			mov ax, 4c00H
			int 21H

code ends

end start
```

ax = 3

æ‰§è¡Œcallæ—¶ï¼Œæ­¤æ—¶IPçš„å€¼å·²ç»æŒ‡å‘ä¸‹ä¸€æ¡åœ°å€äº†ä¹Ÿå°±æ˜¯ï¼Œï¼ˆIPï¼‰å­˜å‚¨åœ¨æ ˆä¸­çš„ä½ç½®ç­‰äºä¸‹ä¸€ä¸ªå†…å­˜å•å…ƒçš„åœ°å€ã€‚æ­¤æ—¶è·³è½¬åˆ°ds:[0EH]ä¿å­˜çš„åç§»åœ°å€å°±æ˜¯æ”¾åœ¨æ ˆä¸­çš„IPåœ°å€æ‰€ä»¥ï¼Œcallè·³è½¬åˆ°ä¸‹ä¸€æ¡æŒ‡ä»¤ï¼Œæ‰€ä»¥ç¨‹åºæŒ‰é¡ºåºæ‰§è¡Œã€‚

1. CPUå–æŒ‡ä»¤ : (call word ptr ds:[0EH])
2. ipè‡ªå¢ä¸Šè¿°æŒ‡ä»¤çš„é•¿åº¦ , æŒ‡å‘äº†ä¸‹ä¸€æ¡æŒ‡ä»¤ (inc ax)
3. å¼€å§‹æ‰§è¡Œè¯¥æŒ‡ä»¤ 3.1. push ip ; å°† ip å‹å…¥æ ˆ , ä¹Ÿå°±æ˜¯ï¼šss:[0EH] ä¿å­˜ ip çš„ä½ 8 ä½ , ss:[0FH] ä¿å­˜é«˜ 8 ä½ 3.2. jmp ds:[0EH] ( (ip) = ds:[0EH] , ä¹Ÿå°±æ˜¯è¯´ , ç¨‹åºåˆä» ds:[0EH] ä¸­å–å‡ºæ•°æ®èµ‹å€¼ç»™ ip , ç„¶åç»§ç»­æ‰§è¡Œ )
4. ç°åœ¨å…¶å®å°±å¼€å§‹æ‰§è¡Œ ip ä¹‹å‰ä¿å­˜çš„åœ°å€çš„æŒ‡ä»¤äº† , ä¹Ÿå°±æ˜¯ä¸‰ä¸ª inc ax
5. å› æ­¤æœ€ç»ˆ ax å€¼ä¸º 3

ä¾‹2ï¼šax å’Œ bxçš„æ•°å€¼ä¸ºå¤šå°‘ï¼Ÿ

```assembly
assume cs:code 

data segment
	dw 8 dup (0)
data ends

code segment
	start:  mov ax, data
			mov ss, ax
			mov sp, 16
	
			mov word ptr ss:[0], offset s
			mov ss:[2], cs

			call dword ptr ss:[0]   ;è·³è½¬ä½ç½® cs = ä»£ç æ®µå¼€å¤´ï¼Œ ip = sçš„ä½ç½® 
			nop

		s:  mov ax, offset s
			sub ax, ss:[0Ch]  ;0
			mov bx, cs        ;0
			sub bx, ss:[0EH]
			
			mov ax, 4C00H
			int 21H

code ends

end start
```

ss:[0CH] å¤„ä¿å­˜çš„æ˜¯ : call dword ptr ss:[0] è¿™æ¡æŒ‡ä»¤çš„ä¸‹ä¸€æ¡æŒ‡ä»¤ nop çš„ç›¸å¯¹äºä»£ç æ®µåç§»åœ°å€ ax = (mov ax, offset second çš„åç§»åœ°å€) - ( nop çš„åç§»åœ°å€) ä¹Ÿå°±æ˜¯ nop æŒ‡ä»¤çš„é•¿åº¦ , ä¹Ÿå°±æ˜¯ 1ã€‚(0CHå­˜æ”¾çš„å°±æ˜¯callä½ç½®çš„ä¸‹ä¸€æ¡åœ°å€çš„åç§»ä½ç½®)

å°†ä»£ç æ®µçš„åŸºå€èµ‹å€¼ç»™ bx ï¼Œbx = (bx) - (ss:[0EH])ï¼Œ(ss:[0EH]) = (cs)å› æ­¤ bx = 0ã€‚



## call å’Œ retçš„é…åˆä½¿ç”¨

**ä¾‹ï¼šbxçš„å€¼ï¼Ÿ**

```assembly
assume cs:code

code segment

	start:  mov ax, 1
			mov cx, 3

			call s   ;åˆ°å­ç¨‹åºsæ‰§è¡Œ
			mov bx, ax
			mov ax, 4c00H	
			int 21H

		s:  add ax, ax
			loop s
			ret		

code ends

end start
```

åˆ†æï¼š

â€ƒ1ï¼‰CPUå°†call sæŒ‡ä»¤çš„æœºå™¨ç è¯»å…¥ï¼ŒIPæŒ‡å‘call såçš„æŒ‡ä»¤mov bx, axï¼Œç„¶åCPUæ‰§è¡Œcall sæŒ‡ä»¤ï¼Œå°†å½“å‰çš„IPå€¼ï¼ˆæŒ‡ä»¤mov bx, ax çš„åç§»åœ°å€ï¼‰å‹æ ˆï¼Œå¹¶å°†IPçš„å€¼æ”¹å˜ä½æ ‡å·så¤„çš„åç§»åœ°å€ã€‚

â€ƒ2ï¼‰CPUä»æ ‡å·så¤„å¼€å§‹æ‰§è¡ŒæŒ‡ä»¤ï¼Œloopå¾ªç¯å®Œæ¯•åï¼Œ(ax) = 8ã€‚

â€ƒ3ï¼‰CPUå°†retæŒ‡ä»¤çš„æœºå™¨ç è¯»å…¥ï¼ŒIPæŒ‡å‘äº†retæŒ‡ä»¤åçš„å†…å­˜å•å…ƒï¼Œç„¶åCPUæ‰§è¡ŒretæŒ‡ä»¤ï¼Œä»æ ˆä¸­å¼¹å‡ºä¸€ä¸ªå€¼ï¼ˆå³ call s å…ˆå‰å‹å…¥çš„ mov bx, axæŒ‡ä»¤çš„åç§»åœ°å€ï¼‰é€å…¥IPä¸­ã€‚åˆ™CS:IPæŒ‡å‘ mov bx, axã€‚

â€ƒ4ï¼‰ CPUä»mov bx, axå¼€å§‹æ‰§è¡ŒæŒ‡ä»¤ï¼Œç›´è‡³å®Œæˆã€‚

**ä¾‹ï¼š**

æºç¨‹åºå’Œå†…å­˜ä¸­æƒ…å†µï¼ˆ1000:0000è£…å…¥ï¼‰

```assembly
assume cs:code

stack segment 

	db 8 dup (0)     1000:0000 00, 00, 00, 00, 00, 00, 00, 00
	db 8 dup (0)	 1000:0008 00, 00, 00, 00, 00, 00, 00, 00

stack ends

code segment 

	start:  mov ax, stack   1001:0000   BE 00 10
			mov ss, ax      1001:0003   8E D0      
			mov sp, 16      1001:0005   BC 10 00

			mov ax, 1000    1001:0008   B8 E8 03
			call s          1001:000B   E8 05 00
			mov ax, 4c00H   1001:000E   B8 00 4C 
			int 21H         1001:0011   CD 21
		s:  add ax, ax      1001:0013   03 C0
			ret             1001:0015   C3

code ends

end strat
```

CPUè¯»å…¥call sæŒ‡ä»¤åï¼Œç¨‹åºè·³è½¬åˆ°så¤„ï¼Œå¹¶æŠŠmov ax, 4C00Hå¤„çš„æŒ‡ä»¤ä¿å­˜åˆ°æ ˆä¸­ï¼Œç„¶åæ‰§è¡Œä»så¤„å¼€å§‹æ‰§è¡Œï¼Œå½“CPUè¯»å…¥retæŒ‡ä»¤åï¼Œretè·³è½¬æ ˆä¸­å­˜æ”¾çš„IPåç§»åœ°å€æ‰€æŒ‡å‘çš„ä½ç½®ï¼Œå³mov ax, 4C00H å¤„ã€‚

æ ¹æ®callå’Œretå¯ä»¥å†™ä¸€ä¸ªå…·æœ‰ä¸€å®šåŠŸèƒ½çš„ç¨‹åºæ®µï¼Œæˆ‘ä»¬ç§°å…¶ä¸ºå­ç¨‹åºï¼Œéœ€è¦çš„æ—¶å€™ï¼Œç”¨callæŒ‡ä»¤è½¬å»æ‰§è¡Œï¼Œå¯ä»¥åœ¨å­ç¨‹åºçš„åé¢ä½¿ç”¨retæŒ‡ä»¤ï¼Œä»è€Œè·³è½¬åˆ°callæŒ‡ä»¤åé¢çš„ä»£ç å¤„ç»§ç»­æ‰§è¡Œã€‚

åˆ©ç”¨callå’Œretæ¥å®ç°å­ç¨‹åºçš„æœºåˆ¶ã€‚å­ç¨‹åºæ¡†æ¶ï¼š

```
æ ‡å·ï¼š
	æŒ‡ä»¤
	ret
```

**ç¨‹åºæ¡†æ¶ï¼š**

```assembly
assume cs:code

code segment

	main:  :
		   :
		   call sub1
		   :
		   :
		   mov ax, 4C00H
		   int 21H

     sub1: :
		   :
		   call sub2
           :
           :
           ret

     sub2: :
           :
		   ret

code ends

end main
```

## å‚æ•°å’Œç»“æœä¼ é€’é—®é¢˜ï¼ˆcallå’Œretè¿ç”¨ï¼‰

ä¾‹ï¼šè®¡ç®—dataæ®µä¸­ç¬¬ä¸€ç»„æ•°æ®çš„3æ¬¡æ–¹ï¼Œç»“æœä¿å­˜åœ¨åé¢ä¸€ç»„æ•°æ®ä¸­ã€‚

```assembly
assume cs:code 

data segment

	dw 1, 2, 3, 4, 5, 6, 7, 8  
	dd 0, 0, 0, 0, 0, 0, 0, 0

data ends

code segment

	start:  mov ax, data
			mov ds, ax
			mov si, 0
			mov di, 16
			mov cx, 8
			
		s1:	mov bx, ds:[si]
			mov dx, ax
			call s
			mov ds:[di], ax  //ä¿å­˜ä½ä½
			mov ds:[di].2, dx  //ä¿å­˜é«˜ä½
			add si, 2     //åç§»
			add di, 4	  //åç§»
			loop s1

			mov ax, 4C00H
			int 21H

	    s:  mov ax, bx  //(ä¸èƒ½ç”¨dx)
			mul bx
			mul bx
			ret

code ends

end start
```

## æ‰¹é‡æ•°æ®çš„ä¼ é€’

å¯„å­˜å™¨çš„æ•°é‡ç»ˆç©¶æœ‰é™ï¼Œæˆ‘ä»¬å¯ä»¥å°†æ‰¹é‡æ•°æ®æ”¾åˆ°å†…å­˜ä¸­ï¼Œç„¶åå°†å®ƒä»¬æ‰€åœ¨å†…å­˜ç©ºé—´çš„é¦–åœ°å€æ”¾åœ¨å¯„å­˜å™¨ä¸­ï¼Œä¼ é€’ç»™éœ€è¦çš„å­ç¨‹åºã€‚å¯¹äºå…·æœ‰æ‰¹é‡æ•°æ®çš„è¿”å›ç»“æœï¼Œä¹Ÿå¯ä»¥ç”¨åŒæ ·çš„æ–¹æ³•ã€‚

**ä¾‹ï¼šå°†ä¸€ä¸ªå…¨æ˜¯å­—æ¯çš„å­—ç¬¦ä¸²è½¬åŒ–ä¸ºå¤§å†™ã€‚**

```assembly
assume cs:code

data segment

	db 'conversation'

data ends

code segment

	start:  mov ax, data
			mov ds, ax
			mov cx, 12
			mov si, 0
			call s

			mov ax, 4C00H
			int 21H


		s1: and byte ptr ds:[si]:11011111B  //è½¬æ¢ï¼Œä¼ é€’å†…å­˜å•å…ƒçš„é¦–åœ°å€
			inc si
			loop s1
			ret

code ends

end start
```

é™¤äº†ç”¨å¯„å­˜å™¨ä¼ é€’å‚æ•°å¤–ï¼Œè¿˜æœ‰ä¸€ç§é€šç”¨çš„æ–¹æ³•æ˜¯ç”¨æ ˆæ¥ä¼ é€’å‚æ•°ã€‚

## å¯„å­˜å™¨å†²çªé—®é¢˜

**ä¾‹ï¼šå°†ä¸€ä¸ªå…¨æ˜¯å­—æ¯ï¼Œä»¥0ç»“å°¾çš„å­—ç¬¦ä¸²ï¼Œè½¬æ¢ä¸ºå¤§å†™ã€‚**

```assembly
assume cs:code

data segment

	db 'conversation', 0

data ends

code segment

	start:  mov ax, data
			mov ds, ax
			mov si, 0
			
			call s

			mov ax, 4C00H
			int 21H

		s:  mov cl, ds:[si]
			mov ch, 0
			jcxz ok
			and byte ptr ds:[si], 11011111B
			inc si
			jmp short s   //æ­»å¾ªç¯
			
		ok: ret

code ends

end start
```

ä¾‹ï¼š

```assembly
assume cs:code

data segment

	db 'word', 0
	db 'unix', 0
	db 'wind', 0
	db 'good', 0

data ends

code segment

	start:  mov ax, data
			mov ds, ax
			mov cx, 4
			mov bx, 0

		s:  mov si, 0
			call s1
			add bx, 5
			pop cx
			loop s

			mov ax, 4C00H
			int 21H
	
		s1: push cx
			mov cl, ds:[bx + si]
			mov cH, 0
			jcxz s0
			and byte ptr ds:[bx + si], 11011111B
			inc si
			jmp short s1
			
		s0: ret

code ends

end atart
```

æˆ‘ä»¬å¸Œæœ›ï¼š

1ï¼‰ç¼–å†™è°ƒç”¨å­ç¨‹åºçš„ç¨‹åºçš„æ—¶å€™ï¼Œä¸å¿…å…³å¿ƒå­ç¨‹åºåˆ°åº•ä½¿ç”¨äº†é‚£äº›å¯„å­˜å™¨ï¼›

2ï¼‰ç¼–å†™å­ç¨‹åºçš„æ—¶å€™ä¸å¿…å…³ç³»è°ƒç”¨è€…ä½¿ç”¨äº†é‚£äº›å¯„å­˜å™¨ã€‚

3ï¼‰ä¸ä¼šå‘ç”Ÿå¯„å­˜å™¨å†²çªã€‚

è§£å†³è¿™ä¸ªé—®é¢˜çš„ç®€æ·æ–¹æ³•æ˜¯ï¼Œåœ¨å­ç¨‹åºçš„å¼€å§‹å°†å­ç¨‹åºç§æ‰€æœ‰ç”¨åˆ°çš„å¯„å­˜å™¨ç§çš„å†…å®¹éƒ½ä¿å­˜èµ·æ¥ï¼Œåœ¨å­ç¨‹åºè¿”å›å‰å†æ¢å¤ï¼Œæˆ–ä¸å†å­ç¨‹åºä¸­æ”¹å˜å¯„å­˜å™¨çš„å€¼ã€‚



## ç¼–å†™å­ç¨‹åº

**ä¾‹.æ˜¾ç¤ºå­—ç¬¦ä¸²**

åœ¨æŒ‡å®šä½ç½®ï¼Œç”¨æŒ‡å®šé¢œè‰²ï¼Œæ˜¾ç¤ºä¸€ä¸ªç”¨0ç»“æŸçš„å­—ç¬¦ä¸²ã€‚

ï¼ˆdhï¼‰= è¡Œå·ï¼ˆ0 ~ 24ï¼‰ï¼Œ dl = åˆ—å·ï¼ˆ0 ~ 79ï¼‰, (cl) = é¢œè‰²ã€‚

åœ¨å±å¹•ç¬¬8è¡Œï¼Œç¬¬3åˆ—ï¼Œç”¨ç»¿è‰²æ˜¾ç¤ºdataæ®µä¸­çš„å­—ç¬¦ä¸²ã€‚0 ~ 79 ä¸ªå­—ç¬¦ï¼Œä¸€ä¸ªå­—ç¬¦1å­—èŠ‚åŠ ä¸Š1å­—èŠ‚çš„é¢œè‰²ã€‚

ç¬¬8è¡Œç›¸å½“äºå‘ä¸‹7ä¸ª160ä¸ªå­—èŠ‚çš„ä½ç½®ï¼Œç¬¬3åˆ—ç›¸å½“äºå‘å³3ä¸ªå­—ç¬¦ï¼Œå³3 * 2ä¸ªå­—èŠ‚çš„ä½ç½®ã€‚

æ˜¾å­˜å­˜æ”¾ï¼Œä½ä½å­—ç¬¦ï¼Œé«˜ä½é¢œè‰²ï¼Œ æ‰€ä»¥ä¸€å…±å 2ä¸ªå­—èŠ‚ã€‚ å­—ç¬¦ä¸€ä¸ªå­—èŠ‚ï¼Œé¢œè‰²ä¸€ä¸ªå­—èŠ‚ã€‚

```assembly
assume cs:code

data segment

	db 'Welcome to masm!', 0

data ends

code segment
	
	start:  mov dh, 8
			mov dl, 3
			mov cl, 2
			mov ax, data
			mov ds, ax
			mov si, 0
			call show_str

			mov ax, 4C00H
			int 21H
		
  show_str: //ä¿å­˜ç”¨åˆ°çš„å¯„å­˜å™¨
			push cx
			push si
			push es
			push di
			push bx

			mov ax, 0B800H  //æ˜¾å­˜çš„èµ·å§‹åœ°å€(æ¯å°ç”µè„‘ä¸ä¸€å®šä¸€æ ·)
			mov es, ax
			mov di, 0       

			//è®¡ç®—è¡Œå¼€å§‹çš„ä½ç½®
			mov al, 0A0H    //ä¸€è¡Œ160ä¸ªå­—èŠ‚, 80 * 2 = 160
			dec dh          //ç¬¬8è¡Œï¼Œ0-7  ä¹Ÿå°±æ˜¯7çš„ä½ç½®
			mul dh          //ä¸€å…±dhè¡Œ
			mov bx, ax

			//è®¡ç®—åˆ—å¼€å§‹çš„ä½ç½®
			mov al, 2       //ä¸€åˆ—
			dec dl          //åˆ—ä¹Ÿæ˜¯ ä»é›¶å¼€å§‹
			mul dl          //ä¸€ä¸ªå­—ç¬¦2ä¸ªå­—èŠ‚
			add bx, ax      //å¼€å§‹çš„åç§»ä½ç½®
			
	    	mov al, cl      //ä¿å­˜é¢œè‰²
			
         s: mov cl, ds:[si]
			mov ch, 0
			mov es:[bx + di], ds:[si]  //æ˜¾ç¤ºå­—ç¬¦ä¸²
			mov es:[bx + di], al   //æ˜¾ç¤ºé¢œè‰²
			jcxz ok                //åˆ¤æ–­æ˜¯å¦ä¸ºé›¶
			inc si
			add di, 2               //ç§»åŠ¨2ä¸ªå­—èŠ‚ï¼Œå³ä¸€ä¸ªå­—ç¬¦
			jmp short s

		ok: //å–å›ä¿å­˜çš„å€¼,æ³¨æ„å‡ºæ ˆé¡ºåº
			pop bx
			pop di
			pop es
			pop si
			pop cx
			ret	
	
code ends

end start
```



## END é“¾æ¥
+ [å›åˆ°ç›®å½•](../README.md)
+ [ä¸Šä¸€èŠ‚](19.md)
+ [ä¸‹ä¸€èŠ‚](21.md)
---
+ [å‚ä¸è´¡çŒ®â¤ï¸ğŸ’•ğŸ’•](https://github.com/3293172751/Block_Chain/blob/master/Git/git-contributor.md)