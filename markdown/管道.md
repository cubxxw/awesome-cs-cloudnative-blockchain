[toc]

ğŸ˜¶â€ğŸŒ«ï¸goè¯­è¨€å®˜æ–¹ç¼–ç¨‹æŒ‡å—ï¼š[https://golang.org/#](https://golang.org/#)  

>   goè¯­è¨€çš„å®˜æ–¹æ–‡æ¡£å­¦ä¹ ç¬”è®°å¾ˆå…¨ï¼Œæ¨èå»å®˜ç½‘å­¦ä¹ 

ğŸ˜¶â€ğŸŒ«ï¸æˆ‘çš„å­¦ä¹ ç¬”è®°ï¼šgithub: [https://github.com/3293172751/golang-rearn](https://github.com/3293172751/golang-rearn)

---

**åŒºå—é“¾æŠ€æœ¯ï¼ˆä¹Ÿç§°ä¹‹ä¸ºåˆ†å¸ƒå¼è´¦æœ¬æŠ€æœ¯ï¼‰**ï¼Œæ˜¯ä¸€ç§äº’è”ç½‘æ•°æ®åº“æŠ€æœ¯ï¼Œå…¶ç‰¹ç‚¹æ˜¯å»ä¸­å¿ƒåŒ–ï¼Œå…¬å¼€é€æ˜ï¼Œè®©æ¯ä¸€ä¸ªäººå‡å¯å‚ä¸çš„æ•°æ®åº“è®°å½•

>   â¤ï¸ğŸ’•ğŸ’•å…³äºåŒºå—é“¾æŠ€æœ¯ï¼Œå¯ä»¥å…³æ³¨æˆ‘ï¼Œå…±åŒå­¦ä¹ æ›´å¤šçš„åŒºå—é“¾æŠ€æœ¯ã€‚åšå®¢[http://nsddd.top](http://nsddd.top)

---

## 45å¤©å­¦ä¼šgo --ç¬¬åå…«å¤© channel(ç®¡é“)

**æ¼”ç¤ºç®¡é“ä½¿ç”¨**

**channelåˆå§‹åŒ–ï¼š**

```go
var intChan chan int 
intChan = make(chan int,10)
```

> ä¸€å®šè¦ä½¿ç”¨makeä¸ç„¶ä¼šæŠ¥é”™

```go
package main
import(
	"fmt"
)
func main(){
	/*åˆ›å»ºä¸€ä¸ªå¯ä»¥å­˜æ”¾3ä¸ªintç±»å‹çš„ç®¡é“*/
    var intChan chan int 
    intChan = make(chan int ,3)
    
    //çœ‹ä¸€ä¸‹intchanæ˜¯ä¸€ç§ä»€ä¹ˆç±»å‹ï¼Œåœ°å€è¿˜æ˜¯æ•°å­—
    fmt.Println("intchan æœ¬èº«çš„å€¼ä¸º:",intchan)
    fmt.Printf("intchan æœ¬èº«çš„åœ°å€ä¸º%p:",&intchan)
}
```

**çœ‹ä¸‹intChanæ˜¯ä»€ä¹ˆ**

```shell
[root@mail ~]# go run chan.go 
intchan æœ¬èº«çš„å€¼ä¸º: 0xc00001e080
intchan æœ¬èº«çš„åœ°å€ï¼š0xc00000e028
```

**ç”±æ­¤å¯è§ï¼Œç®¡é“æ˜¯ä¸€ä¸ªåœ°å€**

![image-20220320114737171](https://s2.loli.net/2022/03/20/eRdMEkUaCY2PpTW.png)

> ç®¡é“æ˜¯ä¸€ä¸ªåº”ç”¨ç±»å‹ï¼Œä½¿ç”¨å‡½æ•°å˜åŒ–çš„æ˜¯åœ°å€

**å‘ç®¡é“å†™å…¥æ•°æ®**

```go
/*************************************************************************
    > File Name: chan.go
    > Author: smile
    > Mail: 3293172751nss@gmail.com 
    > Created Time: Sun 20 Mar 2022 11:40:41 AM CST
 ************************************************************************/
 package main
import(
	"fmt"
)
func main(){
	/*åˆ›å»ºä¸€ä¸ªå¯ä»¥å­˜æ”¾3ä¸ªintç±»å‹çš„ç®¡é“*/
    var intChan chan int
    intChan = make(chan int ,3)

    //çœ‹ä¸€ä¸‹intchanæ˜¯ä¸€ç§ä»€ä¹ˆç±»å‹ï¼Œåœ°å€è¿˜æ˜¯æ•°å­—
    fmt.Println("intchan æœ¬èº«çš„å€¼ä¸º:",intChan)
    fmt.Printf("intchan æœ¬èº«çš„åœ°å€ä¸º%p:\n",&intChan)

    //å‘ç®¡é“ä¸­å†™å…¥æ•°æ®--æ³¨æ„ä½¿ç”¨çš„æ˜¯<- å†™å…¥ç¬¦å·
    intChan <- 10
    num := 211 //å®šä¹‰ä¸€ä¸ªå˜é‡å¹¶ä¸”å†™å…¥å˜é‡
    intChan <- num
	/*æ³¨æ„ -- å½“æˆ‘ä»¬ç»™ç®¡é“å†™å…¥æ•°æ®çš„æ—¶å€™ï¼Œä¸èƒ½è¶…è¿‡å…¶å®¹é‡ ï¼Œæ­¤æ—¶åªèƒ½å†™å…¥ä¸€æ¡æ•°æ®äº†ï¼Œå› ä¸ºé•¿åº¦ä¸å¯ä»¥æ¯”å®¹é‡é«˜ï¼Œæœ€å¤šä¸º3*/
    intChan <- a:=100 //æé™ã€‚æ­¤æ—¶å†åŠ å…¥æŠ¥é”™
    //çœ‹çœ‹ç®¡é“çš„é•¿åº¦å’Œå®¹é‡cap(å®¹é‡)
    fmt.Println("channel len = %v\n cap = %v\n",len(intChan),cap(intChan))
}
```



**ç¼–è¯‘**

``` shell
[root@mail ~]# go run chan.go 
intchan æœ¬èº«çš„å€¼ä¸º: 0xc0000aa000
intchan æœ¬èº«çš„åœ°å€ä¸º0xc0000a4018:
channel len = 3
cap = 3
```



> æ‰€ä»¥åœ¨ä½¿ç”¨ç®¡é“çš„æ—¶å€™ä¸å¯ä»¥è¶…è¿‡æœ€å¤§çš„å®¹é‡ï¼Œå¯ä»¥å°†ç®¡é“ä¸­çš„æ•°æ®**å–å‡ºæ¥åå†æ’å…¥**ï¼Œå–å‡ºæ•°æ®åç®¡é“é•¿åº¦ä¼šå‘ç”Ÿå˜åŒ–ï¼Œä½†æ˜¯å®ƒçš„å®¹é‡mapæ˜¯ä¸ä¼šå‘ç”Ÿå˜åŒ–çš„

**æ¡ˆä¾‹**

```go
//å–å‡ºæ•°æ®
var num2 int 
num2 = <-intChan 
fmt.Println("num2 = ",num2)
fmt.Printf("channel len = %v\n cap = %v\n",len(intChan),cap(intChan))
num2 = <-intChan    //æ³¨æ„å¦‚æœæ•°æ®å…¨éƒ¨å–å‡ºï¼Œå†æ— ä¼‘æ­¢çš„å–å‡ºä¼šæŠ¥é”™
fmt.Println("num2 = ",num2)
fmt.Printf("channel len = %v\n cap = %v\n",len(intChan),cap(intChan))
```

**ç¼–è¯‘**

```shell
[root@mail ~]# go run chan.go 
intchan æœ¬èº«çš„å€¼ä¸º: 0xc0000aa000
intchan æœ¬èº«çš„åœ°å€ï¼š0xc0000a4018
channel len = 3
cap = 3
num2 =  10
channel len = 2
cap = 3
num2 =  211
channel len = 1
cap = 3
```

**ç®¡é“çš„æ•°æ®å¯ä»¥ç›´æ¥æ‰”æ‰ï¼Œæ²¡æœ‰æ¥æ”¶çš„å˜é‡**

```go
<- intChan    //ç›´æ¥æ‰”æ‰
```

---

##  [ğŸ–±ï¸ç‚¹å‡»è¿›å…¥chanåº•å±‚åˆ†æ](chanåº•å±‚åˆ†æ)

---



> å¦‚æœæœ‰ä¸€ä¸ªéœ€æ±‚ï¼Œå¸Œæœ›ç®¡é“æ—¢å¯ä»¥æ”¾ç»“æ„ä½“ï¼Œåˆå¯ä»¥æ”¾æŒ‡é’ˆï¼Œå³å¯ä»¥æ”¾å…¥ä»»ä½•ç±»å‹å˜é‡
>
> **æ­¤æ—¶æˆ‘ä»¬å¯ä»¥å®šä¹‰ä¸€ä¸ªç©ºæ¥å£ï¼Œç©ºæ¥å£å¯ä»¥æ¥æ”¶ä»»ä½•ç±»å‹çš„**

```go
var allChan chan interface{}       //ç©ºæ¥å£
allChan = make(chan inerface{},10)
```



## channelå…³é—­

**ä½¿ç”¨å†…ç½®å‡½æ•°closeå¯ä»¥å…³é—­channelï¼Œå…³é—­åï¼Œåªèƒ½è¯»å–æ•°æ®è€Œä¸èƒ½å†™å…¥æ•°æ®**

```go
package main
import(
	"fmt"
)
func main(){
	/*åˆ›å»ºä¸€ä¸ªå¯ä»¥å­˜æ”¾3ä¸ªintç±»å‹çš„ç®¡é“*/
    intChan := make(chan int ,3)
    intChan <- 100
    intChan <- 300
    close(intChan)               //closeå…³é—­ç®¡é“
    
    /*
    intChan -< 100
    ä¸å¯ä»¥å†å†™å…¥ä¼šæŠ¥é”™*/
    a := <-intChan
    //çœ‹ä¸€ä¸‹intchanæ˜¯ä¸€ç§ä»€ä¹ˆç±»å‹ï¼Œåœ°å€è¿˜æ˜¯æ•°å­—
    fmt.Println("a=",a)
}
```

```
a= 100
```





## channelçš„éå† 

**channelçš„éå†==åªèƒ½ä½¿ç”¨`for-range`éå†ï¼Œä¸å¯ä»¥ä½¿ç”¨æ™®é€šçš„forå¾ªç¯==,å› ä¸ºé•¿åº¦ä¼šå˜åŒ–**

**æƒ…å†µï¼š**

1. **éå†æ—¶ï¼Œchannelæ²¡æœ‰å…³é—­ï¼Œå‡ºç°deadlockçš„é”™è¯¯**
2. **éå†æ—¶ï¼Œchannelå·²ç»å…³é—­ï¼Œåˆ™ä¼šæ­£å¸¸éå†ï¼Œéå†å®Œæˆï¼Œå°±é€€å‡ºéå†**

```go
package main
import(
	"fmt"
)
func main(){
	/*åˆ›å»ºä¸€ä¸ªå¯ä»¥å­˜æ”¾100ä¸ªintç±»å‹çš„ç®¡é“,éå†*/
    intChan := make(chan int ,100)
    for i:=0;i<100;1++{
        intChan <- 100*i      	  //æ”¾å…¥ä¸€ç™¾ä¸ªæ•°æ®åˆ°ç®¡é“
    }
    close(intChan)                //closeå…³é—­ç®¡é“
    
    //ç®¡é“éå†
   /* for i:=0; i<len(intChan2);i++{
       ä¸èƒ½ä½¿ç”¨è¯¥æ–¹æ³•éå†ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ 
    }*/
    for v:=range intChan{
        fmt.Println("ç¬¬"+"æ•°=",v)
    }
}
```





## goroutine å’Œ channelç»“åˆ

```go
/*************************************************************************
    > File Name: jiehe.go
    > Author: smile
    > Mail: 3293172751nss@gmail.com 
    > Created Time: Sun 20 Mar 2022 02:09:34 PM CST
 ************************************************************************/
package main
import(
	"fmt"
    "time"
)

func writeData(intChan chan int){
   for i := 1;i<=50;i++{
    //æ”¾å…¥æ•°æ®
    intChan <- i*i
    fmt.Println("writeData",i)
    //å†™çš„æ—¶å€™ä¼‘çœ ä¸€ç§’é’Ÿ
       time.Sleep(time.Second)
   }
   close(intChan)
}
func readData(intChan chan int,exitChan chan bool){

    for{
        v,ok := <-intChan 
        if !ok{
            break
        }
        fmt.Println("è¯»å–åˆ°ä¸€ä¸ªÂ·æ•°æ®",v)
            //è¯»å–çš„æ—¶å€™ä¼‘çœ ä¸€ç§’é’Ÿ
       time.Sleep(time.Second)
        
    }
    //è¯»å–æ•°æ®åä»»åŠ¡å®Œæˆ
    exitChan <- true
    close(exitChan)
}
func main(){
    //åˆ›å»ºAä¸¤ä¸ªç®¡é“

    intChan := make(chan int,50)
    exitChan := make(chan bool,1)
    go writeData(intChan)
    go readData(intChan,exitChan)

    time.Sleep(time.Second * 10)
}

```

**ç¼–è¯‘**

```shell
[root@mail ~]# go run  jiehe.go 
writeData 1
è¯»å–åˆ°ä¸€ä¸ªÂ·æ•°æ® 1
writeData 2
è¯»å–åˆ°ä¸€ä¸ªÂ·æ•°æ® 4
writeData 3
è¯»å–åˆ°ä¸€ä¸ªÂ·æ•°æ® 9
writeData 4
è¯»å–åˆ°ä¸€ä¸ªÂ·æ•°æ® 16
writeData 5
è¯»å–åˆ°ä¸€ä¸ªÂ·æ•°æ® 25
writeData 6
è¯»å–åˆ°ä¸€ä¸ªÂ·æ•°æ® 36
writeData 7
è¯»å–åˆ°ä¸€ä¸ªÂ·æ•°æ® 49
writeData 8
è¯»å–åˆ°ä¸€ä¸ªÂ·æ•°æ® 64
^Csignal: interrupt
```

> å½“æˆ‘ä»¬makeçš„ç®¡é“å®¹é‡å¾ˆå°ï¼Œä½†æ˜¯å­˜å…¥çš„æ•°æ®å¾ˆå¤šï¼Œé‚£ä¹ˆæ­¤æ—¶ä¼šå‡ºç°è¯¸å¡

---

> æˆ‘ä»¬å›åˆ°å¼€å§‹çš„é‚£ä¸€ä¸ªé—®é¢˜ï¼Œä¸€ä¸ªéœ€æ±‚,ç»Ÿè®¡1~80000ä¸­æœ‰å“ªäº›ç´ æ•°
>
> æˆ‘ä»¬å½“æ—¶æƒ³åˆ°çš„æ–¹æ³•æ˜¯å°†ç»Ÿè®¡ç´ æ•°çš„ä»»åŠ¡åˆ†é…ç»™4ä¸ªCPUå»åšï¼ˆæˆ‘åªæœ‰4ä¸ª**å¹¶è¡Œ**ï¼Œç”¨8ä¸ª**å¹¶å‘**

```go
package main
import (
	"fmt"
	"time"
)

//å‘ intChanæ”¾å…¥ 1-80000ä¸ªæ•°
func putNum(intChan chan int) {

	for i := 1; i <= 800000; i++ {    
		intChan<- i
	}

	//å…³é—­intChan
	close(intChan)
}

// ä» intChanå–å‡ºæ•°æ®ï¼Œå¹¶åˆ¤æ–­æ˜¯å¦ä¸ºç´ æ•°,å¦‚æœæ˜¯ï¼Œå°±
// 	//æ”¾å…¥åˆ°primeChan
func primeNum(intChan chan int, primeChan chan int, exitChan chan bool) {

	//ä½¿ç”¨for å¾ªç¯
	// var num int
	var flag bool // 
	for {
		//time.Sleep(time.Millisecond * 10)
		num, ok := <-intChan //intChan å–ä¸åˆ°..
		
		if !ok { 
			break
		}
		flag = true //å‡è®¾æ˜¯ç´ æ•°
		//åˆ¤æ–­numæ˜¯ä¸æ˜¯ç´ æ•°
		for i := 2; i < num; i++ {
			if num % i == 0 {//è¯´æ˜è¯¥numä¸æ˜¯ç´ æ•°
				flag = false
				break
			}
		}

		if flag {
			//å°†è¿™ä¸ªæ•°å°±æ”¾å…¥åˆ°primeChan
			primeChan<- num
		}
	}

	fmt.Println("æœ‰ä¸€ä¸ªprimeNum åç¨‹å› ä¸ºå–ä¸åˆ°æ•°æ®ï¼Œé€€å‡º")
	//è¿™é‡Œæˆ‘ä»¬è¿˜ä¸èƒ½å…³é—­ primeChan
	//å‘ exitChan å†™å…¥true
	exitChan<- true	

}

func main() {

	intChan := make(chan int , 1000)
	primeChan := make(chan int, 20000)//æ”¾å…¥ç»“æœ
	//æ ‡è¯†é€€å‡ºçš„ç®¡é“
	exitChan := make(chan bool, 8) // 4ä¸ª



	start := time.Now().Unix()
	
	//å¼€å¯ä¸€ä¸ªåç¨‹ï¼Œå‘ intChanæ”¾å…¥ 1-80000ä¸ªæ•°
	go putNum(intChan)
	//å¼€å¯4ä¸ªåç¨‹ï¼Œä» intChanå–å‡ºæ•°æ®ï¼Œå¹¶åˆ¤æ–­æ˜¯å¦ä¸ºç´ æ•°,å¦‚æœæ˜¯ï¼Œå°±
	//æ”¾å…¥åˆ°primeChan
	for i := 0; i < 8; i++ {
		go primeNum(intChan, primeChan, exitChan)
	}

	//è¿™é‡Œæˆ‘ä»¬ä¸»çº¿ç¨‹ï¼Œè¿›è¡Œå¤„ç†
	//ç›´æ¥
	go func(){
		for i := 0; i < 8; i++ {
			<-exitChan
		}

		end := time.Now().Unix()
		fmt.Println("ä½¿ç”¨åç¨‹è€—æ—¶=", end - start)

		//å½“æˆ‘ä»¬ä»exitChan å–å‡ºäº†4ä¸ªç»“æœï¼Œå°±å¯ä»¥æ”¾å¿ƒçš„å…³é—­ prprimeChan
		close(primeChan)
	}()


	//éå†æˆ‘ä»¬çš„ primeChan ,æŠŠç»“æœå–å‡º
	for {
		_, ok := <-primeChan
		if !ok{
			break
		}
		//å°†ç»“æœè¾“å‡º
//	fmt.Printf("ç´ æ•°=%d\n", res)
	}

	fmt.Println("mainçº¿ç¨‹é€€å‡º")
}
```

**ç¼–è¯‘**

```shell
[root@mail ~]# ./sushu 
æœ‰ä¸€ä¸ªprimeNum åç¨‹å› ä¸ºå–ä¸åˆ°æ•°æ®ï¼Œé€€å‡º
æœ‰ä¸€ä¸ªprimeNum åç¨‹å› ä¸ºå–ä¸åˆ°æ•°æ®ï¼Œé€€å‡º
æœ‰ä¸€ä¸ªprimeNum åç¨‹å› ä¸ºå–ä¸åˆ°æ•°æ®ï¼Œé€€å‡º
æœ‰ä¸€ä¸ªprimeNum åç¨‹å› ä¸ºå–ä¸åˆ°æ•°æ®ï¼Œé€€å‡º
æœ‰ä¸€ä¸ªprimeNum åç¨‹å› ä¸ºå–ä¸åˆ°æ•°æ®ï¼Œé€€å‡º
æœ‰ä¸€ä¸ªprimeNum åç¨‹å› ä¸ºå–ä¸åˆ°æ•°æ®ï¼Œé€€å‡º
æœ‰ä¸€ä¸ªprimeNum åç¨‹å› ä¸ºå–ä¸åˆ°æ•°æ®ï¼Œé€€å‡º
æœ‰ä¸€ä¸ªprimeNum åç¨‹å› ä¸ºå–ä¸åˆ°æ•°æ®ï¼Œé€€å‡º
ä½¿ç”¨åç¨‹è€—æ—¶= 2
mainçº¿ç¨‹é€€å‡º
```



## channelä½¿ç”¨ç»†èŠ‚

**ç®¡é“å¯ä»¥å£°æ˜ä¸ºåªè¯»æˆ–è€…åªå†™ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œç®¡é“æ˜¯å³å¯è¯»ï¼Œä¹Ÿå¯ä»¥å†™å…¥**

```go
package main
import (
	"fmt"
	"time"
)

func main(){
    //é»˜è®¤å¯è¯»å¯å†™
    var chan0 chan<- int
    
    //åªå†™
    var chan1 chan <- int 
    chan1 = maker(chan int,3)   
    
    //åªè¯»
    var chan2 <- chan int
    num2 := < chan2     //åªè¯»
}
```

**ä½œç”¨èŒƒå›´ï¼š**

```go
func main(){
    ch := make(chan int,10)
    exitChan := make(chan sturct{},2)
    go send(ch,exitChan)       //åªå†™
    go recv(ch,exitChan)       //åªè¯»
}
```

> è€Œä¸”Goè¯­è¨€åœ¨åº•å±‚åšäº†ä¼˜åŒ–ï¼Œæ‰€ä»¥æ•ˆç‡æ›´é«˜ä¸€äº›

---

> åœ¨æˆ‘ä»¬å®é™…å¼€å‘ä¸­ï¼Œå¯èƒ½ä¸å¥½ç¡®å®šä»€ä¹ˆæ—¶å€™å…³é—­è¯¥ç®¡é“ï¼Œæ­¤æ—¶æˆ‘ä»¬å°±ä¸èƒ½ç”¨closeï¼Œå¯ä»¥ä½¿ç”¨selectè§£å†³æ–¹æ³•

```go
select{
	case v:= <-ç®¡é“
	....
	default:
	è¯­å¥
}
```

**æ¡ˆä¾‹**

```go
/*å‰é¢æœ‰ä¸¤ä¸ªç®¡é“*/
label          //æ ‡ç­¾ï¼Œé‡æ–°è¯»å–æ•°æ®
for{
    select{
        case v:= <-intChan :
            fmt.Prinf("ä»intChanç®¡é“ä¸­å–å‡ºæ•°æ®%d\n",v)
        case v:= <-stringChan :
            fmt.Prinf("ä»stringChanç®¡é“ä¸­å–å‡ºæ•°æ®%d\n",v)
        default:
            fmt.Prinf("éƒ½å–ä¸åˆ°äº†ï¼ŒåŠ å…¥ä¸šåŠ¡é€»è¾‘ï¼ŒåŠ å…¥æˆ–è€…")
        	breaK
        /*return : ä»£è¡¨è·³å‡ºè¿™ä¸ªå‡½æ•°*/
        //æˆ–è€…ä½¿ç”¨æ ‡ç­¾
        /* break label */
        }
}
```

