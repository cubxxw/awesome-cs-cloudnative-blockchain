+ [author](http://nsddd.top)

# ç¬¬20èŠ‚ æ–°ä¼šè®®æ”¹å˜basefs

<div><a href = '19.md' style='float:left'>â¬†ï¸ä¸Šä¸€èŠ‚ğŸ”—  </a><a href = '21.md' style='float: right'>  â¬‡ï¸ä¸‹ä¸€èŠ‚ğŸ”—</a></div>
<br>

> â¤ï¸ğŸ’•ğŸ’•è®°å½•[sealos](https://github.com/cubxxw/sealos)å¼€æºé¡¹ç›®çš„å­¦ä¹ è¿‡ç¨‹ã€‚[k8s,dockerå’Œäº‘åŸç”Ÿçš„å­¦ä¹ ](https://github.com/cubxxw/sealos)ã€‚Myblog:[http://nsddd.top](http://nsddd.top/)

---
[TOC]

## å¼€å§‹

+ add image spec definition [#1915](https://github.com/sealerio/sealer/pull/1915)
+ New design for basefs [#1909](https://github.com/sealerio/sealer/pull/1909)
+ sealer new doc [sealerio/sealer.cool#15](https://github.com/sealerio/sealer.cool/issues/15)
+ More detail about How to implement image policy for sealer using Kyverno [#1899](https://github.com/sealerio/sealer/issues/1899)
+ sealer CI e2e-test by using github action [#1633](https://github.com/sealerio/sealer/issues/1633)

---

**å…³äºbasefs çš„è®¾è®¡ï¼š**

+ [https://github.com/sealerio/basefs](https://github.com/sealerio/basefs)



## å…³äºrootfsçš„å®‰æ’

+ [https://github.com/sealerio/sealer/pull/1909](https://github.com/sealerio/sealer/pull/1909)



## æè¿°

ç­¾å­—äººï¼šhuaiyou [huaiyou.cyz@alibaba-inc.com](https://mail.google.com/mail/?view=cm&fs=1&tf=1&to=huaiyou.cyz@alibaba-inc.com)

ä¸ºäº†æ–¹ä¾¿åŸºç¡€é•œåƒåˆ¶ä½œè€…çš„ä½¿ç”¨ï¼Œæˆ‘ä»¬éœ€è¦å¯¹ sealer çš„ rootfs å®šä¹‰è¿›è¡Œè§„èŒƒã€‚

**æˆ‘ä¸»è¦åšäº†ä»¥ä¸‹è®¾è®¡ï¼š**

1. `bin` ç­‰å’Œ `plugins` çš„ç”¨é€”åŸºæœ¬ç›¸åŒï¼Œåªæ˜¯æ˜ç¡®äº†ä½¿ç”¨æ–¹æ³•ã€‚
2. é˜æ˜ Metadataã€README.md å’Œ imageList çš„ç”¨é€”ã€‚
3. æ–°å¢ yamls å’Œ charts ä¸¤ä¸ªç›®å½•ï¼Œä¸ºç”¨æˆ·æä¾›æ›´çµæ´»æ‰©å±•åŸºç¡€é•œåƒçš„èƒ½åŠ›ã€‚
4. æœ€åæ˜ç¡®äº†scriptsä¸‹ä¸åŒè„šæœ¬çš„ç”¨é€”ã€‚

ä¸ºäº†æ–¹ä¾¿åŸºç¡€é•œåƒåˆ¶ä½œè€…çš„ä½¿ç”¨ï¼Œæˆ‘ä»¬éœ€è¦æ ‡å‡†åŒ– sealer çš„ rootfs çš„å®šä¹‰ã€‚

æˆ‘ä¸»è¦åšäº†ä»¥ä¸‹è®¾è®¡ï¼š

1. `bin`ï¼Œ`etc`ï¼Œ`plugins` è¿™å‡ ä¸ªç›®å½•çš„ä½¿ç”¨åŸºæœ¬ä¸å˜ï¼Œåªæ˜¯æ˜ç¡®äº†ä½¿ç”¨æ–¹å¼ã€‚
2. æ˜ç¡®å®š `scripts` ä¸‹çš„ä¸åŒè„šæœ¬çš„ç”¨é€”ã€‚



## è®¾è®¡è§„èŒƒ

+ [https://github.com/sealerio/sealer/blob/ec9d2b561eaa20ff59bea28303669b3da0d7c4dd/docs/api/cloudrootfs.md](https://github.com/sealerio/sealer/blob/ec9d2b561eaa20ff59bea28303669b3da0d7c4dd/docs/api/cloudrootfs.md)



## cloud rootfs

cloud rootfs will package all the dependencies refers to the kubernetes cluster requirements

```go
.
â”œâ”€â”€ bin # binaries will be installed at all nodes' /usr/local/bin
â”‚   â”œâ”€â”€ conntrack
â”‚   â”œâ”€â”€ containerd-rootless-setuptool.sh
â”‚   â”œâ”€â”€ containerd-rootless.sh
â”‚   â”œâ”€â”€ crictl
â”‚   â”œâ”€â”€ kubeadm
â”‚   â”œâ”€â”€ kubectl
â”‚   â”œâ”€â”€ kubelet
â”‚   â”œâ”€â”€ nerdctl
â”‚   â”œâ”€â”€ kubelet-pre-start.sh
â”‚   â”œâ”€â”€ helm
â”‚   â””â”€â”€ seautil
â”œâ”€â”€ etc # configs will be put into all nodes' sealer-rootfs
â”‚   â”œâ”€â”€ 10-kubeadm.conf
â”‚   â”œâ”€â”€ daemon.json
â”‚   â”œâ”€â”€ docker.service
â”‚   â”œâ”€â”€ audit-policy.yml
â”‚   â”œâ”€â”€ kubeadm-config.yaml
â”‚   â”œâ”€â”€ kubeadm-config.yaml.tmpl # a.b.c.tmpl will be rendered using envs and rename to a.b.c
â”‚   â””â”€â”€ kubelet.service
â”œâ”€â”€ plugins # plugins can run on some hooks, such as pre-init-host, post-install, see more in the plugins documentation
â”‚   â””â”€â”€ disk_init_shell_plugin.yaml
â”œâ”€â”€ scripts # scripts can use all ClusterFile's env as Linux env variables
â”‚   â”œâ”€â”€ init-kube.sh # initialize kube* binaries on target hosts
â”‚   â”œâ”€â”€ clean-kube.sh # remove kube* binaries from target hosts
â”‚   â”œâ”€â”€ init-container-runtime.sh # initialize container runtime binaries on target hosts
â”‚   â”œâ”€â”€ clean-container-runtime.sh # remove container runtime binaries on target hosts
â”‚   â””â”€â”€ init-registry.sh # initialize registry on local registry's deploy-hosts
â””â”€â”€ applications # applications put here
â”‚   â”œâ”€â”€ redis
â”‚   â””â”€â”€ mysql
```

Using cloud rootfs to build a base cloudImage:

```bash
FROM scratch
COPY . .
sealer build -t kuberntes:v1.18.3 .
```



## Hooks

```dockerfile
FROM kubernetes:1.18.3
COPY preHook.sh /scripts/
```

preHook.sh will execute after init.sh before kubeadm init master0



## Registry

registry container name must be 'sealer-registry'







## END é“¾æ¥

<ul><li><div><a href = '19.md' style='float:left'>â¬†ï¸ä¸Šä¸€èŠ‚ğŸ”—  </a><a href = '21.md' style='float: right'>  ï¸ä¸‹ä¸€èŠ‚ğŸ”—</a></div></li></ul>

+ [â“‚ï¸å›åˆ°ç›®å½•ğŸ ](../README.md)

+ [**ğŸ«µå‚ä¸è´¡çŒ®ğŸ’â¤ï¸â€ğŸ”¥ğŸ’–**](https://nsddd.top/archives/contributors))

+ âœ´ï¸ç‰ˆæƒå£°æ˜ &copy; ï¼šæœ¬ä¹¦æ‰€æœ‰å†…å®¹éµå¾ª[CC-BY-SA 3.0åè®®ï¼ˆç½²å-ç›¸åŒæ–¹å¼å…±äº«ï¼‰&copy;](http://zh.wikipedia.org/wiki/Wikipedia:CC-by-sa-3.0åè®®æ–‡æœ¬) 
