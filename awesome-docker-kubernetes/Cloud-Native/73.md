+ [author](http://nsddd.top)

# ç¬¬73èŠ‚ ä¸€æ¬¡å¤§å‹çš„ review ç°åœºï¼šGeneric event mechanism

<div><a href = '72.md' style='float:left'>â¬†ï¸ä¸Šä¸€èŠ‚ğŸ”—  </a><a href = '74.md' style='float: right'>  â¬‡ï¸ä¸‹ä¸€èŠ‚ğŸ”—</a></div>
<br>

> â¤ï¸ğŸ’•ğŸ’•è®°å½•[sealos](https://github.com/cubxxw/sealos)å¼€æºé¡¹ç›®çš„å­¦ä¹ è¿‡ç¨‹ã€‚[k8s,dockerå’Œäº‘åŸç”Ÿçš„å­¦ä¹ ](https://github.com/cubxxw/sealos)ã€‚Myblog:[http://nsddd.top](http://nsddd.top/)

---
[TOC]

## why

æœ€è¿‘ç½‘æ˜“ æ£®å“¥ èŠ±äº†ä¸€ä¸ªæœˆå¤šçš„æ—¶é—´ç»ˆäºæŠŠ Generic event mechanism è®¾è®¡å‡ºæ¥äº†ï¼Œæˆ‘èµ¶ç´§å» review äº†ä¸€ä¸‹è®¾è®¡æ–¹æ¡ˆå’Œä»£ç ï¼Œå¸Œæœ›ä»ä¸­å­¦ä¹ åˆ°è®¾è®¡ç²¾é«“ã€‚

+ issueï¼šhttps://github.com/horizoncd/horizon/issues/147
+ Google docsï¼šhttps://docs.google.com/document/d/1kE_BMVr4sYucQiSOT8LdEObAsoOtkhL5TL0NhvsML4I/edit?usp=sharing
+ PRï¼šhttps://github.com/horizoncd/horizon/pull/155



## è®¾è®¡æ€è·¯

**æ–‡æ¡£æ€è·¯ï¼š**

+ Horizonå‘å¸ƒä¸‹ä¸€æ‰¹å’Œå‘å¸ƒå®Œæˆæ—¶éœ€è¦å‘é€é€šçŸ¥ç»™ç”¨æˆ·
+ å¤–éƒ¨ç”¨æˆ·ä¹Ÿéœ€è¦æ›´å¤šçš„äº‹ä»¶



**éœ€æ±‚åˆ†æ:**

1. ç”¨æˆ·ä½¿ç”¨è‡ªåŠ¨å‘å¸ƒåŠŸèƒ½ï¼Œè‡ªåŠ¨å‘å¸ƒä¸‹ä¸€æ‰¹å’Œå‘å¸ƒå®Œæˆæˆ–è€…å¤±è´¥æ—¶ï¼Œéœ€è¦å‘é€é€šçŸ¥ç»™å‘å¸ƒçš„è§¦å‘è€…ã€‚
2. å¤–éƒ¨éœ€è¦Horizonæä¾›æ›´å¤šçš„Webhookï¼Œæ¯”å¦‚ä¸Šä¸‹çº¿ï¼Œé‡å¯ç­‰äº‹ä»¶



**äº‹ä»¶åˆ†æ:**

### Rollout

å½“rolloutså‘å¸ƒä¸‹ä¸€æ‰¹æ—¶ï¼Œå‘é€SetStepIndexäº‹ä»¶

| 4h39m | Normal | SetStepIndex | rollout/bad2good-setweight-onlycheck-newrs | Set Step Index to 1 |
| ----- | ------ | ------------ | ------------------------------------------ | ------------------- |
|       |        |              |                                            |                     |

1. å½“rolloutså‘å¸ƒå®Œæˆåï¼Œå°†å‘é€SettingStableRSäº‹ä»¶

| 4h39m | Normal | SettingStableRS | rollout/bad2good-setweight-onlycheck-newrs | Completed all steps |
| ----- | ------ | --------------- | ------------------------------------------ | ------------------- |
|       |        |                 |                                            |                     |

â€‹                    

### Argo Application

å‘å¸ƒæˆåŠŸæ—¶ï¼ŒçŠ¶æ€ç”±Progressingè½¬å˜ä¸ºHealthy

| 17h  | Normal | ResourceUpdated | application/horizon-cs-4-regression | Updated health status: Progressing -> Healthy |
| ---- | ------ | --------------- | ----------------------------------- | --------------------------------------------- |
|      |        |                 |                                     |                                               |

â€‹      

å‘å¸ƒå¤±è´¥æ—¶ï¼ŒçŠ¶æ€ç”±Progressingå˜ä¸ºDegraded

| 18h  | Normal | ResourceUpdated | application/horizon-cs-4-regression | Updated health status: Progressing -> Degraded |
| ---- | ------ | --------------- | ----------------------------------- | ---------------------------------------------- |
|      |        |                 |                                     |                                                |

â€‹     

å‘å¸ƒä¸‹ä¸€æ‰¹æ—¶ï¼ŒçŠ¶æ€ç”±Suspendedè½¬å˜ä¸ºProgressing

| 15h  | Normal | ResourceUpdated | application/for-argocd-dfldsflsj | Updated health status: Suspended -> Progressing |
| ---- | ------ | --------------- | -------------------------------- | ----------------------------------------------- |
|      |        |                 |                                  |                                                 |



**æ•´ä½“è®¾è®¡:**

1. Horizonä¸­æ·»åŠ ç›‘å¬Eventçš„é€»è¾‘ï¼Œç›‘å¬é…ç½®èµ„æºçš„Eventï¼ŒHorizonåº”è¯¥ç›‘å¬regionè¡¨ä¸­æ‰€æœ‰å¯ç”¨çš„é›†ç¾¤
2. å°†ç›‘å¬èµ„æºäº§ç”Ÿçš„Eventå†™å…¥æ•°æ®åº“ä¸­
3. Webhook jobå–å‡ºeventï¼Œå‘é€ç›¸åº”çš„Webhook
4. å¼€å‘`ReleaseAdapter`ç»„ä»¶ï¼Œç›‘å¬webhookï¼Œå¹¶å‘é€é€šçŸ¥ç»™ç›¸å…³ç”¨æˆ·

| Event                   | Description                                                  | Status    |
| ----------------------- | ------------------------------------------------------------ | --------- |
| Generic event mechanism | Horizon listens to events on Kubernetes and supports sending related events through Webhooks | Designing |



**PR æ€è·¯ï¼š**

**å¤§è‡´åšäº†ä¸‰ä»¶äº‹:**

+ æ·»åŠ  k8s  event package ä»¥ ä¾¦å¬ k8s äº‹ä»¶å¹¶å°†å…¶å†™å…¥æ•°æ®åº“ã€‚
+ ä½¿ç”¨ informer åˆ—å‡ºèµ„æºæ ‘ä¸­çš„æ‰€æœ‰ podï¼Œå¤§å¤§å‡è½»äº† kube API æœåŠ¡å™¨çš„å‹åŠ›ã€‚
+ æ·»åŠ æ¸…ç†ä½œä¸šä»¥å®šæœŸæ¸…ç† Webhook æ—¥å¿—å’Œäº‹ä»¶ã€‚



## END é“¾æ¥
<ul><li><div><a href = '72.md' style='float:left'>â¬†ï¸ä¸Šä¸€èŠ‚ğŸ”—  </a><a href = '74.md' style='float: right'>  ï¸ä¸‹ä¸€èŠ‚ğŸ”—</a></div></li></ul>

+ [â“‚ï¸å›åˆ°ç›®å½•ğŸ ](../README.md)

+ [**ğŸ«µå‚ä¸è´¡çŒ®ğŸ’â¤ï¸â€ğŸ”¥ğŸ’–**](https://nsddd.top/archives/contributors))

+ âœ´ï¸ç‰ˆæƒå£°æ˜ &copy; ï¼šæœ¬ä¹¦æ‰€æœ‰å†…å®¹éµå¾ª[CC-BY-SA 3.0åè®®ï¼ˆç½²å-ç›¸åŒæ–¹å¼å…±äº«ï¼‰&copy;](http://zh.wikipedia.org/wiki/Wikipedia:CC-by-sa-3.0åè®®æ–‡æœ¬) 
