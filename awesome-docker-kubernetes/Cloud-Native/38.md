+ [author](http://nsddd.top)

# ç¬¬38èŠ‚ RFC: Sealer é—®é¢˜ææ¡ˆ(ä¸­è‹±æ–‡)

<div><a href = '37.md' style='float:left'>â¬†ï¸ä¸Šä¸€èŠ‚ğŸ”—  </a><a href = '39.md' style='float: right'>  â¬‡ï¸ä¸‹ä¸€èŠ‚ğŸ”—</a></div>
<br>

> â¤ï¸ğŸ’•ğŸ’•è®°å½•[sealos](https://github.com/cubxxw/sealos)å¼€æºé¡¹ç›®çš„å­¦ä¹ è¿‡ç¨‹ã€‚[k8s,dockerå’Œäº‘åŸç”Ÿçš„å­¦ä¹ ](https://github.com/cubxxw/sealos)ã€‚Myblog:[http://nsddd.top](http://nsddd.top/)

---
[TOC]

## é—®é¢˜

ç›®å‰ï¼ŒSealer ç¼ºä¹æ¸…æ™°å’Œä¸€è‡´çš„ç»“æ„ï¼Œè¿™è®©å¼€å‘äººå‘˜éš¾ä»¥è¿›è¡Œå·¥ä½œå’Œæ”¹è¿›ã€‚æ­¤å¤–ï¼Œéœ€è¦ä¼˜åŒ–å’Œè‡ªåŠ¨åŒ– GitHub actions æµç¨‹ä»¥æé«˜æ•ˆç‡ã€‚åŒæ ·è¿™ä¸ªè¿‡ç¨‹å¯¹äºæˆ‘æ¥è¯´è¿™ä¸ªè¿‡ç¨‹æœ‰åŠ©äºæ›´åŠ ç†Ÿæ‚‰ sealer çš„è¿è¡Œæµç¨‹ä»¥åŠç³»ç»Ÿè®¾è®¡ã€‚

ä¸‹é¢çš„å…ˆåå¾ªåºç¬¦åˆè®¾è®¡çš„ä¼˜å…ˆçº§ğŸ¯

## RFC:

### æ”¹è¿› Makefile ç»“æ„

æˆ‘ä»¬æå‡ºä»¥ä¸‹æŒ‰ä¼˜å…ˆçº§æ’åºçš„ Makefile ç»“æ„æ”¹è¿›ï¼š

1. å®ç°å¯é€‰çš„ç‰ˆæƒä¿¡æ¯æ£€æŸ¥ï¼ˆå¦‚æœå°šæœªé€šè¿‡ actions å®ç°ï¼‰ã€‚
2. è‡ªåŠ¨è§£ææ‰€æœ‰ makefile é€‰é¡¹çš„å¸®åŠ©ä¿¡æ¯ã€‚
3. ç¡®ä¿ä¸€è‡´çš„è¡Œä¸ºï¼Œä¾‹å¦‚å¼ºåˆ¶æ‰§è¡Œæäº¤è§„èŒƒã€‚
4. æ·»åŠ å¿…è¦çš„é€‰é¡¹ï¼Œä¾‹å¦‚å•å…ƒæµ‹è¯•è¦†ç›–ç‡ï¼ˆæˆ‘ä»¬å¾ˆåœ¨æ„ï¼Œä½†ç›®å‰æœªæä¾›ï¼‰ã€‚
5. æ·»åŠ è°ƒè¯•ä¿¡æ¯å’Œé€‰æ‹©æ€§è°ƒè¯•ã€‚æ­¤å¤–ï¼Œè€ƒè™‘æä¾›é€šè¿‡ `sealer` æˆ– `seautil` é€‰æ‹©æ€§ç”ŸæˆäºŒè¿›åˆ¶çš„é€‰é¡¹ï¼Œä»¥æé«˜ç¼–è¯‘é€Ÿåº¦ã€‚
6. ç®€åŒ– `/Makefile` æ¨¡å—ä»¥æé«˜å¯è¯»æ€§ã€‚

### ä¼˜åŒ– GitHub Actions æµç¨‹

å°†è¿›è¡Œä»¥ä¸‹æ›´æ”¹ä»¥ä¼˜åŒ– GitHub Actions æµç¨‹ï¼š

1. æä¾›å’Œè‡ªåŠ¨åŒ– CHANGELOG ç®¡ç†ã€‚
2. ä¸ºç›®å‰æœªæ¶µç›–çš„å¾®æ“ä½œå’ŒåŠŸèƒ½æ·»åŠ è‡ªåŠ¨åŒ–æ“ä½œã€‚

### ç›®å½•è®¾è®¡

**scriptç›®å½• :** æˆ‘ä»¬å»ºè®®å°† `/hack` ç›®å½•è¿ç§»è‡³ `/script` ç›®å½•ï¼Œå¹¶å°† Makefile éƒ¨åˆ†åº•å±‚å®ç°è¿ç§»è‡³ `script/make-rules` ç›®å½•ã€‚

**CMD å‘½ä»¤ï¼š**sealer çš„ å‘½ä»¤è¶Šæ¥è¶Šå¤šï¼Œå°¤å…¶æ˜¯ alpha æ‰©å±•ï¼Œæè®®æˆ–è®¸å¯ä»¥å°† cmd çš„æ ¸å¿ƒéƒ¨åˆ†æå–åˆ° `/internal` ç›®å½•ä¸­ï¼ˆåªå…è®¸å†…éƒ¨è®¿é—®ï¼‰å’Œ pkgç›®å½•ä¸‹ï¼ˆå…è®¸è°ƒç”¨ï¼‰ ï¼Œå°† `/common` ç›®å½•è¿ç§»åˆ° `/pkg` ç›®å½•ä¸‹

**ç‰ˆæœ¬ä¿¡æ¯ï¼š**æˆ‘å»ºè®®ä¸º Sealer ç³»ç»Ÿä¿¡æ¯ï¼ˆgit ä¿¡æ¯ã€Go ä¿¡æ¯ç­‰ï¼‰å’Œ pkg è¿è¡Œæ—¶ç‰ˆæœ¬åˆ›å»ºå•ç‹¬çš„ç‰ˆæœ¬ã€‚åº”ç”¨ç¨‹åºæœ¬èº« info çš„version ï¼Œä¸€ä¸ªæ˜¯ pkg çš„ runtime çš„ version ï¼Œè¿™ä¸¤ä¸ª version å­˜æ”¾åˆ°å“ªä¸ªç›®å½•æœ€è§„èŒƒï¼Œæ˜¯éƒ½æ”¾åœ¨ `/pkg/version`ä¸‹é¢è¿˜æ˜¯ æ”¾åœ¨ `/utils/version`ä¸‹é¢ï¼Œè¿˜æ˜¯åˆ†å¼€æ”¾ï¼Ÿ æè®®ï¼šå°†åº”ç”¨ç¨‹åº info è°ƒæ•´åˆ° `/pkg/version` å¯ä¾›å¤–éƒ¨è°ƒç”¨ï¼Œå¯¹ utils/version æ”¾å…¥åˆ° runtime k8s çš„æ¨¡å—ä¸­ï¼Œå¹¶ä¸”æŠ½è±¡å‡ºæ¥å£ä¾›å¯ä¾›å¤–éƒ¨è°ƒç”¨ã€‚

### æ”¹è¿›ç‰ˆæœ¬æ§åˆ¶

æˆ‘å»ºè®®ä¸º Sealer ç³»ç»Ÿä¿¡æ¯ï¼ˆgit ä¿¡æ¯ã€Go ä¿¡æ¯ç­‰ï¼‰å’Œ pkg è¿è¡Œæ—¶ç‰ˆæœ¬åˆ›å»ºå•ç‹¬çš„ç‰ˆæœ¬ã€‚æˆ‘å»ºè®®å°† Sealer çš„å‘½ä»¤æ ¸å¿ƒï¼ˆç‰¹åˆ«æ˜¯ alpha æ‰©å±•ï¼‰ç§»åŠ¨åˆ° `/internal` ç›®å½•ï¼ˆä»…å†…éƒ¨è®¿é—®ï¼‰å’Œ `/pkg` ç›®å½•ï¼ˆå…è®¸è°ƒç”¨ï¼‰ã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬å»ºè®®è¡¥å……ç›¸å…³æ–‡æ¡£ï¼Œä¾‹å¦‚ç‰ˆæœ¬ API å’Œ Makefile æŒ‡å—ã€‚

### ç‰ˆæœ¬æ¥å£è®¾è®¡æ–¹æ¡ˆ

æˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ªè¿è¡Œæ—¶å±‚ä»¥æŠ½è±¡ç‰ˆæœ¬å±‚æ¥å£å¹¶è®¾è®¡æ¥å£ã€‚æˆ‘ä»¬å°†æå– k3sã€k0s å’Œ Kubernetes çš„ç‰ˆæœ¬å¹¶ä»ä¸Šé¢çš„ç‰ˆæœ¬è°ƒç”¨å®ƒä»¬ï¼Œä»–ä»¬ä¸éœ€è¦å…³å¿ƒè°ƒç”¨çš„æ˜¯å“ªä¸ª cluster runtime çš„ version

## Other RFC

RFCï¼šè¡¥å…… k3s çš„å®ç°ã€‚

RFCï¼šSealer ç›®å‰ç¼ºä¹æ§åˆ¶ APP è°ƒç”¨çš„èƒ½åŠ›ï¼ŒPack å¯ä»¥å¸®åŠ©è§£å†³è¿™ä¸ªé—®é¢˜ã€‚æˆ‘å°† `buildpacks` çš„ç ”ç©¶å¹¶å‚è€ƒ [buildpacks.io](http://buildpacks.io/) çš„å®˜æ–¹æ–‡æ¡£ã€‚

> æˆ‘ä»¬å°†ä¸º Pack æä¾›æŠ½è±¡ä¸Šå±‚ Makefile çš„æ„å»ºèƒ½åŠ›ï¼Œä½¿æ„å»ºé•œåƒæ›´åŠ å®¹æ˜“ã€‚å¦‚æœ Sealer å¯ä»¥æ‰“åŒ…å’Œåˆ†å‘é›†ç¾¤ï¼Œå®ƒå°†å…·æœ‰éå¸¸å¼ºå¤§çš„èƒ½åŠ›ã€‚

æˆ‘ä»¬è®¤ä¸ºè¿™äº›æ”¹å˜å°†ä¸º Sealer åˆ›å»ºæ›´æœ‰ç»„ç»‡å’Œé«˜æ•ˆçš„ç»“æ„ï¼Œå¹¶æ”¹è¿›å…¶åŠŸèƒ½ã€‚é€šè¿‡å®ç°è¿™äº›æ”¹å˜ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ Sealer æˆä¸ºä¸€ä¸ªæ›´åŠ ç”¨æˆ·å‹å¥½å’Œé«˜æ•ˆçš„å¼€å‘å·¥å…·ã€‚

## Tasks

| ç±»å‹           | æ”¹è¿›                                                         | é—®é¢˜ | PR   | çŠ¶æ€ | ä¼˜å…ˆçº§ |
| -------------- | ------------------------------------------------------------ | ---- | ---- | ---- | ------ |
| Makefile       | å¯é€‰çš„ç‰ˆæƒä¿¡æ¯æ£€æŸ¥ã€è‡ªåŠ¨è§£ææ‰€æœ‰ makefile é€‰é¡¹çš„å¸®åŠ©ä¿¡æ¯ã€ä¿æŒä¸€è‡´çš„è¡Œä¸ºã€æ·»åŠ å¿…è¦çš„é€‰é¡¹ã€æ·»åŠ è°ƒè¯•ä¿¡æ¯å’Œé€‰æ‹©æ€§è°ƒè¯•ã€ç®€åŒ– /Makefile æ¨¡å—ä»¥æé«˜å¯è¯»æ€§ |      |      | âœ…    | 1      |
| ç›®å½•è®¾è®¡       | å°† /hack ç›®å½•è¿ç§»è‡³ /script ç›®å½•ï¼Œå¹¶å°† Makefile éƒ¨åˆ†åº•å±‚å®ç°è¿ç§»è‡³ script/make-rules ç›®å½•ã€å°† cmd çš„æ ¸å¿ƒéƒ¨åˆ†æå–åˆ° /internal ç›®å½•ä¸­å’Œ /pkg ç›®å½•ä¸‹ã€å°† /common ç›®å½•è¿ç§»åˆ° /pkg ç›®å½•ä¸‹ã€ä¸º Sealer ç³»ç»Ÿä¿¡æ¯å’Œ pkg è¿è¡Œæ—¶ç‰ˆæœ¬åˆ›å»ºå•ç‹¬çš„ç‰ˆæœ¬ã€å°†åº”ç”¨ç¨‹åº info è°ƒæ•´åˆ° /pkg/version å¯ä¾›å¤–éƒ¨è°ƒç”¨ã€å¯¹ utils/version æ”¾å…¥åˆ° runtime k8s çš„æ¨¡å—ä¸­ï¼Œå¹¶ä¸”æŠ½è±¡å‡ºæ¥å£ä¾›å¯ä¾›å¤–éƒ¨è°ƒç”¨ |      |      | âŒ    | 2      |
| GitHub Actions | æä¾›å’Œè‡ªåŠ¨åŒ– CHANGELOG ç®¡ç†ã€ä¸ºç›®å‰æœªæ¶µç›–çš„å¾®æ“ä½œå’ŒåŠŸèƒ½æ·»åŠ è‡ªåŠ¨åŒ–æ“ä½œ |      |      | âŒ    | 3      |
| ç‰ˆæœ¬æ§åˆ¶       | ä¸º Sealer ç³»ç»Ÿä¿¡æ¯å’Œ pkg è¿è¡Œæ—¶ç‰ˆæœ¬åˆ›å»ºå•ç‹¬çš„ç‰ˆæœ¬ã€å°† Sealer çš„å‘½ä»¤æ ¸å¿ƒï¼ˆç‰¹åˆ«æ˜¯ alpha æ‰©å±•ï¼‰ç§»åŠ¨åˆ° /internal ç›®å½•ï¼ˆä»…å†…éƒ¨è®¿é—®ï¼‰å’Œ /pkg ç›®å½•ï¼ˆå…è®¸è°ƒç”¨ï¼‰ã€è¡¥å……ç›¸å…³æ–‡æ¡£ï¼Œä¾‹å¦‚ç‰ˆæœ¬ API å’Œ Makefile æŒ‡å— |      |      | âŒ    | 4      |
| æ¥å£è®¾è®¡æ–¹æ¡ˆ   | åˆ›å»ºä¸€ä¸ªè¿è¡Œæ—¶å±‚ä»¥æŠ½è±¡ç‰ˆæœ¬å±‚æ¥å£å¹¶è®¾è®¡æ¥å£ï¼Œæå– k3sã€k0s å’Œ Kubernetes çš„ç‰ˆæœ¬å¹¶ä»ä¸Šé¢çš„ç‰ˆæœ¬è°ƒç”¨å®ƒä»¬ |      |      | âŒ    | 5      |
| RFC            | è¡¥å…… k3s çš„å®ç°                                              |      |      | âŒ    | 6      |
| RFC            | Sealer ç›®å‰ç¼ºä¹æ§åˆ¶ APP è°ƒç”¨çš„èƒ½åŠ›ï¼ŒPack å¯ä»¥å¸®åŠ©è§£å†³è¿™ä¸ªé—®é¢˜ã€‚æˆ‘å°† buildpacks çš„ç ”ç©¶å¹¶å‚è€ƒ http://buildpacks.io/ çš„å®˜æ–¹æ–‡æ¡£ |      |      | âŒ    | 7      |





# RFC: Sealer Proposal

## Problem

Currently, Sealer lacks a clear and consistent structure, making it difficult for developers to work with and improve. In addition, the GitHub actions workflow needs to be optimized and automated for increased efficiency. This process will help me become more familiar with the Sealer runtime and system design.

The following order of priority is based on our design goals ğŸ¯

## RFC:

### Improve Makefile Structure

+ [ ] Improve Makefile structure

We propose the following Makefile structure improvements, sorted by priority:

1. Implement optional copyright check (if not already implemented by actions).
2. Automatically parse help information for all makefile options.
3. Ensure consistent behavior, such as enforcing commit guidelines.
4. Add necessary options, such as unit test coverage (which we care about but currently do not provide).
5. Add debug information and selective debugging. Also, consider providing options to selectively generate binaries via `sealer` or `seautil` to improve compile speed.
6. Simplify the `/Makefile` module for readability.

### Optimize GitHub Actions Workflow

+ [ ] Optimize directory structure

The following changes will be made to optimize the GitHub Actions workflow:

1. Provide and automate CHANGELOG management.
2. Add automation for micro-operations and functionality not currently covered.

### Directory Design

+ [ ] Optimize actions workflow

**Script Directory:** We recommend migrating the `/hack` directory to the `/script` directory and moving the Makefile portion of the backend implementation to the `script/make-rules` directory.

**CMD Commands:** Sealer's commands are increasing in number, especially with alpha extensions. We propose extracting the core of the cmd to the `/internal` directory (only internally accessible) and `/pkg` directory (allowing for calls). We recommend moving the `/common` directory to the `/pkg` directory.

**Version Information:** We propose creating separate versions for Sealer system information (git information, Go information, etc.) and pkg runtime. Which directory should the two versions be stored in `/pkg/version`, `/utils/version`, or separately? We suggest adjusting the application info to `/pkg/version` for external access and placing utils/version into the runtime k8s module, abstracting an interface for external access.

### Improve Version Control

We propose creating separate versions for Sealer system information (git information, Go information, etc.) and pkg runtime. We suggest moving the core of Sealer's commands (especially alpha extensions) to the `/internal` directory (internal access only) and `/pkg` directory (allowing for calls). Additionally, we propose supplementing relevant documentation, such as version API and Makefile guidelines.

### Version Interface Design Scheme

We will create a runtime layer to abstract the version layer interface and design the interface. We will extract the versions of k3s, k0s, and Kubernetes and call them from the above versions. They do not need to care which cluster runtime version is being called.

## Other RFC

RFC: Supplement k3s implementation.

RFC: Sealer currently lacks the ability to control APP calls, and Pack can help solve this problem. I will research `buildpacks` and refer to the official documentation of [buildpacks.io](http://buildpacks.io/).

> We will provide Pack with the ability to build the upper-level Makefile abstractly, making it easier to build images. If Sealer can package and distribute clusters, it will have a very powerful ability.
>
> We believe that these changes will create a more organized and efficient structure for Sealer and improve its functionality. By implementing these changes, we can make Sealer a more user-friendly and efficient development tool.

## Tasks

| Type                            | Improvement                                                  | **Issues** | PR   | Status | Priority |
| ------------------------------- | ------------------------------------------------------------ | ---------- | ---- | ------ | -------- |
| Makefile                        | Improve Makefile structure                                   |            |      | âœ…      | ğŸ¥‡        |
| Directory Design                | Optimize directory structure                                 |            |      | âŒ      | ğŸ¥ˆ        |
| GitHub Actions                  | Optimize actions workflow                                    |            |      | âŒ      | ğŸ¥‰        |
| Version Control                 | Separate versions for Sealer system and pkg runtime, move core commands to /internal and /pkg directories, supplement documentation |            |      | âŒ      | 4        |
| Version Interface Design Scheme | Create runtime layer to abstract version interface, extract versions of k3s, k0s, and Kubernetes |            |      | âŒ      | 5        |
| RFC                             | Supplement k3s implementation                                |            |      | âŒ      | 6        |
| RFC                             | Add control for APP calls using Pack, research buildpacks    |            |      | âŒ      | 7        |





## END é“¾æ¥
<ul><li><div><a href = '37.md' style='float:left'>â¬†ï¸ä¸Šä¸€èŠ‚ğŸ”—  </a><a href = '39.md' style='float: right'>  ï¸ä¸‹ä¸€èŠ‚ğŸ”—</a></div></li></ul>

+ [â“‚ï¸å›åˆ°ç›®å½•ğŸ ](../README.md)

+ [**ğŸ«µå‚ä¸è´¡çŒ®ğŸ’â¤ï¸â€ğŸ”¥ğŸ’–**](https://nsddd.top/archives/contributors))

+ âœ´ï¸ç‰ˆæƒå£°æ˜ &copy; ï¼šæœ¬ä¹¦æ‰€æœ‰å†…å®¹éµå¾ª[CC-BY-SA 3.0åè®®ï¼ˆç½²å-ç›¸åŒæ–¹å¼å…±äº«ï¼‰&copy;](http://zh.wikipedia.org/wiki/Wikipedia:CC-by-sa-3.0åè®®æ–‡æœ¬) 
