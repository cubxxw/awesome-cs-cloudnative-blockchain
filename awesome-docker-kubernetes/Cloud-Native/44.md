+ [author](http://nsddd.top)

# ç¬¬44èŠ‚ OpenIM first meeting source code

<div><a href = '43.md' style='float:left'>â¬†ï¸ä¸Šä¸€èŠ‚ğŸ”—  </a><a href = '45.md' style='float: right'>  â¬‡ï¸ä¸‹ä¸€èŠ‚ğŸ”—</a></div>
<br>

> â¤ï¸ğŸ’•ğŸ’•è®°å½•[sealos](https://github.com/cubxxw/sealos)å¼€æºé¡¹ç›®çš„å­¦ä¹ è¿‡ç¨‹ã€‚[k8s,dockerå’Œäº‘åŸç”Ÿçš„å­¦ä¹ ](https://github.com/cubxxw/sealos)ã€‚Myblog:[http://nsddd.top](http://nsddd.top/)

---
[TOC]

## ç›®å½•ç»“æ„

```go
â¯ tree Open-IM-SDK-Core -L 2
Open-IM-SDK-Core
â”œâ”€â”€ LICENSE
â”œâ”€â”€ Makefile
â”œâ”€â”€ README.md
â”œâ”€â”€ go.mod
â”œâ”€â”€ go.sum
â”œâ”€â”€ internal
â”‚   â”œâ”€â”€ business
â”‚   â”œâ”€â”€ cache
â”‚   â”œâ”€â”€ common
â”‚   â”œâ”€â”€ conversation_msg
â”‚   â”œâ”€â”€ file
â”‚   â”œâ”€â”€ friend
â”‚   â”œâ”€â”€ full
â”‚   â”œâ”€â”€ group
â”‚   â”œâ”€â”€ heartbeart
â”‚   â”œâ”€â”€ interaction
â”‚   â”œâ”€â”€ login
â”‚   â”œâ”€â”€ obj_storage
â”‚   â”œâ”€â”€ signaling
â”‚   â”œâ”€â”€ super_group
â”‚   â”œâ”€â”€ user
â”‚   â”œâ”€â”€ util
â”‚   â””â”€â”€ work_moments
â”œâ”€â”€ main
â”‚   â”œâ”€â”€ gordon_main.go
â”‚   â”œâ”€â”€ main.go
â”‚   â”œâ”€â”€ online_open_im.go
â”‚   â”œâ”€â”€ press_open_im.go
â”‚   â”œâ”€â”€ reliability_open_im.go
â”‚   â””â”€â”€ sk_main.go
â”œâ”€â”€ open_im_sdk
â”‚   â”œâ”€â”€ conversation_msg.go
â”‚   â”œâ”€â”€ friend.go
â”‚   â”œâ”€â”€ group.go
â”‚   â”œâ”€â”€ init_login.go
â”‚   â”œâ”€â”€ listener.go
â”‚   â”œâ”€â”€ signaling.go
â”‚   â”œâ”€â”€ signaling_listener.go
â”‚   â”œâ”€â”€ third.go
â”‚   â”œâ”€â”€ user.go
â”‚   â”œâ”€â”€ userRelated.go
â”‚   â”œâ”€â”€ util.go
â”‚   â””â”€â”€ workmoments.go
â”œâ”€â”€ open_im_sdk_callback
â”‚   â”œâ”€â”€ callback.go
â”‚   â”œâ”€â”€ for_service.go
â”‚   â””â”€â”€ signaling_callback.go
â”œâ”€â”€ pkg
â”‚   â”œâ”€â”€ common
â”‚   â”œâ”€â”€ constant
â”‚   â”œâ”€â”€ db
â”‚   â”œâ”€â”€ log
â”‚   â”œâ”€â”€ network
â”‚   â”œâ”€â”€ sdk_params_callback
â”‚   â”œâ”€â”€ server_api_params
â”‚   â”œâ”€â”€ syncer
â”‚   â””â”€â”€ utils
â”œâ”€â”€ sdk_struct
â”‚   â””â”€â”€ sdk_struct.go
â”œâ”€â”€ single_test
â”‚   â”œâ”€â”€ msg_delay_open_im.go
â”‚   â”œâ”€â”€ online_open_im.go
â”‚   â””â”€â”€ press_open_im.go
â”œâ”€â”€ test
â”‚   â”œâ”€â”€ Makefile
â”‚   â”œâ”€â”€ account.go
â”‚   â”œâ”€â”€ config.go
â”‚   â”œâ”€â”€ login.go
â”‚   â”œâ”€â”€ online.go
â”‚   â”œâ”€â”€ reliability.go
â”‚   â”œâ”€â”€ sendMessage.go
â”‚   â”œâ”€â”€ t_conversation_msg.go
â”‚   â”œâ”€â”€ t_friend_sdk.go
â”‚   â”œâ”€â”€ t_group_sdk.go
â”‚   â”œâ”€â”€ t_signaling.go
â”‚   â”œâ”€â”€ work_group_create.go
â”‚   â””â”€â”€ work_moments.go
â”œâ”€â”€ testv2
â”‚   â”œâ”€â”€ callback.go
â”‚   â”œâ”€â”€ config.go
â”‚   â”œâ”€â”€ conversation_test.go
â”‚   â”œâ”€â”€ create_msg_test.go
â”‚   â”œâ”€â”€ file_test.go
â”‚   â”œâ”€â”€ friend_test.go
â”‚   â”œâ”€â”€ group_test.go
â”‚   â”œâ”€â”€ init.go
â”‚   â”œâ”€â”€ listener.go
â”‚   â”œâ”€â”€ signaling_test.go
â”‚   â”œâ”€â”€ test.png
â”‚   â”œâ”€â”€ user_test.go
â”‚   â””â”€â”€ work_moment_test.go
â”œâ”€â”€ wasm
â”‚   â”œâ”€â”€ cmd
â”‚   â”œâ”€â”€ event_listener
â”‚   â”œâ”€â”€ indexdb
â”‚   â””â”€â”€ wasm_wrapper
â”œâ”€â”€ work_group_test
â”‚   â”œâ”€â”€ create_work_group_open_im.go
â”‚   â”œâ”€â”€ msg_delay_open_im.go
â”‚   â””â”€â”€ press_open_im.go
â””â”€â”€ ws_wrapper
    â”œâ”€â”€ cmd
    â”œâ”€â”€ test
    â”œâ”€â”€ utils
    â””â”€â”€ ws_local_server
```

+ ```
  Open-IM-SDK-Core
  ```

  : Open-IM SDK æ ¸å¿ƒä»£ç 

  + ```
    internal
    ```

    : å†…éƒ¨å®ç°

    + `business`: ä¸šåŠ¡å¤„ç†ç›¸å…³å®ç°
    + `cache`: ç¼“å­˜ç›¸å…³å®ç°
    + `common`: å…¬ç”¨é€»è¾‘å®ç°
    + `conversation_msg`: æ¶ˆæ¯ç›¸å…³å®ç°
    + `file`: æ–‡ä»¶ç›¸å…³å®ç°
    + `friend`: å¥½å‹ç›¸å…³å®ç°
    + `full`: è·å–å¥½å‹ä¿¡æ¯
    + `group`: ç¾¤ç»„ç›¸å…³å®ç°
    + `heartbeart`: å¿ƒè·³ç›¸å…³å®ç°ï¼Œé•¿è¿æ¥
    + `interaction`: äº¤äº’ç›¸å…³å®ç°
    + `login`: ç™»å½•ç›¸å…³å®ç°
    + `obj_storage`: å¯¹è±¡å­˜å‚¨ç›¸å…³å®ç°
    + `signaling`: ä¿¡ä»¤ç›¸å…³å®ç°
    + `super_group`: è¶…çº§ç¾¤ç›¸å…³å®ç°ï¼ˆtg ç¾¤ï¼Œæœ‰ä¸€ä¸ªç®¡é“ï¼‰
    + `user`: ç”¨æˆ·ç›¸å…³å®ç°
    + `util`: å·¥å…·å‡½æ•°
    + `work_moments`: å·¥ä½œåœˆç›¸å…³å®ç°

  + `main`: ä¸»å‡½æ•°

  + `open_im_sdk`: Open-IM SDK å¯¹å¤–æä¾›çš„ API

  + `open_im_sdk_callback`: Open-IM SDK å›è°ƒå‡½æ•°ç›¸å…³å®ç°

  + ```
    pkg
    ```

    : åŒ…

    + `common`: å…¬å…±é€»è¾‘å®ç°
    + `constant`: å¸¸é‡å®šä¹‰
    + `db`: æ•°æ®åº“ç›¸å…³å®ç°
    + `log`: æ—¥å¿—ç›¸å…³å®ç°
    + `network`: ç½‘ç»œç›¸å…³å®ç°
    + `sdk_params_callback`: SDK å‚æ•°å›è°ƒç›¸å…³å®ç°
    + `server_api_params`: æœåŠ¡ç«¯ API å‚æ•°ç›¸å…³å®ç°
    + `syncer`: åŒæ­¥ç›¸å…³å®ç°
    + `utils`: å·¥å…·å‡½æ•°

  + `sdk_struct`: SDK ç»“æ„ä½“å®šä¹‰

  + `single_test`: å•å…ƒæµ‹è¯•

  + `test`: æµ‹è¯•

  + `testv2`: æµ‹è¯• v2

  + `wasm`: WebAssembly ç›¸å…³å®ç°

  + `work_group_test`: å·¥ä½œç¾¤æµ‹è¯•

  + `ws_wrapper`: WebSocket åŒ…è£…å™¨

## open_im_sdk

è¿™é‡Œé¢éƒ½æ˜¯å…¨éƒ¨å¯¹å¤–çš„ sdk

## open_im_sdk

è¿™é‡Œé¢éƒ½æ˜¯ä¸€äº›å›è°ƒæ¥å£ï¼Œä¹Ÿæ˜¯å¯¹å¤–å¯¼å‡ºï¼Œç§»åŠ¨ç«¯å®ç°è¿™äº›æ¥å£ã€‚

Goè¯­è¨€è°ƒç”¨ callback å…ˆä¸Šä¸€æ¬¡ UI å±‚å¤„ç†ã€‚

## cache

è¿™æ˜¯ä¸€ä¸ªGoè¯­è¨€ç¨‹åºä¸­çš„ä¸€ä¸ªç»“æ„ä½“ç±»å‹`Cache`ï¼Œå®ƒåŒ…å«äº†ä¸€äº›æ–¹æ³•æ¥æ›´æ–°å’ŒæŸ¥è¯¢ç¼“å­˜ä¸­çš„æ•°æ®ã€‚ä¸‹é¢è§£é‡Šæ¯ä¸ªæ–¹æ³•çš„åŠŸèƒ½ï¼š

1. `NewCache(user *user.User, friend *friend.Friend) *Cache`ï¼šè¿™ä¸ªæ–¹æ³•ç”¨äºåˆ›å»ºä¸€ä¸ªæ–°çš„`Cache`å¯¹è±¡ï¼Œå®ƒéœ€è¦ä¸¤ä¸ªå‚æ•°`user`å’Œ`friend`ï¼Œè¿™ä¸¤ä¸ªå‚æ•°åˆ†åˆ«æ˜¯å¯¹ç”¨æˆ·å’Œå¥½å‹çš„æ“ä½œçš„æ¥å£ã€‚
2. `Update(userID, faceURL, nickname string)`ï¼šè¿™ä¸ªæ–¹æ³•ç”¨äºæ›´æ–°ç¼“å­˜ä¸­æŒ‡å®šç”¨æˆ·IDçš„ç”¨æˆ·ä¿¡æ¯ï¼ŒåŒ…æ‹¬ç”¨æˆ·çš„æ˜µç§°å’Œå¤´åƒURLã€‚
3. `UpdateConversation(conversation model_struct.LocalConversation)`ï¼šè¿™ä¸ªæ–¹æ³•ç”¨äºæ›´æ–°ç¼“å­˜ä¸­æŒ‡å®šä¼šè¯IDçš„ä¼šè¯ä¿¡æ¯ã€‚
4. `UpdateConversations(conversations []*model_struct.LocalConversation)`ï¼šè¿™ä¸ªæ–¹æ³•ç”¨äºæ‰¹é‡æ›´æ–°ç¼“å­˜ä¸­å¤šä¸ªä¼šè¯çš„ä¿¡æ¯ã€‚
5. `GetAllConversations() []*model_struct.LocalConversation`ï¼šè¿™ä¸ªæ–¹æ³•ç”¨äºè·å–ç¼“å­˜ä¸­æ‰€æœ‰ä¼šè¯çš„ä¿¡æ¯ã€‚
6. `GetAllHasUnreadMessageConversations() []*model_struct.LocalConversation`ï¼šè¿™ä¸ªæ–¹æ³•ç”¨äºè·å–ç¼“å­˜ä¸­æ‰€æœ‰æœ‰æœªè¯»æ¶ˆæ¯çš„ä¼šè¯çš„ä¿¡æ¯ã€‚
7. `GetConversation(conversationID string) model_struct.LocalConversation`ï¼šè¿™ä¸ªæ–¹æ³•ç”¨äºè·å–ç¼“å­˜ä¸­æŒ‡å®šä¼šè¯IDçš„ä¼šè¯ä¿¡æ¯ã€‚
8. `GetUserNameAndFaceURL(ctx context.Context, userID string) (faceURL, name string, err error)`ï¼šè¿™ä¸ªæ–¹æ³•ç”¨äºè·å–æŒ‡å®šç”¨æˆ·IDçš„ç”¨æˆ·æ˜µç§°å’Œå¤´åƒURLã€‚å®ƒé¦–å…ˆä»ç¼“å­˜ä¸­æŸ¥æ‰¾ï¼Œå¦‚æœç¼“å­˜ä¸­æ²¡æœ‰åˆ™ä»æœ¬åœ°æ•°æ®åº“ä¸­æŸ¥æ‰¾ï¼Œå¦‚æœè¿˜æ²¡æœ‰åˆ™ä»æœåŠ¡å™¨æ•°æ®åº“ä¸­æŸ¥æ‰¾ã€‚å¦‚æœæœ€ç»ˆæ²¡æœ‰æ‰¾åˆ°ï¼Œåˆ™è¿”å›ä¸€ä¸ªé”™è¯¯ã€‚

é™¤äº†`Cache`ç±»å‹ä¸­çš„æ–¹æ³•ï¼Œè¿™æ®µä»£ç è¿˜å®šä¹‰äº†ä¸€ä¸ª`UserInfo`ç±»å‹ï¼Œç”¨äºç¼“å­˜ç”¨æˆ·çš„æ˜µç§°å’Œå¤´åƒURLã€‚



## END é“¾æ¥

<ul><li><div><a href = '43.md' style='float:left'>â¬†ï¸ä¸Šä¸€èŠ‚ğŸ”—  </a><a href = '45.md' style='float: right'>  ï¸ä¸‹ä¸€èŠ‚ğŸ”—</a></div></li></ul>

+ [â“‚ï¸å›åˆ°ç›®å½•ğŸ ](../README.md)

+ [**ğŸ«µå‚ä¸è´¡çŒ®ğŸ’â¤ï¸â€ğŸ”¥ğŸ’–**](https://nsddd.top/archives/contributors))

+ âœ´ï¸ç‰ˆæƒå£°æ˜ &copy; ï¼šæœ¬ä¹¦æ‰€æœ‰å†…å®¹éµå¾ª[CC-BY-SA 3.0åè®®ï¼ˆç½²å-ç›¸åŒæ–¹å¼å…±äº«ï¼‰&copy;](http://zh.wikipedia.org/wiki/Wikipedia:CC-by-sa-3.0åè®®æ–‡æœ¬) 
