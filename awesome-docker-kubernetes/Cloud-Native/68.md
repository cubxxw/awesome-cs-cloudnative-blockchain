+ [author](http://nsddd.top)

# ç¬¬68èŠ‚ æ·±å…¥å­¦ä¹  gin æºç 

<div><a href = '67.md' style='float:left'>â¬†ï¸ä¸Šä¸€èŠ‚ğŸ”—  </a><a href = '69.md' style='float: right'>  â¬‡ï¸ä¸‹ä¸€èŠ‚ğŸ”—</a></div>
<br>

> â¤ï¸ğŸ’•ğŸ’•è®°å½•[sealos](https://github.com/cubxxw/sealos)å¼€æºé¡¹ç›®çš„å­¦ä¹ è¿‡ç¨‹ã€‚[k8s,dockerå’Œäº‘åŸç”Ÿçš„å­¦ä¹ ](https://github.com/cubxxw/sealos)ã€‚Myblog:[http://nsddd.top](http://nsddd.top/)

---
[TOC]

## Why

Gin æ˜¯ä¸€ä¸ªç”¨ Golangç¼–å†™çš„ é«˜æ€§èƒ½çš„web æ¡†æ¶, ç”±äºhttpè·¯ç”±çš„ä¼˜åŒ–ï¼Œé€Ÿåº¦æé«˜äº†è¿‘ 40 å€ã€‚ Ginçš„ç‰¹ç‚¹å°±æ˜¯å°è£…ä¼˜é›…ã€APIå‹å¥½ã€‚

**Ginçš„ä¸€äº›ç‰¹æ€§ï¼š**

+ **å¿«é€Ÿ**ï¼š åŸºäº Radix æ ‘çš„è·¯ç”±ï¼Œå°å†…å­˜å ç”¨ã€‚æ²¡æœ‰åå°„ã€‚å¯é¢„æµ‹çš„ API æ€§èƒ½ã€‚
+ **æ”¯æŒä¸­é—´ä»¶**ï¼šå…¥çš„ HTTP è¯·æ±‚å¯ä»¥ç”±ä¸€ç³»åˆ—ä¸­é—´ä»¶å’Œæœ€ç»ˆæ“ä½œæ¥å¤„ç†ã€‚ ä¾‹å¦‚ï¼šLoggerï¼ŒAuthorizationï¼ŒGZIPï¼Œæœ€ç»ˆæ“ä½œ DBã€‚
+ **Crash å¤„ç†**ï¼šGin å¯ä»¥ catch ä¸€ä¸ªå‘ç”Ÿåœ¨ HTTP è¯·æ±‚ä¸­çš„ panic å¹¶ recover å®ƒã€‚è¿™æ ·ï¼Œä½ çš„æœåŠ¡å™¨å°†å§‹ç»ˆå¯ç”¨ã€‚ä¾‹å¦‚ï¼Œä½ å¯ä»¥å‘ Sentry æŠ¥å‘Šè¿™ä¸ª panicï¼
+ **JSON éªŒè¯**ï¼šGin å¯ä»¥è§£æå¹¶éªŒè¯è¯·æ±‚çš„ JSONï¼Œä¾‹å¦‚æ£€æŸ¥æ‰€éœ€å€¼çš„å­˜åœ¨ã€‚
+ **è·¯ç”±ç»„**ï¼šæ›´å¥½åœ°ç»„ç»‡è·¯ç”±ã€‚æ˜¯å¦éœ€è¦æˆæƒï¼Œä¸åŒçš„ API ç‰ˆæœ¬â€¦â€¦ æ­¤å¤–ï¼Œè¿™äº›ç»„å¯ä»¥æ— é™åˆ¶åœ°åµŒå¥—è€Œä¸ä¼šé™ä½æ€§èƒ½ã€‚
+ **é”™è¯¯ç®¡ç†**ï¼šGin æä¾›äº†ä¸€ç§æ–¹ä¾¿çš„æ–¹æ³•æ¥æ”¶é›† HTTP è¯·æ±‚æœŸé—´å‘ç”Ÿçš„æ‰€æœ‰é”™è¯¯ã€‚æœ€ç»ˆï¼Œä¸­é—´ä»¶å¯ä»¥å°†å®ƒä»¬å†™å…¥æ—¥å¿—æ–‡ä»¶ï¼Œæ•°æ®åº“å¹¶é€šè¿‡ç½‘ç»œå‘é€ã€‚
+ **å†…ç½®æ¸²æŸ“**ï¼šGin ä¸º JSONï¼ŒXML å’Œ HTML æ¸²æŸ“æä¾›äº†æ˜“äºä½¿ç”¨çš„ APIã€‚
+ **å¯æ‰©å±•æ€§**ï¼šæ–°å»ºä¸€ä¸ªä¸­é—´ä»¶éå¸¸ç®€å•ã€‚

ä¸‹è½½å¹¶å®‰è£… gin

```
go get -u github.com/gin-gonic/gin
```



## é¡¹ç›®ç»“æ„

å®é™…é¡¹ç›®ä¸šåŠ¡åŠŸèƒ½å’Œæ¨¡å—ä¼šå¾ˆå¤šï¼Œæˆ‘ä»¬ä¸å¯èƒ½æŠŠæ‰€æœ‰ä»£ç éƒ½å†™åœ¨ä¸€ä¸ªgoæ–‡ä»¶é‡Œé¢æˆ–è€…å†™åœ¨ä¸€ä¸ªmainå…¥å£å‡½æ•°é‡Œé¢ï¼›æˆ‘ä»¬éœ€è¦å¯¹é¡¹ç›®ç»“æ„åšä¸€äº›è§„åˆ’ï¼Œæ–¹ä¾¿ç»´æŠ¤ä»£ç ä»¥åŠæ‰©å±•ã€‚

**Ginæ¡†æ²¡æœ‰å¯¹é¡¹ç›®ç»“æ„åšå‡ºé™åˆ¶ï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ®è‡ªå·±é¡¹ç›®éœ€è¦è‡ªè¡Œè®¾è®¡ã€‚**

**MVC æ¶æ„è®¾è®¡ï¼š**

```bash
â”œâ”€â”€ conf            #é¡¹ç›®é…ç½®æ–‡ä»¶ç›®å½•
â”‚   â””â”€â”€ config.toml #å¤§å®¶å¯ä»¥é€‰æ‹©è‡ªå·±ç†Ÿæ‚‰çš„é…ç½®æ–‡ä»¶ç®¡ç†å·¥å…·åŒ…ä¾‹å¦‚ï¼štomlã€xmlç­‰ç­‰
â”œâ”€â”€ controllers     #æ§åˆ¶å™¨ç›®å½•ï¼ŒæŒ‰æ¨¡å—å­˜æ”¾æ§åˆ¶å™¨ï¼ˆæˆ–è€…å«æ§åˆ¶å™¨å‡½æ•°ï¼‰ï¼Œå¿…è¦çš„æ—¶å€™å¯ä»¥ç»§ç»­åˆ’åˆ†å­ç›®å½•ã€‚
â”‚   â”œâ”€â”€ food.go
â”‚   â””â”€â”€ user.go
â”œâ”€â”€ main.go         #é¡¹ç›®å…¥å£ï¼Œè¿™é‡Œè´Ÿè´£Ginæ¡†æ¶çš„åˆå§‹åŒ–ï¼Œæ³¨å†Œè·¯ç”±ä¿¡æ¯ï¼Œå…³è”æ§åˆ¶å™¨å‡½æ•°ç­‰ã€‚
â”œâ”€â”€ models          #æ¨¡å‹ç›®å½•ï¼Œè´Ÿè´£é¡¹ç›®çš„æ•°æ®å­˜å‚¨éƒ¨åˆ†ï¼Œä¾‹å¦‚å„ä¸ªæ¨¡å—çš„Mysqlè¡¨çš„è¯»å†™æ¨¡å‹ã€‚
â”‚   â”œâ”€â”€ food.go
â”‚   â””â”€â”€ user.go 
â”œâ”€â”€ static          #é™æ€èµ„æºç›®å½•ï¼ŒåŒ…æ‹¬Jsï¼Œcssï¼Œjpgç­‰ç­‰ï¼Œå¯ä»¥é€šè¿‡Ginæ¡†æ¶é…ç½®ï¼Œç›´æ¥è®©ç”¨æˆ·è®¿é—®ã€‚
â”‚   â”œâ”€â”€ css
â”‚   â”œâ”€â”€ images
â”‚   â””â”€â”€ js
â”œâ”€â”€ logs            #æ—¥å¿—æ–‡ä»¶ç›®å½•ï¼Œä¸»è¦ä¿å­˜é¡¹ç›®è¿è¡Œè¿‡ç¨‹ä¸­äº§ç”Ÿçš„æ—¥å¿—ã€‚
â””â”€â”€ views           #è§†å›¾æ¨¡æ¿ç›®å½•ï¼Œå­˜æ”¾å„ä¸ªæ¨¡å—çš„è§†å›¾æ¨¡æ¿ï¼Œå½“ç„¶æœ‰äº›é¡¹ç›®åªæœ‰apiï¼Œæ˜¯ä¸éœ€è¦è§†å›¾éƒ¨åˆ†ï¼Œå¯ä»¥å¿½ç•¥è¿™ä¸ªç›®å½•
    â””â”€â”€ index.html
```

### Gin æ¡†æ¶è¿è¡Œæ¨¡å¼

ä¸ºæ–¹ä¾¿è°ƒè¯•ï¼ŒGin æ¡†æ¶åœ¨è¿è¡Œçš„æ—¶å€™é»˜è®¤æ˜¯debugæ¨¡å¼ï¼Œåœ¨æ§åˆ¶å°é»˜è®¤ä¼šæ‰“å°å‡ºå¾ˆå¤šè°ƒè¯•æ—¥å¿—ï¼Œä¸Šçº¿çš„æ—¶å€™æˆ‘ä»¬éœ€è¦å…³é—­debugæ¨¡å¼ï¼Œæ”¹ä¸ºreleaseæ¨¡å¼ã€‚

```bash
export GIN_MODE=release
```

`GIN_MODE` ç¯å¢ƒå˜é‡ï¼Œå¯ä»¥è®¾ç½®ä¸ºdebugæˆ–è€…release



**é€šè¿‡ä»£ç è®¾ç½®**

```go
åœ¨mainå‡½æ•°ï¼Œåˆå§‹åŒ–ginæ¡†æ¶çš„æ—¶å€™æ‰§è¡Œä¸‹é¢ä»£ç 
// è®¾ç½® releaseæ¨¡å¼
gin.SetMode(gin.ReleaseMode)
// æˆ–è€… è®¾ç½®debugæ¨¡å¼
gin.SetMode(gin.DebugMode)
```



## Gin è·¯ç”±å’Œæ§åˆ¶å™¨

è·¯ç”±æ˜¯ä¸€ä¸ªè¿‡ç¨‹ï¼ŒæŒ‡çš„æ˜¯ä¸€ä¸ª`http`è¯·æ±‚ï¼Œå¦‚ä½•æ‰¾åˆ°å¯¹åº”çš„å¤„ç†å™¨å‡½æ•°ï¼ˆä¹Ÿå¯ä»¥å«æ§åˆ¶å™¨å‡½æ•°ï¼‰, `Gin`æ¡†æ¶çš„è·¯ç”±æ˜¯åŸºäº`httprouter`åŒ…å®ç°çš„ã€‚

æ§åˆ¶å™¨å‡½æ•°ä¸»è¦è´Ÿè´£æ‰§è¡Œ `httpè¯·æ±‚-å“åº”ä»»åŠ¡`ã€‚

ğŸ’¡ç®€å•çš„ä¸€ä¸ªæ¡ˆä¾‹å¦‚ä¸‹ï¼š

```go
r := gin.Default()

// è·¯ç”±å®šä¹‰postè¯·æ±‚, urlè·¯å¾„ä¸ºï¼š/user/login, ç»‘å®šdoLoginæ§åˆ¶å™¨å‡½æ•°
r.POST("/user/login", doLogin)

// æ§åˆ¶å™¨å‡½æ•°
func doLogin(c *gin.Context) {
        // è·å–postè¯·æ±‚å‚æ•°
	username := c.PostForm("username")
	password := c.PostForm("password")

	// é€šè¿‡è¯·æ±‚ä¸Šä¸‹æ–‡å¯¹è±¡Context, ç›´æ¥å¾€å®¢æˆ·ç«¯è¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²
	c.String(200, "username=%s,password=%s", username,password)
}
```



### è·¯ç”±è§„åˆ™

ä¸€æ¡è·¯ç”±è§„åˆ™ç”±ä¸‰éƒ¨åˆ†ç»„æˆï¼š

+ httpè¯·æ±‚æ–¹æ³•
+ urlè·¯å¾„
+ æ§åˆ¶å™¨å‡½æ•°



**httpè¯·æ±‚æ–¹æ³•ï¼š**

å¸¸ç”¨çš„httpè¯·æ±‚æ–¹æ³•æœ‰ä¸‹é¢4ç§:

+ GET
+ POST
+ PUT
+ DELETE



**urlè·¯å¾„ï¼š**

echoæ¡†æ¶ï¼Œurlè·¯å¾„æœ‰ä¸‰ç§å†™æ³•ï¼š

+ é™æ€urlè·¯å¾„
+ å¸¦è·¯å¾„å‚æ•°çš„urlè·¯å¾„
+ å¸¦æ˜Ÿå·ï¼ˆ*ï¼‰æ¨¡ç³ŠåŒ¹é…å‚æ•°çš„urlè·¯å¾„

> ğŸ’¡ç®€å•çš„ä¸€ä¸ªæ¡ˆä¾‹å¦‚ä¸‹ï¼š
>
> ```go
> / ä¾‹å­1ï¼Œ é™æ€Urlè·¯å¾„, å³ä¸å¸¦ä»»ä½•å‚æ•°çš„urlè·¯å¾„
> /users/center
> /user/111
> /food/12
> 
> // ä¾‹å­2ï¼Œå¸¦è·¯å¾„å‚æ•°çš„urlè·¯å¾„ï¼Œurlè·¯å¾„ä¸Šé¢å¸¦æœ‰å‚æ•°,å‚æ•°ç”±å†’å·ï¼ˆ:ï¼‰è·Ÿç€ä¸€ä¸ªå­—ç¬¦ä¸²å®šä¹‰ã€‚
> // è·¯å¾„å‚æ•°å€¼å¯ä»¥æ˜¯æ•°å€¼ï¼Œä¹Ÿå¯ä»¥æ˜¯å­—ç¬¦ä¸²
> 
> //å®šä¹‰å‚æ•°:idï¼Œ å¯ä»¥åŒ¹é…/user/1, /user/899 /user/xiaoli è¿™ç±»Urlè·¯å¾„
> /user/:id
> 
> //å®šä¹‰å‚æ•°:idï¼Œ å¯ä»¥åŒ¹é…/food/2, /food/100 /food/apple è¿™ç±»Urlè·¯å¾„
> /food/:id
> 
> //å®šä¹‰å‚æ•°:typeå’Œ:pageï¼Œ å¯ä»¥åŒ¹é…/foods/2/1, /food/100/25 /food/apple/30 è¿™ç±»Urlè·¯å¾„
> /foods/:type/:page
> 
> // ä¾‹å­3. å¸¦æ˜Ÿå·ï¼ˆ*ï¼‰æ¨¡ç³ŠåŒ¹é…å‚æ•°çš„urlè·¯å¾„
> // æ˜Ÿå·ä»£è¡¨åŒ¹é…ä»»æ„è·¯å¾„çš„æ„æ€, å¿…é¡»åœ¨*å·åé¢æŒ‡å®šä¸€ä¸ªå‚æ•°åï¼Œåé¢å¯ä»¥é€šè¿‡è¿™ä¸ªå‚æ•°è·å–*å·åŒ¹é…çš„å†…å®¹ã€‚
> 
> //ä»¥/foods/ å¼€å¤´çš„æ‰€æœ‰è·¯å¾„éƒ½åŒ¹é…
> //åŒ¹é…ï¼š/foods/1ï¼Œ /foods/200, /foods/1/20, /foods/apple/1 
> /foods/*path
> 
> //å¯ä»¥é€šè¿‡pathå‚æ•°è·å–*å·åŒ¹é…çš„å†…å®¹ã€‚
> ```



**æ§åˆ¶å™¨å‡½æ•°:**

æ§åˆ¶å™¨å‡½æ•°å®šä¹‰ï¼š

```go
func HandlerFunc(c *gin.Context)
```

æ§åˆ¶å™¨å‡½æ•°æ¥å—ä¸€ä¸ªä¸Šä¸‹æ–‡å‚æ•°ã€‚

å¯ä»¥é€šè¿‡ä¸Šä¸‹æ–‡å‚æ•°ï¼Œè·å–httpè¯·æ±‚å‚æ•°ï¼Œå“åº”httpè¯·æ±‚ã€‚



**ğŸ’¡ç®€å•çš„ä¸€ä¸ªæ¡ˆä¾‹å¦‚ä¸‹ï¼š**

```go
//å®ä¾‹åŒ–ginå®ä¾‹å¯¹è±¡ã€‚
r := gin.Default()
	
//å®šä¹‰postè¯·æ±‚, urlè·¯å¾„ä¸ºï¼š/users, ç»‘å®šsaveUseræ§åˆ¶å™¨å‡½æ•°
r.POST("/users", saveUser)

//å®šä¹‰getè¯·æ±‚ï¼Œurlè·¯å¾„ä¸ºï¼š/users/:id  ï¼ˆ:idæ˜¯å‚æ•°ï¼Œä¾‹å¦‚: /users/10, ä¼šåŒ¹é…è¿™ä¸ªurlæ¨¡å¼ï¼‰ï¼Œç»‘å®šgetUseræ§åˆ¶å™¨å‡½æ•°
r.GET("/users/:id", getUser)

//å®šä¹‰putè¯·æ±‚
r.PUT("/users/:id", updateUser)

//å®šä¹‰deleteè¯·æ±‚
r.DELETE("/users/:id", deleteUser)


//æ§åˆ¶å™¨å‡½æ•°å®ç°
func saveUser(c *gin.Context) {
    ...å¿½ç•¥å®ç°...
}

func getUser(c *gin.Context) {
    ...å¿½ç•¥å®ç°...
}

func updateUser(c *gin.Context) {
    ...å¿½ç•¥å®ç°...
}

func deleteUser(c *gin.Context) {
    ...å¿½ç•¥å®ç°...
}
```



### åˆ†ç»„è·¯ç”±

åœ¨æˆ‘ä»¬åš API çš„æ—¶å€™ï¼Œå¦‚æœè¦æ”¯æŒå¤šä¸ª API çš„ç‰ˆæœ¬ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ **åˆ†ç»„è·¯ç”±æ¥å®ç°**

ğŸ’¡ç®€å•çš„ä¸€ä¸ªæ¡ˆä¾‹å¦‚ä¸‹ï¼š

```go
func main() {
	router := gin.Default()

	// åˆ›å»ºv1ç»„
	v1 := router.Group("/v1")
	{
                // åœ¨v1è¿™ä¸ªåˆ†ç»„ä¸‹ï¼Œæ³¨å†Œè·¯ç”±
		v1.POST("/login", loginEndpoint)
		v1.POST("/submit", submitEndpoint)
		v1.POST("/read", readEndpoint)
	}

	// åˆ›å»ºv2ç»„
	v2 := router.Group("/v2")
	{
                // åœ¨v2è¿™ä¸ªåˆ†ç»„ä¸‹ï¼Œæ³¨å†Œè·¯ç”±
		v2.POST("/login", loginEndpoint)
		v2.POST("/submit", submitEndpoint)
		v2.POST("/read", readEndpoint)
	}

	router.Run(":8080")
}
```

ä¸Šé¢çš„ä¾‹å­å°†ä¼šæ³¨å†Œä¸‹é¢çš„è·¯ç”±ä¿¡æ¯ï¼š

+ /v1/login
+ /v1/submit
+ /v1/read
+ /v2/login
+ /v2/submit
+ /v2/read

> **Note**
>
> ä¸€èˆ¬è¿˜æ˜¯æ¨èé‡‡ç”¨åˆé€‚çš„ç›®å½•ç»“æ„è¿›è¡Œåˆ†ç»„



### Ginå¦‚ä½•å¤„ç†è¯·æ±‚å‚æ•°

#### Get è¯·æ±‚

Getè¯·æ±‚urlä¾‹å­ï¼š*/path?id=1234&name=Manu&value=*111

```go
# è·å–Getè¯·æ±‚å‚æ•°çš„å¸¸ç”¨å‡½æ•°ï¼š
func (c *Context) Query(key string) string
func (c *Context) DefaultQuery(key, defaultValue string) string
func (c *Context) GetQuery(key string) (string, bool)
```



ğŸ’¡ç®€å•çš„ä¸€ä¸ªæ¡ˆä¾‹å¦‚ä¸‹ï¼š

```go
func Handler(c *gin.Context) {
	//è·å–nameå‚æ•°, é€šè¿‡Queryè·å–çš„å‚æ•°å€¼æ˜¯Stringç±»å‹ã€‚
	name := c.Query("name")

        //è·å–nameå‚æ•°, è·ŸQueryå‡½æ•°çš„åŒºåˆ«æ˜¯ï¼Œå¯ä»¥é€šè¿‡ç¬¬äºŒä¸ªå‚æ•°è®¾ç½®é»˜è®¤å€¼ã€‚
        name := c.DefaultQuery("name", "tizi365")

	//è·å–idå‚æ•°, é€šè¿‡GetQueryè·å–çš„å‚æ•°å€¼ä¹Ÿæ˜¯Stringç±»å‹, 
	// åŒºåˆ«æ˜¯GetQueryè¿”å›ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªæ˜¯å‚æ•°å€¼ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯å‚æ•°æ˜¯å¦å­˜åœ¨çš„boolå€¼ï¼Œå¯ä»¥ç”¨æ¥åˆ¤æ–­å‚æ•°æ˜¯å¦å­˜åœ¨ã€‚
	id, ok := c.GetQuery("id")
        if !ok {
	   // å‚æ•°ä¸å­˜åœ¨
	}
}
```



#### Post è¯·æ±‚

å¸¸ç”¨çš„å‡½æ•°ï¼š

```go
func (c *Context) PostForm(key string) string
func (c *Context) DefaultPostForm(key, defaultValue string) string
func (c *Context) GetPostForm(key string) (string, bool)
```

ğŸ’¡ç®€å•çš„ä¸€ä¸ªæ¡ˆä¾‹å¦‚ä¸‹ï¼š

```go
func Handler(c *gin.Context) {
	//è·å–nameå‚æ•°, é€šè¿‡PostFormè·å–çš„å‚æ•°å€¼æ˜¯Stringç±»å‹ã€‚
	name := c.PostForm("name")

	// è·ŸPostFormçš„åŒºåˆ«æ˜¯å¯ä»¥é€šè¿‡ç¬¬äºŒä¸ªå‚æ•°è®¾ç½®å‚æ•°é»˜è®¤å€¼
	name := c.DefaultPostForm("name", "tizi365")

	//è·å–idå‚æ•°, é€šè¿‡GetPostFormè·å–çš„å‚æ•°å€¼ä¹Ÿæ˜¯Stringç±»å‹,
	// åŒºåˆ«æ˜¯GetPostFormè¿”å›ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªæ˜¯å‚æ•°å€¼ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯å‚æ•°æ˜¯å¦å­˜åœ¨çš„boolå€¼ï¼Œå¯ä»¥ç”¨æ¥åˆ¤æ–­å‚æ•°æ˜¯å¦å­˜åœ¨ã€‚
	id, ok := c.GetPostForm("id")
	if !ok {
	    // å‚æ•°ä¸å­˜åœ¨
	}
}
```



#### è·å–URLè·¯å¾„å‚æ•°

è·å–URLè·¯å¾„å‚æ•°ï¼ŒæŒ‡çš„æ˜¯è·å– `/user/:id`è¿™ç±»å‹è·¯ç”±ç»‘å®šçš„å‚æ•°ï¼Œè¿™ä¸ªä¾‹å­ç»‘å®šäº†ä¸€ä¸ªå‚æ•°idã€‚

è·å–urlè·¯å¾„å‚æ•°å¸¸ç”¨å‡½æ•°ï¼š

```go
func (c *Context) Param(key string) string
```

ğŸ’¡ç®€å•çš„ä¸€ä¸ªæ¡ˆä¾‹å¦‚ä¸‹ï¼š

```go
r := gin.Default()
	
r.GET("/user/:id", func(c *gin.Context) {
	// è·å–urlå‚æ•°id
	id := c.Param("id")
})
```



#### å°†è¯·æ±‚å‚æ•°ç»‘å®šåˆ°structå¯¹è±¡

å‰é¢è·å–å‚æ•°çš„æ–¹å¼éƒ½æ˜¯ä¸€ä¸ªä¸ªå‚æ•°çš„è¯»å–ï¼Œæ¯”è¾ƒéº»çƒ¦ï¼ŒGinæ¡†æ¶æ”¯æŒå°†è¯·æ±‚å‚æ•°è‡ªåŠ¨ç»‘å®šåˆ°ä¸€ä¸ªstructå¯¹è±¡ï¼Œè¿™ç§æ–¹å¼æ”¯æŒGet/Postè¯·æ±‚ï¼Œä¹Ÿæ”¯æŒhttpè¯·æ±‚bodyå†…å®¹ä¸ºjson/xmlæ ¼å¼çš„å‚æ•°ã€‚

ä¸‹é¢ä¾‹å­æ˜¯å°†è¯·æ±‚å‚æ•°ç»‘å®šåˆ°User structå¯¹è±¡ã€‚

```go
// User ç»“æ„ä½“å®šä¹‰
type User struct {
  Name  string `json:"name" form:"name"`
  Email string `json:"email" form:"email"`
}
```

é€šè¿‡å®šä¹‰ `struct` å­—æ®µçš„æ ‡ç­¾ï¼Œå®šä¹‰è¯·æ±‚å‚æ•°å’Œ `struct` å­—æ®µçš„å…³ç³»ã€‚
ä¸‹é¢å¯¹ `User` çš„ `Name` å­—æ®µçš„æ ‡ç­¾è¿›è¡Œè¯´æ˜ã€‚

**structæ ‡ç­¾è¯´æ˜ï¼š**

| æ ‡ç­¾        | è¯´æ˜                                     |
| :---------- | :--------------------------------------- |
| json:"name" | æ•°æ®æ ¼å¼ä¸ºjsonæ ¼å¼ï¼Œå¹¶ä¸”jsonå­—æ®µåä¸ºname |
| form:"name" | è¡¨å•å‚æ•°åä¸ºname                         |

ä¸‹é¢æ˜¯æ§åˆ¶å™¨ä»£ç ï¼š

```go
r.POST("/user/:id", func(c *gin.Context) {
   // åˆå§‹åŒ–user struct
   u := User{}
   // é€šè¿‡ShouldBindå‡½æ•°ï¼Œå°†è¯·æ±‚å‚æ•°ç»‘å®šåˆ°structå¯¹è±¡ï¼Œ å¤„ç†jsonè¯·æ±‚ä»£ç æ˜¯ä¸€æ ·çš„ã€‚
   // å¦‚æœæ˜¯postè¯·æ±‚åˆ™æ ¹æ®Content-Typeåˆ¤æ–­ï¼Œæ¥æ”¶çš„æ˜¯jsonæ•°æ®ï¼Œè¿˜æ˜¯æ™®é€šçš„httpè¯·æ±‚å‚æ•°
   if c.ShouldBind(&u) == nil {
     // ç»‘å®šæˆåŠŸï¼Œ æ‰“å°è¯·æ±‚å‚æ•°
     log.Println(u.Name)
     log.Println(u.Email)

    }
    // http è¯·æ±‚è¿”å›ä¸€ä¸ªå­—ç¬¦ä¸² 
    c.String(200, "Success")
})
```



#### Ginå¦‚ä½•è·å–å®¢æˆ·ip

```go
r := gin.Default()
	
r.GET("/ip", func(c *gin.Context) {
	// è·å–ç”¨æˆ·IP
	ip := c.ClientIP()
})
```



## Ginå¤„ç†è¯·æ±‚ç»“æœ

gin.Contextä¸Šä¸‹æ–‡å¯¹è±¡æ”¯æŒå¤šç§è¿”å›å¤„ç†ç»“æœï¼Œä¸‹é¢åˆ†åˆ«ä»‹ç»ä¸åŒçš„å“åº”æ–¹å¼ã€‚



### ä»¥å­—ç¬¦ä¸²æ–¹å¼å“åº”è¯·æ±‚

é€šè¿‡Stringå‡½æ•°è¿”å›å­—ç¬¦ä¸²ã€‚

å‡½æ•°å®šä¹‰ï¼š

```
func (c *Context) String(code int, format string, values ...interface{})
```

å‚æ•°è¯´æ˜ï¼š

| å‚æ•°   | è¯´æ˜                                                         |
| :----- | :----------------------------------------------------------- |
| code   | httpçŠ¶æ€ç                                                    |
| format | è¿”å›ç»“æœï¼Œæ”¯æŒç±»ä¼¼Sprintfå‡½æ•°ä¸€æ ·çš„å­—ç¬¦ä¸²æ ¼å¼å®šä¹‰ï¼Œä¾‹å¦‚,%d ä»£è¡¨æ’å…¥æ•´æ•°ï¼Œ%sä»£è¡¨æ’å…¥å­—ç¬¦ä¸² |
| values | ä»»æ„ä¸ªformatå‚æ•°å®šä¹‰çš„å­—ç¬¦ä¸²æ ¼å¼å‚æ•°                         |

ğŸ’¡ç®€å•çš„ä¸€ä¸ªæ¡ˆä¾‹å¦‚ä¸‹ï¼š

```go
func Handler(c *gin.Context)  {
	// ä¾‹å­1ï¼š
	c.String(200, "æ¬¢è¿è®¿é—®nsddd.top!")
	
	// ä¾‹å­2ï¼š è¿™é‡Œå®šä¹‰äº†ä¸¤ä¸ªå­—ç¬¦ä¸²å‚æ•°ï¼ˆä¸¤ä¸ª%sï¼‰ï¼Œåé¢ä¼ å…¥çš„ä¸¤ä¸ªå­—ç¬¦ä¸²å‚æ•°å°†ä¼šæ›¿æ¢å¯¹åº”çš„%s
	c.String(200,"æ¬¢è¿è®¿é—®%s, ä½ æ˜¯%s", "nsddd.top!","æœ€é“çš„ä»”ï¼")
}
```



### ä»¥jsonæ ¼å¼å“åº”è¯·æ±‚

æˆ‘ä»¬å¼€å‘apiæ¥å£çš„æ—¶å€™å¸¸ç”¨çš„æ ¼å¼å°±æ˜¯jsonï¼Œä¸‹é¢æ˜¯è¿”å›jsonæ ¼å¼æ•°æ®çš„ä¾‹å­

```go
// User å®šä¹‰
type User struct {
  Name  string `json:"name"` // é€šè¿‡jsonæ ‡ç­¾å®šä¹‰structå­—æ®µè½¬æ¢æˆjsonå­—æ®µçš„åå­—ã€‚
  Email string `json:"email"`
}

// Handler æ§åˆ¶å™¨
func(c *gin.Context) {
  //åˆå§‹åŒ–userå¯¹è±¡
  u := &User{
    Name:  "Xinwei Xiong",
    Email: "3293172751nss@gmail.com",
  }
  //è¿”å›jsonæ•°æ®
  //è¿”å›ç»“æœï¼š{"name":"Xinwei Xiong", "email":"3293172751nss@gmail.com"}
  c.JSON(200, u)
}
```



### ä»¥xmlæ ¼å¼å“åº”è¯·æ±‚

```go
type User struct {
  Name  string `xml:"name"` // é€šè¿‡xmlæ ‡ç­¾å®šä¹‰structå­—æ®µè½¬æ¢æˆxmlå­—æ®µçš„åå­—ã€‚
  Email string `xml:"email"`
}

c.XML(200, u)
```



### ä»¥æ–‡ä»¶æ ¼å¼å“åº”è¯·æ±‚

ä¸‹é¢ä»‹ç»ginæ¡†æ¶å¦‚ä½•ç›´æ¥è¿”å›ä¸€ä¸ªæ–‡ä»¶ï¼Œå¯ä»¥ç”¨æ¥åšæ–‡ä»¶ä¸‹è½½ã€‚

```go
func(c *gin.Context) {
  //é€šè¿‡Fileå‡½æ•°ï¼Œç›´æ¥è¿”å›æœ¬åœ°æ–‡ä»¶ï¼Œå‚æ•°ä¸ºæœ¬åœ°æ–‡ä»¶åœ°å€ã€‚
  //å‡½æ•°è¯´æ˜ï¼šc.File("æ–‡ä»¶è·¯å¾„")
  c.File("/var/www/1.jpg")
}

ä¾‹å­2ï¼š
func(c *gin.Context) {
  //é€šè¿‡FileAttachmentå‡½æ•°ï¼Œè¿”å›æœ¬åœ°æ–‡ä»¶ï¼Œç±»ä¼¼Fileå‡½æ•°ï¼ŒåŒºåˆ«æ˜¯å¯ä»¥æŒ‡å®šä¸‹è½½çš„æ–‡ä»¶åã€‚
  //å‡½æ•°è¯´æ˜: c.FileAttachment("æ–‡ä»¶è·¯å¾„", "ä¸‹è½½çš„æ–‡ä»¶å")
  c.FileAttachment("/var/www/1.jpg", "1.jpg")
}
```



## htmlæ¨¡æ¿å¤„ç†

Gin æ¡†æ¶é»˜è®¤å°è£…äº†golangå†…ç½®çš„ `html/template` åŒ…ç”¨äºå¤„ç†htmlæ¨¡ç‰ˆã€‚

**ä½¿ç”¨åˆ°äº† Goè¯­è¨€ çš„ template æ¨¡æ¿å¼•æ“çš„ç‰¹æ€§ï¼š**



### Goè¯­è¨€æ¨¡æ¿å¼•æ“

Goè¯­è¨€å†…ç½®äº† text/template å’Œ html/templateä¸¤ä¸ªæ¨¡æ¿åº“ï¼Œä¸“é—¨ç”¨äºå¤„ç†ç½‘é¡µhtmlæ¨¡æ¿ã€‚
html/template æ˜¯åœ¨ text/template æ¨¡æ¿åº“çš„åŸºç¡€ä¸Šå¢åŠ äº†å¯¹htmlè¾“å‡ºçš„å®‰å…¨å¤„ç†ï¼Œä¸»è¦ç›®çš„æ˜¯ä¸ºäº†é˜²æ­¢è¢«æ”»å‡»ã€‚

**æ¨¡ç‰ˆå¼•æ“ä½¿ç”¨æµç¨‹**:

1. ç¼–å†™æ¨¡ç‰ˆä»£ç 
2. å¯¼å…¥åŒ…
3. åŠ è½½æ¨¡ç‰ˆä»£ç 
4. æ ¹æ®æ¨¡ç‰ˆå‚æ•°æ¸²æŸ“æ¨¡ç‰ˆ



**ğŸ’¡ç®€å•çš„ä¸€ä¸ªæ¡ˆä¾‹å¦‚ä¸‹ï¼š**

å°†ä¸‹é¢æ¨¡ç‰ˆä»£ç ä¿å­˜è‡³views/demo.tplæ–‡ä»¶ä¸­ï¼Œ æ–‡ä»¶åç¼€åéšæ„ã€‚

```go
{{define "demo"}}
æ˜µç§°ï¼š {{.Name}},
{{- if .IsWin}}
æ­å–œï¼Œå¤§å‰å¤§åˆ©ï¼Œä»Šæ™šåƒé¸¡ï¼
{{- else}}
é—æ†¾ï¼Œé¸¡è¢«åƒå…‰äº†ï¼
{{- end}}
{{- end}}
```

define "æ¨¡æ¿å" ç”¨äºå®šä¹‰å­æ¨¡æ¿ï¼Œåé¢æ¸²æŸ“æ¨¡æ¿ä¼šç”¨åˆ°è¿™ä¸ªåå­—ã€‚

**ç„¶åæˆ‘ä»¬å¯¼å…¥åŒ…**ï¼š

```go
import "text/template"
```

**åŠ è½½æ¨¡ç‰ˆä»£ç :**

```go
// åŠ è½½æ¨¡ç‰ˆä»£ç ï¼Œå¹¶ä¸”åˆ›å»ºtemplateå¯¹è±¡t
// template.ParseGlob å‡½æ•°åŠ è½½viewsç›®å½•ä¸‹çš„æ‰€æœ‰tplä¸ºåç¼€çš„æ¨¡ç‰ˆæ–‡ä»¶
// template.Mustå‡½æ•°ä¸»è¦ç”¨äºæ£€æµ‹åŠ è½½çš„æ¨¡ç‰ˆæœ‰æ²¡æœ‰é”™è¯¯ï¼Œæœ‰é”™è¯¯è¾“å‡ºpanicé”™è¯¯ï¼Œå¹¶ä¸”ç»“æŸç¨‹åºã€‚
t := template.Must(template.ParseGlob("./views/*.tpl"))
```

**æ ¹æ®æ¨¡ç‰ˆå‚æ•°æ¸²æŸ“æ¨¡ç‰ˆ**

å®šä¹‰æ¨¡ç‰ˆå‚æ•°:

```go
//è¿™é‡Œå®šä¹‰ä¸€ä¸ªstructç±»å‹çš„æ¨¡ç‰ˆå‚æ•°ï¼Œå®é™…ä¸Šæ¨¡ç‰ˆå¯ä»¥æ˜¯ä»»æ„ç±»å‹æ•°æ®
type GameStatus struct {
    Name string
    IsWin bool
}
```

> å› ä¸ºåªèƒ½ä¼ å…¥ä¸€ä¸ªæ¨¡ç‰ˆå‚æ•°ï¼Œå¦‚æœæƒ³ä¼ å…¥å¤šä¸ªæ¨¡ç‰ˆå‚æ•°ï¼Œå¯ä»¥ä½¿ç”¨mapæˆ–è€…structç±»å‹ã€‚

åˆå§‹åŒ–æ¨¡æ¿å‚æ•°, è¿™é‡Œåˆå§‹åŒ–ä¸€ä¸ªå‚æ•°æ•°ç»„ï¼Œä¸‹é¢ç”¨äºå¾ªç¯æ¸²æŸ“æ¨¡æ¿ã€‚

```go
var userStatus = []GameStatus{
    {"å¤§æ˜¥", true},
    {"NiuBee", false},
    {"çƒçƒ", true},
}
```

ä¸‹é¢æ˜¯æ ¹æ®userStatus æ•°ç»„å¾ªç¯æ¸²æŸ“æ¨¡æ¿

```go
for _, u := range userStatus {
    //æ ¹æ®å‚æ•°u, æ¸²æŸ“å‘½åä¸ºdemoçš„æ¨¡æ¿ï¼Œå¹¶ä¸”å°†æ¸²æŸ“ç»“æœæ‰“å°åˆ°æ ‡å‡†è¾“å‡º
    err := t.ExecuteTemplate(os.Stdout, "demo", u)
    if err != nil {
        log.Println("executing template:", err)
    }
}
```

è¾“å‡ºç»“æœ:

```go
æ˜µç§°ï¼š å¤§æ˜¥,
æ­å–œï¼Œå¤§å‰å¤§åˆ©ï¼Œä»Šæ™šåƒé¸¡ï¼
æ˜µç§°ï¼š NiuBee,
é—æ†¾ï¼Œé¸¡è¢«åƒå…‰äº†ï¼
æ˜µç§°ï¼š çƒçƒ,
æ­å–œï¼Œå¤§å‰å¤§åˆ©ï¼Œä»Šæ™šåƒé¸¡ï¼
```



### Gin è¿”å›æ¨¡æ¿çš„æ¡ˆä¾‹

ğŸ’¡ç®€å•çš„ä¸€ä¸ªæ¡ˆä¾‹å¦‚ä¸‹ï¼š

```go
func main() {
        // åˆå§‹åŒ–ginå¯¹è±¡
	router := gin.Default()
        // é¦–å…ˆåŠ è½½templatesç›®å½•ä¸‹é¢çš„æ‰€æœ‰æ¨¡ç‰ˆæ–‡ä»¶ï¼Œæ¨¡ç‰ˆæ–‡ä»¶æ‰©å±•åéšæ„
	router.LoadHTMLGlob("templates/*")

        // ç»‘å®šä¸€ä¸ªurlè·¯ç”± /index
	router.GET("/index", func(c *gin.Context) {
                // é€šè¿‡HTMLå‡½æ•°è¿”å›htmlä»£ç 
                // ç¬¬äºŒä¸ªå‚æ•°æ˜¯æ¨¡ç‰ˆæ–‡ä»¶åå­—
                // ç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯mapç±»å‹ï¼Œä»£è¡¨æ¨¡ç‰ˆå‚æ•°
                // gin.H æ˜¯map[string]interface{}ç±»å‹çš„åˆ«å
		c.HTML(http.StatusOK, "index.html", gin.H{
			"title": "Main website",
		})
	})
        // å¯åŠ¨httpæœåŠ¡ï¼Œå¹¶ä¸”ç»‘å®šåœ¨8080ç«¯å£
	router.Run(":8080")
}
```

æ¨¡ç‰ˆä»£ç 

æ–‡ä»¶åï¼štemplates/index.html

```go
import (
    "fmt"

    "github.com/gin-gonic/gin"
)

func main() {

    router := gin.Default()

    router.GET("/cookie", func(c *gin.Context) {
       // è®¾ç½®cookie
       c.SetCookie("site_cookie", "cookievalue", 3600, "/", "localhost", false, true)
    })

    router.Run()/h1>
</html>
```



## Ginæ¡†æ¶å¦‚ä½•å¤„ç†cookie

cookieé€šå¸¸ç”¨äºåœ¨æµè§ˆå™¨ä¸­ä¿å­˜ä¸€äº›å°æ•°æ®ï¼Œä¾‹å¦‚å®¢æˆ·æ ‡è¯†ã€ç”¨æˆ·éé“­æ„Ÿæ•°æ®ã€‚æ³¨æ„åˆ«ä½¿ç”¨cookieä¿å­˜éšç§æ•°æ®ã€‚

ginæ¡†æ¶ä¸»è¦é€šè¿‡ä¸Šä¸‹æ–‡å¯¹è±¡æä¾›çš„SetCookieå’ŒCookieä¸¤ä¸ªå‡½æ•°æ“ä½œcookie



### è®¾ç½®cookie

```go
import (
    "fmt"

    "github.com/gin-gonic/gin"
)

func main() {

    router := gin.Default()

    router.GET("/cookie", func(c *gin.Context) {
       // è®¾ç½®cookie
       c.SetCookie("site_cookie", "cookievalue", 3600, "/", "localhost", false, true)
    })

    router.Run()
}
```

SetCookieå‡½æ•°å®šä¹‰ï¼š

```go
func (c *Context) SetCookie(name, value string, maxAge int, path, domain string, secure, httpOnly bool)
```

å‚æ•°è¯´æ˜ï¼š

| å‚æ•°å   | ç±»å‹   | è¯´æ˜                                                         |
| -------- | ------ | ------------------------------------------------------------ |
| name     | string | cookieåå­—                                                   |
| value    | string | cookieå€¼                                                     |
| maxAge   | int    | æœ‰æ•ˆæ—¶é—´ï¼Œå•ä½æ˜¯ç§’ï¼ŒMaxAge=0 å¿½ç•¥MaxAgeå±æ€§ï¼ŒMaxAge<0 ç›¸å½“äºåˆ é™¤cookie, é€šå¸¸å¯ä»¥è®¾ç½®-1ä»£è¡¨åˆ é™¤ï¼ŒMaxAge>0 å¤šå°‘ç§’åcookieå¤±æ•ˆ |
| path     | string | cookieè·¯å¾„                                                   |
| domain   | string | cookieä½œç”¨åŸŸ                                                 |
| secure   | bool   | Secure=trueï¼Œé‚£ä¹ˆè¿™ä¸ªcookieåªèƒ½ç”¨httpsåè®®å‘é€ç»™æœåŠ¡å™¨       |
| httpOnly | bool   | è®¾ç½®HttpOnly=trueçš„cookieä¸èƒ½è¢«jsè·å–åˆ°                      |



### è¯»å– cookie

```go
func Handler(c *gin.Context) {
      // æ ¹æ®cookieåå­—è¯»å–cookieå€¼
      data, err := c.Cookie("site_cookie")
      if err != nil {
	 // ç›´æ¥è¿”å›cookieå€¼
	 c.String(200,data)
	 return
      }
      c.String(200,"not found!")
}
```



### åˆ é™¤ cookie

é€šè¿‡å°†cookieçš„MaxAgeè®¾ç½®ä¸º-1, è¾¾åˆ°åˆ é™¤cookieçš„ç›®çš„ã€‚

```go
func Handler(c *gin.Context) {
      // è®¾ç½®cookie  MaxAgeè®¾ç½®ä¸º-1ï¼Œè¡¨ç¤ºåˆ é™¤cookie
       c.SetCookie("site_cookie", "cookievalue", -1, "/", "localhost", false, true)
      c.String(200,"åˆ é™¤cookieæ¼”ç¤º")
}
```



## Go å’Œ Gin å¼€å‘ RESTful API

+ [å®˜æ–¹æ¡ˆä¾‹](https://go.p2hp.com/go.dev/doc/tutorial/web-service-gin)



## Gin æºç å­¦ä¹ 

Gin çš„æºç ä¸»è¦ç”±ä»¥ä¸‹å‡ éƒ¨åˆ†ç»„æˆ:

1. `Engine`:ä»£è¡¨ä¸€ä¸ª Gin å®ä¾‹,ç»´æŠ¤ä¸­é—´ä»¶ã€è·¯ç”±ä¿¡æ¯ç­‰

2. `Router`:å®ç°è·¯ç”±æŸ¥æ‰¾åŠåˆ†å‘è¯·æ±‚çš„é€»è¾‘

3. `Context`:å°è£… Request å’Œ Response,æä¾›ä¸€ç³»åˆ—æ–¹ä¾¿çš„æ–¹æ³•è®¿é—® request/response

4. `Middleware`: ä¸­é—´ä»¶ç›¸å…³ä»£ç 

5. `Render`: æä¾› JSONã€XMLã€YAMLã€HTML ç­‰å“åº”æ¸²æŸ“æ–¹æ³•

6. `File`: æ–‡ä»¶ä¸Šä¼ åŠæœåŠ¡ç›¸å…³æ–¹æ³•

7. `ErrorHandler`:  é”™è¯¯å¤„ç†ä¸­é—´ä»¶

è¿™äº›éƒ¨åˆ†ç»„åˆåœ¨ä¸€èµ·,æ„æˆäº† Gin è¿™ä¸ªè½»é‡çº§ Web æ¡†æ¶ã€‚





## END é“¾æ¥

<ul><li><div><a href = '67.md' style='float:left'>â¬†ï¸ä¸Šä¸€èŠ‚ğŸ”—  </a><a href = '69.md' style='float: right'>  ï¸ä¸‹ä¸€èŠ‚ğŸ”—</a></div></li></ul>

+ [â“‚ï¸å›åˆ°ç›®å½•ğŸ ](../README.md)

+ [**ğŸ«µå‚ä¸è´¡çŒ®ğŸ’â¤ï¸â€ğŸ”¥ğŸ’–**](https://nsddd.top/archives/contributors))

+ âœ´ï¸ç‰ˆæƒå£°æ˜ &copy; ï¼šæœ¬ä¹¦æ‰€æœ‰å†…å®¹éµå¾ª[CC-BY-SA 3.0åè®®ï¼ˆç½²å-ç›¸åŒæ–¹å¼å…±äº«ï¼‰&copy;](http://zh.wikipedia.org/wiki/Wikipedia:CC-by-sa-3.0åè®®æ–‡æœ¬) 
