+ [author](http://nsddd.top)

# ç¬¬83èŠ‚ Custom actions

<div><a href = '82.md' style='float:left'>â¬†ï¸ä¸Šä¸€èŠ‚ğŸ”—  </a><a href = '84.md' style='float: right'>  â¬‡ï¸ä¸‹ä¸€èŠ‚ğŸ”—</a></div>
<br>

> â¤ï¸ğŸ’•ğŸ’•è®°å½•[sealos](https://github.com/cubxxw/sealos)å¼€æºé¡¹ç›®çš„å­¦ä¹ è¿‡ç¨‹ã€‚[k8s,dockerå’Œäº‘åŸç”Ÿçš„å­¦ä¹ ](https://github.com/cubxxw/sealos)ã€‚Myblog:[http://nsddd.top](http://nsddd.top/)

---
[TOC]



## åˆ›å»º actions

**actions æ˜¯å¯ä»¥è”åˆæ”¶å‰²æœºä»¥åˆ›å»ºä½œä¸šå’Œè‡ªå®šä¹‰å·¥ä½œæµçš„å•ä¸ªä»»åŠ¡ã€‚æ‚¨å¯ä»¥åˆ›å»ºè‡ªå·±çš„æ“ä½œï¼Œæˆ–ä½¿ç”¨å’Œè‡ªå®šä¹‰GitHubç¤¾åŒºå…±äº«çš„æ“ä½œã€‚**

å¯ä»¥é€šè¿‡ç¼–å†™è‡ªå®šä¹‰ä»£ç æ¥åˆ›å»ºæ“ä½œï¼Œè¿™äº›ä»£ç å¯ä»¥ä»¥æ‚¨å–œæ¬¢çš„ä»»ä½•æ–¹å¼ä¸æ‚¨çš„å­˜å‚¨åº“è¿›è¡Œäº¤äº’ï¼ŒåŒ…æ‹¬ä¸GitHubçš„APIå’Œä»»ä½•å…¬å¼€å¯ç”¨çš„ç¬¬ä¸‰æ–¹APIé›†æˆã€‚

å¯ä»¥ç¼–å†™è‡ªå·±çš„æ“ä½œä»¥åœ¨å·¥ä½œæµä¸­ä½¿ç”¨ï¼Œæˆ–ä¸GitHubç¤¾åŒºå…±äº«æ‚¨æ„å»ºçš„æ“ä½œã€‚è¦ä¸æ‰€æœ‰äººå…±äº«æ‚¨æ„å»ºçš„æ“ä½œï¼Œæ‚¨çš„å­˜å‚¨åº“å¿…é¡»æ˜¯å…¬å…±çš„ã€‚

æ“ä½œå¯ä»¥ç›´æ¥åœ¨æœºå™¨ä¸Šæˆ–Dockerå®¹å™¨ä¸­è¿è¡Œã€‚æ‚¨å¯ä»¥å®šä¹‰æ“ä½œçš„è¾“å…¥ã€è¾“å‡ºå’Œç¯å¢ƒå˜é‡ã€‚

å¯ä»¥æ„å»ºDockerå®¹å™¨ã€JavaScriptå’Œå¤åˆæ“ä½œã€‚æ“ä½œéœ€è¦ä¸€ä¸ªå…ƒæ•°æ®æ–‡ä»¶æ¥å®šä¹‰æ“ä½œçš„è¾“å…¥ã€è¾“å‡ºå’Œä¸»å…¥å£ç‚¹ã€‚å…ƒæ•°æ®æ–‡ä»¶åå¿…é¡»ä¸º `action.yml` æˆ– `action.yaml` ã€‚æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜…â€œGitHubæ“ä½œçš„å…ƒæ•°æ®è¯­æ³•ã€‚â€œ



## docker å®¹å™¨æ“ä½œ

Dockerå®¹å™¨ç”¨GitHub Actionsä»£ç æ‰“åŒ…ç¯å¢ƒã€‚è¿™åˆ›å»ºäº†ä¸€ä¸ªæ›´åŠ ä¸€è‡´å’Œå¯é çš„å·¥ä½œå•å…ƒï¼Œå› ä¸ºæ“ä½œçš„ä½¿ç”¨è€…ä¸éœ€è¦æ‹…å¿ƒå·¥å…·æˆ–ä¾èµ–é¡¹ã€‚

Dockerå®¹å™¨å…è®¸æ‚¨ä½¿ç”¨ç‰¹å®šç‰ˆæœ¬çš„æ“ä½œç³»ç»Ÿã€ä¾èµ–é¡¹ã€å·¥å…·å’Œä»£ç ã€‚å¯¹äºå¿…é¡»åœ¨ç‰¹å®šç¯å¢ƒé…ç½®ä¸­è¿è¡Œçš„æ“ä½œï¼ŒDockeræ˜¯ç†æƒ³çš„é€‰æ‹©ï¼Œå› ä¸ºæ‚¨å¯ä»¥è‡ªå®šä¹‰æ“ä½œç³»ç»Ÿå’Œå·¥å…·ã€‚



## å¯¹æ“ä½œè¿›è¡Œå‘å¸ƒç®¡ç†

å¦‚æœæ‚¨æ­£åœ¨å¼€å‘ä¾›å…¶ä»–äººä½¿ç”¨çš„æ“ä½œï¼Œæˆ‘ä»¬å»ºè®®ä½¿ç”¨å‘å¸ƒç®¡ç†æ¥æ§åˆ¶åˆ†å‘æ›´æ–°çš„æ–¹å¼ã€‚

ç”¨æˆ·å¯ä»¥æœŸæœ›æ“ä½œçš„ä¿®è¡¥ç¨‹åºç‰ˆæœ¬åŒ…æ‹¬å¿…è¦çš„å…³é”®ä¿®å¤ç¨‹åºå’Œå®‰å…¨ä¿®è¡¥ç¨‹åºï¼ŒåŒæ—¶ä»ä¸å…¶ç°æœ‰å·¥ä½œæµä¿æŒå…¼å®¹ã€‚æ¯å½“æ‚¨çš„æ›´æ”¹å½±å“å…¼å®¹æ€§æ—¶ï¼Œæ‚¨åº”è¯¥è€ƒè™‘å‘å¸ƒæ–°çš„ä¸»ç‰ˆæœ¬ã€‚

åœ¨è¿™ç§å‘å¸ƒç®¡ç†æ–¹æ³•ä¸‹ï¼Œç”¨æˆ·ä¸åº”è¯¥å¼•ç”¨æ“ä½œçš„é»˜è®¤åˆ†æ”¯ï¼Œå› ä¸ºå®ƒå¯èƒ½åŒ…å«æœ€æ–°çš„ä»£ç ï¼Œå› æ­¤å¯èƒ½ä¸ç¨³å®šã€‚

ç›¸åï¼Œæ‚¨å¯ä»¥å»ºè®®ç”¨æˆ·åœ¨ä½¿ç”¨æ‚¨çš„æ“ä½œæ—¶æŒ‡å®šä¸€ä¸ªä¸»è¦ç‰ˆæœ¬ï¼Œå¹¶ä¸”ä»…åœ¨é‡åˆ°é—®é¢˜æ—¶æ‰å°†ä»–ä»¬å¼•å¯¼åˆ°æ›´å…·ä½“çš„ç‰ˆæœ¬ã€‚

è¦ä½¿ç”¨ç‰¹å®šçš„æ“ä½œç‰ˆæœ¬ï¼Œç”¨æˆ·å¯ä»¥é…ç½®ä»–ä»¬çš„GitHubæ“ä½œå·¥ä½œæµï¼Œä»¥é’ˆå¯¹æ ‡ç­¾ï¼Œæäº¤çš„SHAæˆ–ä»¥å‘å¸ƒå‘½åçš„åˆ†æ”¯ã€‚



## ä½¿ç”¨æ ‡ç­¾è¿›è¡Œå‘å¸ƒç®¡ç†

æˆ‘ä»¬å»ºè®®ä½¿ç”¨æ ‡ç­¾è¿›è¡Œæ“ä½œå‘å¸ƒç®¡ç†ã€‚ä½¿ç”¨æ­¤æ–¹æ³•ï¼Œæ‚¨çš„ç”¨æˆ·å¯ä»¥è½»æ¾åŒºåˆ†ä¸»ç‰ˆæœ¬å’Œæ¬¡ç‰ˆæœ¬ï¼š

+ åœ¨åˆ›å»ºå‘å¸ƒæ ‡ç­¾ï¼ˆä¾‹å¦‚ `v1.0.2` ï¼‰ä¹‹å‰ï¼Œåœ¨å‘å¸ƒåˆ†æ”¯ï¼ˆä¾‹å¦‚ `release/v1` ï¼‰ä¸Šåˆ›å»ºå¹¶éªŒè¯å‘å¸ƒã€‚
+ ä½¿ç”¨è¯­ä¹‰ç‰ˆæœ¬æ§åˆ¶åˆ›å»ºå‘å¸ƒ
  + æ–‡ä»¶åˆ—è¡¨çš„å³ä¾§ï¼Œå•å‡»**Releases**
  + é¡µé¢é¡¶éƒ¨ï¼Œå•å‡»**è‰æ‹Ÿæ–°ç‰ˆæœ¬**ã€‚
  + è¦ä¸ºå‘å¸ƒé€‰æ‹©æ ‡ç­¾ï¼Œè¯·é€‰æ‹©**é€‰æ‹©æ ‡ç­¾**ä¸‹æ‹‰èœå•ã€‚
  + å¦‚æœæ‚¨åˆ›å»ºäº†ä¸€ä¸ªæ–°æ ‡ç­¾ï¼Œè¯·é€‰æ‹©**ç›®æ ‡**ä¸‹æ‹‰èœå•ï¼Œç„¶åå•å‡»åŒ…å«æ‚¨è¦å‘å¸ƒçš„é¡¹ç›®çš„åˆ†æ”¯ã€‚
  + åœ¨â€œæè¿°æ­¤ç‰ˆæœ¬â€å­—æ®µä¸­ï¼Œä¸ºæ‚¨çš„ç‰ˆæœ¬é”®å…¥æè¿°ã€‚å¦‚æœæ‚¨åœ¨æè¿°ä¸­ `@mention` ä»»ä½•äººï¼Œå‘å¸ƒçš„ç‰ˆæœ¬å°†åŒ…å«ä¸€ä¸ª**è´¡çŒ®è€…**éƒ¨åˆ†ï¼Œå…¶ä¸­åŒ…å«æ‰€æœ‰æåŠç”¨æˆ·çš„å¤´åƒåˆ—è¡¨ã€‚æˆ–è€…ï¼Œæ‚¨å¯ä»¥é€šè¿‡å•å‡»ç”Ÿæˆå‘è¡Œè¯´æ˜è‡ªåŠ¨**ç”Ÿæˆå‘è¡Œè¯´æ˜**ã€‚
  + æˆ–è€…ï¼Œè¦åœ¨æ‚¨çš„ç‰ˆæœ¬ä¸­åŒ…å«äºŒè¿›åˆ¶æ–‡ä»¶ï¼ˆä¾‹å¦‚å·²ç¼–è¯‘çš„ç¨‹åºï¼‰ï¼Œè¯·åœ¨äºŒè¿›åˆ¶æ–‡ä»¶æ¡†ä¸­æ‹–æ”¾æˆ–æ‰‹åŠ¨é€‰æ‹©æ–‡ä»¶
  + æˆ–è€…ï¼Œé€‰æ‹©**è®¾ç½®ä¸ºæœ€æ–°ç‰ˆæœ¬**ã€‚å¦‚æœä¸é€‰æ‹©æ­¤é€‰é¡¹ï¼Œå°†æ ¹æ®è¯­ä¹‰ç‰ˆæœ¬æ§åˆ¶è‡ªåŠ¨åˆ†é…æœ€æ–°ç‰ˆæœ¬æ ‡ç­¾ã€‚
  + å¦‚æœæ‚¨å‡†å¤‡å¥½å‘å¸ƒæ‚¨çš„ç‰ˆæœ¬ï¼Œè¯·å•å‡»**å‘å¸ƒç‰ˆæœ¬**ã€‚è¦ç¨åå¤„ç†è¯¥ç‰ˆæœ¬ï¼Œè¯·å•å‡»**ä¿å­˜è‰ç¨¿**ã€‚ç„¶åï¼Œæ‚¨å¯ä»¥åœ¨å­˜å‚¨åº“çš„å‘å¸ƒæè¦ä¸­æŸ¥çœ‹å·²å‘å¸ƒæˆ–è‰ç¨¿çš„å‘å¸ƒã€‚æœ‰å…³è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…â€œ[æŸ¥çœ‹å­˜å‚¨åº“çš„ç‰ˆæœ¬å’Œæ ‡ç­¾](https://docs.github.com/en/repositories/releasing-projects-on-github/viewing-your-repositorys-releases-and-tags)â€ã€‚
+ ç§»åŠ¨major versionæ ‡ç­¾ï¼ˆä¾‹å¦‚ `v1` ã€ `v2` ï¼‰ï¼ŒæŒ‡å‘å½“å‰ç‰ˆæœ¬çš„Git refã€‚ä¾‹å¦‚ï¼š` git tag -a v1.4 -m "my version 1.4"`
+ å¼•å…¥æ–°çš„ä¸»è¦ç‰ˆæœ¬æ ‡è®°ï¼ˆ `v2` ï¼‰ï¼Œç”¨äºå°†ç ´åç°æœ‰å·¥ä½œæµçš„æ›´æ”¹ã€‚ä¾‹å¦‚ï¼Œæ›´æ”¹æ“ä½œçš„è¾“å…¥å°†æ˜¯ä¸€ä¸ªçªç ´æ€§çš„æ›´æ”¹ã€‚
+ ä¸»è¦ç‰ˆæœ¬æœ€åˆå¯ä»¥ä½¿ç”¨ `beta` æ ‡ç­¾å‘å¸ƒï¼Œä»¥æŒ‡ç¤ºå…¶çŠ¶æ€ï¼Œä¾‹å¦‚ `v2-beta` ã€‚ `-beta` æ ‡ç­¾å¯ä»¥åœ¨å‡†å¤‡å¥½æ—¶ç§»é™¤ã€‚

### å¸¦æœ‰æŸ¥è¯¢å‚æ•°çš„å‘å¸ƒè¡¨å•è‡ªåŠ¨åŒ–

> è¦é€šè¿‡ä½¿ç”¨è‡ªå®šä¹‰ä¿¡æ¯è‡ªåŠ¨å¡«å……æ–°å‘å¸ƒè¡¨å•æ¥å¿«é€Ÿåˆ›å»ºå‘å¸ƒï¼Œæ‚¨å¯ä»¥å°†æŸ¥è¯¢å‚æ•°æ·»åŠ åˆ°å‘å¸ƒè¡¨å•é¡µé¢çš„ URLã€‚

æŸ¥è¯¢å‚æ•°æ˜¯ URL çš„å¯é€‰éƒ¨åˆ†ï¼Œæ‚¨å¯ä»¥è‡ªå®šä¹‰ä»¥å…±äº«ç‰¹å®šç½‘é¡µè§†å›¾ï¼Œä¾‹å¦‚æœç´¢ç­›é€‰ç»“æœã€é—®é¢˜æ¨¡æ¿æˆ– GitHub ä¸Šçš„å‘å¸ƒè¡¨å•é¡µé¢ã€‚è¦åˆ›å»ºè‡ªå·±çš„æŸ¥è¯¢å‚æ•°ï¼Œæ‚¨å¿…é¡»åŒ¹é…é”®å€¼å¯¹ã€‚

| æŸ¥è¯¢å‚æ•°     | ä¾‹å­                                                         |
| :----------- | :----------------------------------------------------------- |
| `tag`        | `https://github.com/octo-org/octo-repo/releases/new?tag=v1.0.1`åŸºäºåä¸ºâ€œv1.0.1â€çš„æ ‡ç­¾åˆ›å»ºä¸€ä¸ªç‰ˆæœ¬ã€‚ |
| `target`     | `https://github.com/octo-org/octo-repo/releases/new?target=release-1.0.1`æ ¹æ®å¯¹â€œrelease-1.0.1â€åˆ†æ”¯çš„æœ€æ–°æäº¤åˆ›å»ºä¸€ä¸ªç‰ˆæœ¬ã€‚ |
| `title`      | `https://github.com/octo-org/octo-repo/releases/new?tag=v1.0.1&title=octo-1.0.1`åŸºäºåä¸ºâ€œv1.0.1â€çš„æ ‡ç­¾åˆ›å»ºåä¸ºâ€œocto-1.0.1â€çš„ç‰ˆæœ¬ã€‚ |
| `body`       | `https://github.com/octo-org/octo-repo/releases/new?body=Adds+widgets+support`åœ¨å‘å¸ƒæ­£æ–‡ä¸­åˆ›å»ºä¸€ä¸ªå¸¦æœ‰æè¿°â€œæ·»åŠ å°éƒ¨ä»¶æ”¯æŒâ€çš„å‘å¸ƒã€‚ |
| `prerelease` | `https://github.com/octo-org/octo-repo/releases/new?prerelease=1`åˆ›å»ºä¸€ä¸ªå°†è¢«æ ‡è¯†ä¸ºéç”Ÿäº§å°±ç»ªçš„ç‰ˆæœ¬ã€‚ |



### å¦‚ä½•å¼•ç”¨ç‰ˆæœ¬

æ­¤ç¤ºä¾‹æ¼”ç¤ºäº†ç”¨æˆ·å¦‚ä½•å¼•ç”¨ä¸»è¦ç‰ˆæœ¬æ ‡è®°ï¼š

```
steps:
    - uses: actions/javascript-action@v1
```

æ­¤ç¤ºä¾‹æ¼”ç¤ºäº†ç”¨æˆ·å¦‚ä½•å¼•ç”¨ç‰¹å®šçš„ä¿®è¡¥ç¨‹åºç‰ˆæœ¬æ ‡è®°ï¼š

```
steps:
    - uses: actions/javascript-action@v1.0.1
```



## ä½¿ç”¨åˆ†æ”¯è¿›è¡Œç‰ˆæœ¬ç®¡ç†

å¦‚æœæ‚¨æ›´å–œæ¬¢ä½¿ç”¨åˆ†æ”¯åç§°è¿›è¡Œå‘å¸ƒç®¡ç†ï¼Œåˆ™æ­¤ç¤ºä¾‹æ¼”ç¤ºå¦‚ä½•å¼•ç”¨å‘½ååˆ†æ”¯ï¼š

```yaml
steps:
    - uses: actions/javascript-action@v1-beta
```



## ä½¿ç”¨æäº¤çš„SHAè¿›è¡Œå‘å¸ƒç®¡ç†

æ¯ä¸ªGitæäº¤éƒ½ä¼šæ”¶åˆ°ä¸€ä¸ªè®¡ç®—å‡ºæ¥çš„SHAå€¼ï¼Œè¿™ä¸ªå€¼æ˜¯å”¯ä¸€çš„ï¼Œä¸å¯å˜çš„ã€‚ä½ çš„åŠ¨ä½œçš„ç”¨æˆ·å¯èƒ½æ›´å–œæ¬¢ä¾èµ–äºæäº¤çš„SHAå€¼ï¼Œå› ä¸ºè¿™ç§æ–¹æ³•æ¯”æŒ‡å®šä¸€ä¸ªæ ‡ç­¾æ›´å¯é ï¼Œè€Œæ ‡ç­¾å¯èƒ½ä¼šè¢«åˆ é™¤æˆ–ç§»åŠ¨ã€‚

ä½†æ˜¯ï¼Œè¿™æ„å‘³ç€ç”¨æˆ·å°†ä¸ä¼šæ”¶åˆ°å¯¹æ“ä½œçš„è¿›ä¸€æ­¥æ›´æ–°ã€‚æ‚¨å¿…é¡»ä½¿ç”¨æäº¤çš„å®Œæ•´SHAå€¼ï¼Œè€Œä¸æ˜¯ç¼©å†™å€¼ã€‚

```yaml
steps:
    - uses: actions/javascript-action@a824008085750b8e136effc585c3cd6082bd575f
```



##  GitHub actions å’Œ GitHub apps çš„å¯¹æ¯”

è™½ç„¶GitHub Actionså’ŒGitHub Appséƒ½æä¾›äº†æ„å»ºè‡ªåŠ¨åŒ–å’Œå·¥ä½œæµå·¥å…·çš„æ–¹æ³•ï¼Œä½†å®ƒä»¬å„è‡ªéƒ½æœ‰ä¼˜åŠ¿ï¼Œä½¿å®ƒä»¬åœ¨ä¸åŒçš„æ–¹é¢å‘æŒ¥ä½œç”¨ã€‚

**GitHub appsï¼š**

- æŒç»­è¿è¡Œï¼Œå¹¶èƒ½å¿«é€Ÿå“åº”äº‹ä»¶ã€‚
- åœ¨éœ€è¦æŒä¹…æ€§æ•°æ®æ—¶å·¥ä½œå‡ºè‰²ã€‚
- æœ€é€‚åˆä¸è€—æ—¶çš„APIè¯·æ±‚ã€‚
- åœ¨æ‚¨æä¾›çš„æœåŠ¡å™¨æˆ–è®¡ç®—åŸºç¡€æ¶æ„ä¸Šè¿è¡Œã€‚

**GitHub actionsï¼š**

- æä¾›å¯æ‰§è¡ŒæŒç»­é›†æˆå’ŒæŒç»­éƒ¨ç½²çš„è‡ªåŠ¨åŒ–ã€‚
- å¯ä»¥ç›´æ¥åœ¨runneræœºå™¨æˆ–Dockerå®¹å™¨ä¸­è¿è¡Œã€‚
- å¯ä»¥åŒ…æ‹¬å¯¹å­˜å‚¨åº“çš„å…‹éš†çš„è®¿é—®ï¼Œä»è€Œä½¿éƒ¨ç½²å’Œå‘å¸ƒå·¥å…·ã€ä»£ç æ ¼å¼åŒ–ç¨‹åºå’Œå‘½ä»¤è¡Œå·¥å…·èƒ½å¤Ÿè®¿é—®ä»£ç ã€‚
- ä¸éœ€è¦éƒ¨ç½²ä»£ç æˆ–æä¾›åº”ç”¨ç¨‹åºã€‚
- æœ‰ä¸€ä¸ªç®€å•çš„ç•Œé¢æ¥åˆ›å»ºå’Œä½¿ç”¨secretï¼Œå®ƒä½¿æ“ä½œèƒ½å¤Ÿä¸ç¬¬ä¸‰æ–¹æœåŠ¡äº¤äº’ï¼Œè€Œæ— éœ€å­˜å‚¨ä½¿ç”¨æ“ä½œçš„äººçš„å‡­æ®ã€‚



## åˆ›å»º docker å®¹å™¨ actions

ä½ å°†äº†è§£åˆ›å»ºå’Œä½¿ç”¨æ‰“åŒ…çš„Dockerå®¹å™¨æ“ä½œæ‰€éœ€çš„åŸºæœ¬ç»„ä»¶ã€‚ä¸ºäº†å°†æœ¬æŒ‡å—çš„é‡ç‚¹æ”¾åœ¨æ‰“åŒ…æ“ä½œæ‰€éœ€çš„ç»„ä»¶ä¸Šï¼Œæ“ä½œä»£ç çš„åŠŸèƒ½æ˜¯æœ€å°çš„ã€‚



### Creating a Dockerfile

åœ¨æ–°çš„ `hello-world-docker-action` ç›®å½•ä¸­ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„ `Dockerfile` æ–‡ä»¶ã€‚å¦‚æœæ‚¨é‡åˆ°é—®é¢˜ï¼Œè¯·ç¡®ä¿æ–‡ä»¶åçš„å¤§å†™æ­£ç¡®ï¼ˆä½¿ç”¨å¤§å†™ `D` è€Œä¸æ˜¯å¤§å†™ `f` ï¼‰ã€‚

```go
# Container image that runs your code
FROM alpine:3.10

# Copies your code file from your action repository to the filesystem path `/` of the container
COPY entrypoint.sh /entrypoint.sh

# Code file to execute when the docker container starts up (`entrypoint.sh`)
ENTRYPOINT ["/entrypoint.sh"]
```



### å…ƒæ•°æ® actions è¯­æ³•

æ‰€æœ‰æ“ä½œéƒ½éœ€è¦ä¸€ä¸ªå…ƒæ•°æ®æ–‡ä»¶ã€‚å…ƒæ•°æ®æ–‡ä»¶åå¿…é¡»æ˜¯`action.yml`æˆ–`action.yaml`. å…ƒæ•°æ®æ–‡ä»¶ä¸­çš„æ•°æ®ä¸ºæ‚¨çš„æ“ä½œå®šä¹‰è¾“å…¥ã€è¾“å‡ºå’Œè¿è¡Œé…ç½®ã€‚

+ nameï¼š**å¿…å¡«**ã€‚æ‚¨çš„æ“ä½œçš„åç§°ã€‚`name`GitHubåœ¨**æ“ä½œ**é€‰é¡¹å¡ä¸­æ˜¾ç¤ºï¼Œä»¥å¸®åŠ©ç›´è§‚åœ°è¯†åˆ«æ¯ä¸ªä½œä¸šä¸­çš„æ“ä½œã€‚
+ descriptionï¼š*å¯é€‰*ã€‚å¯¹æ‚¨çš„æ“ä½œè¿›è¡Œç®€çŸ­çš„æè¿°ã€‚GitHubå°†åœ¨æ“ä½œçš„è¯¦ç»†ä¿¡æ¯é¡µé¢ä¸Šæ˜¾ç¤ºæ­¤æè¿°ã€‚
+ authorï¼š*å¯é€‰*ã€‚æ“ä½œçš„ä½œè€…æˆ–ç»„ç»‡åç§°ã€‚
+ inputsï¼š*å¯é€‰*ã€‚å®šä¹‰æ“ä½œçš„è¾“å…¥å‚æ•°ã€‚æ¯ä¸ªè¾“å…¥éƒ½æ˜¯ä¸€ä¸ªé”®å€¼å¯¹ï¼Œå…¶ä¸­é”®æ˜¯å‚æ•°åç§°ï¼Œå€¼æ˜¯æè¿°è¯¥å‚æ•°çš„å±æ€§ã€‚å±æ€§åŒ…æ‹¬`description`ã€`required`å’Œ`default`ã€‚
+ outputsï¼š*å¯é€‰*ã€‚å®šä¹‰æ“ä½œçš„è¾“å‡ºå‚æ•°ã€‚æ¯ä¸ªè¾“å‡ºéƒ½æ˜¯ä¸€ä¸ªé”®å€¼å¯¹ï¼Œå…¶ä¸­é”®æ˜¯å‚æ•°åç§°ï¼Œå€¼æ˜¯æè¿°è¯¥å‚æ•°çš„å±æ€§ã€‚å±æ€§åŒ…æ‹¬`description`å’Œ`value`ã€‚
+ runsï¼š**å¿…å¡«**ã€‚å®šä¹‰æ“ä½œçš„è¿è¡Œé…ç½®ã€‚è¿è¡Œé…ç½®æŒ‡å®šæ“ä½œåº”è¯¥è¿è¡Œåœ¨å“ªä¸ªæ“ä½œç³»ç»Ÿå’Œç¯å¢ƒä¸­ã€‚è¿è¡Œé…ç½®åŒ…æ‹¬`using`ã€`image`å’Œ`args`ã€‚
+ brandingï¼š **å¯é€‰**æ‚¨å¯ä»¥ä½¿ç”¨é¢œè‰²å’Œ[ç¾½æ¯›](https://feathericons.com/)å›¾æ ‡åˆ›å»ºå¾½ç« æ¥ä¸ªæ€§åŒ–å’ŒåŒºåˆ†æ‚¨çš„æ“ä½œã€‚å¾½ç« æ˜¾ç¤ºåœ¨[GitHub Marketplace](https://github.com/marketplace?type=actions)ä¸­æ‚¨çš„æ“ä½œåç§°æ—è¾¹ã€‚



**æŒ‡å®šè¾“å…¥ï¼š**

```yaml
inputs:
  num-octocats:
    description: 'Number of Octocats'
    required: false
    default: '1'
  octocat-eye-color:
    description: 'Eye color of the Octocats'
    required: true
```

æ­¤ç¤ºä¾‹é…ç½®ä¸¤ä¸ªè¾“å…¥ï¼š`num-octocats`å’Œ`octocat-eye-color`ã€‚è¾“å…¥`num-octocats`ä¸æ˜¯å¿…éœ€çš„ï¼Œé»˜è®¤å€¼ä¸ºâ€œ1â€ï¼›`octocat-eye-color`æ˜¯å¿…éœ€çš„ï¼Œæ²¡æœ‰é»˜è®¤å€¼ã€‚ä½¿ç”¨æ­¤æ“ä½œçš„å·¥ä½œæµæ–‡ä»¶å¿…é¡»ä½¿ç”¨`with`å…³é”®å­—ä¸º è®¾ç½®è¾“å…¥å€¼`octocat-eye-color`ã€‚

å½“æ‚¨åœ¨å·¥ä½œæµæ–‡ä»¶ä¸­æŒ‡å®šè¾“å…¥æˆ–ä½¿ç”¨é»˜è®¤è¾“å…¥å€¼æ—¶ï¼ŒGitHub ä¼šä¸ºè¾“å…¥åˆ›å»ºä¸€ä¸ªåä¸º çš„ç¯å¢ƒå˜é‡`INPUT_<VARIABLE_NAME>`ã€‚åˆ›å»ºçš„ç¯å¢ƒå˜é‡å°†è¾“å…¥åç§°è½¬æ¢ä¸ºå¤§å†™å­—æ¯å¹¶å°†ç©ºæ ¼æ›¿æ¢ä¸º`_`å­—ç¬¦ã€‚

å¦‚æœ action æ˜¯ä½¿ç”¨[composite](https://docs.github.com/en/actions/creating-actions/creating-a-composite-action)ç¼–å†™çš„ï¼Œé‚£ä¹ˆå®ƒä¸ä¼šè‡ªåŠ¨è·å–`INPUT_<VARIABLE_NAME>`ã€‚å¦‚æœæ²¡æœ‰å‘ç”Ÿè½¬æ¢ï¼Œæ‚¨å¯ä»¥æ‰‹åŠ¨æ›´æ”¹è¿™äº›è¾“å…¥ã€‚

è¦è®¿é—® Docker å®¹å™¨æ“ä½œä¸­çš„ç¯å¢ƒå˜é‡ï¼Œæ‚¨å¿…é¡»ä½¿ç”¨`args`æ“ä½œå…ƒæ•°æ®æ–‡ä»¶ä¸­çš„å…³é”®å­—ä¼ é€’è¾“å…¥ã€‚æœ‰å…³ Docker å®¹å™¨æ“ä½œçš„æ“ä½œå…ƒæ•°æ®æ–‡ä»¶çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜…â€œ[åˆ›å»º Docker å®¹å™¨æ“ä½œ](https://docs.github.com/en/actions/creating-actions/creating-a-docker-container-action#creating-an-action-metadata-file)â€ã€‚

ä¾‹å¦‚ï¼Œå¦‚æœå·¥ä½œæµå®šä¹‰äº†`num-octocats`å’Œè¾“å…¥ï¼Œåˆ™æ“ä½œä»£ç å¯ä»¥ä½¿ç”¨å’Œç¯å¢ƒå˜é‡`octocat-eye-color`è¯»å–è¾“å…¥å€¼ã€‚`INPUT_NUM-OCTOCATS INPUT_OCTOCAT-EYE-COLOR`



**å‚æ•°**ï¼š

+ `inputs.<input_id>`: **å¿…éœ€**`string`ä¸è¾“å…¥å…³è”çš„æ ‡è¯†ç¬¦ã€‚çš„å€¼`<input_id>`æ˜¯è¾“å…¥å…ƒæ•°æ®çš„æ˜ å°„ã€‚å¿…é¡»`<input_id>`æ˜¯å¯¹è±¡å†…çš„å”¯ä¸€æ ‡è¯†ç¬¦`inputs`ã€‚å¿…é¡»`<input_id>`ä»¥å­—æ¯ or å¼€å¤´ï¼Œ`_`å¹¶ä¸”ä»…åŒ…å«å­—æ¯æ•°å­—å­—ç¬¦ ,`-`æˆ–`_`ã€‚

+ `inputs.<input_id>.description` : **å¿…éœ€**`string`å¯¹è¾“å…¥å‚æ•°çš„æè¿°ã€‚

- `inputs.<input_id>.required`: è¡¨ç¤ºè¯¥è¾“å…¥å‚æ•°æ˜¯å¦æ˜¯å¿…éœ€çš„ï¼Œå¦‚æœä¸º trueï¼Œåˆ™åœ¨è¿è¡Œå·¥ä½œæµç¨‹æ—¶å¿…é¡»æä¾›è¯¥è¾“å…¥å‚æ•°çš„å€¼ï¼Œå¦åˆ™å·¥ä½œæµç¨‹å°†å¤±è´¥ã€‚
- `inputs.<input_id>.default`: è¡¨ç¤ºè¯¥è¾“å…¥å‚æ•°çš„é»˜è®¤å€¼ï¼Œå¦‚æœåœ¨è¿è¡Œå·¥ä½œæµç¨‹æ—¶æœªæä¾›è¯¥è¾“å…¥å‚æ•°çš„å€¼ï¼Œåˆ™ä½¿ç”¨è¯¥é»˜è®¤å€¼ã€‚
- `inputs.<input_id>.env`: è¡¨ç¤ºå°†è¯¥è¾“å…¥å‚æ•°çš„å€¼ä½œä¸ºç¯å¢ƒå˜é‡ä¼ é€’ç»™å·¥ä½œæµç¨‹ä¸­çš„æ­¥éª¤ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥ä½¿ç”¨ `${{ env.INPUT_NAME }}` çš„æ–¹å¼åœ¨æ­¥éª¤ä¸­å¼•ç”¨è¯¥è¾“å…¥å‚æ•°çš„å€¼ã€‚
- `inputs.<input_id>.group`: è¡¨ç¤ºå°†è¯¥è¾“å…¥å‚æ•°åˆ†ç»„ï¼Œå¯ä»¥å°†å¤šä¸ªè¾“å…¥å‚æ•°åˆ†ç»„åˆ°åŒä¸€ä¸ªç»„ä¸­ï¼Œä»¥ä¾¿æ›´å¥½åœ°ç»„ç»‡å’Œæ˜¾ç¤ºå®ƒä»¬ã€‚





### åˆ›å»ºæ“ä½œå…ƒæ•°æ®æ–‡ä»¶

åœ¨ä¸Šé¢åˆ›å»ºçš„ `hello-world-docker-action` ç›®å½•ä¸­åˆ›å»ºä¸€ä¸ªæ–°çš„ `action.yml` æ–‡ä»¶ã€‚

```yaml
# action.yml
name: 'Hello World'
description: 'Greet someone and record the time'
inputs:
  who-to-greet:  # id of input
    description: 'Who to greet'
    required: true
    default: 'World'
outputs:
  time: # id of output
    description: 'The time we greeted you'
runs:
  using: 'docker'
  image: 'Dockerfile'
  args:
    - ${{ inputs.who-to-greet }}
```

è¯¥å…ƒæ•°æ®å®šä¹‰ä¸€ä¸ª `who-to-greet` è¾“å…¥å’Œä¸€ä¸ª `time` è¾“å‡ºå‚æ•°ã€‚è¦å°†è¾“å…¥ä¼ é€’ç»™Dockerå®¹å™¨ï¼Œæ‚¨åº”è¯¥ä½¿ç”¨ `inputs` å£°æ˜è¾“å…¥ï¼Œå¹¶åœ¨ `args` å…³é”®å­—ä¸­ä¼ é€’è¾“å…¥ã€‚æ‚¨åœ¨ `args` ä¸­åŒ…å«çš„æ‰€æœ‰å†…å®¹éƒ½å°†ä¼ é€’åˆ°å®¹å™¨ï¼Œä½†ä¸ºäº†è®©ç”¨æˆ·æ›´å¥½åœ°å‘ç°æ‚¨çš„æ“ä½œï¼Œæˆ‘ä»¬å»ºè®®ä½¿ç”¨è¾“å…¥ã€‚

GitHubå°†ä»æ‚¨çš„ Dockerfile æ„å»ºä¸€ä¸ªé•œåƒï¼Œå¹¶ä½¿ç”¨æ­¤é•œåƒåœ¨æ–°å®¹å™¨ä¸­è¿è¡Œå‘½ä»¤ã€‚



### ç¼–å†™æ“ä½œä»£ç 

ä½ å¯ä»¥é€‰æ‹©ä»»ä½•åŸºæœ¬çš„Dockeré•œåƒï¼Œå› æ­¤ï¼Œä½ çš„æ“ä½œä¹Ÿå¯ä»¥é€‰æ‹©ä»»ä½•è¯­è¨€ã€‚ä¸‹é¢çš„shellè„šæœ¬ç¤ºä¾‹ä½¿ç”¨ `who-to-greet` è¾“å…¥å˜é‡åœ¨æ—¥å¿—æ–‡ä»¶ä¸­æ‰“å°"Hello [who-to-greet]"ã€‚

æ¥ä¸‹æ¥ï¼Œè„šæœ¬è·å–å½“å‰æ—¶é—´ï¼Œå¹¶å°†å…¶è®¾ç½®ä¸ºè¾“å‡ºå˜é‡ï¼Œä½œä¸šä¸­ç¨åè¿è¡Œçš„æ“ä½œå¯ä»¥ä½¿ç”¨è¯¥è¾“å‡ºå˜é‡ã€‚ä¸ºäº†è®©GitHubè¯†åˆ«è¾“å‡ºå˜é‡ï¼Œä½ å¿…é¡»å°†å®ƒä»¬å†™å…¥ `$GITHUB_OUTPUT` ç¯å¢ƒæ–‡ä»¶ï¼š `echo "<output name>=<value>" >> $GITHUB_OUTPUT` .æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜…â€œGitHubæ“ä½œçš„å·¥ä½œæµå‘½ä»¤ã€‚â€œ

1. åœ¨ `hello-world-docker-action` ç›®å½•ä¸­åˆ›å»ºæ–°çš„ `entrypoint.sh` æ–‡ä»¶ã€‚

2. å°†ä»¥ä¸‹ä»£ç æ·»åŠ åˆ° `entrypoint.sh` æ–‡ä»¶ä¸­ã€‚

   ```bash
   #!/bin/sh -l
   
   echo "Hello $1"
   time=$(date)
   echo "time=$time" >> $GITHUB_OUTPUT
   ```

   > å¦‚æœ `entrypoint.sh` æ‰§è¡Œæ—¶æ²¡æœ‰ä»»ä½•é”™è¯¯ï¼Œåˆ™æ“ä½œçš„çŠ¶æ€è®¾ç½®ä¸º `success` ã€‚è¿˜å¯ä»¥åœ¨æ“ä½œä»£ç ä¸­æ˜¾å¼è®¾ç½®é€€å‡ºä»£ç ï¼Œä»¥æä¾›æ“ä½œçš„çŠ¶æ€ã€‚æœ‰å…³è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…â€œè®¾ç½®æ“ä½œçš„é€€å‡ºä»£ç ã€‚â€œ

3. ä½¿æ‚¨çš„ `entrypoint.sh` æ–‡ä»¶å¯æ‰§è¡Œã€‚Gitæä¾›äº†ä¸€ç§æ–¹æ³•æ¥æ˜¾å¼åœ°æ›´æ”¹æ–‡ä»¶çš„æƒé™æ¨¡å¼ï¼Œè¿™æ ·å®ƒå°±ä¸ä¼šåœ¨æ¯æ¬¡æœ‰å…‹éš†/åˆ†å‰æ—¶éƒ½è¢«é‡ç½®ã€‚

   ```bash
   $ git add entrypoint.sh
   $ git update-index --chmod=+x entrypoint.sh
   ```

4. å¯é€‰åœ°ï¼Œè¦æ£€æŸ¥gitç´¢å¼•ä¸­æ–‡ä»¶çš„æƒé™æ¨¡å¼ï¼Œè¯·è¿è¡Œä»¥ä¸‹å‘½ä»¤ã€‚

   ```bash
   $ git ls-files --stage entrypoint.sh
   ```





## åœ¨å·¥ä½œæµä¸­æµ‹è¯•æ‚¨çš„æ“ä½œ

ç°åœ¨æ‚¨å·²ç»å‡†å¤‡å¥½åœ¨å·¥ä½œæµä¸­æµ‹è¯•æ‚¨çš„æ“ä½œäº†ã€‚

- å…¬å…±æ“ä½œå¯ç”±ä»»ä½•å­˜å‚¨åº“ä¸­çš„å·¥ä½œæµä½¿ç”¨ã€‚

ä»¥ä¸‹å·¥ä½œæµä»£ç ä½¿ç”¨å…¬å…± `actions/hello-world-docker-action` å­˜å‚¨åº“ä¸­å·²å®Œæˆçš„hello worldæ“ä½œã€‚å°†ä»¥ä¸‹å·¥ä½œæµç¤ºä¾‹ä»£ç å¤åˆ¶åˆ° `.github/workflows/main.yml` æ–‡ä»¶ä¸­ï¼Œä½†ç”¨æ‚¨çš„å­˜å‚¨åº“å’Œæ“ä½œåç§°æ›¿æ¢ `actions/hello-world-docker-action` ã€‚æ‚¨ä¹Ÿå¯ä»¥å°† `who-to-greet` è¾“å…¥æ›¿æ¢ä¸ºæ‚¨çš„å§“åã€‚å³ä½¿å…¬å…±æ“ä½œæ²¡æœ‰å‘å¸ƒåˆ°GitHub Marketplaceï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨å®ƒä»¬ã€‚æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜…â€œåœ¨GitHub Marketplaceä¸­å‘å¸ƒæ“ä½œã€‚"

```yaml
on: [push]

jobs:
  hello_world_job:
    runs-on: ubuntu-latest
    name: A job to say hello
    steps:
      - name: Hello world action step
        id: hello
        uses: actions/hello-world-docker-action@v2
        with:
          who-to-greet: 'Mona the Octocat'
      # Use the output from the `hello` step
      - name: Get the output time
        run: echo "The time was ${{ steps.hello.outputs.time }}"

```

ä»å­˜å‚¨åº“ä¸­ï¼Œå•å‡»â€œæ“ä½œâ€é€‰é¡¹å¡ï¼Œç„¶åé€‰æ‹©æœ€æ–°çš„å·¥ä½œæµè¿è¡Œã€‚åœ¨â€œä½œä¸šâ€ä¸‹æˆ–å¯è§†åŒ–å›¾å½¢ä¸­ï¼Œå•å‡»â€œä½œä¸šâ€ä»¥æ‰“æ‹›å‘¼ã€‚

å•å‡»Hello worldæ“ä½œæ­¥éª¤ï¼Œæ‚¨åº”è¯¥ä¼šçœ‹åˆ°â€œHelloè«çº³the Octocatâ€æˆ–æ‚¨ç”¨äº `who-to-greet` è¾“å…¥çš„åç§°æ‰“å°åœ¨æ—¥å¿—ä¸­ã€‚å•å‡»è·å–è¾“å‡ºæ—¶é—´ä»¥æŸ¥çœ‹æ—¶é—´æˆ³ã€‚





## ä½¿ç”¨å·¥ä½œæµ

[GitHub Marketplace](https://github.com/marketplace?type=actions) æ˜¯ä¸€ä¸ªä¸­å¿ƒä½ç½®ï¼Œæ‚¨å¯ä»¥æ‰¾åˆ°GitHubç¤¾åŒºåˆ›å»ºçš„æ“ä½œã€‚GitHub Marketplaceé¡µé¢å…è®¸æ‚¨æŒ‰ç±»åˆ«è¿‡æ»¤æ“ä½œã€‚

æ‚¨åœ¨å·¥ä½œæµä¸­ä½¿ç”¨çš„æ“ä½œå¯ä»¥åœ¨ä»¥ä¸‹ä¸­å®šä¹‰ï¼š

- ä¸å·¥ä½œæµæ–‡ä»¶ç›¸åŒçš„å­˜å‚¨åº“
- ä»»ä½•å…¬å…±å­˜å‚¨åº“
- Docker Hubä¸Šå‘å¸ƒçš„Dockerå®¹å™¨é•œåƒ



### åœ¨å·¥ä½œæµç¼–è¾‘å™¨ä¸­æµè§ˆMarketplaceæ“ä½œ

æ‚¨å¯ä»¥ç›´æ¥åœ¨å­˜å‚¨åº“çš„å·¥ä½œæµç¼–è¾‘å™¨ä¸­æœç´¢å’Œæµè§ˆæ“ä½œã€‚ä»ä¾§è¾¹æ ä¸­ï¼Œæ‚¨å¯ä»¥æœç´¢ç‰¹å®šæ“ä½œã€æŸ¥çœ‹ç‰¹è‰²æ“ä½œä»¥åŠæµè§ˆç‰¹è‰²ç±»åˆ«ã€‚æ‚¨è¿˜å¯ä»¥æŸ¥çœ‹æŸä¸ªåŠ¨ä½œä»GitHubç¤¾åŒºæ”¶åˆ°çš„æ˜Ÿæ•°ã€‚

1. åœ¨å­˜å‚¨åº“ä¸­ï¼Œæµè§ˆåˆ°è¦ç¼–è¾‘çš„å·¥ä½œæµæ–‡ä»¶ã€‚
2. åœ¨æ–‡ä»¶è§†å›¾çš„å³ä¸Šè§’ï¼Œè¦æ‰“å¼€å·¥ä½œæµç¼–è¾‘å™¨ï¼Œè¯·å•å‡» 
3. åœ¨ç¼–è¾‘å™¨å³ä¾§ï¼Œä½¿ç”¨GitHub Marketplaceä¾§è¾¹æ æµè§ˆæ“ä½œã€‚ä¸ å¾½ç« è¡¨æ˜GitHubå·²å°†æ“ä½œçš„åˆ›å»ºè€…éªŒè¯ä¸ºåˆä½œä¼™ä¼´ç»„ç»‡ã€‚



### å‘å·¥ä½œæµæ·»åŠ æ“ä½œå‘å·¥ä½œæµæ·»åŠ æ“ä½œ

å¯ä»¥é€šè¿‡å¼•ç”¨å·¥ä½œæµæ–‡ä»¶ä¸­çš„æ“ä½œå°†æ“ä½œæ·»åŠ åˆ°å·¥ä½œæµä¸­ã€‚

æ‚¨å¯ä»¥å°†GitHub Actionså·¥ä½œæµä¸­å¼•ç”¨çš„æ“ä½œä½œä¸ºä¾èµ–å…³ç³»åœ¨åŒ…å«å·¥ä½œæµçš„å­˜å‚¨åº“çš„ä¾èµ–å…³ç³»å›¾ä¸­æŸ¥çœ‹ã€‚æœ‰å…³è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…â€œ[å…³äºä¾èµ–å…³ç³»å›¾](https://docs.github.com/en/code-security/supply-chain-security/understanding-your-software-supply-chain/about-the-dependency-graph)â€ã€‚



### ä»GitHub Marketplaceæ·»åŠ æ“ä½œ

æ“ä½œçš„åˆ—è¡¨é¡µåŒ…æ‹¬æ“ä½œçš„ç‰ˆæœ¬å’Œä½¿ç”¨æ“ä½œæ‰€éœ€çš„å·¥ä½œæµè¯­æ³•ã€‚
ä¸ºäº†ä¿æŒå·¥ä½œæµçš„ç¨³å®šï¼Œå³ä½¿å¯¹æ“ä½œè¿›è¡Œäº†æ›´æ–°ï¼Œæ‚¨å¯ä»¥é€šè¿‡åœ¨å·¥ä½œæµæ–‡ä»¶ä¸­æŒ‡å®š Git æˆ– Docker æ ‡è®°å·æ¥å¼•ç”¨è¦ä½¿ç”¨çš„æ“ä½œç‰ˆæœ¬ã€‚

1. å¯¼èˆªåˆ°è¦åœ¨å·¥ä½œæµä¸­ä½¿ç”¨çš„æ“ä½œã€‚

2. å•å‡»ä»¥æŸ¥çœ‹æ“ä½œçš„å®Œæ•´å¸‚åœºåˆ—è¡¨ã€‚

3. åœ¨â€œå®‰è£…â€ä¸‹ï¼Œå•å‡» å¤åˆ¶å·¥ä½œæµè¯­æ³•ã€‚

   ![Screenshot of the marketplace listing for an action. The "Copy to clipboard" icon for the action is highlighted with a dark orange outline.](https://docs.github.com/assets/cb-52866/images/help/repository/actions-sidebar-detailed-view.png)

4. å°†è¯­æ³•ç²˜è´´ä¸ºå·¥ä½œæµä¸­çš„æ–°æ­¥éª¤ã€‚æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜…â€œ[GitHubæ“ä½œçš„å·¥ä½œæµè¯­æ³•](https://docs.github.com/en/actions/using-workflows/workflow-syntax-for-github-actions#jobsjob_idsteps)ã€‚â€œ

5. å¦‚æœæ“ä½œè¦æ±‚æ‚¨æä¾›è¾“å…¥ï¼Œè¯·åœ¨å·¥ä½œæµä¸­è®¾ç½®å®ƒä»¬ã€‚æœ‰å…³æ“ä½œå¯èƒ½éœ€è¦çš„è¾“å…¥çš„ä¿¡æ¯ï¼Œè¯·å‚è§â€œ[æŸ¥æ‰¾å’Œè‡ªå®šä¹‰æ“ä½œâ€](https://docs.github.com/en/actions/learn-github-actions/finding-and-customizing-actions#using-inputs-and-outputs-with-an-action)ã€‚â€œ

æ‚¨è¿˜å¯ä»¥ä¸ºæ·»åŠ åˆ°å·¥ä½œæµä¸­çš„æ“ä½œå¯ç”¨Dependabotç‰ˆæœ¬æ›´æ–°ã€‚æœ‰å…³è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…â€œ[ä½¿ç”¨Dependabotä¿æŒæ‚¨çš„æ“ä½œæœ€æ–°](https://docs.github.com/en/code-security/dependabot/working-with-dependabot/keeping-your-actions-up-to-date-with-dependabot)ã€‚â€œ



### ä»åŒä¸€å­˜å‚¨åº“æ·»åŠ æ“ä½œ

å¦‚æœåœ¨å·¥ä½œæµæ–‡ä»¶ä½¿ç”¨æ“ä½œçš„åŒä¸€å­˜å‚¨åº“ä¸­å®šä¹‰äº†æ“ä½œï¼Œåˆ™å¯ä»¥åœ¨å·¥ä½œæµæ–‡ä»¶ä¸­ä½¿ç”¨`{owner}/{repo}@{ref}`æˆ–`./path/to/dir`è¯­æ³•å¼•ç”¨è¯¥æ“ä½œã€‚

å­˜å‚¨åº“æ–‡ä»¶ç»“æ„ç¤ºä¾‹ï¼š

```
|-- hello-world (repository)
|   |__ .github
|       â””â”€â”€ workflows
|           â””â”€â”€ my-first-workflow.yml
|       â””â”€â”€ actions
|           |__ hello-world-action
|               â””â”€â”€ action.yml
```

å·¥ä½œæµæ–‡ä»¶ç¤ºä¾‹ï¼š

```yaml
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      # This step checks out a copy of your repository.
      - uses: actions/checkout@v3
      # This step references the directory that contains the action.
      - uses: ./.github/actions/hello-world-action
```

`action.yml`æ–‡ä»¶ç”¨äºä¸ºæ“ä½œæä¾›å…ƒæ•°æ®ã€‚åœ¨â€œ[Metadata syntax for GitHub Actions](https://docs.github.com/en/actions/creating-actions/metadata-syntax-for-github-actions).â€œ



### ä»å…¶ä»–å­˜å‚¨åº“æ·»åŠ æ“ä½œ

å¦‚æœæŸä¸ªæ“ä½œæ˜¯åœ¨ä¸å·¥ä½œæµæ–‡ä»¶ä¸åŒçš„å­˜å‚¨åº“ä¸­å®šä¹‰çš„ï¼Œåˆ™å¯ä»¥åœ¨å·¥ä½œæµæ–‡ä»¶ä¸­ä½¿ç”¨`{owner}/{repo}@{ref}`è¯­æ³•å¼•ç”¨è¯¥æ“ä½œã€‚

æ“ä½œå¿…é¡»å­˜å‚¨åœ¨å…¬å…±å­˜å‚¨åº“ä¸­ã€‚

```yaml
jobs:
  my_first_job:
    steps:
      - name: My first step
        uses: actions/setup-node@v3
```



### åœ¨Docker Hubä¸Šå¼•ç”¨å®¹å™¨

å¦‚æœåœ¨Docker Hubä¸Šå‘å¸ƒçš„Dockerå®¹å™¨é•œåƒä¸­å®šä¹‰äº†æŸä¸ªæ“ä½œï¼Œåˆ™å¿…é¡»åœ¨å·¥ä½œæµæ–‡ä»¶ä¸­ä½¿ç”¨`docker://{image}:{tag}`è¯­æ³•å¼•ç”¨è¯¥æ“ä½œã€‚ä¸ºäº†ä¿æŠ¤æ‚¨çš„ä»£ç å’Œæ•°æ®ï¼Œæˆ‘ä»¬å¼ºçƒˆå»ºè®®æ‚¨åœ¨å°†Docker Hubä¸­çš„Dockerå®¹å™¨é•œåƒç”¨äºæ‚¨çš„å·¥ä½œæµç¨‹ä¹‹å‰ï¼Œå…ˆéªŒè¯å®ƒçš„å®Œæ•´æ€§ã€‚

```yaml
jobs:
  my_first_job:
    steps:
      - name: My first step
        uses: docker://alpine:3.8
```

æœ‰å…³Dockeræ“ä½œçš„ä¸€äº›ç¤ºä¾‹ï¼Œè¯·å‚è§[Docker-image.ymlå·¥ä½œæµ](https://github.com/actions/starter-workflows/blob/main/ci/docker-image.yml)å’Œâ€œ[åˆ›å»ºDockerå®¹å™¨æ“ä½œ](https://docs.github.com/en/actions/creating-actions/creating-a-docker-container-action)ã€‚â€œ



## action çš„åŸºæœ¬ç‰¹å¾

GitHub Actionså…è®¸æ‚¨è‡ªå®šä¹‰å·¥ä½œæµï¼Œä»¥æ»¡è¶³æ‚¨çš„åº”ç”¨ç¨‹åºå’Œå›¢é˜Ÿçš„ç‹¬ç‰¹éœ€æ±‚ã€‚ä¾‹å¦‚ä½¿ç”¨å˜é‡ã€è¿è¡Œè„šæœ¬ä»¥åŠåœ¨ä½œä¸šä¹‹é—´å…±äº«æ•°æ®å’Œå·¥ä»¶ã€‚



### åœ¨å·¥ä½œæµä¸­ä½¿ç”¨å˜é‡

GitHub ActionsåŒ…æ‹¬æ¯ä¸ªå·¥ä½œæµè¿è¡Œçš„é»˜è®¤ç¯å¢ƒå˜é‡ã€‚å¦‚æœéœ€è¦ä½¿ç”¨è‡ªå®šä¹‰ç¯å¢ƒå˜é‡ï¼Œå¯ä»¥åœ¨YAMLå·¥ä½œæµæ–‡ä»¶ä¸­è®¾ç½®è¿™äº›å˜é‡ã€‚è¿™ä¸ªä¾‹å­æ¼”ç¤ºäº†å¦‚ä½•åˆ›å»ºåä¸º`POSTGRES_HOST`å’Œ`POSTGRES_PORT`çš„è‡ªå®šä¹‰å˜é‡ã€‚ç„¶åï¼Œè¿™äº›å˜é‡å¯ç”¨äº`node client.js`è„šæœ¬ã€‚

```yaml
jobs:
  example-job:
      steps:
        - name: Connect to PostgreSQL
          run: node client.js
          env:
            POSTGRES_HOST: postgres
            POSTGRES_PORT: 5432
```



### å‘å·¥ä½œæµæ·»åŠ è„šæœ¬

æ‚¨å¯ä»¥ä½¿ç”¨æ“ä½œè¿è¡Œè„šæœ¬å’Œshellå‘½ä»¤ï¼Œç„¶ååœ¨åˆ†é…çš„è¿è¡Œå™¨ä¸Šæ‰§è¡Œè¿™äº›å‘½ä»¤ã€‚è¿™ä¸ªä¾‹å­æ¼”ç¤ºäº†ä¸€ä¸ªåŠ¨ä½œå¦‚ä½•ä½¿ç”¨`run`å…³é”®å­—åœ¨ runner ä¸Šæ‰§è¡Œ`npm install -g bats`ã€‚

```yaml
jobs:
  example-job:
    steps:
      - run: npm install -g bats
```

ä¾‹å¦‚ï¼Œè¦å°†è„šæœ¬ä½œä¸ºæ“ä½œè¿è¡Œï¼Œå¯ä»¥å°†è„šæœ¬å­˜å‚¨åœ¨å­˜å‚¨åº“ä¸­å¹¶æä¾›è·¯å¾„å’Œshellç±»å‹ã€‚

```yaml
jobs:
  example-job:
    steps:
      - name: Run build script
        run: ./.github/scripts/build.sh
        shell: bash
```

æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜…â€œ[GitHubæ“ä½œçš„å·¥ä½œæµè¯­æ³•](https://docs.github.com/en/actions/using-workflows/workflow-syntax-for-github-actions#jobsjob_idstepsrun)ã€‚â€œ



### åœ¨ä½œä¸šä¹‹é—´å…±äº«æ•°æ®

å¦‚æœä½ çš„ä½œä¸šç”Ÿæˆäº†ä½ æƒ³ä¸åŒä¸€å·¥ä½œæµä¸­çš„å¦ä¸€ä¸ªä½œä¸šå…±äº«çš„æ–‡ä»¶ï¼Œæˆ–è€…ä½ æƒ³ä¿å­˜è¿™äº›æ–‡ä»¶ä»¥ä¾›ä»¥åå‚è€ƒï¼Œä½ å¯ä»¥å°†å®ƒä»¬ä½œä¸ºå·¥ä»¶å­˜å‚¨åœ¨GitHubä¸­ã€‚å·¥ä»¶æ˜¯åœ¨æ„å»ºå’Œæµ‹è¯•ä»£ç æ—¶åˆ›å»ºçš„æ–‡ä»¶ã€‚ä¾‹å¦‚ï¼Œå·¥ä»¶å¯èƒ½åŒ…æ‹¬äºŒè¿›åˆ¶æ–‡ä»¶æˆ–åŒ…æ–‡ä»¶ã€æµ‹è¯•ç»“æœã€å±å¹•æˆªå›¾æˆ–æ—¥å¿—æ–‡ä»¶ã€‚å·¥ä»¶ä¸åˆ›å»ºå·¥ä»¶çš„å·¥ä½œæµè¿è¡Œç›¸å…³è”ï¼Œå¹¶å¯ç”±å…¶ä»–ä½œä¸šä½¿ç”¨ã€‚åœ¨ä¸€æ¬¡è¿è¡Œä¸­è°ƒç”¨çš„æ‰€æœ‰æ“ä½œå’Œå·¥ä½œæµéƒ½å¯¹è¯¥è¿è¡Œçš„å·¥ä»¶å…·æœ‰å†™è®¿é—®æƒé™ã€‚

ä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥åˆ›å»ºä¸€ä¸ªæ–‡ä»¶ï¼Œç„¶åå°†å…¶ä½œä¸ºå·¥ä»¶ä¸Šä¼ ã€‚

```yaml
jobs:
  example-job:
    name: Save output
    steps:
      - shell: bash
        run: |
          expr 1 + 1 > output.log
      - name: Upload output file
        uses: actions/upload-artifact@v3
        with:
          name: output-log-file
          path: output.log
```

è¦ä»å•ç‹¬çš„å·¥ä½œæµè¿è¡Œä¸­ä¸‹è½½å·¥ä»¶ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨`actions/download-artifact`æ“ä½œã€‚ä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥ä¸‹è½½åä¸º`output-log-file`çš„å·¥ä»¶ã€‚

```yaml
jobs:
  example-job:
    steps:
      - name: Download a single artifact
        uses: actions/download-artifact@v3
        with:
          name: output-log-file
```

è¦ä»åŒä¸€å·¥ä½œæµè¿è¡Œä¸­ä¸‹è½½å·¥ä»¶ï¼Œæ‚¨çš„ä¸‹è½½ä½œä¸šåº”æŒ‡å®š`needs: upload-job-name`ï¼Œä»¥ä¾¿åœ¨ä¸Šè½½ä½œä¸šå®Œæˆä¹‹å‰ä¸ä¼šå¯åŠ¨ã€‚

æœ‰å…³å·¥ä»¶çš„è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚è§â€œ[å°†å·¥ä½œæµæ•°æ®å­˜å‚¨ä¸ºå·¥ä»¶](https://docs.github.com/en/actions/using-workflows/storing-workflow-data-as-artifacts)ã€‚â€œ



## context

ä¸Šä¸‹æ–‡ï¼Œå…³äº github  actions ä¸­çš„ context æ˜¯ä»€ä¹ˆæ ·çš„

ä¸Šä¸‹æ–‡æ˜¯è®¿é—®æœ‰å…³å·¥ä½œæµè¿è¡Œã€å˜é‡ã€è¿è¡Œå™¨ç¯å¢ƒã€ä½œä¸šå’Œæ­¥éª¤çš„ä¿¡æ¯çš„ä¸€ç§æ–¹æ³•ã€‚æ¯ä¸ªä¸Šä¸‹æ–‡éƒ½æ˜¯ä¸€ä¸ªåŒ…å«å±æ€§çš„å¯¹è±¡ï¼Œè¿™äº›å±æ€§å¯ä»¥æ˜¯å­—ç¬¦ä¸²æˆ–å…¶ä»–å¯¹è±¡ã€‚

åœ¨ä¸åŒçš„å·¥ä½œæµè¿è¡Œæ¡ä»¶ä¸‹ï¼Œä¸Šä¸‹æ–‡ã€å¯¹è±¡å’Œå±æ€§ä¼šæœ‰å¾ˆå¤§å·®å¼‚ã€‚ä¾‹å¦‚ï¼Œä»…ä¸ºçŸ©é˜µä¸­çš„ä½œä¸šå¡«å…… `matrix` ä¸Šä¸‹æ–‡ã€‚

å¯èƒ½è¿˜æ˜¯ä¸æ˜¯å¾ˆæ¸…æ¥šï¼Œæˆ‘ä»¬ç›´æ¥çœ‹ä¸‹ä½•æ—¶ä½¿ç”¨ contextï¼š

GitHub ActionsåŒ…å«ä¸€ä¸ªåä¸ºcontextçš„å˜é‡é›†åˆå’Œä¸€ä¸ªåä¸ºdefaultå˜é‡çš„ç±»ä¼¼å˜é‡é›†åˆã€‚è¿™äº›å˜é‡ç”¨äºå·¥ä½œæµä¸­çš„ä¸åŒç‚¹ï¼š

+ é»˜è®¤ç¯å¢ƒå˜é‡ï¼ˆDefault environment variablesï¼‰ï¼šè¿™äº›ç¯å¢ƒå˜é‡åªå­˜åœ¨äºæ‰§è¡Œä½œä¸šçš„è¿è¡Œç¨‹åºä¸Šã€‚æœ‰å…³è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…â€œå˜é‡ã€‚â€œ
+ ä¸Šä¸‹æ–‡ï¼ˆcontextï¼‰ï¼šæ‚¨å¯ä»¥åœ¨å·¥ä½œæµä¸­çš„ä»»ä½•æ—¶å€™ä½¿ç”¨å¤§å¤šæ•°ä¸Šä¸‹æ–‡ï¼ŒåŒ…æ‹¬é»˜è®¤å˜é‡ä¸å¯ç”¨æ—¶ã€‚ä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨å…·æœ‰è¡¨è¾¾å¼çš„ä¸Šä¸‹æ–‡ï¼Œåœ¨å°†ä½œä¸šè·¯ç”±åˆ°è¿è¡Œç¨‹åºæ‰§è¡Œä¹‹å‰æ‰§è¡Œåˆå§‹å¤„ç†;è¿™å…è®¸æ‚¨ä½¿ç”¨å¸¦æœ‰æ¡ä»¶ `if` å…³é”®å­—çš„ä¸Šä¸‹æ–‡æ¥ç¡®å®šæ˜¯å¦åº”è¿è¡ŒæŸä¸ªæ­¥éª¤ã€‚ä¸€æ—¦ä½œä¸šå¼€å§‹è¿è¡Œï¼Œæ‚¨è¿˜å¯ä»¥ä»æ­£åœ¨æ‰§è¡Œä½œä¸šçš„è¿è¡Œç¨‹åºä¸­æ£€ç´¢ä¸Šä¸‹æ–‡å˜é‡ï¼Œä¾‹å¦‚ `runner.os` ã€‚æœ‰å…³å¯ä»¥åœ¨å·¥ä½œæµä¸­ä½¿ç”¨å„ç§ä¸Šä¸‹æ–‡çš„ä½ç½®çš„è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜… â€œä¸Šä¸‹æ–‡ã€‚â€œ

ä»¥ä¸‹ç¤ºä¾‹æ¼”ç¤ºäº†å¦‚ä½•åœ¨ä½œä¸šä¸­ä¸€èµ·ä½¿ç”¨è¿™äº›ä¸åŒç±»å‹çš„å˜é‡ï¼š

```yaml
name: CI
on: push
jobs:
  prod-check:
    if: ${{ github.ref == 'refs/heads/main' }}
    runs-on: ubuntu-latest
    steps:
      - run: echo "Deploying to production server on branch $GITHUB_REF"
```

åœ¨æœ¬ä¾‹ä¸­ï¼Œ `if` è¯­å¥æ£€æŸ¥ `github.ref` ä¸Šä¸‹æ–‡ä»¥ç¡®å®šå½“å‰åˆ†æ”¯åç§°;å¦‚æœåç§°æ˜¯ `refs/heads/main` ï¼Œåˆ™æ‰§è¡Œåç»­æ­¥éª¤ã€‚ `if` æ£€æŸ¥ç”±GitHub Actionså¤„ç†ï¼Œåªæœ‰å½“ç»“æœä¸º `true` æ—¶ï¼Œä½œä¸šæ‰ä¼šå‘é€ç»™runnerã€‚ä¸€æ—¦å°†ä½œä¸šå‘é€ç»™è¿è¡Œç¨‹åºï¼Œå°±ä¼šæ‰§è¡Œè¯¥æ­¥éª¤ï¼Œå¹¶å¼•ç”¨æ¥è‡ªè¿è¡Œç¨‹åºçš„ `$GITHUB_REF` å˜é‡ã€‚



### Context availability

åœ¨æ•´ä¸ªå·¥ä½œæµè¿è¡Œè¿‡ç¨‹ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ä¸åŒçš„ä¸Šä¸‹æ–‡ã€‚ä¾‹å¦‚ï¼Œ `secrets` ä¸Šä¸‹æ–‡å¯ä»¥ä»…åœ¨ä½œä¸šå†…çš„æŸäº›ä½ç½®å¤„ä½¿ç”¨ã€‚

æ­¤å¤–ï¼ŒæŸäº›åŠŸèƒ½å¯èƒ½ä»…åœ¨æŸäº›åœ°æ–¹ä½¿ç”¨ã€‚ä¾‹å¦‚ï¼Œ `hashFiles` å‡½æ•°å¹¶ä¸æ˜¯åœ¨ä»»ä½•åœ°æ–¹éƒ½å¯ç”¨ã€‚

| Workflow key å·¥ä½œæµå¯†é’¥                            | Context è¯­å¢ƒ                                                 | Special functions ç‰¹æ®ŠåŠŸèƒ½                       |
| :------------------------------------------------- | :----------------------------------------------------------- | :----------------------------------------------- |
| `run-name`                                         | `github, inputs, vars`                                       | None æ—                                           |
| `concurrency`                                      | `github, inputs, vars`                                       | None æ—                                           |
| `env`                                              | `github, secrets, inputs, vars`                              | None æ—                                           |
| `jobs.<job_id>.concurrency`                        | `github, needs, strategy, matrix, inputs, vars`              | None æ—                                           |
| `jobs.<job_id>.container`                          | `github, needs, strategy, matrix, vars, inputs`              | None æ—                                           |
| `jobs.<job_id>.container.credentials`              | `github, needs, strategy, matrix, env, vars, secrets, inputs` | None æ—                                           |
| `jobs.<job_id>.container.env.<env_id>`             | `github, needs, strategy, matrix, job, runner, env, vars, secrets, inputs` | None æ—                                           |
| `jobs.<job_id>.container.image`                    | `github, needs, strategy, matrix, vars, inputs`              | None æ—                                           |
| `jobs.<job_id>.continue-on-error`                  | `github, needs, strategy, vars, matrix, inputs`              | None æ—                                           |
| `jobs.<job_id>.defaults.run`                       | `github, needs, strategy, matrix, env, vars, inputs`         | None æ—                                           |
| `jobs.<job_id>.env`                                | `github, needs, strategy, matrix, vars, secrets, inputs`     | None æ—                                           |
| `jobs.<job_id>.environment`                        | `github, needs, strategy, matrix, vars, inputs`              | None æ—                                           |
| `jobs.<job_id>.environment.url`                    | `github, needs, strategy, matrix, job, runner, env, vars, steps, inputs` | None æ—                                           |
| `jobs.<job_id>.if`                                 | `github, needs, vars, inputs`                                | `always, cancelled, success, failure`            |
| `jobs.<job_id>.name`                               | `github, needs, strategy, matrix, vars, inputs`              | None æ—                                           |
| `jobs.<job_id>.outputs.<output_id>`                | `github, needs, strategy, matrix, job, runner, env, vars, secrets, steps, inputs` | None æ—                                           |
| `jobs.<job_id>.runs-on`                            | `github, needs, strategy, matrix, vars, inputs`              | None æ—                                           |
| `jobs.<job_id>.secrets.<secrets_id>`               | `github, needs, strategy, matrix, secrets, inputs, vars`     | None æ—                                           |
| `jobs.<job_id>.services`                           | `github, needs, strategy, matrix, vars, inputs`              | None æ—                                           |
| `jobs.<job_id>.services.<service_id>.credentials`  | `github, needs, strategy, matrix, env, vars, secrets, inputs` | None æ—                                           |
| `jobs.<job_id>.services.<service_id>.env.<env_id>` | `github, needs, strategy, matrix, job, runner, env, vars, secrets, inputs` | None æ—                                           |
| `jobs.<job_id>.steps.continue-on-error`            | `github, needs, strategy, matrix, job, runner, env, vars, secrets, steps, inputs` | `hashFiles`                                      |
| `jobs.<job_id>.steps.env`                          | `github, needs, strategy, matrix, job, runner, env, vars, secrets, steps, inputs` | `hashFiles`                                      |
| `jobs.<job_id>.steps.if`                           | `github, needs, strategy, matrix, job, runner, env, vars, steps, inputs` | `always, cancelled, success, failure, hashFiles` |
| `jobs.<job_id>.steps.name`                         | `github, needs, strategy, matrix, job, runner, env, vars, secrets, steps, inputs` | `hashFiles`                                      |
| `jobs.<job_id>.steps.run`                          | `github, needs, strategy, matrix, job, runner, env, vars, secrets, steps, inputs` | `hashFiles`                                      |
| `jobs.<job_id>.steps.timeout-minutes`              | `github, needs, strategy, matrix, job, runner, env, vars, secrets, steps, inputs` | `hashFiles`                                      |
| `jobs.<job_id>.steps.with`                         | `github, needs, strategy, matrix, job, runner, env, vars, secrets, steps, inputs` | `hashFiles`                                      |
| `jobs.<job_id>.steps.working-directory`            | `github, needs, strategy, matrix, job, runner, env, vars, secrets, steps, inputs` | `hashFiles`                                      |
| `jobs.<job_id>.strategy`                           | `github, needs, vars, inputs`                                | None æ—                                           |
| `jobs.<job_id>.timeout-minutes`                    | `github, needs, strategy, matrix, vars, inputs`              | None æ—                                           |
| `jobs.<job_id>.with.<with_id>`                     | `github, needs, strategy, matrix, inputs, vars`              | None æ—                                           |
| `on.workflow_call.inputs.<inputs_id>.default`      | `github, inputs, vars`                                       | None æ—                                           |
| `on.workflow_call.outputs.<output_id>.value`       | `github, jobs, vars, inputs`                                 | None æ—                                           |



### GitHub context

`github` ä¸Šä¸‹æ–‡åŒ…å«æœ‰å…³å·¥ä½œæµè¿è¡Œå’Œè§¦å‘è¿è¡Œçš„äº‹ä»¶çš„ä¿¡æ¯ã€‚æ‚¨è¿˜å¯ä»¥åœ¨ç¯å¢ƒå˜é‡ä¸­è¯»å–å¤§éƒ¨åˆ† `github` ä¸Šä¸‹æ–‡æ•°æ®ã€‚æœ‰å…³ç¯å¢ƒå˜é‡çš„è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…â€œå˜é‡ã€‚â€œ

| ç‰©ä¸šåç§°                     | ç±»å‹      | æè¿°                                                         |
| :--------------------------- | :-------- | :----------------------------------------------------------- |
| `github`                     | `object`  | å·¥ä½œæµä¸­ä»»ä½•ä½œä¸šæˆ–æ­¥éª¤æœŸé—´å¯ç”¨çš„é¡¶çº§ä¸Šä¸‹æ–‡ã€‚è¯¥å¯¹è±¡åŒ…å«ä¸‹é¢åˆ—å‡ºçš„æ‰€æœ‰å±æ€§ã€‚ |
| `github.action`              | `string`  | å½“å‰æ­£åœ¨è¿è¡Œçš„æ“ä½œçš„åç§°æˆ–[`id`](https://docs.github.com/en/actions/using-workflows/workflow-syntax-for-github-actions#jobsjob_idstepsid)æ­¥éª¤çš„åç§°ã€‚GitHub ä¼šåˆ é™¤ç‰¹æ®Šå­—ç¬¦ï¼Œå¹¶`__run`åœ¨å½“å‰æ­¥éª¤è¿è¡Œä¸å¸¦`id`. å¦‚æœæ‚¨åœ¨åŒä¸€ä¸ªä½œä¸šä¸­å¤šæ¬¡ä½¿ç”¨ç›¸åŒçš„æ“ä½œï¼Œåˆ™åç§°å°†åŒ…å«ä¸€ä¸ªåç¼€ï¼Œå…¶åºåˆ—å·å‰é¢å¸¦æœ‰ä¸‹åˆ’çº¿ã€‚ä¾‹å¦‚ï¼Œæ‚¨è¿è¡Œçš„ç¬¬ä¸€ä¸ªè„šæœ¬çš„åç§°ä¸º`__run`ï¼Œç¬¬äºŒä¸ªè„šæœ¬çš„åç§°ä¸º`__run_2`ã€‚åŒæ ·ï¼Œç¬¬äºŒæ¬¡è°ƒç”¨`actions/checkout`will æ˜¯`actionscheckout2`ã€‚ |
| `github.action_path`         | `string`  | åŠ¨ä½œæ‰€åœ¨çš„è·¯å¾„ã€‚æ­¤å±æ€§ä»…åœ¨å¤åˆæ“ä½œä¸­å—æ”¯æŒã€‚æ‚¨å¯ä»¥ä½¿ç”¨æ­¤è·¯å¾„è®¿é—®ä¸æ“ä½œä½äºåŒä¸€å­˜å‚¨åº“ä¸­çš„æ–‡ä»¶ï¼Œä¾‹å¦‚é€šè¿‡å°†ç›®å½•æ›´æ”¹ä¸ºè·¯å¾„ï¼š `cd ${{ github.action_path }}`ã€‚ |
| `github.action_ref`          | `string`  | å¯¹äºæ‰§è¡Œæ“ä½œçš„æ­¥éª¤ï¼Œè¿™æ˜¯æ­£åœ¨æ‰§è¡Œçš„æ“ä½œçš„å¼•ç”¨ã€‚ä¾‹å¦‚ï¼Œ`v2`.    |
| `github.action_repository`   | `string`  | å¯¹äºæ‰§è¡Œæ“ä½œçš„æ­¥éª¤ï¼Œè¿™æ˜¯æ“ä½œçš„æ‰€æœ‰è€…å’Œå­˜å‚¨åº“åç§°ã€‚ä¾‹å¦‚ï¼Œ`actions/checkout`. |
| `github.action_status`       | `string`  | å¯¹äºå¤åˆæ“ä½œï¼Œå¤åˆæ“ä½œçš„å½“å‰ç»“æœã€‚                           |
| `github.actor`               | `string`  | è§¦å‘åˆå§‹å·¥ä½œæµè¿è¡Œçš„ç”¨æˆ·çš„ç”¨æˆ·åã€‚å¦‚æœå·¥ä½œæµè¿è¡Œæ˜¯é‡æ–°è¿è¡Œï¼Œåˆ™è¯¥å€¼å¯èƒ½ä¸ ä¸åŒ`github.triggering_actor`ã€‚ä»»ä½•å·¥ä½œæµé‡æ–°è¿è¡Œéƒ½å°†ä½¿ç”¨ çš„æƒé™`github.actor`ï¼Œå³ä½¿å‘èµ·é‡æ–°è¿è¡Œçš„å‚ä¸è€… ( `github.triggering_actor`) å…·æœ‰ä¸åŒçš„æƒé™ã€‚ |
| `github.actor_id`            | `string`  | è§¦å‘åˆå§‹å·¥ä½œæµç¨‹è¿è¡Œçš„äººå‘˜æˆ–åº”ç”¨ç¨‹åºçš„å¸æˆ· IDã€‚ä¾‹å¦‚ï¼Œ`1234567`. è¯·æ³¨æ„ï¼Œè¿™ä¸æ¼”å‘˜ç”¨æˆ·åä¸åŒã€‚ |
| `github.api_url`             | `string`  | GitHub REST API çš„ URLã€‚                                     |
| `github.base_ref`            | `string`  | `base_ref`å·¥ä½œæµè¿è¡Œä¸­æ‹‰å–è¯·æ±‚çš„æˆ–ç›®æ ‡åˆ†æ”¯ã€‚ä»…å½“è§¦å‘å·¥ä½œæµè¿è¡Œçš„äº‹ä»¶ä¸º æˆ– æ—¶ï¼Œæ­¤å±æ€§æ‰å¯`pull_request`ç”¨ã€‚`pull_request_target` |
| `github.env`                 | `string`  | è¿è¡Œå™¨ä¸Šä»å·¥ä½œæµå‘½ä»¤è®¾ç½®ç¯å¢ƒå˜é‡çš„æ–‡ä»¶çš„è·¯å¾„ã€‚è¯¥æ–‡ä»¶å¯¹äºå½“å‰æ­¥éª¤æ˜¯å”¯ä¸€çš„ï¼Œå¹¶ä¸”æ˜¯ä½œä¸šä¸­æ¯ä¸ªæ­¥éª¤çš„ä¸åŒæ–‡ä»¶ã€‚æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜…â€œ [GitHub Actions çš„å·¥ä½œæµç¨‹å‘½ä»¤](https://docs.github.com/en/actions/using-workflows/workflow-commands-for-github-actions#setting-an-environment-variable)â€ã€‚ |
| `github.event`               | `object`  | å®Œæ•´çš„äº‹ä»¶ Webhook è´Ÿè½½ã€‚æ‚¨å¯ä»¥ä½¿ç”¨æ­¤ä¸Šä¸‹æ–‡è®¿é—®äº‹ä»¶çš„å„ä¸ªå±æ€§ã€‚è¯¥å¯¹è±¡ä¸è§¦å‘å·¥ä½œæµè¿è¡Œçš„äº‹ä»¶çš„ Webhook è´Ÿè½½ç›¸åŒï¼Œå¹¶ä¸”å¯¹äºæ¯ä¸ªäº‹ä»¶éƒ½ä¸åŒã€‚ æ¯ä¸ª GitHub Actions äº‹ä»¶çš„ Webhook éƒ½é“¾æ¥åœ¨â€œ[è§¦å‘å·¥ä½œæµçš„äº‹ä»¶](https://docs.github.com/en/actions/using-workflows/events-that-trigger-workflows)â€ä¸­ã€‚ä¾‹å¦‚ï¼Œå¯¹äºç”±äº‹ä»¶è§¦å‘çš„å·¥ä½œæµè¿è¡Œ[`push`ï¼Œè¯¥å¯¹è±¡åŒ…å«](https://docs.github.com/en/actions/using-workflows/events-that-trigger-workflows#push)[æ¨é€ webhook è´Ÿè½½](https://docs.github.com/en/webhooks-and-events/webhooks/webhook-events-and-payloads#push)çš„å†…å®¹ã€‚ |
| `github.event_name`          | `string`  | è§¦å‘å·¥ä½œæµè¿è¡Œçš„äº‹ä»¶çš„åç§°ã€‚                                 |
| `github.event_path`          | `string`  | è¿è¡Œå™¨ä¸ŠåŒ…å«å®Œæ•´äº‹ä»¶ Webhook è´Ÿè½½çš„æ–‡ä»¶çš„è·¯å¾„ã€‚              |
| `github.graphql_url`         | `string`  | GitHub GraphQL API çš„ URLã€‚                                  |
| `github.head_ref`            | `string`  | `head_ref`å·¥ä½œæµè¿è¡Œä¸­æ‹‰å–è¯·æ±‚çš„æˆ–æºåˆ†æ”¯ã€‚ä»…å½“è§¦å‘å·¥ä½œæµè¿è¡Œçš„äº‹ä»¶ä¸º æˆ– æ—¶ï¼Œæ­¤å±æ€§æ‰å¯`pull_request`ç”¨ã€‚`pull_request_target` |
| `github.job`                 | `string`  | [`job_id`](https://docs.github.com/en/actions/using-workflows/workflow-syntax-for-github-actions#jobsjob_id)å½“å‰å·¥ä½œçš„ã€‚ æ³¨æ„ï¼šæ­¤ä¸Šä¸‹æ–‡å±æ€§ç”±æ“ä½œè¿è¡Œå™¨è®¾ç½®ï¼Œå¹¶ä¸”ä»…åœ¨`steps`ä½œä¸šæ‰§è¡ŒæœŸé—´å¯ç”¨ã€‚å¦åˆ™ï¼Œè¯¥å±æ€§çš„å€¼ä¸º`null`ã€‚ |
| `github.job_workflow_sha`    | `string`  | å¯¹äºä½¿ç”¨å¯é‡ç”¨å·¥ä½œæµç¨‹çš„ä½œä¸šï¼Œå¯é‡ç”¨å·¥ä½œæµç¨‹æ–‡ä»¶çš„æäº¤ SHAã€‚ |
| `github.path`                | `string`  | è¿è¡Œå™¨ä¸Šä»å·¥ä½œæµå‘½ä»¤è®¾ç½®ç³»ç»Ÿå˜é‡çš„æ–‡ä»¶çš„è·¯å¾„`PATH`ã€‚è¯¥æ–‡ä»¶å¯¹äºå½“å‰æ­¥éª¤æ˜¯å”¯ä¸€çš„ï¼Œå¹¶ä¸”æ˜¯ä½œä¸šä¸­æ¯ä¸ªæ­¥éª¤çš„ä¸åŒæ–‡ä»¶ã€‚æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜…â€œ [GitHub Actions çš„å·¥ä½œæµç¨‹å‘½ä»¤](https://docs.github.com/en/actions/using-workflows/workflow-commands-for-github-actions#adding-a-system-path)â€ã€‚ |
| `github.ref`                 | `string`  | è§¦å‘å·¥ä½œæµè¿è¡Œçš„åˆ†æ”¯æˆ–æ ‡ç­¾çš„å®Œæ•´å¼•ç”¨ã€‚å¯¹äº è§¦å‘çš„å·¥ä½œæµç¨‹`push`ï¼Œè¿™æ˜¯æ¨é€çš„åˆ†æ”¯æˆ–æ ‡ç­¾å¼•ç”¨ã€‚å¯¹äº è§¦å‘çš„å·¥ä½œæµç¨‹`pull_request`ï¼Œè¿™æ˜¯æ‹‰å–è¯·æ±‚åˆå¹¶åˆ†æ”¯ã€‚å¯¹äºç”± è§¦å‘çš„å·¥ä½œæµç¨‹`release`ï¼Œè¿™æ˜¯åˆ›å»ºçš„å‘å¸ƒæ ‡ç­¾ã€‚å¯¹äºå…¶ä»–è§¦å‘å™¨ï¼Œè¿™æ˜¯è§¦å‘å·¥ä½œæµè¿è¡Œçš„åˆ†æ”¯æˆ–æ ‡è®°å¼•ç”¨ã€‚ä»…å½“åˆ†æ”¯æˆ–æ ‡ç­¾å¯ç”¨äºäº‹ä»¶ç±»å‹æ—¶æ‰è®¾ç½®æ­¤å€¼ã€‚ç»™å‡ºçš„ ref æ˜¯å®Œå…¨å½¢æˆçš„ï¼Œè¿™æ„å‘³ç€å¯¹äºåˆ†æ”¯ï¼Œæ ¼å¼æ˜¯ï¼Œå¯¹äºæ‹‰å–è¯·æ±‚ï¼Œæ ¼å¼æ˜¯ï¼Œå¯¹äºæ ‡ç­¾ï¼Œæ ¼å¼æ˜¯ã€‚ä¾‹å¦‚ï¼Œ.`refs/heads/<branch_name>``refs/pull/<pr_number>/merge``refs/tags/<tag_name>``refs/heads/feature-branch-1` |
| `github.ref_name`            | `string`  | è§¦å‘å·¥ä½œæµè¿è¡Œçš„åˆ†æ”¯æˆ–æ ‡ç­¾çš„çŸ­å¼•ç”¨åç§°ã€‚è¯¥å€¼ä¸ GitHub ä¸Šæ˜¾ç¤ºçš„åˆ†æ”¯æˆ–æ ‡ç­¾åç§°åŒ¹é…ã€‚ä¾‹å¦‚ï¼Œ`feature-branch-1`. |
| `github.ref_protected`       | `boolean` | `true`æ˜¯å¦ä¸ºè§¦å‘å·¥ä½œæµè¿è¡Œçš„å¼•ç”¨é…ç½®äº†åˆ†æ”¯ä¿æŠ¤ã€‚             |
| `github.ref_type`            | `string`  | è§¦å‘å·¥ä½œæµè¿è¡Œçš„å¼•ç”¨ç±»å‹ã€‚æœ‰æ•ˆå€¼ä¸º`branch`æˆ–`tag`ã€‚          |
| `github.repository`          | `string`  | æ‰€æœ‰è€…å’Œå­˜å‚¨åº“åç§°ã€‚ä¾‹å¦‚ï¼Œ.`octocat/Hello-World`             |
| `github.repository_id`       | `string`  | å­˜å‚¨åº“çš„ IDã€‚ä¾‹å¦‚ï¼Œ`123456789`. è¯·æ³¨æ„ï¼Œè¿™ä¸å­˜å‚¨åº“åç§°ä¸åŒã€‚ |
| `github.repository_owner`    | `string`  | å­˜å‚¨åº“æ‰€æœ‰è€…çš„ç”¨æˆ·åã€‚ä¾‹å¦‚ï¼Œ`octocat`.                       |
| `github.repository_owner_id` | `string`  | å­˜å‚¨åº“æ‰€æœ‰è€…çš„å¸æˆ· IDã€‚ä¾‹å¦‚ï¼Œ`1234567`. è¯·æ³¨æ„ï¼Œè¿™ä¸æ‰€æœ‰è€…çš„å§“åä¸åŒã€‚ |
| `github.repositoryUrl`       | `string`  | å­˜å‚¨åº“çš„ Git URLã€‚ä¾‹å¦‚ï¼Œ.`git://github.com/octocat/hello-world.git` |
| `github.retention_days`      | `string`  | å·¥ä½œæµè¿è¡Œæ—¥å¿—å’Œå·¥ä»¶çš„ä¿ç•™å¤©æ•°ã€‚                             |
| `github.run_id`              | `string`  | å­˜å‚¨åº“ä¸­è¿è¡Œçš„æ¯ä¸ªå·¥ä½œæµç¨‹çš„å”¯ä¸€ç¼–å·ã€‚å¦‚æœæ‚¨é‡æ–°è¿è¡Œå·¥ä½œæµç¨‹ï¼Œæ­¤æ•°å­—ä¸ä¼šæ›´æ”¹ã€‚ |
| `github.run_number`          | `string`  | å­˜å‚¨åº“ä¸­ç‰¹å®šå·¥ä½œæµç¨‹æ¯æ¬¡è¿è¡Œçš„å”¯ä¸€ç¼–å·ã€‚å¯¹äºå·¥ä½œæµç¬¬ä¸€æ¬¡è¿è¡Œï¼Œè¯¥æ•°å­—ä» 1 å¼€å§‹ï¼Œå¹¶éšç€æ¯æ¬¡æ–°è¿è¡Œè€Œé€’å¢ã€‚å¦‚æœæ‚¨é‡æ–°è¿è¡Œå·¥ä½œæµç¨‹ï¼Œæ­¤æ•°å­—ä¸ä¼šæ›´æ”¹ã€‚ |
| `github.run_attempt`         | `string`  | å­˜å‚¨åº“ä¸­ç‰¹å®šå·¥ä½œæµè¿è¡Œçš„æ¯æ¬¡å°è¯•çš„å”¯ä¸€ç¼–å·ã€‚å¯¹äºå·¥ä½œæµç¬¬ä¸€æ¬¡å°è¯•è¿è¡Œï¼Œæ­¤æ•°å­—ä» 1 å¼€å§‹ï¼Œå¹¶éšç€æ¯æ¬¡é‡æ–°è¿è¡Œè€Œé€’å¢ã€‚ |
| `github.secret_source`       | `string`  | å·¥ä½œæµç¨‹ä¸­ä½¿ç”¨çš„æœºå¯†çš„æ¥æºã€‚å¯èƒ½çš„å€¼ä¸º`None`ã€`Actions`ã€`Codespaces`æˆ–`Dependabot`ã€‚ |
| `github.server_url`          | `string`  | GitHub æœåŠ¡å™¨çš„ URLã€‚ä¾‹å¦‚ï¼š.`https://github.com`             |
| `github.sha`                 | `string`  | è§¦å‘å·¥ä½œæµç¨‹çš„æäº¤ SHAã€‚æ­¤æäº¤ SHA çš„å€¼å–å†³äºè§¦å‘å·¥ä½œæµçš„äº‹ä»¶ã€‚æœ‰å…³è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…â€œ[è§¦å‘å·¥ä½œæµçš„äº‹ä»¶](https://docs.github.com/en/actions/using-workflows/events-that-trigger-workflows)â€ã€‚ä¾‹å¦‚ï¼Œ`ffac537e6cbbf934b08745a378932722df287a53`. |
| `github.token`               | `string`  | ä»£è¡¨å­˜å‚¨åº“ä¸Šå®‰è£…çš„ GitHub åº”ç”¨ç¨‹åºè¿›è¡Œèº«ä»½éªŒè¯çš„ä»¤ç‰Œã€‚è¿™åœ¨åŠŸèƒ½ä¸Šç­‰åŒäº`GITHUB_TOKEN`ç§˜å¯†ã€‚æœ‰å…³è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…â€œ[è‡ªåŠ¨ä»¤ç‰Œèº«ä»½éªŒè¯](https://docs.github.com/en/actions/security-guides/automatic-token-authentication)â€ã€‚ æ³¨æ„ï¼šæ­¤ä¸Šä¸‹æ–‡å±æ€§ç”±æ“ä½œè¿è¡Œå™¨è®¾ç½®ï¼Œå¹¶ä¸”ä»…åœ¨`steps`ä½œä¸šæ‰§è¡ŒæœŸé—´å¯ç”¨ã€‚å¦åˆ™ï¼Œè¯¥å±æ€§çš„å€¼ä¸º`null`ã€‚ |
| `github.triggering_actor`    | `string`  | å¯åŠ¨å·¥ä½œæµè¿è¡Œçš„ç”¨æˆ·çš„ç”¨æˆ·åã€‚å¦‚æœå·¥ä½œæµè¿è¡Œæ˜¯é‡æ–°è¿è¡Œï¼Œåˆ™è¯¥å€¼å¯èƒ½ä¸ ä¸åŒ`github.actor`ã€‚ä»»ä½•å·¥ä½œæµé‡æ–°è¿è¡Œéƒ½å°†ä½¿ç”¨ çš„æƒé™`github.actor`ï¼Œå³ä½¿å‘èµ·é‡æ–°è¿è¡Œçš„å‚ä¸è€… ( `github.triggering_actor`) å…·æœ‰ä¸åŒçš„æƒé™ã€‚ |
| `github.workflow`            | `string`  | å·¥ä½œæµç¨‹çš„åç§°ã€‚å¦‚æœå·¥ä½œæµæ–‡ä»¶æœªæŒ‡å®š a `name`ï¼Œåˆ™æ­¤å±æ€§çš„å€¼æ˜¯å­˜å‚¨åº“ä¸­å·¥ä½œæµæ–‡ä»¶çš„å®Œæ•´è·¯å¾„ã€‚ |
| `github.workflow_ref`        | `string`  | å·¥ä½œæµç¨‹çš„å‚è€ƒè·¯å¾„ã€‚ä¾‹å¦‚ï¼Œ.`octocat/hello-world/.github/workflows/my-workflow.yml@refs/heads/my_branch` |
| `github.workflow_sha`        | `string`  | å·¥ä½œæµæ–‡ä»¶çš„æäº¤ SHAã€‚                                       |
| `github.workspace`           | `string`  | æ­¥éª¤è¿è¡Œå™¨ä¸Šçš„é»˜è®¤å·¥ä½œç›®å½•ï¼Œä»¥åŠä½¿ç”¨æ“ä½œæ—¶å­˜å‚¨åº“çš„é»˜è®¤ä½ç½®[`checkout`](https://github.com/actions/checkout)ã€‚ |



### ä¸€äº›åŠŸèƒ½æ¡ˆä¾‹

| **ç‰¹å¾**                             | **æ‰§è¡Œ**                                                     |
| :----------------------------------- | :----------------------------------------------------------- |
| è§¦å‘å·¥ä½œæµè‡ªåŠ¨è¿è¡Œ                   | [`push`](https://docs.github.com/en/actions/using-workflows/events-that-trigger-workflows#push) |
| è§¦å‘å·¥ä½œæµè‡ªåŠ¨è¿è¡Œ                   | [`pull_request`](https://docs.github.com/en/actions/using-workflows/events-that-trigger-workflows#pull_request) |
| ä» UI æ‰‹åŠ¨è¿è¡Œå·¥ä½œæµç¨‹               | [`workflow_dispatch`](https://docs.github.com/en/actions/using-workflows/events-that-trigger-workflows#workflow_dispatch) |
| è®¾ç½®ä»¤ç‰Œçš„æƒé™                       | [`permissions`](https://docs.github.com/en/actions/using-jobs/assigning-permissions-to-jobs) |
| æ§åˆ¶å¯ä»¥åŒæ—¶è¿è¡Œçš„å·¥ä½œæµç¨‹æˆ–ä½œä¸šæ•°é‡ | [`concurrency`](https://docs.github.com/en/actions/using-jobs/using-concurrency) |
| æ ¹æ®å­˜å‚¨åº“åœ¨ä¸åŒçš„è¿è¡Œå™¨ä¸Šè¿è¡Œä½œä¸š   | [`runs-on`](https://docs.github.com/en/actions/using-jobs/choosing-the-runner-for-a-job) |
| å°†æ‚¨çš„å­˜å‚¨åº“å…‹éš†åˆ°è¿è¡Œå™¨             | [`actions/checkout`](https://github.com/actions/checkout)    |
| å®‰è£…`node`åœ¨è½¬è½®ä¸Š                   | [`actions/setup-node`](https://github.com/actions/setup-node) |
| ä½¿ç”¨ç¬¬ä¸‰æ–¹æ“ä½œ                       | [`trilom/file-changes-action`](https://github.com/trilom/file-changes-action) |
| åœ¨è¿è¡Œå™¨ä¸Šè¿è¡Œè„šæœ¬                   | ä½¿ç”¨`./script/rendered-content-link-checker.mjs`             |



## actions é«˜çº§åŠŸèƒ½

æœ¬èŠ‚ç®€è¦ä»‹ç» GitHub Actions çš„ä¸€äº›é«˜çº§åŠŸèƒ½ï¼Œå¯å¸®åŠ©æ‚¨åˆ›å»ºæ›´å¤æ‚çš„å·¥ä½œæµç¨‹ã€‚



### å‚¨å­˜ç§˜å¯†

*å¦‚æœæ‚¨çš„å·¥ä½œæµç¨‹ä½¿ç”¨æ•æ„Ÿæ•°æ®ï¼ˆä¾‹å¦‚å¯†ç æˆ–è¯ä¹¦ï¼‰ï¼Œæ‚¨å¯ä»¥å°†è¿™äº›æ•°æ®ä½œä¸ºæœºå¯†* ä¿å­˜åœ¨ GitHub ä¸­ï¼Œç„¶ååœ¨å·¥ä½œæµç¨‹ä¸­å°†å®ƒä»¬ç”¨ä½œç¯å¢ƒå˜é‡ã€‚è¿™æ„å‘³ç€æ‚¨å°†èƒ½å¤Ÿåˆ›å»ºå’Œå…±äº«å·¥ä½œæµç¨‹ï¼Œè€Œæ— éœ€å°†æ•æ„Ÿå€¼ç›´æ¥åµŒå…¥åˆ°å·¥ä½œæµç¨‹çš„ YAML æºä¸­ã€‚

æ­¤ç¤ºä¾‹ä½œä¸šæ¼”ç¤ºäº†å¦‚ä½•å¼•ç”¨ç°æœ‰å¯†é’¥ä½œä¸ºç¯å¢ƒå˜é‡ï¼Œå¹¶å°†å…¶ä½œä¸ºå‚æ•°å‘é€åˆ°ç¤ºä¾‹å‘½ä»¤ã€‚

```yaml
jobs:
  example-job:
    runs-on: ubuntu-latest
    steps:
      - name: Retrieve secret
        env:
          super_secret: ${{ secrets.SUPERSECRET }}
        run: |
          example-command "$super_secret"
```



### åˆ›é€ ä¾èµ–å·¥ä½œ

é»˜è®¤æƒ…å†µä¸‹ï¼Œå·¥ä½œæµç¨‹ä¸­çš„ä½œä¸šå…¨éƒ¨åŒæ—¶ **å¹¶è¡Œè¿è¡Œ**ã€‚å¦‚æœæ‚¨çš„ä½œä¸šå¿…é¡»ä»…åœ¨å¦ä¸€ä¸ªä½œä¸šå®Œæˆåè¿è¡Œï¼Œåˆ™å¯ä»¥ä½¿ç”¨å…³é”®å­—`needs`åˆ›å»ºæ­¤ä¾èµ–é¡¹ã€‚å¦‚æœå…¶ä¸­ä¸€é¡¹ä½œä¸šå¤±è´¥ï¼Œåˆ™è·³è¿‡æ‰€æœ‰ç›¸å…³ä½œä¸šï¼›ä½†æ˜¯ï¼Œå¦‚æœæ‚¨éœ€è¦ç»§ç»­æ‰§è¡Œä½œä¸šï¼Œåˆ™å¯ä»¥ä½¿ç”¨`if`æ¡ä»¶è¯­å¥è¿›è¡Œå®šä¹‰ã€‚

åœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œ`setup`ã€`build`å’Œ`test`ä½œä¸šä¸²è”è¿è¡Œï¼Œå¹¶ä¸”`build`ä¾èµ–`test`äºå®ƒä»¬ä¹‹å‰çš„ä½œä¸šæ˜¯å¦æˆåŠŸå®Œæˆï¼š

```yaml
jobs:
  setup:
    runs-on: ubuntu-latest
    steps:
      - run: ./setup_server.sh
  build:
    needs: setup
    runs-on: ubuntu-latest
    steps:
      - run: ./build_server.sh
  test:
    needs: build
    runs-on: ubuntu-latest
    steps:
      - run: ./test_server.sh
```

æœ‰å…³è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…â€œ[åœ¨å·¥ä½œæµç¨‹ä¸­ä½¿ç”¨ä½œä¸š](https://docs.github.com/en/actions/using-jobs/using-jobs-in-a-workflow#defining-prerequisite-jobs)â€ã€‚



### ä½¿ç”¨çŸ©é˜µ

çŸ©é˜µç­–ç•¥å…è®¸æ‚¨åœ¨å•ä¸ªä½œä¸šå®šä¹‰ä¸­ä½¿ç”¨å˜é‡æ¥è‡ªåŠ¨åˆ›å»ºåŸºäºå˜é‡ç»„åˆçš„å¤šä¸ªä½œä¸šè¿è¡Œã€‚ä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨çŸ©é˜µç­–ç•¥åœ¨ä¸€ç§è¯­è¨€çš„å¤šä¸ªç‰ˆæœ¬æˆ–å¤šä¸ªæ“ä½œç³»ç»Ÿä¸Šæµ‹è¯•æ‚¨çš„ä»£ç ã€‚è¯¥çŸ©é˜µæ˜¯ä½¿ç”¨`strategy`å…³é”®å­—åˆ›å»ºçš„ï¼Œè¯¥å…³é”®å­—ä»¥æ•°ç»„å½¢å¼æ¥æ”¶æ„å»ºé€‰é¡¹ã€‚ä¾‹å¦‚ï¼Œæ­¤çŸ©é˜µå°†ä½¿ç”¨ä¸åŒç‰ˆæœ¬çš„ Node.js å¤šæ¬¡è¿è¡Œä½œä¸šï¼š

```yaml
jobs:
  build:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        node: [12, 14, 16]
    steps:
      - uses: actions/setup-node@v3
        with:
          node-version: ${{ matrix.node }}
```

æœ‰å…³è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…â€œ[ä¸ºæ‚¨çš„ä½œä¸šä½¿ç”¨çŸ©é˜µ](https://docs.github.com/en/actions/using-jobs/using-a-matrix-for-your-jobs)â€ã€‚


### ç¼“å­˜ä¾èµ–é¡¹

å¦‚æœæ‚¨çš„ä½œä¸šç»å¸¸é‡ç”¨ä¾èµ–é¡¹ï¼Œæ‚¨å¯ä»¥è€ƒè™‘ç¼“å­˜è¿™äº›æ–‡ä»¶ä»¥å¸®åŠ©æé«˜æ€§èƒ½ã€‚åˆ›å»ºç¼“å­˜åï¼ŒåŒä¸€å­˜å‚¨åº“ä¸­çš„æ‰€æœ‰å·¥ä½œæµéƒ½å¯ä»¥ä½¿ç”¨å®ƒã€‚

æ­¤ç¤ºä¾‹æ¼”ç¤ºå¦‚ä½•ç¼“å­˜`~/.npm`ç›®å½•ï¼š

```yaml
jobs:
  example-job:
    steps:
      - name: Cache node modules
        uses: actions/cache@v3
        env:
          cache-name: cache-node-modules
        with:
          path: ~/.npm
          key: ${{ runner.os }}-build-${{ env.cache-name }}-${{ hashFiles('**/package-lock.json') }}
          restore-keys: |
            ${{ runner.os }}-build-${{ env.cache-name }}-
```

æœ‰å…³è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…â€œ[ç¼“å­˜ä¾èµ–é¡¹ä»¥åŠ å¿«å·¥ä½œæµç¨‹](https://docs.github.com/en/actions/using-workflows/caching-dependencies-to-speed-up-workflows)â€ã€‚



### ä½¿ç”¨æ•°æ®åº“å’ŒæœåŠ¡å®¹å™¨

å¦‚æœä½ çš„å·¥ä½œéœ€è¦æ•°æ®åº“æˆ–ç¼“å­˜æœåŠ¡ï¼Œä½ å¯ä»¥ä½¿ç”¨å…³é”®å­—[`services`](https://docs.github.com/en/actions/using-jobs/running-jobs-in-a-container)åˆ›å»ºä¸€ä¸ªä¸´æ—¶å®¹å™¨æ¥æ‰˜ç®¡æœåŠ¡ï¼›ç„¶åï¼Œç”Ÿæˆçš„å®¹å™¨å¯ç”¨äºè¯¥ä½œä¸šä¸­çš„æ‰€æœ‰æ­¥éª¤ï¼Œå¹¶åœ¨ä½œä¸šå®Œæˆåè¢«åˆ é™¤ã€‚æ­¤ç¤ºä¾‹æ¼”ç¤ºäº†ä½œä¸šå¦‚ä½•ç”¨äº`services`åˆ›å»º`postgres`å®¹å™¨ï¼Œç„¶åç”¨äº`node`è¿æ¥åˆ°æœåŠ¡ã€‚

```yaml
jobs:
  container-job:
    runs-on: ubuntu-latest
    container: node:10.18-jessie
    services:
      postgres:
        image: postgres
    steps:
      - name: Check out repository code
        uses: actions/checkout@v3
      - name: Install dependencies
        run: npm ci
      - name: Connect to PostgreSQL
        run: node client.js
        env:
          POSTGRES_HOST: postgres
          POSTGRES_PORT: 5432
```

æœ‰å…³è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…â€œ[ä½¿ç”¨å®¹å™¨åŒ–æœåŠ¡](https://docs.github.com/en/actions/using-containerized-services)â€ã€‚



### ä½¿ç”¨æ ‡ç­¾æ¥è·¯ç”±å·¥ä½œæµç¨‹

å¦‚æœæ‚¨æƒ³ç¡®ä¿ç‰¹å®šç±»å‹çš„è¿è¡Œå™¨å°†å¤„ç†æ‚¨çš„ä½œä¸šï¼Œæ‚¨å¯ä»¥ä½¿ç”¨æ ‡ç­¾æ¥æ§åˆ¶ä½œä¸šçš„æ‰§è¡Œä½ç½®ã€‚é™¤äº†é»˜è®¤æ ‡ç­¾ ä¹‹å¤–ï¼Œæ‚¨è¿˜å¯ä»¥ä¸ºè‡ªæ‰˜ç®¡è¿è¡Œå™¨åˆ†é…æ ‡ç­¾`self-hosted`ã€‚ç„¶åï¼Œæ‚¨å¯ä»¥åœ¨ YAML å·¥ä½œæµç¨‹ä¸­å¼•ç”¨è¿™äº›æ ‡ç­¾ï¼Œç¡®ä¿ä½œä¸šä»¥å¯é¢„æµ‹çš„æ–¹å¼è·¯ç”±ã€‚GitHub æ‰˜ç®¡çš„è¿è¡Œå™¨å·²åˆ†é…é¢„å®šä¹‰æ ‡ç­¾ã€‚

æ­¤ç¤ºä¾‹æ˜¾ç¤ºå·¥ä½œæµå¦‚ä½•ä½¿ç”¨æ ‡ç­¾æ¥æŒ‡å®šæ‰€éœ€çš„è¿è¡Œç¨‹åºï¼š

```yaml
jobs:
  example-job:
    runs-on: [self-hosted, linux, x64, gpu]
```

å·¥ä½œæµå°†ä»…åœ¨å…·æœ‰`runs-on`æ•°ç»„ä¸­æ‰€æœ‰æ ‡ç­¾çš„è¿è¡Œå™¨ä¸Šè¿è¡Œã€‚è¯¥ä½œä¸šå°†ä¼˜å…ˆè½¬åˆ°å…·æœ‰æŒ‡å®šæ ‡ç­¾çš„ç©ºé—²è‡ªæ‰˜ç®¡è¿è¡Œå™¨ã€‚å¦‚æœæ²¡æœ‰å¯ç”¨çš„å¹¶ä¸”å­˜åœ¨å…·æœ‰æŒ‡å®šæ ‡ç­¾çš„ GitHub æ‰˜ç®¡è¿è¡Œå™¨ï¼Œåˆ™ä½œä¸šå°†è½¬åˆ° GitHub æ‰˜ç®¡è¿è¡Œå™¨ã€‚

è¦äº†è§£æœ‰å…³è‡ªæ‰˜ç®¡è¿è¡Œå™¨æ ‡ç­¾çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜…â€œ[å°†æ ‡ç­¾ä¸è‡ªæ‰˜ç®¡è¿è¡Œå™¨ç»“åˆä½¿ç”¨](https://docs.github.com/en/actions/hosting-your-own-runners/managing-self-hosted-runners/using-labels-with-self-hosted-runners)â€ã€‚

è¦äº†è§£æœ‰å…³ GitHub æ‰˜ç®¡çš„è¿è¡Œå™¨æ ‡ç­¾çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜…â€œ[å…³äº GitHub æ‰˜ç®¡çš„è¿è¡Œå™¨](https://docs.github.com/en/actions/using-github-hosted-runners/about-github-hosted-runners#supported-runners-and-hardware-resources)â€ã€‚

### é‡ç”¨å·¥ä½œæµç¨‹

æ‚¨å¯ä»¥ä»ä¸€ä¸ªå·¥ä½œæµç¨‹è°ƒç”¨å¦ä¸€ä¸ªå·¥ä½œæµç¨‹ã€‚è¿™ä½¿æ‚¨å¯ä»¥é‡ç”¨å·¥ä½œæµç¨‹ï¼Œé¿å…é‡å¤å¹¶ä½¿å·¥ä½œæµç¨‹æ›´æ˜“äºç»´æŠ¤ã€‚æœ‰å…³è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…â€œ[é‡ç”¨å·¥ä½œæµç¨‹](https://docs.github.com/en/actions/using-workflows/reusing-workflows)â€ã€‚

### ä½¿ç”¨ç¯å¢ƒ

æ‚¨å¯ä»¥ä½¿ç”¨ä¿æŠ¤è§„åˆ™å’Œæœºå¯†é…ç½®ç¯å¢ƒï¼Œä»¥æ§åˆ¶å·¥ä½œæµä¸­ä½œä¸šçš„æ‰§è¡Œã€‚å·¥ä½œæµä¸­çš„æ¯ä¸ªä½œä¸šéƒ½å¯ä»¥å¼•ç”¨å•ä¸ªç¯å¢ƒã€‚åœ¨å°†å¼•ç”¨ç¯å¢ƒçš„ä½œä¸šå‘é€åˆ°è¿è¡Œå™¨ä¹‹å‰ï¼Œä¸ºç¯å¢ƒé…ç½®çš„ä»»ä½•ä¿æŠ¤è§„åˆ™éƒ½å¿…é¡»é€šè¿‡ã€‚æœ‰å…³è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…â€œ[ä½¿ç”¨éƒ¨ç½²ç¯å¢ƒ](https://docs.github.com/en/actions/deployment/targeting-different-environments/using-environments-for-deployment)â€ã€‚



## å¹¶å‘å·¥ä½œ

æ‚¨å¯ä»¥ä½¿ç”¨å®ƒ`jobs.<job_id>.concurrency`æ¥ç¡®ä¿ä¸€æ¬¡ä»…è¿è¡Œä¸€ä¸ªä½¿ç”¨ç›¸åŒå¹¶å‘ç»„çš„ä½œä¸šæˆ–å·¥ä½œæµã€‚å¹¶å‘ç»„å¯ä»¥æ˜¯ä»»ä½•å­—ç¬¦ä¸²æˆ–è¡¨è¾¾å¼ã€‚å…è®¸çš„è¡¨è¾¾å¼ä¸Šä¸‹æ–‡ï¼š[`github`](https://docs.github.com/en/actions/learn-github-actions/contexts#github-context)ã€[`inputs`](https://docs.github.com/en/actions/learn-github-actions/contexts#inputs-context)ã€[`vars`](https://docs.github.com/en/actions/learn-github-actions/contexts#vars-context)ã€[`needs`](https://docs.github.com/en/actions/learn-github-actions/contexts#needs-context)ã€[`strategy`](https://docs.github.com/en/actions/learn-github-actions/contexts#strategy-context)å’Œ[`matrix`](https://docs.github.com/en/actions/learn-github-actions/contexts#matrix-context)ã€‚æœ‰å…³è¡¨è¾¾å¼çš„è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…â€œ[è¡¨è¾¾å¼](https://docs.github.com/en/actions/learn-github-actions/expressions)â€ã€‚

æ‚¨è¿˜å¯ä»¥`concurrency`åœ¨å·¥ä½œæµç¨‹çº§åˆ«æŒ‡å®šã€‚æœ‰å…³è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…[`concurrency`](https://docs.github.com/en/actions/using-workflows/workflow-syntax-for-github-actions#concurrency)ã€‚

å½“å¹¶å‘ä½œä¸šæˆ–å·¥ä½œæµæ’é˜Ÿæ—¶ï¼Œå¦‚æœä½¿ç”¨å­˜å‚¨åº“ä¸­ç›¸åŒå¹¶å‘ç»„çš„å¦ä¸€ä¸ªä½œä¸šæˆ–å·¥ä½œæµæ­£åœ¨è¿›è¡Œä¸­ï¼Œåˆ™æ’é˜Ÿçš„ä½œä¸šæˆ–å·¥ä½œæµå°†ä¸º`pending`ã€‚å¹¶å‘ç»„ä¸­ä»»ä½•å…ˆå‰æŒ‚èµ·çš„ä½œä¸šæˆ–å·¥ä½œæµéƒ½å°†è¢«å–æ¶ˆã€‚è¦åŒæ—¶å–æ¶ˆåŒä¸€å¹¶å‘ç»„ä¸­ä»»ä½•å½“å‰æ­£åœ¨è¿è¡Œçš„ä½œä¸šæˆ–å·¥ä½œæµï¼Œè¯·æŒ‡å®š`cancel-in-progress: true`ã€‚

### ç¤ºä¾‹ï¼šä½¿ç”¨å¹¶å‘å’Œé»˜è®¤è¡Œä¸º

```yaml
concurrency: staging_environment
concurrency: ci-${{ github.ref }}
```

### ç¤ºä¾‹ï¼šä½¿ç”¨å¹¶å‘å–æ¶ˆä»»ä½•æ­£åœ¨è¿›è¡Œçš„ä½œä¸šæˆ–è¿è¡Œ

```yaml
concurrency:
  group: ${{ github.ref }}
  cancel-in-progress: true
```



## å®¹å™¨ä¸­è¿è¡Œ

ç”¨äº`jobs.<job_id>.container`åˆ›å»ºå®¹å™¨ä»¥è¿è¡Œä½œä¸šä¸­å°šæœªæŒ‡å®šå®¹å™¨çš„ä»»ä½•æ­¥éª¤ã€‚å¦‚æœæ‚¨æœ‰åŒæ—¶ä½¿ç”¨è„šæœ¬å’Œå®¹å™¨æ“ä½œçš„æ­¥éª¤ï¼Œåˆ™å®¹å™¨æ“ä½œå°†ä½œä¸ºå…·æœ‰ç›¸åŒå·æŒ‚è½½çš„åŒä¸€ç½‘ç»œä¸Šçš„åŒçº§å®¹å™¨è¿è¡Œã€‚

å¦‚æœæ‚¨ä¸è®¾ç½® a `container`ï¼Œåˆ™æ‰€æœ‰æ­¥éª¤éƒ½å°†ç›´æ¥åœ¨ æŒ‡å®šçš„ä¸»æœºä¸Šè¿è¡Œï¼Œ`runs-on`é™¤éæ­¥éª¤å¼•ç”¨é…ç½®ä¸ºåœ¨å®¹å™¨ä¸­è¿è¡Œçš„æ“ä½œã€‚

æ¡ˆä¾‹ï¼š

```yaml
name: CI
on:
  push:
    branches: [ main ]
jobs:
  container-test-job:
    runs-on: ubuntu-latest
    container:
      image: node:14.16
      env:
        NODE_ENV: development
      ports:
        - 80
      volumes:
        - my_docker_volume:/volume_mount
      options: --cpus 1
    steps:
      - name: Check for dockerenv file
        run: (ls /.dockerenv && echo Found dockerenv) || (echo No dockerenv)
```

å½“æ‚¨åªæŒ‡å®šå®¹å™¨é•œåƒæ—¶ï¼Œå¯ä»¥çœç•¥è¯¥`image`å…³é”®å­—ã€‚

```yaml
jobs:
  container-test-job:
    runs-on: ubuntu-latest
    container: node:14.16
```



## å®šä¹‰å®¹å™¨é•œåƒ

ç”¨äº`jobs.<job_id>.container.image`å®šä¹‰ç”¨ä½œè¿è¡Œæ“ä½œçš„å®¹å™¨çš„ Docker æ˜ åƒã€‚è¯¥å€¼å¯ä»¥æ˜¯ Docker Hub æ˜ åƒåç§°æˆ–æ³¨å†Œè¡¨åç§°ã€‚

å¦‚æœé•œåƒçš„å®¹å™¨æ³¨å†Œè¡¨éœ€è¦èº«ä»½éªŒè¯æ‰èƒ½æ‹‰å–é•œåƒï¼Œæ‚¨å¯ä»¥ä½¿ç”¨å’Œæ¥`jobs.<job_id>.container.credentials`è®¾ç½®ã€‚å‡­æ®ä¸æ‚¨å‘å‘½ä»¤æä¾›çš„å€¼ç›¸åŒã€‚

map username password [docker login](https://docs.docker.com/engine/reference/commandline/login/)



## å°†ç¯å¢ƒå˜é‡ä¸å®¹å™¨ä¸€èµ·ä½¿ç”¨

ç”¨äºåœ¨å®¹å™¨ä¸­`jobs.<job_id>.container.env`è®¾ç½®ä¸€ç³»åˆ—ç¯å¢ƒå˜é‡ã€‚`map`



**åœ¨å®¹å™¨ä¸­å®‰è£…å·ï¼š**

ç”¨äº`jobs.<job_id>.container.volumes`è®¾ç½®`array`å®¹å™¨ä½¿ç”¨çš„å·ã€‚æ‚¨å¯ä»¥ä½¿ç”¨å·åœ¨æœåŠ¡æˆ–ä½œä¸šä¸­çš„å…¶ä»–æ­¥éª¤ä¹‹é—´å…±äº«æ•°æ®ã€‚æ‚¨å¯ä»¥åœ¨ä¸»æœºä¸ŠæŒ‡å®šå‘½å Docker å·ã€åŒ¿å Docker å·æˆ–ç»‘å®šå®‰è£…ã€‚

è¦æŒ‡å®šå·ï¼Œè¯·æŒ‡å®šæºè·¯å¾„å’Œç›®æ ‡è·¯å¾„ï¼š

`<source>:<destinationPath>`ã€‚

æ˜¯`<source>`ä¸»æœºä¸Šçš„å·åç§°æˆ–ç»å¯¹è·¯å¾„ï¼Œ`<destinationPath>`æ˜¯å®¹å™¨ä¸­çš„ç»å¯¹è·¯å¾„ã€‚



### ç¤ºä¾‹ï¼šåœ¨å®¹å™¨ä¸­å®‰è£…å·

```yaml
volumes:
  - my_docker_volume:/volume_mount
  - /data/my_data
  - /source/directory:/destination/directory
```



## å®šä¹‰å°†åº”ç”¨äºå·¥ä½œæµä¸­çš„æ‰€æœ‰ä½œä¸šæˆ–ä½œä¸šä¸­æ‰€æœ‰æ­¥éª¤çš„é»˜è®¤è®¾ç½®

å½“ä½¿ç”¨ç›¸åŒåç§°å®šä¹‰å¤šä¸ªé»˜è®¤è®¾ç½®æ—¶ï¼ŒGitHub å°†ä½¿ç”¨æœ€å…·ä½“çš„é»˜è®¤è®¾ç½®ã€‚ä¾‹å¦‚ï¼Œä½œä¸šä¸­å®šä¹‰çš„é»˜è®¤è®¾ç½®å°†è¦†ç›–åœ¨å·¥ä½œæµä¸­å®šä¹‰çš„åç§°ç›¸åŒçš„é»˜è®¤è®¾ç½®ã€‚



### è®¾ç½®é»˜è®¤å¤–å£³å’Œå·¥ä½œç›®å½•

ç”¨äº `jobs.<job_id>.defaults` åˆ›å»º `map` å°†åº”ç”¨äºä½œä¸šä¸­æ‰€æœ‰æ­¥éª¤çš„é»˜è®¤è®¾ç½®ã€‚æ‚¨è¿˜å¯ä»¥ä¸ºæ•´ä¸ªå·¥ä½œæµè®¾ç½®é»˜è®¤è®¾ç½®ã€‚æœ‰å…³è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚è§ `defaults`  https://docs.github.com/en/actions/using-workflows/workflow-syntax-for-github-actions#defaultsã€‚

å½“ä½¿ç”¨ç›¸åŒçš„åç§°å®šä¹‰å¤šä¸ªé»˜è®¤è®¾ç½®æ—¶ï¼ŒGitHubä½¿ç”¨æœ€å…·ä½“çš„é»˜è®¤è®¾ç½®ã€‚ä¾‹å¦‚ï¼Œåœ¨ä½œä¸šä¸­å®šä¹‰çš„é»˜è®¤è®¾ç½®å°†è¦†ç›–åœ¨å·¥ä½œæµä¸­å®šä¹‰çš„åŒåé»˜è®¤è®¾ç½®ã€‚



### è®¾ç½®ä½œä¸šçš„é»˜è®¤shellå’Œå·¥ä½œç›®å½•

ç”¨äº `jobs.<job_id>.defaults.run` ä¸ºä½œä¸šä¸­ `shell` `working-directory` çš„æ‰€æœ‰ `run` æ­¥éª¤æä¾›é»˜è®¤å€¼ã€‚æ­¤èŠ‚ä¸­ä¸å…è®¸ä½¿ç”¨ä¸Šä¸‹æ–‡å’Œè¡¨è¾¾å¼ã€‚

å¯ä»¥ä¸ºä½œä¸šä¸­çš„æ‰€æœ‰æ­¥éª¤æä¾›é»˜è®¤å€¼ `shell` å’Œ `working-directory` é€‰é¡¹ `run` ã€‚ä¹Ÿå¯ä»¥ `run` ä¸ºæ•´ä¸ªå·¥ä½œæµè®¾ç½®é»˜è®¤è®¾ç½®ã€‚æœ‰å…³è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚è§ `jobs.defaults.run` ã€‚ä¸èƒ½åœ¨æ­¤å…³é”®å­—ä¸­ä½¿ç”¨ä¸Šä¸‹æ–‡æˆ–è¡¨è¾¾å¼ã€‚

å½“ä½¿ç”¨ç›¸åŒçš„åç§°å®šä¹‰å¤šä¸ªé»˜è®¤è®¾ç½®æ—¶ï¼ŒGitHubä½¿ç”¨æœ€å…·ä½“çš„é»˜è®¤è®¾ç½®ã€‚ä¾‹å¦‚ï¼Œåœ¨ä½œä¸šä¸­å®šä¹‰çš„é»˜è®¤è®¾ç½®å°†è¦†ç›–åœ¨å·¥ä½œæµä¸­å®šä¹‰çš„åŒåé»˜è®¤è®¾ç½®ã€‚



### è®¾ç½® `run` ä½œä¸šçš„é»˜è®¤æ­¥éª¤é€‰é¡¹

```yaml
jobs:
  job1:
    runs-on: ubuntu-latest
    defaults:
      run:
        shell: bash
        working-directory: scripts
```



## ä¸ºä½œä¸šåˆ†é…æƒé™

æ‚¨å¯ä»¥ä½¿ç”¨ `permissions` ä¿®æ”¹æˆäºˆçš„é»˜è®¤æƒé™ `GITHUB_TOKEN` ï¼Œæ ¹æ®éœ€è¦æ·»åŠ æˆ–åˆ é™¤è®¿é—®æƒé™ï¼Œä»¥ä¾¿ä»…å…è®¸æ‰€éœ€çš„æœ€å°è®¿é—®æƒé™ã€‚æœ‰å…³è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…â€œ[è‡ªåŠ¨ä»¤ç‰Œèº«ä»½éªŒè¯ã€‚](https://docs.github.com/en/actions/security-guides/automatic-token-authentication#permissions-for-the-github_token)â€œ

æ‚¨å¯ä»¥å°†å…¶ç”¨ä½œ `permissions` é¡¶çº§å…³é”®å­—ï¼Œä»¥åº”ç”¨äºå·¥ä½œæµä¸­çš„æ‰€æœ‰ä½œä¸šæˆ–ç‰¹å®šä½œä¸šå†…çš„ä½œä¸šã€‚åœ¨ `permissions` ç‰¹å®šä½œä¸šä¸­æ·»åŠ å¯†é’¥æ—¶ï¼Œè¯¥ä½œä¸šä¸­ä½¿ç”¨çš„æ‰€æœ‰æ“ä½œå’Œè¿è¡Œå‘½ä»¤éƒ½å°†è·å¾— `GITHUB_TOKEN` æ‚¨æŒ‡å®šçš„è®¿é—®æƒé™ã€‚æœ‰å…³è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚è§ `jobs.<job_id>.permissions` ã€‚

å¯ç”¨çš„ä½œç”¨åŸŸå’Œè®¿é—®å€¼ï¼š

```yaml
permissions:
  actions: read|write|none
  checks: read|write|none
  contents: read|write|none
  deployments: read|write|none
  id-token: read|write|none
  issues: read|write|none
  discussions: read|write|none
  packages: read|write|none
  pages: read|write|none
  pull-requests: read|write|none
  repository-projects: read|write|none
  security-events: read|write|none
  statuses: read|write|none
```

å¦‚æœä¸ºè¿™äº›ä½œç”¨åŸŸä¸­çš„ä»»ä½•ä¸€ä¸ªæŒ‡å®šäº†è®¿é—®æƒé™ï¼Œåˆ™æ‰€æœ‰æœªæŒ‡å®šçš„ä½œç”¨åŸŸéƒ½å°†è®¾ç½®ä¸º `none` ã€‚

å¯ä»¥ä½¿ç”¨ä»¥ä¸‹è¯­æ³•å®šä¹‰æ‰€æœ‰å¯ç”¨ä½œç”¨åŸŸçš„è¯»æˆ–å†™è®¿é—®æƒé™ï¼š

```yaml
permissions: read-all|write-all
```

å¯ä»¥ä½¿ç”¨ä»¥ä¸‹è¯­æ³•ç¦ç”¨æ‰€æœ‰å¯ç”¨ä½œç”¨åŸŸçš„æƒé™ï¼š

```yaml
permissions: {}
```

æ‚¨å¯ä»¥ä½¿ç”¨è¯¥å¯†é’¥æ·»åŠ å’Œåˆ é™¤æ´¾ç”Ÿå­˜å‚¨åº“çš„è¯»å–æƒé™ï¼Œä½†é€šå¸¸ä¸èƒ½æˆäºˆå†™å…¥æƒé™ã€‚ `permissions` key to add and remove read permissions for forked repositories, but typically you can't grant write access.æ­¤è¡Œä¸ºçš„ä¾‹å¤–æƒ…å†µæ˜¯ç®¡ç†å‘˜ç”¨æˆ·åœ¨GitHub Actionsè®¾ç½®ä¸­é€‰æ‹©äº†â€œä»æ‹‰å–è¯·æ±‚ä¸­å‘é€å†™å…¥ä»¤ç‰Œåˆ°å·¥ä½œæµâ€é€‰é¡¹ã€‚æœ‰å…³è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…"ç®¡ç†å­˜å‚¨åº“çš„GitHubæ“ä½œè®¾ç½®ã€‚"



### ä¸ºGITHUB_TOKENåˆ†é…æƒé™

æ­¤ç¤ºä¾‹æ˜¾ç¤ºä¸ºè®¾ç½®çš„æƒé™ï¼Œè¯¥æƒé™å°†åº”ç”¨äºå·¥ä½œæµä¸­çš„æ‰€æœ‰ä½œä¸šã€‚ `GITHUB_TOKEN` è¿™å°†é€‚ç”¨äºå·¥ä½œæµä¸­çš„æ‰€æœ‰ä½œä¸šã€‚æ‰€æœ‰æƒé™éƒ½è¢«æˆäºˆè¯»è®¿é—®æƒé™ã€‚

```go
name: "My workflow"

on: [ push ]

permissions: read-all

jobs:
  ...
```



### ç¤ºä¾‹ï¼šè®¾ç½®ç‰¹å®šä½œä¸šçš„æƒé™

æ­¤ç¤ºä¾‹æ˜¾ç¤ºä¸ºè®¾ç½®çš„æƒé™ï¼Œè¯¥ `GITHUB_TOKEN` æƒé™ä»…é€‚ç”¨äºåä¸ºçš„ä½œä¸š `stale` ã€‚å’Œä½œç”¨åŸŸè¢«æˆäºˆå†™è®¿é—®æƒé™ `issues` `pull-requests` ã€‚æ‰€æœ‰å…¶ä»–ä½œç”¨åŸŸéƒ½æ²¡æœ‰è®¿é—®æƒé™ã€‚

```yaml
jobs:
  stale:
    runs-on: ubuntu-latest

    permissions:
      issues: write
      pull-requests: write

    steps:
      - uses: actions/stale@v5
```



## æ„å»ºå’Œæµ‹è¯•(CI)

**å…³äºæŒç»­é›†æˆï¼ˆCIï¼‰ï¼š**

æˆ‘ä»¬å¬è¿‡å¾ˆå¤šæ¬¡ CICD çš„å¤§åï¼Œåˆ†åˆ«ä»£è¡¨çš„æ˜¯ *æŒç»­é›†æˆ*ï¼Œå’Œ *æŒç»­éƒ¨ç½²*

æŒç»­é›†æˆï¼ˆCIï¼‰æ˜¯ä¸€ç§è½¯ä»¶å®è·µï¼Œéœ€è¦é¢‘ç¹åœ°å°†ä»£ç æäº¤åˆ°å…±äº«å­˜å‚¨åº“ã€‚æ›´é¢‘ç¹åœ°æäº¤ä»£ç å¯ä»¥æ›´å¿«åœ°æ£€æµ‹åˆ°é”™è¯¯ï¼Œå¹¶å‡å°‘å¼€å‘äººå‘˜åœ¨æŸ¥æ‰¾é”™è¯¯æºæ—¶éœ€è¦è°ƒè¯•çš„ä»£ç é‡ã€‚

é¢‘ç¹çš„ä»£ç æ›´æ–°ä¹Ÿä½¿å¾—åˆå¹¶æ¥è‡ªè½¯ä»¶å¼€å‘å›¢é˜Ÿçš„ä¸åŒæˆå‘˜çš„æ›´æ”¹å˜å¾—æ›´åŠ å®¹æ˜“ã€‚è¿™å¯¹å¼€å‘äººå‘˜æ¥è¯´éå¸¸å¥½ï¼Œä»–ä»¬å¯ä»¥èŠ±æ›´å¤šçš„æ—¶é—´ç¼–å†™ä»£ç ï¼Œè€ŒèŠ±æ›´å°‘çš„æ—¶é—´è°ƒè¯•é”™è¯¯æˆ–è§£å†³åˆå¹¶å†²çªã€‚

å½“æ‚¨å°†ä»£ç æäº¤åˆ°å­˜å‚¨åº“æ—¶ï¼Œæ‚¨å¯ä»¥ä¸æ–­åœ°æ„å»ºå’Œæµ‹è¯•ä»£ç ï¼Œä»¥ç¡®ä¿æäº¤ä¸ä¼šå¼•å…¥é”™è¯¯ã€‚

æµ‹è¯•å¯ä»¥åŒ…æ‹¬ä»£ç é“¾æ¥ï¼ˆæ£€æŸ¥æ ·å¼æ ¼å¼ï¼‰ã€å®‰å…¨æ£€æŸ¥ã€ä»£ç è¦†ç›–ç‡ã€åŠŸèƒ½æµ‹è¯•å’Œå…¶ä»–è‡ªå®šä¹‰æ£€æŸ¥ã€‚

æ„å»ºå’Œæµ‹è¯•ä»£ç éœ€è¦æœåŠ¡å™¨ã€‚æ‚¨å¯ä»¥åœ¨å°†ä»£ç æ¨é€åˆ°å­˜å‚¨åº“ä¹‹å‰åœ¨æœ¬åœ°æ„å»ºå’Œæµ‹è¯•æ›´æ–°ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨CIæœåŠ¡å™¨æ¥æ£€æŸ¥å­˜å‚¨åº“ä¸­çš„æ–°ä»£ç æäº¤ã€‚



### å…³äºä½¿ç”¨GitHub Actionsè¿›è¡ŒæŒç»­é›†æˆ

æ‚¨å¯ä»¥é…ç½®CIå·¥ä½œæµï¼Œä½¿å…¶åœ¨GitHubäº‹ä»¶å‘ç”Ÿæ—¶ï¼ˆä¾‹å¦‚ï¼Œå½“æ–°ä»£ç è¢«æ¨é€åˆ°å­˜å‚¨åº“æ—¶ï¼‰ã€æŒ‰è®¾å®šçš„æ—¶é—´è¡¨è¿è¡Œï¼Œæˆ–è€…ä½¿ç”¨å­˜å‚¨åº“è°ƒåº¦webhookåœ¨å¤–éƒ¨äº‹ä»¶å‘ç”Ÿæ—¶è¿è¡Œã€‚

GitHubè¿è¡ŒCIæµ‹è¯•ï¼Œå¹¶åœ¨pullè¯·æ±‚ä¸­æä¾›æ¯ä¸ªæµ‹è¯•çš„ç»“æœï¼Œå› æ­¤æ‚¨å¯ä»¥æŸ¥çœ‹åˆ†æ”¯ä¸­çš„æ›´æ”¹æ˜¯å¦ä¼šå¼•å…¥é”™è¯¯ã€‚å½“å·¥ä½œæµä¸­çš„æ‰€æœ‰é…ç½®é¡¹æµ‹è¯•éƒ½é€šè¿‡æ—¶ï¼Œæ‚¨æ¨é€çš„æ›´æ”¹å°±å¯ä»¥ç”±å›¢é˜Ÿæˆå‘˜å®¡é˜…æˆ–åˆå¹¶äº†ã€‚

å½“æµ‹è¯•å¤±è´¥æ—¶ï¼Œå¯èƒ½æ˜¯æ‚¨çš„æŸä¸ªæ›´æ”¹å¯¼è‡´äº†å¤±è´¥ã€‚

å½“æ‚¨åœ¨å­˜å‚¨åº“ä¸­è®¾ç½®CIæ—¶ï¼ŒGitHubä¼šåˆ†æå­˜å‚¨åº“ä¸­çš„ä»£ç ï¼Œå¹¶æ ¹æ®å­˜å‚¨åº“ä¸­çš„è¯­è¨€å’Œæ¡†æ¶æ¨èCIå·¥ä½œæµã€‚ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨ä½¿ç”¨Node.jsï¼ŒGitHubå°†å»ºè®®ä¸€ä¸ªå¯åŠ¨å·¥ä½œæµï¼Œç”¨äºå®‰è£…Node.jsåŒ…å¹¶è¿è¡Œæµ‹è¯•ã€‚æ‚¨å¯ä»¥ä½¿ç”¨GitHubå»ºè®®çš„CI starterå·¥ä½œæµï¼Œè‡ªå®šä¹‰å»ºè®®çš„starterå·¥ä½œæµï¼Œæˆ–åˆ›å»ºè‡ªå·±çš„è‡ªå®šä¹‰å·¥ä½œæµæ–‡ä»¶æ¥è¿è¡ŒCIæµ‹è¯•ã€‚

é™¤äº†å¸®åŠ©æ‚¨ä¸ºé¡¹ç›®è®¾ç½®CIå·¥ä½œæµå¤–ï¼Œæ‚¨è¿˜å¯ä»¥ä½¿ç”¨GitHub Actionsåœ¨æ•´ä¸ªè½¯ä»¶å¼€å‘ç”Ÿå‘½å‘¨æœŸä¸­åˆ›å»ºå·¥ä½œæµã€‚ä¾‹å¦‚ï¼Œå¯ä»¥ä½¿ç”¨æ“ä½œæ¥éƒ¨ç½²ã€æ‰“åŒ…æˆ–å‘å¸ƒé¡¹ç›®ã€‚æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜…â€œ[å­¦ä¹ GitHubæ“ä½œ](https://docs.github.com/en/actions/learn-github-actions)ã€‚â€œ



## Starter workflow

GitHubä¸ºå„ç§è¯­è¨€å’Œæ¡†æ¶æä¾›CIå¯åŠ¨å·¥ä½œæµã€‚

åœ¨ [actions/starter-workflow](https://github.com/actions/starter-workflows/tree/main/ci) å­˜å‚¨åº“ä¸­æµè§ˆGitHubæä¾›çš„CI starterå·¥ä½œæµçš„å®Œæ•´åˆ—è¡¨ã€‚



## å…³äºæŒç»­éƒ¨ç½²(CD)

æŒç»­éƒ¨ç½²ï¼ˆCDï¼‰æ˜¯ä½¿ç”¨è‡ªåŠ¨åŒ–æ¥å‘å¸ƒå’Œéƒ¨ç½²è½¯ä»¶æ›´æ–°çš„å®è·µã€‚ä½œä¸ºå…¸å‹CDè¿‡ç¨‹çš„ä¸€éƒ¨åˆ†ï¼Œä»£ç åœ¨éƒ¨ç½²ä¹‹å‰ä¼šè‡ªåŠ¨æ„å»ºå’Œæµ‹è¯•ã€‚

æ‚¨å¯ä»¥è®¾ç½®GitHub Actionså·¥ä½œæµæ¥éƒ¨ç½²æ‚¨çš„è½¯ä»¶äº§å“ã€‚ä¸ºäº†éªŒè¯äº§å“æ˜¯å¦æŒ‰é¢„æœŸå·¥ä½œï¼Œæ‚¨çš„å·¥ä½œæµå¯ä»¥åœ¨å­˜å‚¨åº“ä¸­æ„å»ºä»£ç å¹¶åœ¨éƒ¨ç½²ä¹‹å‰è¿è¡Œæµ‹è¯•ã€‚

æ‚¨å¯ä»¥é…ç½®CDå·¥ä½œæµï¼Œä½¿å…¶åœ¨GitHubäº‹ä»¶å‘ç”Ÿæ—¶ï¼ˆä¾‹å¦‚ï¼Œå½“æ–°ä»£ç è¢«æ¨é€åˆ°å­˜å‚¨åº“çš„é»˜è®¤åˆ†æ”¯æ—¶ï¼‰ï¼ŒæŒ‰ç…§è®¾ç½®çš„æ—¶é—´è¡¨ï¼Œæ‰‹åŠ¨æˆ–ä½¿ç”¨å­˜å‚¨åº“è°ƒåº¦webhookå‘ç”Ÿå¤–éƒ¨äº‹ä»¶æ—¶è¿è¡Œã€‚

*æ¥ä¸‹æ¥æˆ‘ä»¬æ¥å­¦ä¹ ä½¿ç”¨githubçš„ actions æ¥è¿›è¡ŒæŒç»­éƒ¨ç½²ï¼š*

GitHub Actionsæä¾›äº†ä¸€äº›åŠŸèƒ½ï¼Œå¯ä»¥è®©ä½ æ§åˆ¶éƒ¨ç½²ã€‚æ‚¨å¯ä»¥ï¼š

- ä½¿ç”¨å„ç§äº‹ä»¶è§¦å‘å·¥ä½œæµã€‚
- é…ç½®ç¯å¢ƒä»¥åœ¨ä½œä¸šç»§ç»­ä¹‹å‰è®¾ç½®è§„åˆ™å¹¶é™åˆ¶å¯¹æœºå¯†çš„è®¿é—®ã€‚
- ä½¿ç”¨å¹¶å‘æ§åˆ¶ä¸€æ¬¡è¿è¡Œçš„éƒ¨ç½²æ•°é‡ã€‚



### è§¦å‘éƒ¨ç½²

æ‚¨å¯ä»¥ä½¿ç”¨å„ç§äº‹ä»¶æ¥è§¦å‘éƒ¨ç½²å·¥ä½œæµã€‚å…¶ä¸­æœ€å¸¸è§çš„æœ‰ï¼š `pull_request` ã€ `push` å’Œ `workflow_dispatch` ã€‚

+ åˆ†æ”¯ä¸Šæœ‰ä¸€ä¸ªæ¨åŠ› `main` ã€‚
+ ä»¥åˆ†æ”¯ä¸ºç›®æ ‡çš„æ‹‰å–è¯·æ±‚ `main` è¢«æ‰“å¼€ã€åŒæ­¥æˆ–é‡æ–°æ‰“å¼€ã€‚
+ æœ‰äººæ‰‹åŠ¨è§¦å‘äº†å®ƒã€‚

```yaml
on:
  push:
    branches:
      - main
  pull_request:
    branches:
      - main
  workflow_dispatch:
```



### ä½¿ç”¨å¹¶å‘

å¹¶å‘ç¡®ä¿ä¸€æ¬¡åªè¿è¡Œä½¿ç”¨åŒä¸€å¹¶å‘ç»„çš„å•ä¸ªä½œä¸šæˆ–å·¥ä½œæµã€‚æ‚¨å¯ä»¥ä½¿ç”¨å¹¶å‘æ€§ï¼Œä»¥ä¾¿ç¯å¢ƒä¸­ä¸€æ¬¡æœ€å¤šæœ‰ä¸€ä¸ªæ­£åœ¨è¿›è¡Œçš„éƒ¨ç½²å’Œä¸€ä¸ªæŒ‚èµ·çš„éƒ¨ç½²ã€‚

ä¾‹å¦‚ï¼Œå½“ä»¥ä¸‹å·¥ä½œæµè¿è¡Œæ—¶ï¼Œ `pending` å¦‚æœä½¿ç”¨å¹¶å‘ç»„çš„ä»»ä½•ä½œä¸šæˆ–å·¥ä½œæµ `production` æ­£åœ¨è¿›è¡Œï¼Œåˆ™è¯¥å·¥ä½œæµå°†æš‚åœï¼ŒçŠ¶æ€ä¸ºã€‚å®ƒè¿˜å°†å–æ¶ˆä½¿ç”¨å¹¶å‘ç»„å¹¶å…·æœ‰çŠ¶æ€çš„ä»»ä½•ä½œä¸šæˆ–å·¥ä½œæµ `production` , `pending` ã€‚è¿™æ„å‘³ç€åœ¨ä¸­ä½¿ç”¨å¹¶å‘ç»„çš„ä½œä¸šæˆ–å·¥ä½œæµæœ€å¤šåªèƒ½æœ‰ä¸€ä¸ªæ­£åœ¨è¿è¡Œå’Œä¸€ä¸ªæŒ‚ `production` èµ·ã€‚

```yaml
name: Deployment

concurrency: production

on:
  push:
    branches:
      - main

jobs:
  deployment:
    runs-on: ubuntu-latest
    environment: production
    steps:
      - name: deploy
        # ...deployment-specific steps
```

æ‚¨è¿˜å¯ä»¥åœ¨ä½œä¸šçº§åˆ«æŒ‡å®šå¹¶å‘æ€§ã€‚è¿™å°†å…è®¸å·¥ä½œæµä¸­çš„å…¶ä»–ä½œä¸šç»§ç»­è¿›è¡Œï¼Œå³ä½¿å¹¶å‘ä½œä¸šæ˜¯ `pending` ã€‚

```yaml
name: Deployment

on:
  push:
    branches:
      - main

jobs:
  deployment:
    runs-on: ubuntu-latest
    environment: production
    concurrency: production
    steps:
      - name: deploy
        # ...deployment-specific steps
```



### Choosing a runner 

æ‚¨å¯ä»¥åœ¨GitHubæ‰˜ç®¡çš„runneræˆ–è‡ªæ‰˜ç®¡çš„runnerä¸Šè¿è¡Œéƒ¨ç½²å·¥ä½œæµã€‚æ¥è‡ªGitHubæ‰˜ç®¡çš„runnerçš„æµé‡å¯èƒ½æ¥è‡ªå„ç§ç½‘ç»œåœ°å€ã€‚å¦‚æœæ‚¨æ­£åœ¨éƒ¨ç½²åˆ°å†…éƒ¨ç¯å¢ƒï¼Œå¹¶ä¸”æ‚¨çš„å…¬å¸é™åˆ¶å¤–éƒ¨æµé‡è¿›å…¥ä¸“ç”¨ç½‘ç»œï¼Œåˆ™åœ¨GitHubæ‰˜ç®¡çš„runnerä¸Šè¿è¡Œçš„GitHub Actionså·¥ä½œæµå¯èƒ½æ— æ³•ä¸æ‚¨çš„å†…éƒ¨æœåŠ¡æˆ–èµ„æºé€šä¿¡ã€‚



## å…³äºä½¿ç”¨ GitHub Actions è¿›è¡Œæ‰“åŒ…

æ‰“åŒ…æ­¥éª¤æ˜¯æŒç»­é›†æˆæˆ–æŒç»­äº¤ä»˜å·¥ä½œæµç¨‹çš„å¸¸è§éƒ¨åˆ†ã€‚åœ¨æŒç»­é›†æˆå·¥ä½œæµç¨‹ç»“æŸæ—¶åˆ›å»ºåŒ…å¯ä»¥åœ¨æ‹‰å–è¯·æ±‚çš„ä»£ç å®¡æŸ¥æœŸé—´æä¾›å¸®åŠ©ã€‚

æ„å»ºå’Œæµ‹è¯•ä»£ç åï¼Œæ‰“åŒ…æ­¥éª¤å¯ä»¥ç”Ÿæˆå¯è¿è¡Œæˆ–å¯éƒ¨ç½²çš„å·¥ä»¶ã€‚æ ¹æ®æ‚¨æ­£åœ¨æ„å»ºçš„åº”ç”¨ç¨‹åºçš„ç±»å‹ï¼Œå¯ä»¥åœ¨æœ¬åœ°ä¸‹è½½æ­¤åŒ…ä»¥è¿›è¡Œæ‰‹åŠ¨æµ‹è¯•ï¼Œå¯ä¾›ç”¨æˆ·ä¸‹è½½ï¼Œæˆ–éƒ¨ç½²åˆ°ä¸´æ—¶æˆ–ç”Ÿäº§ç¯å¢ƒã€‚

ä¾‹å¦‚ï¼ŒJava é¡¹ç›®çš„æŒç»­é›†æˆå·¥ä½œæµç¨‹å¯èƒ½ä¼šè¿è¡Œ`mvn package`ä»¥ç”Ÿæˆ JAR æ–‡ä»¶ã€‚æˆ–è€…ï¼ŒNode.js åº”ç”¨ç¨‹åºçš„ CI å·¥ä½œæµç¨‹å¯èƒ½ä¼šåˆ›å»º Docker å®¹å™¨ã€‚

ç°åœ¨ï¼Œåœ¨æŸ¥çœ‹æ‹‰å–è¯·æ±‚æ—¶ï¼Œæ‚¨å°†èƒ½å¤ŸæŸ¥çœ‹å·¥ä½œæµç¨‹è¿è¡Œå¹¶ä¸‹è½½ç”Ÿæˆçš„å·¥ä»¶ã€‚

![å·¥ä½œæµç¨‹è¿è¡Œçš„â€œå·¥ä»¶â€éƒ¨åˆ†çš„å±å¹•æˆªå›¾ã€‚ è¿è¡Œç”Ÿæˆçš„å·¥ä»¶çš„åç§°â€œå·¥ä»¶â€ä»¥æ·±æ©™è‰²è½®å»“çªå‡ºæ˜¾ç¤ºã€‚](https://docs.github.com/assets/cb-13991/images/help/repository/artifact-drop-down-updated.png)



### å‘å¸ƒåŒ…çš„å·¥ä½œæµç¨‹

é™¤äº†ä¸Šä¼ æ‰“åŒ…å·¥ä»¶ä»¥åœ¨æŒç»­é›†æˆå·¥ä½œæµç¨‹ä¸­è¿›è¡Œæµ‹è¯•ä¹‹å¤–ï¼Œæ‚¨è¿˜å¯ä»¥åˆ›å»ºæ„å»ºé¡¹ç›®å¹¶å°†åŒ…å‘å¸ƒåˆ°åŒ…æ³¨å†Œè¡¨çš„å·¥ä½œæµç¨‹ã€‚

- **å°†åŒ…å‘å¸ƒåˆ° GitHub Packages** GitHub Packages å¯ä»¥å……å½“å¤šç§ç±»å‹åŒ…çš„åŒ…æ‰˜ç®¡æœåŠ¡ã€‚æ‚¨å¯ä»¥é€‰æ‹©ä¸æ‰€æœ‰ GitHub å…±äº«æ‚¨çš„åŒ…ï¼Œä¹Ÿå¯ä»¥é€‰æ‹©ä¸åä½œè€…æˆ–ç»„ç»‡å…±äº«ç§æœ‰åŒ…ã€‚æ›´å¤šä¿¡æ¯è¯·å‚é˜…â€œ [GitHub åŒ…ç®€ä»‹](https://docs.github.com/en/packages/learn-github-packages/introduction-to-github-packages)â€ã€‚

  æ‚¨å¯èƒ½å¸Œæœ›åœ¨æ¯æ¬¡æ¨é€åˆ°é»˜è®¤åˆ†æ”¯æ—¶å°†åŒ…å‘å¸ƒåˆ° GitHub Packagesã€‚è¿™å°†ä½¿é¡¹ç›®çš„å¼€å‘äººå‘˜å§‹ç»ˆèƒ½å¤Ÿé€šè¿‡ä» GitHub Packages å®‰è£…å®ƒæ¥è½»æ¾è¿è¡Œå’Œæµ‹è¯•é»˜è®¤åˆ†æ”¯çš„æœ€æ–°ç‰ˆæœ¬ã€‚

- **å°†åŒ…å‘å¸ƒåˆ°åŒ…æ³¨å†Œè¡¨** å¯¹äºè®¸å¤šé¡¹ç›®ï¼Œæ¯å½“å‘å¸ƒé¡¹ç›®çš„æ–°ç‰ˆæœ¬æ—¶éƒ½ä¼šæ‰§è¡Œå‘åŒ…æ³¨å†Œè¡¨çš„å‘å¸ƒã€‚ä¾‹å¦‚ï¼Œç”Ÿæˆ JAR æ–‡ä»¶çš„é¡¹ç›®å¯ä»¥å°†æ–°ç‰ˆæœ¬ä¸Šä¼ åˆ° Maven ä¸­å¤®å­˜å‚¨åº“ã€‚æˆ–è€…ï¼Œ.NET é¡¹ç›®å¯èƒ½ä¼šç”Ÿæˆ nuget åŒ…å¹¶å°†å…¶ä¸Šä¼ åˆ° NuGet Galleryã€‚

  æ‚¨å¯ä»¥é€šè¿‡åˆ›å»ºä¸€ä¸ªå·¥ä½œæµç¨‹æ¥è‡ªåŠ¨æ‰§è¡Œæ­¤æ“ä½œï¼Œè¯¥å·¥ä½œæµç¨‹åœ¨æ¯æ¬¡åˆ›å»ºç‰ˆæœ¬æ—¶å°†åŒ…å‘å¸ƒåˆ°åŒ…æ³¨å†Œè¡¨ã€‚æœ‰å…³è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…â€œ[ç®¡ç†å­˜å‚¨åº“ä¸­çš„ç‰ˆæœ¬](https://docs.github.com/en/repositories/releasing-projects-on-github/managing-releases-in-a-repository)â€ã€‚



### å‘å¸ƒ Docker é•œåƒ

æ¯æ¬¡åœ¨ GitHub ä¸Šåˆ›å»ºæ–°ç‰ˆæœ¬æ—¶ï¼Œæ‚¨éƒ½å¯ä»¥è§¦å‘å·¥ä½œæµç¨‹æ¥å‘å¸ƒå›¾åƒã€‚ä»¥ä¸‹ç¤ºä¾‹ä¸­çš„å·¥ä½œæµåœ¨æ´»åŠ¨ç±»å‹`release`çš„äº‹ä»¶è§¦å‘æ—¶è¿è¡Œ`created`ã€‚æœ‰å…³è¯¥`release`äº‹ä»¶çš„è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…â€œ[è§¦å‘å·¥ä½œæµçš„äº‹ä»¶](https://docs.github.com/en/actions/using-workflows/events-that-trigger-workflows#release)â€ã€‚

åœ¨ä¸‹é¢çš„ç¤ºä¾‹å·¥ä½œæµç¨‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ Docker `login-action` å’Œ `build-push-action` æ“ä½œæ¥æ„å»º Docker æ˜ åƒï¼Œå¦‚æœæ„å»ºæˆåŠŸï¼Œåˆ™å°†æ„å»ºçš„æ˜ åƒæ¨é€åˆ° Docker Hubã€‚

è¦æ¨é€åˆ° Docker Hubï¼Œæ‚¨éœ€è¦æœ‰ä¸€ä¸ª Docker Hub å¸æˆ·ï¼Œå¹¶åˆ›å»ºä¸€ä¸ª Docker Hub å­˜å‚¨åº“ã€‚æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜…Docker æ–‡æ¡£ä¸­çš„â€œ[å°† Docker å®¹å™¨æ˜ åƒæ¨é€åˆ° Docker Hub â€ã€‚](https://docs.docker.com/docker-hub/repos/#pushing-a-docker-container-image-to-docker-hub)

`login-action` Docker Hub æ‰€éœ€çš„é€‰é¡¹æ˜¯ï¼š

- `username`å’Œ`password`ï¼šè¿™æ˜¯æ‚¨çš„ Docker Hub ç”¨æˆ·åå’Œå¯†ç ã€‚æˆ‘ä»¬å»ºè®®å°†æ‚¨çš„ Docker Hub ç”¨æˆ·åå’Œå¯†ç å­˜å‚¨ä¸ºæœºå¯†ï¼Œè¿™æ ·å®ƒä»¬å°±ä¸ä¼šåœ¨æ‚¨çš„å·¥ä½œæµç¨‹æ–‡ä»¶ä¸­å…¬å¼€ã€‚æœ‰å…³è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…â€œ[åŠ å¯†çš„æœºå¯†](https://docs.github.com/en/actions/security-guides/encrypted-secrets)â€ã€‚

`metadata-action`Docker Hub æ‰€éœ€çš„é€‰é¡¹æ˜¯ï¼š

- `images`ï¼šæ‚¨æ­£åœ¨æ„å»º/æ¨é€åˆ° Docker Hub çš„ Docker æ˜ åƒçš„å‘½åç©ºé—´å’Œåç§°ã€‚

`build-push-action` Docker Hub æ‰€éœ€çš„é€‰é¡¹æ˜¯ï¼š

- `tags`ï¼šæ–°å›¾åƒæ ¼å¼çš„æ ‡ç­¾`DOCKER-HUB-NAMESPACE/DOCKER-HUB-REPOSITORY:VERSION`ã€‚æ‚¨å¯ä»¥å¦‚ä¸‹æ‰€ç¤ºè®¾ç½®å•ä¸ªæ ‡ç­¾ï¼Œæˆ–åœ¨åˆ—è¡¨ä¸­æŒ‡å®šå¤šä¸ªæ ‡ç­¾ã€‚
- `push`ï¼šå¦‚æœè®¾ç½®ä¸º`true`ï¼Œåˆ™é•œåƒæ„å»ºæˆåŠŸåå°†è¢«æ¨é€åˆ°æ³¨å†Œè¡¨ã€‚

```yaml
name: Publish Docker image

on:
  release:
    types: [published]

jobs:
  push_to_registry:
    name: Push Docker image to Docker Hub
    runs-on: ubuntu-latest
    steps:
      - name: Check out the repo
        uses: actions/checkout@v3
      
      - name: Log in to Docker Hub
        uses: docker/login-action@f4ef78c080cd8ba55a85445d5b36e214a81df20a
        with:
          username: ${{ secrets.DOCKER_USERNAME }}
          password: ${{ secrets.DOCKER_PASSWORD }}
      
      - name: Extract metadata (tags, labels) for Docker
        id: meta
        uses: docker/metadata-action@9ec57ed1fcdbf14dcef7dfbe97b2010124a938b7
        with:
          images: my-docker-hub-namespace/my-docker-hub-repository
      
      - name: Build and push Docker image
        uses: docker/build-push-action@3b5e8027fcad23fda98b2e3ac259d8d67585f671
        with:
          context: .
          file: ./Dockerfile
          push: true
          tags: ${{ steps.meta.outputs.tags }}
          labels: ${{ steps.meta.outputs.labels }}
```

ä¸Šé¢çš„å·¥ä½œæµç¨‹æ£€æŸ¥ GitHub å­˜å‚¨åº“ï¼Œä½¿ç”¨`login-action`ç™»å½•åˆ°æ³¨å†Œè¡¨ï¼Œç„¶åä½¿ç”¨æ“ä½œ`build-push-action`æ¥ï¼š åŸºäºå­˜å‚¨åº“çš„ æ„å»º Docker æ˜ åƒ`Dockerfile`ï¼›å°†é•œåƒæ¨é€åˆ° Docker Hubï¼Œå¹¶ä¸ºé•œåƒåº”ç”¨æ ‡ç­¾ã€‚



### å°†å›¾åƒå‘å¸ƒåˆ° GitHub åŒ…

æ¯æ¬¡åœ¨ GitHub ä¸Šåˆ›å»ºæ–°ç‰ˆæœ¬æ—¶ï¼Œæ‚¨éƒ½å¯ä»¥è§¦å‘å·¥ä½œæµç¨‹æ¥å‘å¸ƒå›¾åƒã€‚ä»¥ä¸‹ç¤ºä¾‹ä¸­çš„å·¥ä½œæµåœ¨æ´»åŠ¨ç±»å‹`release`çš„äº‹ä»¶è§¦å‘æ—¶è¿è¡Œ`created`ã€‚æœ‰å…³è¯¥`release`äº‹ä»¶çš„è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…â€œ[è§¦å‘å·¥ä½œæµçš„äº‹ä»¶](https://docs.github.com/en/actions/using-workflows/events-that-trigger-workflows#release)â€ã€‚

åœ¨ä¸‹é¢çš„ç¤ºä¾‹å·¥ä½œæµç¨‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ Docker `login-action`ã€`metadata-action`å’Œ`build-push-action`æ“ä½œæ¥æ„å»º Docker é•œåƒï¼Œå¦‚æœæ„å»ºæˆåŠŸï¼Œåˆ™å°†æ„å»ºçš„é•œåƒæ¨é€åˆ° GitHub Packagesã€‚

`login-action`GitHub åŒ…æ‰€éœ€çš„é€‰é¡¹æœ‰ï¼š

- `registry`ï¼šå¿…é¡»è®¾ç½®ä¸º`ghcr.io`ã€‚
- `username`ï¼šæ‚¨å¯ä»¥ä½¿ç”¨`${{ github.actor }}`ä¸Šä¸‹æ–‡è‡ªåŠ¨ä½¿ç”¨è§¦å‘å·¥ä½œæµè¿è¡Œçš„ç”¨æˆ·çš„ç”¨æˆ·åã€‚æœ‰å…³è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…â€œ[ä¸Šä¸‹æ–‡](https://docs.github.com/en/actions/learn-github-actions/contexts#github-context)â€ã€‚
- `password`ï¼šæ‚¨å¯ä»¥ä½¿ç”¨è‡ªåŠ¨ç”Ÿæˆçš„`GITHUB_TOKEN`å¯†ç ä½œä¸ºå¯†ç ã€‚æœ‰å…³è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…â€œ[è‡ªåŠ¨ä»¤ç‰Œèº«ä»½éªŒè¯](https://docs.github.com/en/actions/security-guides/automatic-token-authentication)â€ã€‚

`metadata-action`GitHub Packages æ‰€éœ€çš„é€‰é¡¹æ˜¯ï¼š

- `images`ï¼šæ‚¨æ­£åœ¨æ„å»ºçš„ Docker æ˜ åƒçš„å‘½åç©ºé—´å’Œåç§°ã€‚

`build-push-action`GitHub åŒ…æ‰€éœ€çš„é€‰é¡¹æœ‰ï¼š

- `context`ï¼šå°†æ„å»ºçš„ä¸Šä¸‹æ–‡å®šä¹‰ä¸ºä½äºæŒ‡å®šè·¯å¾„ä¸­çš„æ–‡ä»¶é›†ã€‚
- `push`ï¼šå¦‚æœè®¾ç½®ä¸º`true`ï¼Œåˆ™é•œåƒæ„å»ºæˆåŠŸåå°†è¢«æ¨é€åˆ°æ³¨å†Œè¡¨ã€‚
- `tags`å’Œ`labels`ï¼šè¿™äº›ç”± çš„è¾“å‡ºå¡«å……`metadata-action`ã€‚

```yaml
# GitHub recommends pinning actions to a commit SHA.
# To get a newer version, you will need to update the SHA.
# You can also reference a tag or branch, but the action may change without warning.

name: Create and publish a Docker image

on:
  push:
    branches: ['release']

env:
  REGISTRY: ghcr.io
  IMAGE_NAME: ${{ github.repository }}

jobs:
  build-and-push-image:
    runs-on: ubuntu-latest
    permissions:
      contents: read
      packages: write

    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Log in to the Container registry
        uses: docker/login-action@65b78e6e13532edd9afa3aa52ac7964289d1a9c1
        with:
          registry: ${{ env.REGISTRY }}
          username: ${{ github.actor }}
          password: ${{ secrets.GITHUB_TOKEN }}

      - name: Extract metadata (tags, labels) for Docker
        id: meta
        uses: docker/metadata-action@9ec57ed1fcdbf14dcef7dfbe97b2010124a938b7
        with:
          images: ${{ env.REGISTRY }}/${{ env.IMAGE_NAME }}

      - name: Build and push Docker image
        uses: docker/build-push-action@f2a1d5e99d037542a71f64918e516c093c6f3fc4
        with:
          context: .
          push: true
          tags: ${{ steps.meta.outputs.tags }}
          labels: ${{ steps.meta.outputs.labels }}
```



### å°†é•œåƒå‘å¸ƒåˆ° Docker Hub å’Œ GitHub åŒ…

åœ¨å•ä¸ªå·¥ä½œæµç¨‹ä¸­ï¼Œæ‚¨å¯ä»¥é€šè¿‡å¯¹æ¯ä¸ªæ³¨å†Œè¡¨ä½¿ç”¨`login-action`å’Œæ“ä½œå°† Docker æ˜ åƒå‘å¸ƒåˆ°å¤šä¸ªæ³¨å†Œè¡¨ã€‚`build-push-action`

ä»¥ä¸‹ç¤ºä¾‹å·¥ä½œæµç¨‹ä½¿ç”¨å‰é¢éƒ¨åˆ†ï¼ˆâ€œ[å°†æ˜ åƒå‘å¸ƒåˆ° Docker Hub](https://docs.github.com/en/actions/publishing-packages/publishing-docker-images#publishing-images-to-docker-hub) â€å’Œâ€œ[å°†æ˜ åƒå‘å¸ƒåˆ° GitHub åŒ…](https://docs.github.com/en/actions/publishing-packages/publishing-docker-images#publishing-images-to-github-packages)â€ï¼‰ä¸­çš„æ­¥éª¤æ¥åˆ›å»ºæ¨é€åˆ°ä¸¤ä¸ªæ³¨å†Œè¡¨çš„å•ä¸ªå·¥ä½œæµç¨‹ã€‚

```yaml
# This workflow uses actions that are not certified by GitHub.
# They are provided by a third-party and are governed by
# separate terms of service, privacy policy, and support
# documentation.

# GitHub recommends pinning actions to a commit SHA.
# To get a newer version, you will need to update the SHA.
# You can also reference a tag or branch, but the action may change without warning.

name: Publish Docker image

on:
  release:
    types: [published]

jobs:
  push_to_registries:
    name: Push Docker image to multiple registries
    runs-on: ubuntu-latest
    permissions:
      packages: write
      contents: read
    steps:
      - name: Check out the repo
        uses: actions/checkout@v3
      
      - name: Log in to Docker Hub
        uses: docker/login-action@f4ef78c080cd8ba55a85445d5b36e214a81df20a
        with:
          username: ${{ secrets.DOCKER_USERNAME }}
          password: ${{ secrets.DOCKER_PASSWORD }}
      
      - name: Log in to the Container registry
        uses: docker/login-action@65b78e6e13532edd9afa3aa52ac7964289d1a9c1
        with:
          registry: ghcr.io
          username: ${{ github.actor }}
          password: ${{ secrets.GITHUB_TOKEN }}
      
      - name: Extract metadata (tags, labels) for Docker
        id: meta
        uses: docker/metadata-action@9ec57ed1fcdbf14dcef7dfbe97b2010124a938b7
        with:
          images: |
            my-docker-hub-namespace/my-docker-hub-repository
            ghcr.io/${{ github.repository }}
      
      - name: Build and push Docker images
        uses: docker/build-push-action@3b5e8027fcad23fda98b2e3ac259d8d67585f671
        with:
          context: .
          push: true
          tags: ${{ steps.meta.outputs.tags }}
          labels: ${{ steps.meta.outputs.labels }}
```



## é¡¹ç›®ç®¡ç†

æ‚¨å¯ä»¥ä½¿ç”¨ GitHub Actions é€šè¿‡åˆ›å»ºå·¥ä½œæµç¨‹æ¥è‡ªåŠ¨åŒ–é¡¹ç›®ç®¡ç†ä»»åŠ¡ã€‚æ¯ä¸ªå·¥ä½œæµåŒ…å«ä¸€ç³»åˆ—ä»»åŠ¡ï¼Œè¿™äº›ä»»åŠ¡åœ¨æ¯æ¬¡å·¥ä½œæµè¿è¡Œæ—¶è‡ªåŠ¨æ‰§è¡Œã€‚ä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥åˆ›å»ºä¸€ä¸ªå·¥ä½œæµç¨‹ï¼Œè¯¥å·¥ä½œæµç¨‹åœ¨æ¯æ¬¡åˆ›å»ºé—®é¢˜æ—¶è¿è¡Œï¼Œä»¥æ·»åŠ æ ‡ç­¾ã€ç•™ä¸‹è¯„è®ºå¹¶å°†é—®é¢˜ç§»è‡³é¡¹ç›®æ¿ä¸Šã€‚



### æ·»åŠ  labels

æœ¬æ•™ç¨‹æ¼”ç¤ºå¦‚ä½•ä½¿ç”¨å·¥ä½œæµä¸­çš„[`actions/github-script`æ“ä½œæ¥æ ‡è®°æ–°æ‰“å¼€æˆ–é‡æ–°æ‰“å¼€çš„é—®é¢˜ã€‚](https://github.com/marketplace/actions/github-script)ä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥`triage`åœ¨æ¯æ¬¡æ‰“å¼€æˆ–é‡æ–°æ‰“å¼€é—®é¢˜æ—¶æ·»åŠ æ ‡ç­¾ã€‚ç„¶åï¼Œæ‚¨å¯ä»¥é€šè¿‡ç­›é€‰å¸¦æœ‰æ ‡ç­¾çš„é—®é¢˜æ¥æŸ¥çœ‹éœ€è¦åˆ†ç±»çš„æ‰€æœ‰é—®é¢˜`triage`ã€‚

è¯¥`actions/github-script`æ“ä½œå…è®¸æ‚¨åœ¨å·¥ä½œæµç¨‹ä¸­è½»æ¾ä½¿ç”¨ GitHub APIã€‚

**åˆ›å»ºå·¥ä½œæµç¨‹ï¼š**

1. é€‰æ‹©è¦åº”ç”¨æ­¤é¡¹ç›®ç®¡ç†å·¥ä½œæµç¨‹çš„å­˜å‚¨åº“ã€‚æ‚¨å¯ä»¥ä½¿ç”¨å…·æœ‰å†™å…¥æƒé™çš„ç°æœ‰å­˜å‚¨åº“ï¼Œä¹Ÿå¯ä»¥åˆ›å»ºæ–°å­˜å‚¨åº“ã€‚æœ‰å…³åˆ›å»ºå­˜å‚¨åº“çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜…â€œ[åˆ›å»ºæ–°å­˜å‚¨åº“](https://docs.github.com/en/repositories/creating-and-managing-repositories/creating-a-new-repository)â€ã€‚
2. åœ¨æ‚¨çš„å­˜å‚¨åº“ä¸­ï¼Œåˆ›å»ºä¸€ä¸ªåä¸º çš„æ–‡ä»¶`.github/workflows/YOUR_WORKFLOW.yml`ï¼Œå¹¶æ›¿æ¢`YOUR_WORKFLOW`ä¸ºæ‚¨é€‰æ‹©çš„åç§°ã€‚è¿™æ˜¯ä¸€ä¸ªå·¥ä½œæµç¨‹æ–‡ä»¶ã€‚æœ‰å…³åœ¨ GitHub ä¸Šåˆ›å»ºæ–°æ–‡ä»¶çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜…â€œ[åˆ›å»ºæ–°æ–‡ä»¶](https://docs.github.com/en/repositories/working-with-files/managing-files/creating-new-files)â€ã€‚

```yaml
name: Label issues
on:
  issues:
    types:
      - reopened
      - opened
jobs:
  label_issues:
    runs-on: ubuntu-latest
    permissions:
      issues: write
    steps:
      - uses: actions/github-script@v6
        with:
          script: |
            github.rest.issues.addLabels({
              issue_number: context.issue.number,
              owner: context.repo.owner,
              repo: context.repo.repo,
              labels: ["triage"]
            })
```

3. è‡ªå®šä¹‰`script`å·¥ä½œæµç¨‹æ–‡ä»¶ä¸­çš„å‚æ•°ï¼š

- å€¼æ˜¯ä½¿ç”¨å¯¹è±¡è‡ªåŠ¨è®¾ç½®`issue_number`çš„ã€‚æ‚¨ä¸éœ€è¦æ›´æ”¹è¿™äº›ã€‚`owner``repo``context`
- å°†å€¼æ›´æ”¹ä¸º`labels`è¦æ·»åŠ åˆ°é—®é¢˜çš„æ ‡ç­¾åˆ—è¡¨ã€‚ç”¨é€—å·åˆ†éš”å¤šä¸ªæ ‡ç­¾ã€‚ä¾‹å¦‚ï¼Œ`["help wanted", "good first issue"]`. æœ‰å…³æ ‡ç­¾çš„è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…â€œ[ç®¡ç†æ ‡ç­¾](https://docs.github.com/en/issues/using-labels-and-milestones-to-track-work/managing-labels#applying-labels-to-issues-and-pull-requests)â€ã€‚

4. å°†å·¥ä½œæµç¨‹æ–‡ä»¶æäº¤åˆ°å­˜å‚¨åº“çš„é»˜è®¤åˆ†æ”¯ã€‚æœ‰å…³è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…â€œ[åˆ›å»ºæ–°æ–‡ä»¶](https://docs.github.com/en/repositories/working-with-files/managing-files/creating-new-files)â€ã€‚



### åœ¨é¡¹ç›®æ¿ä¸Šç§»åŠ¨åˆ†é…çš„é—®é¢˜

æœ¬æ•™ç¨‹æ¼”ç¤ºå¦‚ä½•ä½¿ç”¨è¯¥[`alex-page/github-project-automation-plus`æ“ä½œ](https://github.com/marketplace/actions/github-project-automation)åœ¨åˆ†é…é—®é¢˜æ—¶è‡ªåŠ¨å°†é—®é¢˜ç§»åŠ¨åˆ°é¡¹ç›®æ¿ä¸Šçš„ç‰¹å®šåˆ—ã€‚ä¾‹å¦‚ï¼Œåˆ†é…é—®é¢˜åï¼Œæ‚¨å¯ä»¥å°†å…¶ç§»è‡³`In Progress`é¡¹ç›®æ¿çš„åˆ—ä¸­ã€‚

### åˆ›å»ºå·¥ä½œæµç¨‹

1. é€‰æ‹©è¦åº”ç”¨æ­¤é¡¹ç›®ç®¡ç†å·¥ä½œæµç¨‹çš„å­˜å‚¨åº“ã€‚æ‚¨å¯ä»¥ä½¿ç”¨å…·æœ‰å†™å…¥æƒé™çš„ç°æœ‰å­˜å‚¨åº“ï¼Œä¹Ÿå¯ä»¥åˆ›å»ºæ–°å­˜å‚¨åº“ã€‚æœ‰å…³åˆ›å»ºå­˜å‚¨åº“çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜…â€œ[åˆ›å»ºæ–°å­˜å‚¨åº“](https://docs.github.com/en/repositories/creating-and-managing-repositories/creating-a-new-repository)â€ã€‚
2. åœ¨æ‚¨çš„å­˜å‚¨åº“ä¸­ï¼Œé€‰æ‹©ä¸€ä¸ªé¡¹ç›®æ¿ã€‚æ‚¨å¯ä»¥ä½¿ç”¨ç°æœ‰é¡¹ç›®ï¼Œä¹Ÿå¯ä»¥åˆ›å»ºæ–°é¡¹ç›®ã€‚æœ‰å…³åˆ›å»ºé¡¹ç›®çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜…â€œ[åˆ›å»ºé¡¹ç›®ï¼ˆç»å…¸ï¼‰](https://docs.github.com/en/issues/organizing-your-work-with-project-boards/managing-project-boards/creating-a-project-board) â€ã€‚
3. åœ¨æ‚¨çš„å­˜å‚¨åº“ä¸­ï¼Œåˆ›å»ºä¸€ä¸ªåä¸º çš„æ–‡ä»¶`.github/workflows/YOUR_WORKFLOW.yml`ï¼Œå¹¶æ›¿æ¢`YOUR_WORKFLOW`ä¸ºæ‚¨é€‰æ‹©çš„åç§°ã€‚è¿™æ˜¯ä¸€ä¸ªå·¥ä½œæµç¨‹æ–‡ä»¶ã€‚æœ‰å…³åœ¨ GitHub ä¸Šåˆ›å»ºæ–°æ–‡ä»¶çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜…â€œ[åˆ›å»ºæ–°æ–‡ä»¶](https://docs.github.com/en/repositories/working-with-files/managing-files/creating-new-files)â€ã€‚
4. å°†ä»¥ä¸‹ YAML å†…å®¹å¤åˆ¶åˆ°æ‚¨çš„å·¥ä½œæµç¨‹æ–‡ä»¶ä¸­ã€‚

```yaml
# GitHub recommends pinning actions to a commit SHA.
# To get a newer version, you will need to update the SHA.
# You can also reference a tag or branch, but the action may change without warning.

name: Move assigned card
on:
  issues:
    types:
      - assigned
jobs:
  move-assigned-card:
    runs-on: ubuntu-latest
    steps:
      - uses: alex-page/github-project-automation-plus@7ffb872c64bd809d23563a130a0a97d01dfa8f43
        with:
          project: Docs Work
          column: In Progress
          repo-token: ${{ secrets.PERSONAL_ACCESS_TOKEN }}
```

1. è‡ªå®šä¹‰å·¥ä½œæµç¨‹æ–‡ä»¶ä¸­çš„å‚æ•°ï¼š
   - å°† çš„å€¼æ›´æ”¹`project`ä¸ºæ‚¨çš„é¡¹ç›®æ¿çš„åç§°ã€‚å¦‚æœæ‚¨æœ‰å¤šä¸ªåŒåçš„é¡¹ç›®æ¿ï¼Œåˆ™è¯¥`alex-page/github-project-automation-plus`æ“ä½œå°†ä½œç”¨äºå…·æœ‰æŒ‡å®šåç§°çš„æ‰€æœ‰é¡¹ç›®ã€‚
   - å°† çš„å€¼æ›´æ”¹ä¸º`column`æ‚¨å¸Œæœ›åœ¨åˆ†é…é—®é¢˜æ—¶å°†å…¶ç§»è‡³çš„åˆ—çš„åç§°ã€‚
   - æ›´æ”¹ çš„å€¼ `repo-token`: 
     1. ä½¿ç”¨èŒƒå›´åˆ›å»ºä¸ªäººè®¿é—®ä»¤ç‰Œï¼ˆç»å…¸ï¼‰`repo`ã€‚æœ‰å…³è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…â€œ[ç®¡ç†æ‚¨çš„ä¸ªäººè®¿é—®ä»¤ç‰Œ](https://docs.github.com/en/authentication/keeping-your-account-and-data-secure/creating-a-personal-access-token)â€ã€‚
     2. å°†æ­¤ä¸ªäººè®¿é—®ä»¤ç‰Œä½œä¸ºç§˜å¯†å­˜å‚¨åœ¨æ‚¨çš„å­˜å‚¨åº“ä¸­ã€‚æœ‰å…³å­˜å‚¨æœºå¯†çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜…â€œ[åŠ å¯†çš„æœºå¯†](https://docs.github.com/en/actions/security-guides/encrypted-secrets)â€ã€‚
     3. åœ¨æ‚¨çš„å·¥ä½œæµç¨‹æ–‡ä»¶ä¸­ï¼Œæ›¿æ¢`PERSONAL_ACCESS_TOKEN`ä¸ºæ‚¨çš„å¯†é’¥åç§°ã€‚



## END é“¾æ¥
<ul><li><div><a href = '82.md' style='float:left'>â¬†ï¸ä¸Šä¸€èŠ‚ğŸ”—  </a><a href = '84.md' style='float: right'>  ï¸ä¸‹ä¸€èŠ‚ğŸ”—</a></div></li></ul>

+ [â“‚ï¸å›åˆ°ç›®å½•ğŸ ](../README.md)

+ [**ğŸ«µå‚ä¸è´¡çŒ®ğŸ’â¤ï¸â€ğŸ”¥ğŸ’–**](https://nsddd.top/archives/contributors))

+ âœ´ï¸ç‰ˆæƒå£°æ˜ &copy; ï¼šæœ¬ä¹¦æ‰€æœ‰å†…å®¹éµå¾ª[CC-BY-SA 3.0åè®®ï¼ˆç½²å-ç›¸åŒæ–¹å¼å…±äº«ï¼‰&copy;](http://zh.wikipedia.org/wiki/Wikipedia:CC-by-sa-3.0åè®®æ–‡æœ¬) 
