+ [author](http://nsddd.top)

# ç¬¬9èŠ‚ sealer runtime Stage 2 (including biweekly meetings)

<div><a href = '8.md' style='float:left'>â¬†ï¸ä¸Šä¸€èŠ‚ğŸ”—  </a><a href = '10.md' style='float: right'>  â¬‡ï¸ä¸‹ä¸€èŠ‚ğŸ”—</a></div>
<br>

> â¤ï¸ğŸ’•ğŸ’•è®°å½•[sealos](https://github.com/cubxxw/sealos)å¼€æºé¡¹ç›®çš„å­¦ä¹ è¿‡ç¨‹ã€‚[k8s,dockerå’Œäº‘åŸç”Ÿçš„å­¦ä¹ ](https://github.com/cubxxw/sealos)ã€‚Myblog:[http://nsddd.top](http://nsddd.top/)

---
[TOC]

## code module

::: tip ISSUES 1859
[feature\] want to implement the k3s runtime module](https://github.com/sealerio/sealer/issues/1859#top)#1859

[3293172751](https://github.com/cubxxw) opened this issue å‰å¤© Â· 4 comments

What a good start [@3293172751](https://github.com/cubxxw)! Now i have some suggestions maybe make you more understand about sealer runtime.

the Achieve Interface step is definitely correct. but it would be some misunderstand about k3s's cluterimage rootfs in your chapter  ***k3s - rootfs*** , i think we do not need to care too much about k3s install package distribution in this stage. I propose a step which is my learning path of sealer,FYI [@3293172751](https://github.com/cubxxw) .

+ k8s runtiem interface é€»è¾‘æ˜¯ä»€ä¹ˆ?
+ sealer å¦‚ä½•ä»¥åŠä½•æ—¶å®‰è£…ç§äººæ³¨å†Œè¡¨?
+ runtime module å¦‚ä½•ä¸ rootfs ä¸­çš„è„šæœ¬äº¤äº’?

:::



## k3s module

::: tip ISSUE
And you mentioned about the k3s installation [online\offline]. I have little confusions.
If sqlite couldn't support cluster HA installation? How to specify the database?
Another question is about install step. AFAIK, k3s support join node by `k3s agent` `k3s server`, so whether you tried this method?
Last, k3s support custom private registry, how to config this? and whether k3s could support external CRI? [@3293172751](https://github.com/cubxxw)

æœ€åï¼Œk3sæ”¯æŒè‡ªå®šä¹‰ç§æœ‰æ³¨å†Œè¡¨ï¼Œå¦‚ä½•é…ç½®?k3æ˜¯å¦å¯ä»¥æ”¯æŒå¤–éƒ¨CRI?

 ğŸ‰about [online\offline]   

ğŸ‰ about HA install and  single node

:::



âš ï¸ k3s [discussions 6478](https://github.com/k3s-io/k3s/discussions/6478) ä¸€äº›ç­”ç–‘å’Œè®¨è®º~



## k8s runtiem interface é€»è¾‘æ˜¯ä»€ä¹ˆ?



## å…³äºè®¾è®¡ç»Ÿä¸€çš„interface

**å¸Œæœ›åœ¨æ¥å£ `interface`å±‚å®ç°å„ä¸ªæ¨¡å—çš„åŠŸèƒ½ï¼Œç»Ÿä¸€æš´éœ²å‡ºå»ï¼š**

```
seal run k3s~
seal run k0s~
seal run kuberntes~
```



### ä½œè€…

å¦ä¸€ä¸ªé—®é¢˜æ˜¯å…³äºå®‰è£…æ­¥éª¤ã€‚AFAIKï¼Œk3s æ”¯æŒé€šè¿‡ k3s ä»£ç† k3s æœåŠ¡å™¨åŠ å…¥èŠ‚ç‚¹å—ï¼Ÿ æœ€åï¼Œk3sæ”¯æŒ`è‡ªå®šä¹‰ç§æœ‰registry`ï¼Œè¿™ä¸ªæ€ä¹ˆé…ç½®ï¼Ÿk3sèƒ½ä¸èƒ½æ”¯æŒå¤–éƒ¨CRIï¼Ÿ

>  k3sæ”¯æŒé€šè¿‡ `k3s agent k3s server` åŠ å…¥èŠ‚ç‚¹å—ï¼Ÿæ˜¯çš„ï¼Œ`k3s agent`èŠ‚ç‚¹å¯ä»¥åŠ å…¥å¦ä¸€ä¸ªæ­£åœ¨è¿è¡Œçš„èŠ‚ç‚¹çš„é›†ç¾¤`k3s server`ã€‚è¿™å°±æ˜¯ä½ æƒ³é—®çš„å—ï¼Ÿk3s æ”¯æŒè‡ªå®šä¹‰ç§æœ‰æ³¨å†Œä¸­å¿ƒï¼Œ
>
> å¦‚ä½•é…ç½®ï¼Ÿæ‚¨æœ‰æœºä¼šæŸ¥çœ‹æ–‡æ¡£å—ï¼Ÿhttps://docs.k3s.io/installation/private-registryk3s 
>
> å¯ä»¥æ”¯æŒå¤–éƒ¨ CRI å—ï¼Ÿæ˜¯çš„ï¼Œä½¿ç”¨ `--docker` æˆ– `--container-runtime-endpoint`ã€‚ä¸Šé¢æåˆ°çš„ `registries.yaml` æ”¯æŒä»…é€‚ç”¨äºåµŒå…¥å¼ `containerd`ï¼›å¦‚æœæ‚¨è‡ªå¸¦ `CRI`ï¼Œåˆ™ç”±æ‚¨è‡ªè¡Œæ­£ç¡®é…ç½®ã€‚



### æ³¨å†Œè¡¨

```go
// GenerateCert generate the containerd CA for registry TLS and k0s join token for 100 years.
func (k *Runtime) GenerateCert() error {
	if err := k.generateK0sToken(); err != nil {
		return err
	}
	if err := k.GenerateRegistryCert(); err != nil {
		return err
	}
	return k.SendRegistryCert(k.cluster.GetMasterIPList()[:1])
}
```





### rootfsäº¤äº’

**runtime:**

```go
func (k *Runtime) initRegistryCmd() string {
	return fmt.Sprintf("cd %s/scripts && ./init-registry.sh %s %s %s", k.getRootfs(), k.RegConfig.Port, fmt.Sprintf("%s/registry", k.getRootfs()), k.RegConfig.Domain)
}

// getRootfs return the rootfs dir like: /var/lib/sealer/data/my-k0s-cluster/rootfs
func (k *Runtime) getRootfs() string {
	return common.DefaultTheClusterRootfsDir(k.cluster.Name)
}

//common
func DefaultTheClusterRootfsDir(clusterName string) string {
	return filepath.Join(DefaultSealerDataDir, clusterName, "rootfs")
}

DefaultSealerDataDir          = "/var/lib/sealer/data"
```



## END é“¾æ¥

<ul><li><div><a href = '8.md' style='float:left'>â¬†ï¸ä¸Šä¸€èŠ‚ğŸ”—  </a><a href = '10.md' style='float: right'>  ï¸ä¸‹ä¸€èŠ‚ğŸ”—</a></div></li></ul>

+ [â“‚ï¸å›åˆ°ç›®å½•ğŸ ](../README.md)

+ [**ğŸ«µå‚ä¸è´¡çŒ®ğŸ’â¤ï¸â€ğŸ”¥ğŸ’–**](https://nsddd.top/archives/contributors))

+ âœ´ï¸ç‰ˆæƒå£°æ˜ &copy; ï¼šæœ¬ä¹¦æ‰€æœ‰å†…å®¹éµå¾ª[CC-BY-SA 3.0åè®®ï¼ˆç½²å-ç›¸åŒæ–¹å¼å…±äº«ï¼‰&copy;](http://zh.wikipedia.org/wiki/Wikipedia:CC-by-sa-3.0åè®®æ–‡æœ¬) 
