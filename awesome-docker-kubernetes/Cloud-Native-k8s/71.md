+ [author](http://nsddd.top)

# ç¬¬71èŠ‚ ProwåŠå…¶ç”Ÿæ€ç³»ç»Ÿ

<div><a href = '70.md' style='float:left'>â¬†ï¸ä¸Šä¸€èŠ‚ğŸ”—  </a><a href = '72.md' style='float: right'>  â¬‡ï¸ä¸‹ä¸€èŠ‚ğŸ”—</a></div>
<br>

> â¤ï¸ğŸ’•ğŸ’•æ–°æ—¶ä»£æ‹¥æŠ±äº‘åŸç”Ÿï¼Œäº‘åŸç”Ÿå…·æœ‰ç¯å¢ƒç»Ÿä¸€ã€æŒ‰éœ€ä»˜è´¹ã€å³å¼€å³ç”¨ã€ç¨³å®šæ€§å¼ºç‰¹ç‚¹ã€‚Myblog:[http://nsddd.top](http://nsddd.top/)

---
[TOC]

## why?

**æ•…äº‹æ˜¯ä»è¿™ä¸ª proposal å¼€å§‹idea~**

ğŸ¤– [OpenIM cicd robot machine proposal](https://github.com/OpenIMSDK/Open-IM-Server/issues/398)

Prowæ˜¯åŸºäºKubernetesçš„CI/CDç³»ç»Ÿã€‚ä½œä¸šå¯ä»¥ç”±å„ç§ç±»å‹çš„äº‹ä»¶è§¦å‘ï¼Œå¹¶å°†å…¶çŠ¶æ€æŠ¥å‘Šç»™è®¸å¤šä¸åŒçš„æœåŠ¡ã€‚é™¤äº†ä½œä¸šæ‰§è¡Œï¼ŒProwè¿˜ä»¥ç­–ç•¥æ‰§è¡Œã€é€šè¿‡ `/foo` é£æ ¼å‘½ä»¤çš„èŠå¤©æ“ä½œå’Œè‡ªåŠ¨PRåˆå¹¶çš„å½¢å¼æä¾›GitHubè‡ªåŠ¨åŒ–ã€‚

æœ‰å…³ Golang æ–‡æ¡£ï¼Œè¯·å‚é˜… [GoDoc](https://pkg.go.dev/k8s.io/test-infra/prow)ã€‚è¯·æ³¨æ„ï¼Œè¿™äº›åº“ä»…ä¾›prowä½¿ç”¨ï¼Œæˆ‘ä»¬ä¸ä¼šå°è¯•ä¿ç•™å‘åå…¼å®¹æ€§ã€‚

**Kubernetes ä¸“é—¨ä¸º Prow æä¾›äº†ç½‘é¡µå‘½ä»¤æŸ¥è¯¢ï¼š**

+ [https://prow.k8s.io/command-help](https://prow.k8s.io/command-help)

å…³äºProwå¦‚ä½•è¿è¡Œä½œä¸šçš„ç®€è¦æ¦‚è¿°ï¼Œè¯·å‚é˜… [Prowä½œä¸šçš„ç”Ÿå‘½å‘¨æœŸ](https://docs.prow.k8s.io/docs/life-of-a-prow-job/)ã€‚

è¦æŸ¥çœ‹Prowçš„å¸¸ç”¨ç”¨æ³•å’Œäº¤äº’æµï¼Œè¯·å‚è§æ‹‰å–è¯·æ±‚äº¤äº’åºåˆ—å›¾ã€‚



### hello world

æœ€ç®€å•çš„ä¸€ä¸ªä¸Šæ‰‹æ¡ˆä¾‹è«è¿‡äº [pull request](https://help.github.com/articles/about-pull-requests/) ã€‚

æå‡ºä¸€ä¸ªæ‹‰å–è¯·æ±‚ï¼ˆä»¥ä¸‹ç®€ç§°PRï¼‰ã€‚åœ¨PRæ­£æ–‡ä¸­ï¼Œå¯ä»¥éšæ„æ·»åŠ åŒºåŸŸæ ‡ç­¾ï¼ˆå¦‚æœåˆé€‚ï¼‰ï¼Œä¾‹å¦‚ `/area <AREA>` ã€‚æ ‡ç­¾åˆ—è¡¨[åœ¨è¿™é‡Œ](https://github.com/kubernetes/test-infra/labels)ã€‚ä¹Ÿå¯ä»¥éšæ„æ¨èä¸€ä½è¯„è®ºè€… `/assign @theirname` ã€‚

ä¸€æ—¦æ‚¨çš„å®¡é˜…è€…æ»¡æ„ï¼Œä»–ä»¬ä¼šè¯´ `/lgtm` ï¼Œè¿™å°†åº”ç”¨ `lgtm` æ ‡ç­¾ï¼Œå¦‚æœä»–ä»¬æ˜¯OWNERï¼Œå°†åº”ç”¨ `approved` æ ‡ç­¾ã€‚ `approved` æ ‡ç­¾ä¹Ÿå°†è‡ªåŠ¨åº”ç”¨äºæ‰€æœ‰è€…æ‰“å¼€çš„PRã€‚å¦‚æœæ‚¨å’Œæ‚¨çš„å®¡é˜…è€…éƒ½ä¸æ˜¯OWNERï¼Œè¯· `/assign` æŸä¸ªæ‰€æœ‰è€…ã€‚å¦‚æœæ‚¨çš„PRæœ‰ `lgtm` å’Œ `approved` æ ‡ç­¾ï¼Œæ²¡æœ‰ä»»ä½• `do-not-merge/*` æ ‡ç­¾ï¼Œå¹¶ä¸”æ‰€æœ‰æµ‹è¯•å‡é€šè¿‡ï¼Œåˆ™PRå°†è‡ªåŠ¨åˆå¹¶ã€‚



### æŸ¥çœ‹æµ‹è¯•ç»“æœ

+ Kubernetes TestGrid æ˜¾ç¤ºå†å²æµ‹è¯•ç»“æœ
  + åœ¨ [testgrid/config.yaml](https://github.com/k8s-ci-robot/test-infra/blob/master/testgrid/config.yaml) é…ç½®è‡ªå·±çš„ testgrid ä»ªè¡¨ç›˜
  + [Gubernator](https://gubernator.k8s.io/) æ ¼å¼åŒ–æ¯æ¬¡è¿è¡Œçš„è¾“å‡º
+ [PR Dashboard](https://gubernator.k8s.io/pr) æŸ¥æ‰¾éœ€è¦æ³¨æ„çš„ PR
+ Prow å®‰æ’æµ‹è¯•å¹¶æ›´æ–°é—®é¢˜
  + Prow å“åº” GitHub äº‹ä»¶ã€å®šæ—¶å™¨å’Œåœ¨ GitHub è¯„è®ºä¸­ç»™å‡ºçš„[æ‰‹åŠ¨å‘½ä»¤](https://go.k8s.io/bot-commands)ã€‚
  + [prow dashboard](https://prow.k8s.io/) æ˜¾ç¤ºå½“å‰æ­£åœ¨æµ‹è¯•ä»€ä¹ˆ
  + åœ¨ [config/jobs](https://github.com/k8s-ci-robot/test-infra/blob/master/config/jobs) é…ç½® prow è¿è¡Œæ–°æµ‹è¯•
+ Triage Dashboard æ±‡æ€»æ•…éšœ
  + å°†æ•…éšœé›†ç¾¤åœ¨ä¸€èµ·
  + æœç´¢è·¨ä½œä¸šçš„æµ‹è¯•å¤±è´¥
  + åœ¨ç‰¹å®šçš„æµ‹è¯•å’Œ/æˆ–ä½œä¸šçš„ regex ä¸­è¿‡æ»¤å¤±è´¥
+ Velodrome æŒ‡æ ‡è·Ÿè¸ªä½œä¸šå’Œæµ‹è¯•å¥åº·çŠ¶å†µã€‚
  + [Kettle](https://github.com/k8s-ci-robot/test-infra/blob/master/kettle) è¿›è¡Œæ”¶é›†ï¼Œ[metrics](https://github.com/k8s-ci-robot/test-infra/blob/master/metrics) è¿›è¡ŒæŠ¥å‘Šï¼Œ[velodrome](https://github.com/k8s-ci-robot/test-infra/blob/master/velodrome) æ˜¯å‰ç«¯ã€‚



## åŠŸèƒ½å’Œç‰¹æ€§

**prow çš„åŠŸèƒ½å¾ˆå¼ºå¤§ï¼Œç”šè‡³æ˜¯æ¯” actions æ›´åŠ å‡ºä¼—ã€‚å¯ä»¥æµ‹è¯•ã€æ‰¹å¤„ç†ã€å·¥ä»¶å‘å¸ƒçš„ä½œä¸šæ‰§è¡Œã€‚**

+ GitHubäº‹ä»¶ç”¨äºè§¦å‘post-PR-mergeï¼ˆpostsubmitï¼‰ä½œä¸šå’Œon-PR-updateï¼ˆpresubmitï¼‰ä½œä¸šã€‚
+ æ”¯æŒå¤šä¸ªæ‰§è¡Œå¹³å°å’Œæºä»£ç å®¡æŸ¥ç«™ç‚¹ã€‚

**å¯æ’æ‹”çš„GitHub botè‡ªåŠ¨åŒ–ï¼Œå®ç° `/foo` é£æ ¼çš„å‘½ä»¤å¹¶å¼ºåˆ¶æ‰§è¡Œé…ç½®çš„ç­–ç•¥/æµç¨‹ã€‚**

::: details ä»€ä¹ˆæ˜¯ foo é£æ ¼ 
`/foo` é£æ ¼é€šå¸¸æŒ‡çš„æ˜¯åœ¨èŠå¤©åº”ç”¨ç¨‹åºï¼ˆå¦‚Slackï¼‰ä¸­ä½¿ç”¨çš„å‘½ä»¤æ ¼å¼ã€‚è¿™ç§æ ¼å¼çš„å‘½ä»¤ä»¥æ–œæ  `/` å¼€å¤´ï¼Œåè·Ÿä¸€ä¸ªå…³é”®å­—æˆ–çŸ­è¯­ï¼Œä¾‹å¦‚ `/help` æˆ– `/status`ã€‚GitHub botè‡ªåŠ¨åŒ–å¯ä»¥ä½¿ç”¨æ­¤æ ¼å¼æ¥å®ç°ç‰¹å®šåŠŸèƒ½ï¼Œä¾‹å¦‚åœ¨GitHubä¸Šè‡ªåŠ¨åˆ›å»ºé—®é¢˜æˆ–æ‹‰å–è¯·æ±‚ï¼Œå¹¶å¼ºåˆ¶æ‰§è¡Œç‰¹å®šçš„å·¥ä½œæµç¨‹æˆ–ç­–ç•¥ã€‚

:::



**å…¶ä»–çš„åŠŸèƒ½ï¼š**

+ GitHubå°†è‡ªåŠ¨åŒ–ä¸æ‰¹é‡æµ‹è¯•é€»è¾‘åˆå¹¶ã€‚
+ ç”¨äºæŸ¥çœ‹ä½œä¸šã€åˆå¹¶é˜Ÿåˆ—çŠ¶æ€ã€åŠ¨æ€ç”Ÿæˆçš„å¸®åŠ©ä¿¡æ¯ç­‰çš„å‰ç«¯ã€‚
+ åŸºäºé…ç½®çš„æºä»£ç ç®¡ç†çš„è‡ªåŠ¨éƒ¨ç½²ã€‚
+ åœ¨æºä»£ç æ§åˆ¶ä¸­é…ç½®çš„è‡ªåŠ¨ `GitHub org/repo` ç®¡ç†ã€‚
+ ä¸“ä¸ºå…·æœ‰æ•°åä¸ªå­˜å‚¨åº“çš„å¤šç»„ç»‡è§„æ¨¡è€Œè®¾è®¡ã€‚(The Kubernetes Prowå®ä¾‹ä»…ä½¿ç”¨1ä¸ªGitHub botä»¤ç‰Œï¼ï¼‰
+ é«˜å¯ç”¨æ€§æ˜¯åœ¨Kubernetesä¸Šè¿è¡Œçš„å¥½å¤„ã€‚ï¼ˆå¤åˆ¶ã€è´Ÿè½½å¹³è¡¡ã€æ»šåŠ¨æ›´æ–°...ï¼‰
+ JSONç»“æ„åŒ–æ—¥å¿—ã€‚
+ æ”¯æŒ æ™®ç½—ç±³ä¿®æ–¯æŒ‡æ ‡ã€‚



## Documentation

ä»»ä½•ä¸€ä¸ªå¤§å‹çš„å·¥ç¨‹ç¬¬ä¸€ä¸ªè€ƒè™‘çš„åº”è¯¥æ˜¯ç¨³å®šæ€§ï¼Œprowçš„ç¨³å®šæ€§å¾ˆå¤§ç¨‹åº¦ä¸Šä¾èµ–äºå•å…ƒæµ‹è¯•å’Œé›†æˆæµ‹è¯•ã€‚

+ å•å…ƒæµ‹è¯•ä¸prowæºä»£ç ä½äºåŒä¸€ä½ç½®
+ [Integration tests](https://docs.prow.k8s.io/docs/test/integration/) utilizes [kind](https://kind.sigs.k8s.io/) with hermetic integration tests. See [instructions for adding new integration tests](https://docs.prow.k8s.io/docs/test/integration/#adding-new-integration-tests) for more details



**Getting startedï¼šæˆ‘ä»¬åˆ†ä¸ºä¸‰ä¸ªå¤§çš„æ¿å—**

+ ä½¿ç”¨è‡ªå·±çš„ Prow éƒ¨ç½²
+ ä¸º Prow å¼€å‘
+ As a job author: [ProwJobs](https://docs.prow.k8s.io/docs/jobs/)



## ä½¿ç”¨è‡ªå·±çš„Prowéƒ¨ç½²

è¿™é‡Œæˆ‘ä»¬åº”è¯¥å­¦ä¼šçš„æ˜¯å¦‚ä½•å°†ä½ è‡ªå·±çš„ Prow å®ä¾‹éƒ¨ç½²åˆ° Kubernetes çš„é›†ç¾¤ã€‚

Prowå¯ä»¥åœ¨ä»»ä½•`Kubernetes`é›†ç¾¤ä¸­è¿è¡Œã€‚ä¸‹é¢çš„æŒ‡å—ä¸“æ³¨äºGoogle Kubernetes Engineï¼Œä½†åº”è¯¥é€‚ç”¨äºä»»ä½•Kuberneteså‘è¡Œç‰ˆï¼Œ**æ— éœ€/åªéœ€** å¾ˆå°‘çš„æ›´æ”¹ã€‚

Prow æ˜¯ä½¿ç”¨ webhook åšçš„ï¼Œwebhook ç›¸å¯¹æ¥è¯´æ¯”è¾ƒå¤æ‚ä¸€äº›ã€‚

å°±æ˜¯å½“ä½ åˆ›å»º robot çš„æ—¶å€™ï¼Œå…ˆåˆ›å»º webhookï¼Œç„¶åå†™å…¥ webhook é“¾æ¥ã€‚

k8sæœ‰è‡ªå·±çš„æœåŠ¡ï¼Œprew éœ€è¦å•ç‹¬æ­å»ºå‡ºæ¥ã€‚

> webhookçš„åœ°å€æ˜¯ä½ å†™çš„æœåŠ¡çš„å…¬ç½‘åœ°å€ã€‚ç›¸å½“äºgithubè¦è°ƒç”¨webhook

å…¶å®ä½ å†™ä¸ªwebhookç„¶åæŠŠwebhookæ­å»ºåˆ°cloudä¸Šï¼Œå°±ä¸²èµ·æ¥äº†ã€‚ç„¶åä½ è‡ªåŠ¨å‘å¸ƒå°±ç›´æ¥æ”¹é•œåƒå®Œäº‹ã€‚ä¸»è¦å°±æ˜¯æŠŠwebhookå†™ä¸€ä¸‹ï¼Œè§£ææŒ‡ä»¤å°±è¡Œäº†ã€‚

å¦‚æœä½ æ²¡æœ‰è‡ªå·±çš„æœåŠ¡å™¨ï¼Œä¹Ÿå¯ä»¥å€ŸåŠ© actions è‡ªå·±è·‘ï¼Œå‚è€ƒï¼š[https://github.com/labring/sealos/blob/main/.github/workflows/bot.yml](https://github.com/labring/sealos/blob/main/.github/workflows/bot.yml)



### GitHub APP

é¦–å…ˆï¼Œæ‚¨éœ€è¦ [åˆ›å»ºä¸€ä¸ªGitHubåº”ç”¨ç¨‹åº](https://docs.github.com/en/apps/creating-github-apps/setting-up-a-github-app/creating-a-github-app)ã€‚GitHubæœ¬èº«ä¹Ÿè®°å½•äº†è¿™ä¸€ç‚¹ã€‚ æœ€åˆï¼Œä¸ºWebhookè®¾ç½®ä¸€ä¸ªè™šæ‹ŸURLå°±è¶³å¤Ÿäº†ã€‚æ‰€éœ€çš„ç¡®åˆ‡æƒé™é›†å› æ‚¨ä½¿ç”¨çš„åŠŸèƒ½è€Œå¼‚ã€‚ä¸‹é¢æ˜¯æ‰€éœ€çš„æœ€ä½æƒé™é›†ã€‚

> âš ï¸ ä¸€ä¸ªç”¨æˆ·æˆ–è€…ç»„ç»‡æœ€å¤šåªèƒ½æœ‰ 100 ä¸ª robot

**å­˜å‚¨åº“æƒé™**ï¼š

+ Actionsï¼šåªè¯»ï¼ˆä»…åœ¨ä½¿ç”¨åˆå¹¶è‡ªåŠ¨åŒ– `tide` æ—¶éœ€è¦ï¼‰
+ Administrationï¼šåªè¯»ï¼ˆè·å–å›¢é˜Ÿå’Œåä½œè€…æ—¶å¿…éœ€ï¼‰
+ Checksï¼šåªè¯»ï¼ˆä»…åœ¨ä½¿ç”¨åˆå¹¶è‡ªåŠ¨åŒ– `tide` æ—¶éœ€è¦ï¼‰
+ Contentsï¼šè¯»å–ï¼ˆä½¿ç”¨åˆå¹¶è‡ªåŠ¨åŒ–æ—¶éœ€è¦è¯»å–å’Œå†™å…¥ `tide` ï¼‰
+ Issues: Read & write 
+ Metadata: Read-Only
+ Pull Requests: Read & write
+ projectsï¼šä½¿ç”¨ `projects` æ’ä»¶æ—¶ä¸ºAdminï¼Œå¦åˆ™ä¸ºnone
+ Commit statuses: Read & write



**ç»„ç»‡æƒé™ï¼š**

+ Membersï¼šåªè¯»ï¼ˆä½¿ç”¨ `peribolos` æ—¶è¯»å†™ï¼‰
+ projectsï¼šä½¿ç”¨ `projects` æ’ä»¶æ—¶ä¸ºAdminï¼Œå¦åˆ™ä¸ºnone



åœ¨ `Subscribe to events` ä¸­é€‰æ‹©æ‰€æœ‰äº‹ä»¶ã€‚

ä¿å­˜åº”ç”¨ç¨‹åºåï¼Œå•å‡»åº•éƒ¨çš„â€œç”Ÿæˆç§é’¥â€ï¼Œå¹¶å°†ç§é’¥ä¸é¡µé¢é¡¶éƒ¨çš„ `App ID` ä¸€èµ·ä¿å­˜ã€‚

sealos ä¹Ÿé›†æˆäº†è‡ªå·±çš„ robotï¼Œå¯ä»¥ä½œä¸ºå‘è¡Œç‰ˆæˆ–è€…æ˜¯è§£å†³å¹³å¸¸çš„ PR

+ **[sealos-release-rebot](https://github.com/sealos-release-rebot)**
+ **[k8s-release-robot](https://github.com/k8s-release-robot)**

å…³äº `sealos` çš„ bot ä»“åº“åœ°å€ï¼Œè—åœ¨äº†[è¿™é‡Œ](https://github.com/labring/gh-rebot) 



## å¦‚ä½•åšä¸€ä¸ª github-bot

GitHubæœºå™¨äººæ˜¯ä¸€ç§è‡ªåŠ¨åŒ–å·¥å…·ï¼Œå®ƒå¯ä»¥åœ¨æœåŠ¡ç«¯ä¸Šå¯åŠ¨ä¸€ä¸ªåŸºäº [Koa.js](https://github.com/koajs/koa/) çš„HTTPæœåŠ¡å™¨ï¼Œå¹¶å»ºç«‹ä¸€äº›é¡¹ç›®è§„èŒƒï¼Œä¾‹å¦‚è§„å®šissueæ ¼å¼ã€pull requestæ ¼å¼ã€é…ç½®æŒ‡å®šæ ‡ç­¾çš„æ‰€æœ‰è€…ã€ç»Ÿä¸€git commit logæ ¼å¼ç­‰ã€‚é€šè¿‡ä½¿ç”¨ [GitHub Webhooks](https://github.com/labring/sealos/blob/main/.github/workflows/bot.yml) å’Œ [GitHub API](https://docs.github.com/en/rest)ï¼Œæœºå™¨äººå¯ä»¥è‡ªåŠ¨å¤„ç†ä¸€äº›äº‹æƒ…ï¼Œä¾‹å¦‚è‡ªåŠ¨å›å¤issueã€è‡ªåŠ¨åˆå¹¶pull requestç­‰ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œæœºå™¨äººæ˜¯ä¸€ä¸ªå•ç‹¬çš„è´¦å·ï¼Œä¾‹å¦‚ [@kubbot](https://github.com/kubbot)ã€‚ä½¿ç”¨GitHubæœºå™¨äººå¯ä»¥å®ç°å¿«é€Ÿå“åº”ã€è‡ªåŠ¨åŒ–å’Œè§£æ”¾äººåŠ›çš„æ•ˆæœï¼Œä»è€Œæé«˜é¡¹ç›®çš„æ•ˆç‡å’Œè´¨é‡ã€‚



### actions å…³é—­å’Œæ“ä½œ issue 

å…¶å® robot æœ€åŸºæœ¬çš„æƒé™å°±æ˜¯å¯¹ issue å’Œ PR çš„æƒé™ã€‚

```bash
name: Invite users to join our group
on:
  issue_comment:
    types:
      - created
jobs:
  issue_comment:
    name: Invite users to join our group
    if: ${{ github.event.comment.body == '/invite' }}
    runs-on: ubuntu-latest
    permissions:
      issues: write
    steps:

      - name: Invite user to join our group
        uses: peter-evans/create-or-update-comment@v1
        with:
          issue-number: ${{ github.event.issue.number }}
          body: |
			#......

      - name: Close Issue
        uses: peter-evans/close-issue@v3
        with:
          issue-number: ${{ github.event.issue.number }}
          comment: auto-closing issue, if you still need help please reopen the issue or ask for help in the community above
          labels: |
            triage/accepted
```



**github åœ°å€ï¼š**

+ [https://github.com/peter-evans/close-issue](https://github.com/peter-evans/close-issue)

æœ€åè¿˜è´´å¿ƒçš„åŠ ä¸Š labels



### å†æ¥ä¸€ä¸ªï¼šIssues Translate Chinese Action

å°†åŒ…å«ä¸­æ–‡ issue å®æ—¶ç¿»è¯‘æˆè‹±æ–‡ issue çš„ actionã€‚

```yaml
name: 'issue translator'
on:
  issue_comment:
    types: [created]
  issues:
    types: [opened]

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: usthe/issues-translate-action@v2.7
        with:
          # it is not necessary to decide whether you need to modify the issue header content
          IS_MODIFY_TITLE: true
          BOT_GITHUB_TOKEN: ${{ secrets.BOT_GITHUB_TOKEN }}
          # Required, input your bot github tokenè¿™é‡Œæœ‰ä¸€ç‚¹å¾ˆç¥å¥‡ï¼Œå°±æ˜¯æˆ‘ä»¬ä¸éœ€è¦å»æŒ‡å®š GitHub ä¸­ BOT çš„ç”¨æˆ· @kubbot ï¼ŒGitHubåœ¨ç¯å¢ƒå¯†é’¥ä¸­å°±å¯ä»¥çŸ¥é“ã€è§£æå‡ºæ¥ã€‚
```

ç”¨äº†ä¸Šé¢çš„æ¨¡æ¿åï¼ŒGitHubå°±èƒ½è‡ªåŠ¨çš„å»åˆ†æ issue å¹¶ä¸”ç¿»è¯‘ã€‚

**è¿˜æœ‰ä¸€ä¸ªæ˜¯ç”¨çš„ chatgpt ç¿»è¯‘çš„ï¼š**

+ [https://github.com/marketplace/actions/gpt-translate](https://github.com/marketplace/actions/gpt-translate)

åœ¨é—®é¢˜æˆ–æ‹‰å–è¯·æ±‚ä¸­åˆ›å»ºå¸¦æœ‰ `/gpt-translate` æˆ– `/gt` çš„è¯„è®ºã€‚

[On issue]è½¬æ¢åçš„æ–‡ä»¶å°†ä½œä¸ºæ‹‰å–è¯·æ±‚åˆ›å»ºã€‚

[On pull request]è½¬æ¢åçš„æ–‡ä»¶å°†é€šè¿‡æ–°æäº¤æ·»åŠ åˆ°pull requestä¸­ã€‚

æ¢å¥è¯è¯´ï¼Œå¦‚æœä½ ç»§ç»­è¯„è®ºä¸€ä¸ªé—®é¢˜ï¼Œæ–°çš„PRå°†ä¸æ–­è¢«åˆ›å»ºã€‚å¦‚æœä½ ä¸€ç›´åœ¨PRä¸Šè¯„è®ºï¼Œæ–°çš„æäº¤å°†ä¸æ–­åœ°è¢«æ·»åŠ åˆ°è¯¥PRä¸­ã€‚

```bash
/gpt-translate README.md README_zh-CN.md traditional-chinese
```

actions æ–‡ä»¶ï¼š

[@kubbot](https://github.com/kubbot)

```yaml
# .github/workflows/gpt-translate.yml
name: GPT Translate

on:
  issue_comment:
    types: [ created ]

jobs:
  gpt_translate:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v3

      - name: Run GPT Translate
        if: |
          contains(github.event.comment.body, '/gpt-translate') || 
          contains(github.event.comment.body, '/gt')
        uses: 3ru/gpt-translate@v1.0
        with:
          apikey: ${{ secrets.OPENAI_API_KEY }}
          token: "${{ secrets.BOT_GITHUB_TOKEN }}"
```





### å¦‚ä½•ä½¿ç”¨æŒ‡å®šçš„GitHub robot ä»£æ›¿ GitHub actions 

æ¯ä¸€æ¬¡çœ‹åˆ° GitHub actionsï¼Œæ„Ÿè§‰çœ‹ç€ä¸é¡ºçœ¼ï¼Œè¿˜ä¸å¦‚æä¸€ä¸ªè‡ªå·±çš„ robotã€‚

ä½†æ˜¯ä¸€ä¸å°å¿ƒæäº†ä¸¤ä¸ª ğŸ˜’

+ https://github.com/kubbot: I am a member bot of [@OpenIMSDK](https://github.com/OpenIMSDK) and the older brother of [@openimbot](https://github.com/openimbot)
+ https://github.com/openimbot: I am a member bot of [@OpenIMSDK](https://github.com/OpenIMSDK) openim and a sister of [@kubbot](https://github.com/kubbot)



### Lighthouse

+ https://github.com/jenkins-x/lighthouse

Lighthouseæ˜¯ä¸€ä¸ªè½»é‡çº§çš„åŸºäº ChatOps çš„ webhook å¤„ç†ç¨‹åºï¼Œå¯ä»¥åŸºäºæ¥è‡ªå¤šä¸ªgitæä¾›å•†ï¼ˆå¦‚GitHubï¼ŒGitHub Enterpriseï¼ŒBitBucket Serverå’ŒGitLabï¼‰çš„webhookè§¦å‘Jenkins X Pipelinesï¼ŒTekton Pipelinesæˆ–Jenkins Jobsã€‚

 Lighthouse æœ€å¼€å§‹çš„æ—¶å€™ä¹Ÿæ˜¯åŸºäº prow çš„ï¼Œå¹¶ä¸”æ˜¯ä»ä»–ä»¬çš„åŸºç¡€ä»£ç çš„å‰¯æœ¬å¼€å§‹ã€‚

ç›®å‰ï¼ŒLighthouseæ”¯æŒæ ‡å‡†çš„Prowæ’ä»¶ï¼Œå¹¶å¤„ç†å°†webhookæ¨é€åˆ°åˆ†æ”¯ï¼Œç„¶ååœ¨æ‚¨é€‰æ‹©çš„ä»£ç†ä¸Šè§¦å‘ç®¡é“æ‰§è¡Œã€‚

Lighthouseä½¿ç”¨ä¸Prowç›¸åŒçš„ `config.yaml` å’Œ `plugins.yaml` è¿›è¡Œé…ç½®ã€‚



## Test-Infra ä»‹ç»

ä½œä¸º kubernetes åŸºç¡€ä¿éšœï¼Œtest-infra åŠŸèƒ½éå¸¸çš„å¼ºå¤§ã€‚

![img](https://raw.githubusercontent.com/kubernetes/test-infra/9771710c13868bddd1476170a77ddab36941c512/docs/architecture.svg)

**æ¶æ„è§£é‡Šï¼š**

å¯¹äº test-infra çš„æ¶æ„ï¼Œæˆ‘ä»¬é¦–å…ˆå¯ä»¥å‘ç°ï¼Œå…¶ç›¸å¯¹å¤æ‚ï¼Œå¹¶ä¸”åŒ…å«è®¸å¤šå¾®æœåŠ¡ç»„ä»¶ã€‚å€¼å¾—æ³¨æ„çš„ä¸€ç‚¹æ˜¯ï¼Œtest-infra ä¸­çš„å¾®æœåŠ¡ä¸å…¶ä»–å¾®æœåŠ¡ä¹‹é—´çš„äº¤äº’å¹¶ä¸é‡‡ç”¨æˆ‘ä»¬ç†ŸçŸ¥çš„ä¼ ç»Ÿæ–¹å¼ï¼Œä¾‹å¦‚ï¼Œå®ƒå¹¶ä¸é€šè¿‡ grpc è¿›è¡Œè°ƒç”¨ï¼Œè¿™ä¸ OpenIM ç­‰ä¼ ç»Ÿå¾®æœåŠ¡æœ‰æ‰€åŒºåˆ«ã€‚

test-infra çš„æ¶æ„çš„æ ¸å¿ƒç»„æˆéƒ¨åˆ†æ˜¯ Hooksï¼Œå®ƒè´Ÿè´£æ¥æ”¶ä¸åŒç±»å‹çš„äº‹ä»¶ã€‚ç„¶åï¼Œtest-infra ä¼šé€šè¿‡ä¸€å¥—æ’ä»¶ç³»ç»Ÿï¼Œæ ¹æ®äº‹ä»¶ç±»å‹å°†å…¶åˆ†å‘ç»™ä¸åŒçš„æ’ä»¶è¿›è¡Œå¤„ç†ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæˆ‘ä»¬è€ƒè™‘ä¸€ä¸ªå®ä¾‹ï¼Œé‚£ä¹ˆåœ¨ kubernetes test-infra ä»“åº“çš„ prow ç›®å½•ä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥æ‰¾åˆ°ä¸€ä¸ªåä¸º plugins çš„æ’ä»¶é›†åˆï¼Œå…¶ä¸­ä¸€ä¸ªæ’ä»¶åä¸º `transfer-issue`ã€‚æ­¤æ’ä»¶è´Ÿè´£å¤„ç† PR è¯·æ±‚ã€‚

å¦ä¸€æ–¹é¢ï¼Œå¯¹äºå•å…ƒè¯·æ±‚ï¼Œå®ƒå°†è¿›è¡Œå•å…ƒæµ‹è¯•ï¼Œå¯¹äºåˆå¹¶è¯·æ±‚ï¼Œå®ƒå°†è¿›è¡Œåˆå¹¶æµ‹è¯•ã€‚åœ¨è¿™ä¸ªç³»ç»Ÿä¸­ï¼Œæˆ‘ä»¬è¿˜æœ‰ä¸€ä¸ªç§°ä¸º `prowjob` çš„CRDèµ„æºï¼Œå®ƒæä¾›äº†ä¸€ç§é«˜å±‚æ¬¡çš„æŠ½è±¡ï¼Œä»¥åŠä¸€ä¸ªè‡ªå®šä¹‰çš„æ§åˆ¶å™¨ã€‚

æ‰€æœ‰çš„æµ‹è¯•ç»“æœä¼šè¢«å›ä¼ åˆ° GitHub çš„æµ‹è¯•é¢æ¿ä¸Šã€‚çŠ¶æ€æ›´æ–°ä¼šé€šè¿‡ crier è¿›è¡Œï¼Œç„¶åä¼ å…¥åˆ°å¯¹åº”çš„ç»„ç»‡å’Œä»“åº“åœ°å€ã€‚

åœ¨å¯è§†åŒ–æ–¹é¢ï¼Œtest-infra æä¾›äº†ä¸€ä¸ªåä¸º deck çš„ç»„ä»¶ã€‚å¯¹åº”çš„ç½‘ç«™æ˜¯ prow.k8s.ioï¼Œå®ƒæä¾›äº†å‰ç«¯è§†å›¾ï¼Œä½¿å¾—ç”¨æˆ·å¯ä»¥æ›´ç›´è§‚åœ°ç†è§£å’ŒæŒæ§æ•´ä¸ªæµ‹è¯•æµç¨‹ã€‚

è¿™æ ·çš„è®¾è®¡è®© test-infra çš„æ¶æ„æ˜¾å¾—æ—¢å¤æ‚åˆçµæ´»ï¼Œä½†ä¹Ÿå¸¦æ¥äº†æé«˜çš„å®šåˆ¶æ€§å’Œæ‰©å±•æ€§ã€‚



**åŸºæœ¬ç»„ä»¶ï¼š**

1. Prow Controller Managerï¼šProwæ§åˆ¶å™¨ç®¡ç†å™¨æ˜¯Prowçš„æ ¸å¿ƒç»„ä»¶ï¼Œè´Ÿè´£åè°ƒProwçš„å„ä¸ªå­ç³»ç»Ÿã€‚å®ƒç›‘æ§Gitå­˜å‚¨åº“ä¸­çš„äº‹ä»¶ï¼Œå¹¶æ ¹æ®é…ç½®è§¦å‘ç›¸åº”çš„æ“ä½œã€‚
2. Prow Jobï¼šProw Jobå®šä¹‰äº†CI/CDç³»ç»Ÿä¸­çš„ä¸€ä¸ªä»»åŠ¡æˆ–ä½œä¸šã€‚å®ƒæè¿°äº†è¦è¿è¡Œçš„ä»£ç ã€æµ‹è¯•å’Œéƒ¨ç½²æ­¥éª¤ï¼Œå¹¶æŒ‡å®šäº†è§¦å‘è¯¥ä½œä¸šçš„æ¡ä»¶ã€‚
3. Prow Pluginï¼šProwæ’ä»¶æ˜¯ä¸€ç§æ‰©å±•æœºåˆ¶ï¼Œå…è®¸å¼€å‘äººå‘˜ä¸ºProwç³»ç»Ÿæ·»åŠ è‡ªå®šä¹‰åŠŸèƒ½ã€‚æ’ä»¶å¯ä»¥ç›‘å¬äº‹ä»¶å¹¶æ‰§è¡Œç›¸åº”çš„æ“ä½œï¼Œä¾‹å¦‚è‡ªåŠ¨åŒ–ä»£ç å®¡æŸ¥ã€ç”ŸæˆæŠ¥å‘Šç­‰ã€‚
4. Prow Dashboardï¼šProwä»ªè¡¨æ¿æ˜¯ä¸€ä¸ªWebç•Œé¢ï¼Œç”¨äºç›‘è§†å’Œç®¡ç†Prowç³»ç»Ÿçš„è¿è¡ŒçŠ¶æ€ã€‚å®ƒæä¾›äº†å¯¹ä½œä¸šã€æ’ä»¶å’Œäº‹ä»¶çš„å¯è§†åŒ–ç•Œé¢ï¼Œæ–¹ä¾¿ç”¨æˆ·æŸ¥çœ‹å’Œæ“ä½œã€‚
5. Plankï¼šPlankæ˜¯Prowçš„ä»»åŠ¡è°ƒåº¦å™¨ï¼Œè´Ÿè´£å°†Prow Jobåˆ†é…ç»™å¯ç”¨çš„å·¥ä½œèŠ‚ç‚¹è¿›è¡Œæ‰§è¡Œã€‚å®ƒä¼šç›‘æ§ä½œä¸šé˜Ÿåˆ—ï¼Œå¹¶å°†ä½œä¸šåˆ†å‘ç»™åˆé€‚çš„å·¥ä½œèŠ‚ç‚¹ï¼Œä»¥ä¾¿å¹¶è¡Œæ‰§è¡Œä½œä¸šã€‚
6. Hookï¼šHookæ˜¯Prowçš„äº‹ä»¶å¤„ç†å™¨ï¼Œç”¨äºæ¥æ”¶å’Œå¤„ç†æ¥è‡ªGitå­˜å‚¨åº“çš„äº‹ä»¶ã€‚å®ƒä¼šç›‘å¬Gitå­˜å‚¨åº“ä¸­çš„äº‹ä»¶ï¼Œå¹¶å°†è¿™äº›äº‹ä»¶è½¬å‘ç»™Prowçš„Controller Managerè¿›è¡Œå¤„ç†ã€‚
7. Deckï¼šDeckæ˜¯Prowçš„ç”¨æˆ·ç•Œé¢ï¼Œæä¾›äº†ä¸€ä¸ªWebç•Œé¢ï¼Œç”¨äºæŸ¥çœ‹Prowç³»ç»Ÿä¸­çš„ä½œä¸šã€æ’ä»¶å’Œäº‹ä»¶ç­‰ä¿¡æ¯ã€‚å¼€å‘äººå‘˜å¯ä»¥ä½¿ç”¨Deckæ¥ç›‘è§†å’Œç®¡ç†CI/CDæµç¨‹ï¼ŒæŸ¥çœ‹ä½œä¸šçš„çŠ¶æ€å’Œæ—¥å¿—ç­‰ã€‚
8. Sinkerï¼šSinkeræ˜¯Prowçš„æ¸…ç†å™¨ï¼Œè´Ÿè´£æ¸…ç†è¿‡æœŸçš„ä½œä¸šå’Œèµ„æºã€‚å®ƒä¼šå®šæœŸæ£€æŸ¥ä½œä¸šçš„çŠ¶æ€ï¼Œå¹¶æ¸…ç†å·²å®Œæˆæˆ–è¿‡æœŸçš„ä½œä¸šï¼Œä»¥é‡Šæ”¾èµ„æºå¹¶ä¿æŒç³»ç»Ÿçš„æ•´æ´ã€‚
9. Tideï¼šTideæ˜¯Prowçš„è‡ªåŠ¨åˆå¹¶ç®¡ç†å™¨ï¼Œç”¨äºç®¡ç†ä»£ç åˆå¹¶æµç¨‹ã€‚å®ƒä¼šç›‘è§†Gitå­˜å‚¨åº“ä¸­çš„Pull Requestï¼Œå¹¶æ ¹æ®é…ç½®çš„è§„åˆ™è‡ªåŠ¨åˆå¹¶ç¬¦åˆæ¡ä»¶çš„Pull Requestã€‚



### k8s prow èƒ½æ”¯æŒå“ªäº›æ—¥å¿—å­˜å‚¨

**ä¹‹å‰ kubesphere ä¸­å¬è¿‡ä¸¤å¥è¯ï¼š**

Prow  ç›®å‰åªæ˜¯æ”¯æŒ Github ï¼ŒGerritï¼Œå¯¹äº gitlab çš„æ”¯æŒçŸ­æœŸéš¾ä»¥çœ‹åˆ°ã€‚

> ä½†æ˜¯æˆ‘ä»¬å¯ä»¥é€šè¿‡ `Lighthouse` å»æ”¯æŒ

~~prow çš„æŒä¹…åŒ–å­˜å‚¨åªæ”¯æŒ GCPï¼Œä½†æ˜¯å¯ä»¥ä½¿ç”¨ Jenkins Xï¼Œå®ƒä½¿ç”¨äº† Knative æ¥è·‘ Job~~

> è¿™å¥è¯ä¸å¯¹ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ prow æ‰¾åˆ°ï¼Œæ˜¯å¯ä»¥æ”¯æŒå…¶ä»–çš„äº‘çš„ã€‚Prow å¹¶ä¸ä»…ç”¨ GCPï¼Œåªè¦æ˜¯å…¼å®¹ s3 çš„ sdk ï¼Œå°±å¯ä»¥ã€‚



### åŸºç¡€æ»¡è¶³

### åˆ›å»º access tokens

https://github.com/settings/tokens ï¼ˆ*éœ€è¦åœ¨ `.env` é‡Œé…ç½®*ï¼‰

### åˆ›å»º webhook

ä»“åº“çš„æ‰€æœ‰äº‹ä»¶ï¼Œéƒ½éœ€è¦é€šè¿‡ webhook å»ç›‘å¬ä½¿ç”¨çš„ã€‚

https://github.com/ç”¨æˆ·å/é¡¹ç›®å/settings/hooks/new

+ Payload URL: [www.example.com:8000](http://www.example.com:8000/)
+ Content type: application/json
+ trigger: Send me everything.
+ Secret: xxx ï¼ˆ*éœ€è¦åœ¨ .env é‡Œé…ç½®*ï¼‰



### å¼€å‘è¿è¡Œ

```
npm install
cp env .env
vim .env
npm start
```



### éƒ¨ç½²

æœ¬é¡¹ç›®ä½¿ç”¨ [pm2](https://github.com/Unitech/pm2) è¿›è¡ŒæœåŠ¡ç®¡ç†ï¼Œå‘å¸ƒå‰è¯·å…ˆå…¨å±€å®‰è£… [pm2](https://github.com/Unitech/pm2)

```
npm install pm2 -g
npm run deploy
```

åå°å¯åŠ¨è¯¥æœåŠ¡åï¼Œå¯ä»¥é€šè¿‡ `pm2 ls` æ¥æŸ¥çœ‹æœåŠ¡åç§°ä¸º `github-bot` çš„è¿è¡ŒçŠ¶æ€ã€‚å…·ä½“ [pm2](https://github.com/Unitech/pm2) ä½¿ç”¨ï¼Œè¯·è®¿é—®ï¼šhttps://github.com/Unitech/pm2



### æ—¥å¿—ç³»ç»Ÿè¯´æ˜

æœ¬ç³»ç»Ÿ `logger` æœåŠ¡åŸºäº [log4js](https://github.com/log4js-node/log4js-node)ã€‚ åœ¨æ ¹ç›®å½•çš„ `.env` æ–‡ä»¶ä¸­æœ‰ä¸ªå‚æ•° `LOG_TYPE` é»˜è®¤ä¸º `console`ï¼Œå‚æ•°å€¼è¯´æ˜ï¼š

```
console - é€šè¿‡ console è¾“å‡ºlogã€‚
file - å°†æ‰€æœ‰ç›¸å…³logè¾“å‡ºåˆ°æ›´æ ¹ç›®å½•çš„ `log` æ–‡ä»¶å¤¹ä¸­ã€‚
```



## END é“¾æ¥

### Link

+ [prow docs](https://docs.prow.k8s.io/docs/overview/)
+ [github kubernetes/test-infra/prow/cron](https://github.com/kubernetes/test-infra/blob/master/prow/cron/cron.go?rgh-link-date=2023-05-13T15%3A35%3A30Z)
+ [using commond](https://prow.k8s.io/command-help)
+ [@k8s-ci-robot](https://github.com/k8s-ci-robot)
+ [@ks-ci-bot](https://github.com/ks-ci-bot)



### å‚è€ƒæ–‡ç« 

+ [xuexb GitHub](https://github.com/xuexb/github-bot)
+ [sealos gh rebot](https://github.com/labring/gh-rebot)
+ https://www.amoyw.com/2020/10/22/Prow/



### Test Infra

åŒ…å« prowï¼š

- Istio: https://github.com/istio/test-infra
- Kubernetes: https://github.com/kubernetes/test-infra
- Knative: https://github.com/knative/test-infra



ä¸å«æœ‰ prowï¼š

- prometheusï¼š https://github.com/prometheus/test-infra
- kyma-projectï¼š https://github.com/kyma-project/test-infra
- Grpc: https://github.com/grpc/test-infra



### æ–‡æ¡£

[Prow: Keeping Kubernetes CI/CD Above Water - Kurt Madel](https://kurtmadel.com/posts/native-kubernetes-continuous-delivery/prow/)

[Prow, Jenkins X Pipeline Operator, and Tekton: Going Serverless With Jenkins X](https://www.alldaydevops.com/blog/prow-jenkins-x-pipeline-operator-and-tekton-going-serverless-with-jenkins-x)

[Jenkins X replaces Prow with Lighthouse for better source control compatibility â€¢ DEVCLASS](https://devclass.com/2020/06/18/jenkins-x-cloudbees-may-update/)

[Prow + Kubernetes - A Perfect Combination To Execute CI/CD At Scale](https://www.velotio.com/engineering-blog/prow-for-native-kubernetes-ci-cd)



#### å‚è€ƒ

[Overview](https://docs.prow.k8s.io/docs/overview/)



#### ä»£ç éƒ¨åˆ†ï¼š

[test-infra/prow at master Â· kubernetes/test-infra](https://github.com/kubernetes/test-infra/tree/master/prow#bots-home)



### å¯¼èˆª

<ul><li><div><a href = '70.md' style='float:left'>â¬†ï¸ä¸Šä¸€èŠ‚ğŸ”—  </a><a href = '72.md' style='float: right'>  ï¸ä¸‹ä¸€èŠ‚ğŸ”—</a></div></li></ul>

+ [â“‚ï¸å›åˆ°ç›®å½•ğŸ ](../README.md)

+ [**ğŸ«µå‚ä¸è´¡çŒ®ğŸ’â¤ï¸â€ğŸ”¥ğŸ’–**](https://nsddd.top/archives/contributors))

+ âœ´ï¸ç‰ˆæƒå£°æ˜ &copy; ï¼šæœ¬ä¹¦æ‰€æœ‰å†…å®¹éµå¾ª[CC-BY-SA 3.0åè®®ï¼ˆç½²å-ç›¸åŒæ–¹å¼å…±äº«ï¼‰&copy;](http://zh.wikipedia.org/wiki/Wikipedia:CC-by-sa-3.0åè®®æ–‡æœ¬) 

