+ [author](http://nsddd.top)

# ç¬¬51èŠ‚  Controller Manager

<div><a href = '50.md' style='float:left'>â¬†ï¸ä¸Šä¸€èŠ‚ğŸ”—  </a><a href = '52.md' style='float: right'>  â¬‡ï¸ä¸‹ä¸€èŠ‚ğŸ”—</a></div>
<br>

> â¤ï¸ğŸ’•ğŸ’•æ–°æ—¶ä»£æ‹¥æŠ±äº‘åŸç”Ÿï¼Œäº‘åŸç”Ÿå…·æœ‰ç¯å¢ƒç»Ÿä¸€ã€æŒ‰éœ€ä»˜è´¹ã€å³å¼€å³ç”¨ã€ç¨³å®šæ€§å¼ºç‰¹ç‚¹ã€‚Myblog:[http://nsddd.top](http://nsddd.top/)

---
[TOC]

### æ§åˆ¶å™¨å¤„ç†æµç¨‹

![img](http://sm.nsddd.top/sm202303081726112.png)

### informer çš„å†…éƒ¨å·¥ä½œæœºåˆ¶

![image-20230308172739991](http://sm.nsddd.top/sm202303081727144.png)

### æ§åˆ¶å™¨çš„ååŒæµç¨‹

![img](http://sm.nsddd.top/sm202303081726666.jpeg)

### é€šç”¨ controller

è¿›å…¥åˆ° kube-controller-manager pod ä¸­æ‰§è¡Œ `kube-controller-manager -h` å‘½ä»¤æ¥æŸ¥è¯¢é»˜è®¤å¯ç”¨çš„ controllerã€‚

```
kubectl -n kube-system exec -it kube-controller-manager-cadmin -- kube-controller-manager -h
```

å¸¸è§ controller å¦‚ä¸‹ï¼š

+ Job Controllerï¼šå¤„ç† job
+ Pod AutoScalerï¼šå¤„ç† pod çš„è‡ªåŠ¨ç¼©å®¹/æ‰©å®¹ã€‚
+ RelicaSetï¼šä¾æ® Replicaset Spec åˆ›å»º Podã€‚
+ Service Controllerï¼šä¸º LoadBalancer type çš„ service åˆ›å»º LB VIPã€‚
+ ServiceAccount Controllerï¼šç¡®ä¿ serviceaccount åœ¨å½“å‰ namespace å­˜åœ¨ã€‚
+ StatefulSet Controllerï¼šå¤„ç† statefulse tä¸­çš„ podã€‚
+ Volume Controller: ä¾æ® PV spec åˆ›å»º volumeã€‚
+ Resource quota Controllerï¼šåœ¨ç”¨æˆ·ä½¿ç”¨èµ„æºä¹‹åï¼Œæ›´æ–°çŠ¶æ€ã€‚
+ Namespace Controllerï¼šä¿è¯ namespace åˆ é™¤æ—¶ï¼Œè¯¥ namespace ä¸‹çš„æ‰€æœ‰èµ„æºéƒ½å…ˆè¢«åˆ é™¤
+ Replication Controllerï¼šåˆ›å»º RC åï¼Œè´Ÿè´£åˆ›å»º podã€‚
+ Node Controllerï¼šç»´æŠ¤ node çŠ¶æ€ï¼Œå¤„ç† evict è¯·æ±‚ç­‰ã€‚
+ Daemon Controllerï¼šä¾æ® damonset åˆ›å»º podã€‚
+ Deployment Controllerï¼šä¾æ® deployment spec åˆ›å»º replicasetã€‚
+ Endpoint Controllerï¼šä¾æ® service spec åˆ›å»º endpoint,ä¾æ® podip æ›´æ–° endpointã€‚
+ Garbage Collectorï¼šå¤„ç†çº§è”åˆ é™¤ï¼Œæ¯”å¦‚åˆ é™¤ deployment çš„åŒæ—¶åˆ é™¤ replicaset ä»¥åŠ podã€‚
+ CronJob Controllerï¼šå¤„ç†cronjobã€‚

### cloud controller manager

**ä»€ä¹ˆæ—¶å€™éœ€è¦cloud controller manager?**

Cloud Controller Manager è‡ª Kubernetes1.6 å¼€å§‹ï¼Œä» kube-controller-manager ä¸­åˆ†ç¦»å‡ºæ¥ï¼Œä¸»è¦å› ä¸º Cloud Controller Manager å¾€å¾€éœ€è¦è·Ÿä¼ä¸š cloud åšæ·±åº¦é›†æˆï¼Œrelease cycle è·Ÿ Kubernetes ç›¸å¯¹ç‹¬ç«‹ã€‚ ä¸ Kubernetes æ ¸å¿ƒç®¡ç†ç»„ä»¶ä¸€èµ·å‡çº§æ˜¯ä¸€ä»¶è´¹æ—¶è´¹åŠ›çš„äº‹ã€‚

é€šå¸¸ cloud controller manager éœ€è¦:

+ è®¤è¯æˆæƒï¼šä¼ä¸š cloud å¾€å¾€éœ€è¦è®¤è¯ä¿¡æ¯ï¼ŒKubernetes è¦ä¸ Cloud API é€šä¿¡ï¼Œéœ€è¦è·å– cloud ç³»ç»Ÿé‡Œçš„ ServiceAccount;
+ Cloud controller manager æœ¬èº«ä½œä¸ºä¸€ä¸ªç”¨æˆ·æ€çš„ component, éœ€è¦åœ¨ Kubernetes ä¸­æœ‰æ­£ç¡®çš„ RBAC è®¾ç½®ï¼Œè·å¾—èµ„æºæ“ä½œæƒé™;
+ é«˜å¯ç”¨ï¼šéœ€è¦é€šè¿‡ leader election æ¥ç¡®ä¿ cloud controller manger é«˜å¯ç”¨ã€‚

cloud controller manager æ˜¯ä»è€ç‰ˆæœ¬çš„ APIServer åˆ†ç¦»å‡ºæ¥çš„ã€‚ Kube-APIServer å’Œ kube-controller-manager ä¸­ä¸€å®šä¸èƒ½æŒ‡å®š cloud-provider,å¦åˆ™ä¼šåŠ è½½å†…ç½®çš„ cloud controller managerã€‚

Kubelet è¦é…ç½® --cloud-provider=externalã€‚

Cloud Controller Manage rä¸»è¦æ”¯æŒ:

+ Node controllerï¼š
  + è®¿é—® cloud API,æ¥æ›´æ–° node çŠ¶æ€;
  + åœ¨ cloud åˆ é™¤è¯¥èŠ‚ç‚¹ä»¥åï¼Œä» kubernetes åˆ é™¤ node;
+ Service controllerï¼šè´Ÿè´£é…ç½®ä¸º loadbalancer ç±»å‹çš„æœåŠ¡é…ç½®LB VIP;
+ Route Controllerï¼šåœ¨ cloud ç¯å¢ƒé…ç½®è·¯ç”±;

å¯ä»¥è‡ªå®šä¹‰ä»»ä½•éœ€è¦çš„ Cloud Controllerã€‚

éœ€è¦å®šåˆ¶çš„ Cloud Controller

+ Ingress controller;
+ Service Controller;
+ è‡ªä¸»ç ”å‘çš„controller ,æ¯”å¦‚ä¹‹å‰æåˆ°çš„:
  + RBAC controller;
  + Account controllerã€‚

#### æ¥è‡ªç”Ÿäº§çš„ç»éªŒ

ä¿æŠ¤å¥½ controller manager çš„ kubeconfig:

+ æ­¤ kubeconfig æ‹¥æœ‰æ‰€æœ‰èµ„æºçš„æ‰€æœ‰æ“ä½œæƒé™ï¼Œé˜²æ­¢æ™®é€šç”¨æˆ·é€šè¿‡ `kubectl exec kube-controller-manager ca`t è·å–è¯¥æ–‡ä»¶ã€‚
+ ç”¨æˆ·å¯èƒ½åšä»»ä½•ä½ æƒ³è±¡ä¸åˆ°çš„æ“ä½œï¼Œç„¶åæ¥æ‰¾ä½  support.

Pod evict å IP å‘ç”Ÿå˜åŒ–ï¼Œä½† endpoint ä¸­çš„ address æ›´æ–°å¤±è´¥:

+ åˆ†æ stacktrace å‘ç° endpoint åœ¨æ›´æ–° LoadBalancer æ—¶è°ƒç”¨ gophercloud è¿æ¥ hang ä½ï¼Œå¯¼è‡´ endpoint worker çº¿ç¨‹å…¨éƒ¨å¡æ­»ã€‚

### ç¡®ä¿ scheduler å’Œ controller çš„é«˜å¯ç”¨

Leader Election Kubenetes æä¾›åŸºäº configmap å’Œ endpoint çš„ leader electionç±»åº“ã€‚

> æ–°ç‰ˆæœ¬æä¾›äº†æ›´è½»é‡çº§çš„ lease å¯¹è±¡ã€‚

Kubernetes é‡‡ç”¨ leader election æ¨¡å¼å¯åŠ¨ component åï¼Œä¼šåˆ›å»ºå¯¹åº” endpoint,å¹¶æŠŠå½“å‰çš„ leader ä¿¡æ¯ annotate åˆ° endponit ä¸Šã€‚

> å’ŒåŸºäº etcd çš„åˆ†å¸ƒå¼é”å·®ä¸å¤šï¼Œå¾ˆç±»ä¼¼ã€‚

![image-20230308172716820](http://sm.nsddd.top/sm202303081727954.png)



## END é“¾æ¥
<ul><li><div><a href = '50.md' style='float:left'>â¬†ï¸ä¸Šä¸€èŠ‚ğŸ”—  </a><a href = '52.md' style='float: right'>  ï¸ä¸‹ä¸€èŠ‚ğŸ”—</a></div></li></ul>

+ [â“‚ï¸å›åˆ°ç›®å½•ğŸ ](../README.md)

+ [**ğŸ«µå‚ä¸è´¡çŒ®ğŸ’â¤ï¸â€ğŸ”¥ğŸ’–**](https://nsddd.top/archives/contributors))

+ âœ´ï¸ç‰ˆæƒå£°æ˜ &copy; ï¼šæœ¬ä¹¦æ‰€æœ‰å†…å®¹éµå¾ª[CC-BY-SA 3.0åè®®ï¼ˆç½²å-ç›¸åŒæ–¹å¼å…±äº«ï¼‰&copy;](http://zh.wikipedia.org/wiki/Wikipedia:CC-by-sa-3.0åè®®æ–‡æœ¬) 

