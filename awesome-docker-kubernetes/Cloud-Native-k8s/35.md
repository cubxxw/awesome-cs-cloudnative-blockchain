+ [author](http://nsddd.top)

# ç¬¬35èŠ‚ client-go å†™ k8s æ§åˆ¶å™¨

<div><a href = '34.md' style='float:left'>â¬†ï¸ä¸Šä¸€èŠ‚ğŸ”—  </a><a href = '36.md' style='float: right'>  â¬‡ï¸ä¸‹ä¸€èŠ‚ğŸ”—</a></div>
<br>

> â¤ï¸ğŸ’•ğŸ’•æ–°æ—¶ä»£æ‹¥æŠ±äº‘åŸç”Ÿï¼Œäº‘åŸç”Ÿå…·æœ‰ç¯å¢ƒç»Ÿä¸€ã€æŒ‰éœ€ä»˜è´¹ã€å³å¼€å³ç”¨ã€ç¨³å®šæ€§å¼ºç‰¹ç‚¹ã€‚Myblog:[http://nsddd.top](http://nsddd.top/)

---
[TOC]

## æ§åˆ¶å™¨

Contaoller è‡³å°‘è¿½è¸ªä¸€ç§ç±»å‹çš„ Kubernetes èµ„æºã€‚è¿™äº› å¯¹è±¡ æœ‰ä¸€ä¸ªä»£è¡¨æœŸæœ›çŠ¶æ€çš„ spec å­—æ®µï¼Œè¯¥èµ„æºçš„æ§åˆ¶å™¨è´Ÿè´£ç¡®ä¿å½“å‰çŠ¶æ€æ¥è¿‘æœŸæœ›çŠ¶æ€ã€‚

kubernetes å®˜æ–¹ä¸€ä¸ª [å®ç°ç®€å•çš„ sample-controller](https://github.com/kubernetes/sample-controller) æ¡ˆä¾‹

kubernetes å®˜æ–¹ä¸€ä¸ª [ç®€å•çš„å®ç° client-go-sample](https://github.com/rootsongjc/kubernetes-client-go-sample) æ¡ˆä¾‹



## client-go

+ [GitHub åœ°å€](https://github.com/kubernetes/client-go)

æˆ‘ä»¬å¦‚ä½•å’Œ Kubernetes å¯¹è¯ï¼Œæ˜¯çš„ï¼Œä½¿ç”¨ kubectl å¯ä»¥ä»¥ CRL æ–¹å¼å’Œ Kubernetes äº¤äº’ã€‚

å¦‚ä½•ä½¿ç”¨ code å®ç°ï¼Œæ˜¯çš„ï¼Œå¯ä»¥ä½¿ç”¨ client-goï¼Œè¿™å¾ˆé‡è¦ï¼ï¼ï¼



### è®¿é—® Kubernetes é›†ç¾¤çš„æ–¹å¼

è®¿é—®kubernetesé›†ç¾¤æœ‰ä»¥ä¸‹å‡ ç§æ–¹å¼ï¼š

| æ–¹å¼                                                         | ç‰¹ç‚¹                                                         | æ”¯æŒè€…   |
| ------------------------------------------------------------ | ------------------------------------------------------------ | -------- |
| Kubernetes dashboard                                         | ç›´æ¥é€šè¿‡Web UIè¿›è¡Œæ“ä½œï¼Œç®€å•ç›´æ¥ï¼Œå¯å®šåˆ¶åŒ–ç¨‹åº¦ä½             | å®˜æ–¹æ”¯æŒ |
| kubectl                                                      | å‘½ä»¤è¡Œæ“ä½œï¼ŒåŠŸèƒ½æœ€å…¨ï¼Œä½†æ˜¯æ¯”è¾ƒå¤æ‚ï¼Œé€‚åˆå¯¹å…¶è¿›è¡Œè¿›ä¸€æ­¥çš„åˆ†è£…ï¼Œå®šåˆ¶åŠŸèƒ½ï¼Œç‰ˆæœ¬é€‚é…æœ€å¥½ | å®˜æ–¹æ”¯æŒ |
| [client-go](https://github.com/kubernetes/client-go)         | ä»kubernetesçš„ä»£ç ä¸­æŠ½ç¦»å‡ºæ¥çš„å®¢æˆ·ç«¯åŒ…ï¼Œç®€å•æ˜“ç”¨ï¼Œä½†éœ€è¦å°å¿ƒåŒºåˆ†kubernetesçš„APIç‰ˆæœ¬ | å®˜æ–¹æ”¯æŒ |
| [client-python](https://github.com/kubernetes-incubator/client-python) | pythonå®¢æˆ·ç«¯ï¼Œkubernetes-incubator                           | å®˜æ–¹æ”¯æŒ |
| [Java client](https://github.com/fabric8io/kubernetes-client) | fabric8ä¸­çš„ä¸€éƒ¨åˆ†ï¼Œkubernetesçš„javaå®¢æˆ·ç«¯                    | Red Hat  |



## ç®€å•çš„å®ç° client-go-sample

```bash
$ go get github.com/rootsongjc/kubernetes-client-go-sample
$ cd $GOPATH/src/github.com/rootsongjc/kubernetes-client-go-sample
$ go build main.go
```



è¯¥å‘½ä»¤çš„ç”¨æ³•å¦‚ä¸‹ã€‚

```bash
 $ ./main
  -app string
        application name (default "app")
  -deployment string
        deployment name
  -image string
        new image name
  -kubeconfig string
        (optional) absolute path to the kubeconfig file (default "/Users/jimmy/.kube/config")
```



**ä½¿ç”¨ä¸å­˜åœ¨çš„imageæ›´æ–°**

```bash
 $ ./main -deployment filebeat-test -image harbor-001.jimmysong.io/library/analytics-docker-test:Build_9 
Found deployment
name -> filebeat-test
Old image -> harbor-001.jimmysong.io/library/analytics-docker-test:Build_8
New image -> harbor-001.jimmysong.io/library/analytics-docker-test:Build_9
```



æŸ¥çœ‹Deploymentçš„eventã€‚

```bash
$ kubectl describe deployment filebeat-test   
Name:            filebeat-test
Namespace:        default
CreationTimestamp:    Fri, 19 May 2017 15:12:28 +0800
Labels:            k8s-app=filebeat-test
Selector:        k8s-app=filebeat-test
Replicas:        2 updated | 3 total | 2 available | 2 unavailable
StrategyType:        RollingUpdate
MinReadySeconds:    0
RollingUpdateStrategy:    1 max unavailable, 1 max surge
Conditions:
  Type        Status    Reason
  ----        ------    ------
  Available     True    MinimumReplicasAvailable
  Progressing     True    ReplicaSetUpdated
OldReplicaSets:    filebeat-test-2365467882 (2/2 replicas created)
NewReplicaSet:    filebeat-test-2470325483 (2/2 replicas created)
Events:
  FirstSeen    LastSeen    Count    From                SubObjectPath    Type        ReasoMessage
  ---------    --------    -----    ----                -------------    --------    ------------
  2h        1m        3    {deployment-controller }            Normal        ScalingReplicaSet    Scaled down replica set filebeat-test-2365467882 to 2
  1m        1m        1    {deployment-controller }            Normal        ScalingReplicaSet    Scaled up replica set filebeat-test-2470325483 to 1
  1m        1m        1    {deployment-controller }            Normal        ScalingReplicaSet    Scaled up replica set filebeat-test-2470325483 to 2
```

å¯ä»¥çœ‹åˆ°è€çš„ReplicaSetä»3ä¸ªreplicaå‡å°‘åˆ°äº†2ä¸ªï¼Œæœ‰2ä¸ªä½¿ç”¨æ–°é…ç½®çš„replicaä¸å¯ç”¨ï¼Œç›®å‰å¯ç”¨çš„replicaæ˜¯2ä¸ªã€‚

è¿™æ˜¯å› ä¸ºæˆ‘ä»¬æŒ‡å®šçš„é•œåƒä¸å­˜åœ¨ï¼ŒæŸ¥çœ‹Deploymentçš„podçš„çŠ¶æ€ã€‚

```bash
$ kubectl get pods -l k8s-app=filebeat-test
NAME                             READY     STATUS             RESTARTS   AGE
filebeat-test-2365467882-4zwx8   2/2       Running            0          33d
filebeat-test-2365467882-rqskl   2/2       Running            0          33d
filebeat-test-2470325483-6vjbw   1/2       ImagePullBackOff   0          4m
filebeat-test-2470325483-gc14k   1/2       ImagePullBackOff   0          4m
```

æˆ‘ä»¬å¯ä»¥çœ‹åˆ°æœ‰ä¸¤ä¸ªpodæ­£åœ¨æ‹‰å–imageã€‚

**è¿˜åŸä¸ºåŸå…ˆçš„é•œåƒ**

å°†imageè®¾ç½®ä¸ºåŸæ¥çš„é•œåƒã€‚

```bash
$ ./main -deployment filebeat-test -image harbor-001.jimmysong.io/library/analytics-docker-test:Build_8
Found deployment
name -> filebeat-test
Old image -> harbor-001.jimmysong.io/library/analytics-docker-test:Build_9
New image -> harbor-001.jimmysong.io/library/analytics-docker-test:Build_8
```

ç°åœ¨å†æŸ¥çœ‹Deploymentçš„çŠ¶æ€ã€‚

```bash
$ kubectl describe deployment filebeat-test   
Name:            filebeat-test
Namespace:        default
CreationTimestamp:    Fri, 19 May 2017 15:12:28 +0800
Labels:            k8s-app=filebeat-test
Selector:        k8s-app=filebeat-test
Replicas:        3 updated | 3 total | 3 available | 0 unavailable
StrategyType:        RollingUpdate
MinReadySeconds:    0
RollingUpdateStrategy:    1 max unavailable, 1 max surge
Conditions:
  Type        Status    Reason
  ----        ------    ------
  Available     True    MinimumReplicasAvailable
  Progressing     True    NewReplicaSetAvailable
OldReplicaSets:    <none>
NewReplicaSet:    filebeat-test-2365467882 (3/3 replicas created)
Events:
  FirstSeen    LastSeen    Count    From                SubObjectPath    Type        ReasoMessage
  ---------    --------    -----    ----                -------------    --------    ------------
  2h        8m        3    {deployment-controller }            Normal        ScalingReplicaSet    Scaled down replica set filebeat-test-2365467882 to 2
  8m        8m        1    {deployment-controller }            Normal        ScalingReplicaSet    Scaled up replica set filebeat-test-2470325483 to 1
  8m        8m        1    {deployment-controller }            Normal        ScalingReplicaSet    Scaled up replica set filebeat-test-2470325483 to 2
  2h        1m        3    {deployment-controller }            Normal        ScalingReplicaSet    Scaled up replica set filebeat-test-2365467882 to 3
  1m        1m        1    {deployment-controller }            Normal        ScalingReplicaSet    Scaled down replica set filebeat-test-2470325483 to 0
```

å¯ä»¥çœ‹åˆ°availableçš„replicaä¸ªæ•°æ¢å¤æˆ3äº†ã€‚



## END é“¾æ¥
<ul><li><div><a href = '34.md' style='float:left'>â¬†ï¸ä¸Šä¸€èŠ‚ğŸ”—  </a><a href = '36.md' style='float: right'>  ï¸ä¸‹ä¸€èŠ‚ğŸ”—</a></div></li></ul>

+ [â“‚ï¸å›åˆ°ç›®å½•ğŸ ](../README.md)

+ [**ğŸ«µå‚ä¸è´¡çŒ®ğŸ’â¤ï¸â€ğŸ”¥ğŸ’–**](https://nsddd.top/archives/contributors))

+ âœ´ï¸ç‰ˆæƒå£°æ˜ &copy; ï¼šæœ¬ä¹¦æ‰€æœ‰å†…å®¹éµå¾ª[CC-BY-SA 3.0åè®®ï¼ˆç½²å-ç›¸åŒæ–¹å¼å…±äº«ï¼‰&copy;](http://zh.wikipedia.org/wiki/Wikipedia:CC-by-sa-3.0åè®®æ–‡æœ¬) 

