+ [author](http://nsddd.top)

# ç¬¬60èŠ‚ ç”Ÿäº§åŒ–é›†ç¾¤çš„ç®¡ç†

<div><a href = '59.md' style='float:left'>â¬†ï¸ä¸Šä¸€èŠ‚ğŸ”—  </a><a href = '61.md' style='float: right'>  â¬‡ï¸ä¸‹ä¸€èŠ‚ğŸ”—</a></div>
<br>

> â¤ï¸ğŸ’•ğŸ’•æ–°æ—¶ä»£æ‹¥æŠ±äº‘åŸç”Ÿï¼Œäº‘åŸç”Ÿå…·æœ‰ç¯å¢ƒç»Ÿä¸€ã€æŒ‰éœ€ä»˜è´¹ã€å³å¼€å³ç”¨ã€ç¨³å®šæ€§å¼ºç‰¹ç‚¹ã€‚Myblog:[http://nsddd.top](http://nsddd.top/)

---
[TOC]

## å¼€å§‹

åŒ…æ‹¬ä»¥ä¸‹å‡ ä¸ªéƒ¨åˆ†ï¼š

+ è®¡ç®—èŠ‚ç‚¹ç›¸å…³
+ æ“ä½œç³»ç»Ÿé€‰æ‹©
+ èŠ‚ç‚¹èµ„æºç®¡ç†
+ èŠ‚ç‚¹å¼‚å¸¸æ£€æµ‹
+ å¸¸ç”¨èŠ‚ç‚¹é—®é¢˜æ’æŸ¥æ‰‹æ®µ
+ åŸºäº extended resource æ‰©å±•èŠ‚ç‚¹èµ„æº
+ æ„å»ºå’Œç®¡ç†é«˜å¯ç”¨é›†ç¾¤
+ Cluster Autoscaler
+ é›†ç¾¤ç®¡ç†å®è·µæ¡ˆä¾‹åˆ†äº«
+ å¤šç§Ÿæˆ·é›†ç¾¤ç®¡ç†



## è®¡ç®—èŠ‚ç‚¹ç›¸å…³

**è®¡ç®—èŠ‚ç‚¹:**

+ å¦‚ä½•æ‰¹é‡å®‰è£…å’Œå‡çº§è®¡ç®—èŠ‚ç‚¹çš„æ“ä½œç³»ç»Ÿ?
+ å¦‚ä½•ç®¡ç†é…ç½®è®¡ç®—èŠ‚ç‚¹çš„ç½‘ç»œä¿¡æ¯?
+ å¦‚ä½•ç®¡ç†ä¸åŒ SKU ( Stock Keeping Unit)çš„è®¡ç®—èŠ‚ç‚¹?
+ å¦‚ä½•å¿«é€Ÿä¸‹æ¶æ•…éšœçš„è®¡ç®—èŠ‚ç‚¹?
+ å¦‚ä½•å¿«é€Ÿæ‰©ç¼©é›†ç¾¤çš„è§„æ¨¡?

**æ§åˆ¶å¹³é¢:**

+ å¦‚ä½•åœ¨ä¸»èŠ‚ç‚¹ä¸Šä¸‹è½½ã€å®‰è£…å’Œå‡çº§æ§åˆ¶å¹³é¢ç»„ä»¶åŠå…¶æ‰€éœ€çš„é…ç½®æ–‡ä»¶?
+ å¦‚ä½•ç¡®ä¿é›†ç¾¤æ‰€éœ€çš„å…¶ä»–æ’ä»¶ï¼Œä¾‹å¦‚ CoreDNSã€ç›‘æ§ç³»ç»Ÿç­‰éƒ¨ç½²å®Œæˆ?
+ å¦‚ä½•å‡†å¤‡æ§åˆ¶å¹³é¢ç»„ä»¶çš„å„ç§å®‰å…¨è¯ä¹¦?
+ å¦‚ä½•å¿«é€Ÿå‡çº§æˆ–å›æ»šæ§åˆ¶å¹³é¢ç»„ä»¶çš„ç‰ˆæœ¬?



**SKUğŸ“œ å¯¹ä¸Šé¢çš„è§£é‡Šï¼š**

> SKU (Stock Keeping Unit) æ˜¯ä¸€ä¸ªå¸¸è§çš„æ¦‚å¿µï¼Œç”¨äºè¡¨ç¤ºä¸åŒé…ç½®çš„ Kubernetes èŠ‚ç‚¹ã€‚æ¯ä¸ª SKU éƒ½åŒ…å«äº†ä¸åŒçš„ç¡¬ä»¶é…ç½®å’Œè½¯ä»¶é…ç½®ï¼Œä¾‹å¦‚ CPUã€å†…å­˜ã€å­˜å‚¨ã€æ“ä½œç³»ç»Ÿã€Kubernetes ç‰ˆæœ¬ç­‰ç­‰ã€‚ä¸åŒçš„ SKU é€‚ç”¨äºä¸åŒçš„åœºæ™¯å’Œåº”ç”¨ç¨‹åºï¼Œå¯ä»¥æ ¹æ®éœ€è¦é€‰æ‹©åˆé€‚çš„ SKU è¿›è¡Œéƒ¨ç½²ã€‚å¯¹äºå¤§è§„æ¨¡çš„ Kubernetes é›†ç¾¤ï¼Œé€šå¸¸éœ€è¦åŒæ—¶éƒ¨ç½²å¤šä¸ª SKUï¼Œä»¥ä¾¿æ»¡è¶³ä¸åŒåº”ç”¨ç¨‹åºçš„éœ€æ±‚å’Œè¦æ±‚ã€‚



## æ“ä½œç³»ç»Ÿçš„é€‰æ‹©

**é€šç”¨æ“ä½œç³»ç»Ÿ**

+ Ubuntu
+ CentOS
+ Fedora



**ä¸“ä¸ºå®¹å™¨ä¼˜åŒ–çš„æ“ä½œç³»ç»Ÿ**

> å®¹å™¨åŒ–æŠ€æœ¯å‡ºç°ä¹‹åï¼Œå°±æœ‰ä¸€äº›ä¸“é—¨é¢å¯¹å®¹å™¨åŒ–çš„æ“ä½œç³»ç»Ÿ ~

æœ€å°åŒ–æ“ä½œç³»ç»Ÿ

+ CoreOS
+ RedHat Atomic
+ Snappy Ubuntu Core
+ RancherOS



æˆ‘ä»¬å†åœ¨ç­›é€‰æ“ä½œç³»ç»Ÿçš„æ—¶å€™è¯¥æ€ä¹ˆé€‰æ‹©ï¼Œè¿™æ˜¯ä¸€ä¸ªé—®é¢˜ ~

**æ“ä½œç³»ç»Ÿè¯„ä¼°å’Œé€‰å‹çš„æ ‡å‡†**

+ æ˜¯å¦æœ‰ç”Ÿæ€ç³»ç»Ÿ
+ æˆç†Ÿåº¦
+ å†…æ ¸ç‰ˆæœ¬
+ å¯¹è¿è¡Œæ—¶çš„æ”¯æŒ
+ Init System
+ åŒ…ç®¡ç†å’Œç³»ç»Ÿå‡çº§
+ å®‰å…¨

**å®¹å™¨ä¼˜åŒ–æ“ä½œç³»ç»Ÿçš„ä¼˜åŠ¿**

+ å°
+ åŸå­çº§å‡çº§å’Œå›é€€
+ æ›´é«˜çš„å®‰å…¨æ€§

| æ“ä½œç³»ç»Ÿ         | CentOS       | Ubuntu       | CoreOS                                                 | Atomic*               | Snappy                           | RancherOS                                          |
| ---------------- | ------------ | ------------ | ------------------------------------------------------ | --------------------- | -------------------------------- | -------------------------------------------------- |
| åˆ†ç±»             | é€šç”¨æ“ä½œç³»ç»Ÿ | é€šç”¨æ“ä½œç³»ç»Ÿ | å®¹å™¨ä¼˜åŒ–                                               | å®¹å™¨ä¼˜åŒ–              | å®¹å™¨ä¼˜åŒ–                         | å®¹å™¨ä¼˜åŒ–                                           |
| ç”Ÿæ€ç³»ç»Ÿå’Œæˆç†Ÿåº¦ | æˆç†Ÿ         | æˆç†Ÿ         | æœ€æ—©çš„å®¹å™¨ä¼˜åŒ–æ“ä½œç³»ç»Ÿï¼Œä¸è¿‡å…¬å¸ä½“é‡å°ï¼Œç›®å‰å·²è¢«æ”¶è´­ã€‚ | RedHat å‡ºå“ï¼Œå“è´¨ä¿è¯ | Canonicalå‡ºå“,æœ€åˆä¸ºç§»åŠ¨è®¾å¤‡è®¾è®¡ | ç›¸å¯¹è¾ƒæ–°,RancherOSä¸­è¿è¡Œçš„æ‰€æœ‰æœåŠ¡éƒ½æ˜¯dockerå®¹å™¨ã€‚ |

CoreOS ç›¸å½“äºæ˜¯ä¸€ä¸ªæ“ä½œç³»ç»Ÿï¼Œè€Œ CentOS åˆ™æ˜¯ä¸€ç§åŸºäº RPM åŒ…ç®¡ç†çš„ Linux å‘è¡Œç‰ˆã€‚CoreOS é‡‡ç”¨äº†å®¹å™¨åŒ–çš„æ–¹å¼æ¥éƒ¨ç½²åº”ç”¨ç¨‹åºå’ŒæœåŠ¡ï¼Œå¹¶ä¸”æ”¯æŒè‡ªåŠ¨åŒ–éƒ¨ç½²ã€å‡çº§å’Œç®¡ç†ã€‚ç”±äº CoreOS å¯ä»¥é€šè¿‡ Docker é•œåƒæ¥éƒ¨ç½²åº”ç”¨ç¨‹åºå’ŒæœåŠ¡ï¼Œå› æ­¤å®ƒéå¸¸é€‚åˆä½œä¸ºäº‘åŸç”Ÿåº”ç”¨ç¨‹åºçš„åŸºç¡€å¹³å°ã€‚ä¸æ­¤ç›¸æ¯”ï¼ŒCentOS åˆ™æ˜¯ä¸€ç§ä¼ ç»Ÿçš„æ“ä½œç³»ç»Ÿï¼Œéœ€è¦é€šè¿‡ RPM åŒ…æ¥å®‰è£…å’Œç®¡ç†åº”ç”¨ç¨‹åºå’ŒæœåŠ¡ã€‚åœ¨äº‘åŸç”Ÿåº”ç”¨ç¨‹åºçš„åœºæ™¯ä¸‹ï¼Œä½¿ç”¨ CoreOS å¯ä»¥æ›´åŠ æ–¹ä¾¿ã€çµæ´»å’Œé«˜æ•ˆåœ°éƒ¨ç½²å’Œç®¡ç†åº”ç”¨ç¨‹åºå’ŒæœåŠ¡ã€‚



### äº‘åŸç”Ÿçš„åŸåˆ™

> äº‘åŸç”Ÿè¯­å¢ƒä¸‹è¿½æ±‚çš„æ˜¯ä¸å¯å˜åŸºç¡€è®¾æ–½ã€‚æ‰€è°“ä¸å¯å˜åŸºç¡€è®¾æ–½ï¼Œå³æŒ‡æ‰€æœ‰çš„åŸºç¡€è®¾æ–½ç»„ä»¶éƒ½æ˜¯ä¸å¯ä¿®æ”¹çš„ï¼Œä»»ä½•å¯¹åŸºç¡€è®¾æ–½çš„æ›´æ”¹éƒ½è¦é€šè¿‡åˆ›å»ºæ–°çš„ç»„ä»¶æ¥å®ç°ã€‚

**å¯å˜åŸºç¡€è®¾æ–½çš„é£é™©**

+ åœ¨ç¾éš¾å‘ç”Ÿçš„æ—¶å€™ï¼Œéš¾ä»¥é‡æ–°æ„å»ºæœåŠ¡ã€‚æŒç»­è¿‡å¤šçš„æ‰‹å·¥æ“ä½œï¼Œç¼ºä¹è®°å½•ï¼Œä¼šå¯¼è‡´å¾ˆéš¾ç”±æ ‡å‡†åˆå§‹åŒ–åçš„æœåŠ¡å™¨æ¥é‡æ–°æ„å»ºèµ·ç­‰æ•ˆçš„æœåŠ¡ã€‚
+ åœ¨æœåŠ¡è¿è¡Œè¿‡ç¨‹ä¸­ï¼ŒæŒç»­çš„ä¿®æ”¹æœåŠ¡å™¨ï¼Œå°±çŠ¹å¦‚ç¨‹åºä¸­çš„å¯å˜å˜é‡çš„å€¼å‘ç”Ÿå˜åŒ–è€Œå¼•å…¥çš„çŠ¶æ€ä¸ä¸€è‡´çš„å¹¶å‘é£é™©ã€‚è¿™äº›å¯¹äºæœåŠ¡å™¨çš„ä¿®æ”¹ï¼ŒåŒæ ·ä¼šå¼•å…¥ä¸­é—´çŠ¶æ€ï¼Œä»è€Œå¯¼è‡´ä¸å¯é¢„çŸ¥çš„é—®é¢˜ã€‚

**ä¸å¯å˜åŸºç¡€è®¾æ–½(immutable infrastructure)**

+ ä¸å¯å˜çš„å®¹å™¨é•œåƒï¼ˆåªè¯»ï¼Œä¸€å±‚å±‚å åŠ ï¼‰
+ ä¸å¯å˜çš„ä¸»æœºæ“ä½œç³»ç»Ÿ

> ä¸å¯å˜çš„æ“ä½œç³»ç»Ÿåªå…è®¸ä¿®æ”¹`/etc`å’Œ`/var`ç›®å½•ï¼Œå…¶ä»–ç›®å½•å‡ä¸ºåªè¯»ã€‚



### Atomic*

Atomicæ˜¯ç”±Red Hatæ”¯æŒçš„è½¯ä»¶åŒ…å®‰è£…ç³»ç»Ÿï¼Œå¯åœ¨å¤šç§å‘è¡Œç‰ˆä¸Šä½¿ç”¨ï¼ŒåŒ…æ‹¬Fedoraã€CentOSå’ŒRHELã€‚Atomicé‡‡ç”¨ä¸å¯å˜çš„æ“ä½œç³»ç»Ÿï¼Œé¢å‘å®¹å™¨ä¼˜åŒ–çš„åŸºç¡€è®¾æ–½ï¼Œçµæ´»ä¸”å®‰å…¨ã€‚å®ƒè¿˜æ”¯æŒæ“ä½œç³»ç»Ÿå‡çº§å’Œå›æ»šçš„åŸå­æ“ä½œï¼Œä½¿ç”¨èµ·æ¥éå¸¸æ–¹ä¾¿ã€‚

**å¤šç§ Distroï¼š**

+ Fedora
+ CentOS
+ RHEL

**ä¼˜åŠ¿ï¼š**

+ ä¸å¯å˜æ“ä½œç³»ç»Ÿï¼Œé¢å‘å®¹å™¨ä¼˜åŒ–çš„åŸºç¡€è®¾æ–½
  + çµæ´»å’Œå®‰å…¨æ€§è¾ƒå¥½
  + åªæœ‰/etcå’Œ/varå¯ä»¥ä¿®æ”¹ï¼Œå…¶ä»–ç›®å½•å‡ä¸ºåªè¯»
+ åŸºäº rpm-ostree ç®¡ç†ç³»ç»ŸåŒ…
  + rpm-ostreeæ˜¯ä¸€ä¸ªå¼€æºé¡¹ç›®ï¼Œä½¿å¾—ç”Ÿäº§ç³»ç»Ÿä¸­æ„å»ºé•œåƒéå¸¸ç®€å•
  + æ”¯æŒæ“ä½œç³»ç»Ÿå‡çº§å’Œå›æ»šçš„åŸå­æ“ä½œ



### æœ€å°åŒ–ä¸»æœºæ“ä½œç³»ç»Ÿ

åœ¨äº‘åŸç”Ÿç¯å¢ƒä¸‹ï¼Œæœ€å°åŒ–ä¸»æœºæ“ä½œç³»ç»Ÿæ˜¯å¾ˆé‡è¦çš„ã€‚åªå®‰è£…å¿…è¦çš„å·¥å…·ï¼Œå¦‚æ”¯æŒç³»ç»Ÿè¿è¡Œçš„æœ€å°å·¥å…·é›†ï¼Œå¯ä»¥æé«˜æ€§èƒ½ã€ç¨³å®šæ€§å’Œå®‰å…¨ä¿éšœã€‚ä»»ä½•è°ƒè¯•å·¥å…·ï¼Œå¦‚æ€§èƒ½æ’æŸ¥å’Œç½‘ç»œæ’æŸ¥å·¥å…·ï¼Œå‡å¯ä»¥åæœŸä»¥å®¹å™¨å½¢å¼è¿è¡Œã€‚

ä»¥ä¸Šæ˜¯äº‘åŸç”ŸåŸºç¡€è®¾æ–½çš„åŸºæœ¬æ¡†æ¶ï¼Œåªæœ‰é€šè¿‡ä¸æ–­çš„å®è·µå’Œæ€»ç»“ï¼Œæ‰èƒ½å®ç°äº‘åŸç”Ÿçš„ç†æƒ³çŠ¶æ€ã€‚

**åŸåˆ™ï¼š**

+ æœ€å°åŒ–ä¸»æœºæ“ä½œç³»ç»Ÿ
+ åªå®‰è£…å¿…è¦çš„å·¥å…·
  + å¿…è¦ï¼šæ”¯æŒç³»ç»Ÿè¿è¡Œçš„æœ€å°å·¥å…·é›†
  + ä»»ä½•è°ƒè¯•å·¥å…·ï¼Œæ¯”å¦‚æ€§èƒ½æ’æŸ¥ï¼Œç½‘ç»œæ’æŸ¥å·¥å…·,å‡å¯ä»¥åæœŸä»¥å®¹å™¨å½¢å¼è¿è¡Œ
+ æ„ä¹‰
  + æ€§èƒ½
  + ç¨³å®šæ€§
  + å®‰å…¨ä¿éšœ



### æ“ä½œç³»ç»Ÿæ„å»ºæµç¨‹

![image-20230313202733661](http://sm.nsddd.top/sm202303132027164.png)



### ostree

æä¾›ä¸€-ä¸ªå…±äº«åº“( libostree)å’Œä¸€äº›åˆ—å‘½ä»¤è¡Œ æä¾›ä¸ git å‘½ä»¤è¡Œä¸€è‡´çš„ä½“éªŒï¼Œå¯ä»¥æäº¤æˆ–è€…ä¸‹è½½ä¸€ä¸ªå®Œæ•´çš„å¯å¯åŠ¨çš„æ–‡ä»¶ç³»ç»Ÿæ ‘ æä¾›å°† ostree éƒ¨ç½²è¿› bootloader çš„æœºåˆ¶

+ https://github.com/ostreedev/ostree/blob/main/src/boot/dracut/module-setup.sh

```go
install() {
    dracut_install /usr/lib/ostree/ostree-prepare-root
    inst_simple "${systemdsystemunitdir}/ostree-prepare-root.service"
    mkdir -p "${initdir}${systemdsystemconfdir}/initrd-root-fs.target.wants"
    ln_r "${systemdsystemunitdir}/ostree-prepare-root.service" \
        "${systemdsystemconfdir}/initrd-root-fs.target.wants/ostree-prepare-root.service"
}
```

#### æ„å»º ostree

rpm-ostree

+ åŸºäº treefile å°† rpm åŒ…æ„å»ºæˆä¸º ostree
+ ç®¡ç† ostree ä»¥åŠ bootloader é…ç½®

treefile

+ referï¼šåˆ†æ”¯å(ç‰ˆæœ¬ï¼Œcpuæ¶æ„)
+ repoï¼šrpm package repositories
+ packagesï¼šå¾…å®‰è£…ç»„ä»¶

å°† rpm æ„å»ºæˆ ostree

```bash
rpm-ostree compose tree --unified-core --cachedir=cache --repo=. /build-repo/path/to/treefile.json
```

#### åŠ è½½ ostree

åˆå§‹åŒ–é¡¹ç›®

```bash
ostree admin os-init centos-atomic-host
```

å¯¼å…¥ ostree repo

```bash
ostree remote add atomic http://ostree.svr/ostree
```

æ‹‰å– ostree

```
ostree pull atomic centos-atomic-host/8/x86_64/standard
```

éƒ¨ç½² OS

```bash
ostree admin deploy --os=centos-atomic-hostcentos-atomic-host/8/x86_64/standard --karg=' root=/dev/atomicos/root'
```



#### æ“ä½œç³»ç»ŸåŠ è½½

**ç‰©ç†æœº**:

+ ç‰©ç†æœºé€šå¸¸éœ€è¦é€šè¿‡ `foreman` å¯åŠ¨ï¼Œ`foreman` é€šè¿‡ `pxe boot`,å¹¶åŠ è½½ `kickstart`
+ `kickstart` é€šè¿‡`ostree deploy` å³å¯å®Œæˆæ“ä½œç³»ç»Ÿçš„éƒ¨ç½²

**è™šæ‹Ÿæœº**:

+ éœ€è¦é€šè¿‡é•œåƒå·¥å…·å°† ostree æ„å»ºæˆ qcow2 æ ¼å¼ï¼Œvhd, raw ç­‰æ¨¡å¼





## END é“¾æ¥
<ul><li><div><a href = '59.md' style='float:left'>â¬†ï¸ä¸Šä¸€èŠ‚ğŸ”—  </a><a href = '61.md' style='float: right'>  ï¸ä¸‹ä¸€èŠ‚ğŸ”—</a></div></li></ul>

+ [â“‚ï¸å›åˆ°ç›®å½•ğŸ ](../README.md)

+ [**ğŸ«µå‚ä¸è´¡çŒ®ğŸ’â¤ï¸â€ğŸ”¥ğŸ’–**](https://nsddd.top/archives/contributors))

+ âœ´ï¸ç‰ˆæƒå£°æ˜ &copy; ï¼šæœ¬ä¹¦æ‰€æœ‰å†…å®¹éµå¾ª[CC-BY-SA 3.0åè®®ï¼ˆç½²å-ç›¸åŒæ–¹å¼å…±äº«ï¼‰&copy;](http://zh.wikipedia.org/wiki/Wikipedia:CC-by-sa-3.0åè®®æ–‡æœ¬) 

