+ [author](http://nsddd.top)

# ç¬¬30èŠ‚ K8s å¼€å‘ç¯å¢ƒæ­å»º

<div><a href = '29.md' style='float:left'>â¬†ï¸ä¸Šä¸€èŠ‚ğŸ”—  </a><a href = '31.md' style='float: right'>  â¬‡ï¸ä¸‹ä¸€èŠ‚ğŸ”—</a></div>
<br>

> â¤ï¸ğŸ’•ğŸ’•æ–°æ—¶ä»£æ‹¥æŠ±äº‘åŸç”Ÿï¼Œäº‘åŸç”Ÿå…·æœ‰ç¯å¢ƒç»Ÿä¸€ã€æŒ‰éœ€ä»˜è´¹ã€å³å¼€å³ç”¨ã€ç¨³å®šæ€§å¼ºç‰¹ç‚¹ã€‚Myblog:[http://nsddd.top](http://nsddd.top/)

---
[TOC]

## æ‰€éœ€è¦çš„è½¯ä»¶åŒ…

+ GNU Development Tool (éå¿…é¡»ï¼šLinuxå¼€å‘çš„æ—¶å€™å¿…å¤‡å·¥å…·)
+ etcd
+ go
+ dockerï¼ˆè™½ç„¶ç°åœ¨åªéœ€è¦ containerdï¼Œdocker è‡ªå¸¦ containerdï¼‰
+ jq ï¼ˆæŸäº›å¸®åŠ©è„šæœ¬çš„éœ€è¦ï¼Œå‘½ä»¤è¡Œçš„jsonå¤„ç†å™¨ï¼‰
+ PyYAML ï¼ˆä¸€äº›æµ‹è¯•ç›¸å…³ï¼‰
+ OpenSSL å’Œ CFSSL
+ rsync ï¼ˆæ–‡ä»¶ä¼ è¾“ï¼‰



## å®‰è£…GNU

```bash
sudo apt install build-essential  
```



## å®‰è£…Docker

```bash
sudo apt-get update  
sudo apt-get install \  
    ca-certificates \  
    curl \  
    gnupg \  
    lsb-release  

curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmor -o /usr/share/keyrings/docker-archive-keyring.gpg  

echo \  
  "deb [arch=$(dpkg --print-architecture) signed-by=/usr/share/keyrings/docker-archive-keyring.gpg] https://download.docker.com/linux/ubuntu \  
  $(lsb_release -cs) stable" | sudo tee /etc/apt/sources.list.d/docker.list > /dev/null  

sudo apt-get update
sudo apt-get install docker-ce docker-ce-cli containerd.io docker-compose-plugin
```



## ä¿®æ”¹ContainerD æ‰€ç”¨çš„é•œåƒåº“åœ°å€

**Containerdåº”ç”¨**:

containerdçš„é»˜è®¤é…ç½®æ–‡ä»¶ä¸º`/etc/containerd/config.toml`ï¼Œå¯é€šè¿‡å‘½ä»¤ï¼š

```bash
containerd config default ##æŸ¥çœ‹é»˜è®¤é…ç½®
```

**ä¿®æ”¹ä¿¡æ¯**

```bash
containerd config default > ~/config.toml  
```

ç„¶åç¼–è¾‘`ï½config.toml`å»æ·»åŠ ä¿¡æ¯ï¼š

::: details ç”Ÿæˆçš„é…ç½®æ–‡ä»¶ï¼š

```go
[stream_processors]

  [stream_processors."io.containerd.ocicrypt.decoder.v1.tar"]
    accepts = ["application/vnd.oci.image.layer.v1.tar+encrypted"]
    args = ["--decryption-keys-path", "/etc/containerd/ocicrypt/keys"]
    env = ["OCICRYPT_KEYPROVIDER_CONFIG=/etc/containerd/ocicrypt/ocicrypt_keyprovider.conf"]
    path = "ctd-decoder"
    returns = "application/vnd.oci.image.layer.v1.tar"

  [stream_processors."io.containerd.ocicrypt.decoder.v1.tar.gzip"]
    accepts = ["application/vnd.oci.image.layer.v1.tar+gzip+encrypted"]
    args = ["--decryption-keys-path", "/etc/containerd/ocicrypt/keys"]
    env = ["OCICRYPT_KEYPROVIDER_CONFIG=/etc/containerd/ocicrypt/ocicrypt_keyprovider.conf"]
    path = "ctd-decoder"
    returns = "application/vnd.oci.image.layer.v1.tar+gzip"
```

:::



```bash
sudo mv ~/config.toml /etc/containerd/config.toml
sudo systemctl restart containerd  
sudo systemctl restart containerd.service #é‡å¯æœåŠ¡
```

::: warning éœ€è¦ï¼Ÿ
é»˜è®¤ contarnerd é…ç½®æ–‡ä»¶æ²¡æœ‰ç”Ÿæˆçš„ï¼Œæ‰€ä»¥ contarnerd é»˜è®¤æŠŠé…ç½®æ–‡ä»¶å¯¼å…¥åˆ°é…ç½®æ–‡ä»¶ä¸­å»ã€‚

:::



## å®‰è£…rsync:

```bash
cd ~/Downloads  
wget https://ghproxy.com/https://github.com/WayneD/rsync/archive/refs/tags/v3.2.4.tar.gz  
tar -xf v3.2.4.tar.gz  
cd rsync-3.2.4  
```



**å®‰è£…ä¸€äº›å·¥å…·åŒ…**

```bash
sudo apt install -y gcc g++ gawk autoconf automake python3-cmarkgfm  
sudo apt install -y acl libacl1-dev  
sudo apt install -y attr libattr1-dev  
sudo apt install -y libxxhash-dev  
sudo apt install -y libzstd-dev  
sudo apt install -y liblz4-dev  
sudo apt install -y libssl-dev  
```

> å¦‚æœå®‰è£…å¤±è´¥é‡è¯•å°±å¥½



**ç¼–è¯‘ï¼Œå®‰è£…ï¼š**

```bash
./configure  
make  
sudo cp ./rsync /usr/local/bin/  
sudo cp ./rsync-ssl /usr/local/bin/  
```



## å®‰è£…jqï¼š

```
sudo apt-get install jq  
```



## å®‰è£…PyYaml:

```bash
sudo apt install -y python3-pip
pip install pyyaml
# å¯é€‰ apt install ipython3
```



## å®‰è£…etcdï¼š

> **etcd** çš„å®‰è£…æ¯”è¾ƒé‡è¦ï¼Œæ­¥éª¤ä¹Ÿæ˜¯æ¯”è¾ƒå¤šä¸€ç‚¹çš„~

```bash
ETCD_VER=v3.5.4  
curl -L https://storage.googleapis.com/etcd/${ETCD_VER}/etcd-${ETCD_VER}-linux-amd64.tar.gz -o /tmp/etcd-${ETCD_VER}-linux-amd64.tar.gz  
mkdir ~/etcd  
tar xzvf /tmp/etcd-${ETCD_VER}-linux-amd64.tar.gz -C ~/etcd --strip-components=1  
rm -f /tmp/etcd-${ETCD_VER}-linux-amd64.tar.gz  

sudo vim ~/.bashrc  
```

æœ€ååŠ å…¥ï¼š`export PATH="/home/<ç”¨æˆ·å>/etcd:${PATH}"`

```
source ~/.bashrc  
```

> å»ºè®®åŠ å…¥è‡ªå®šä¹‰ç¯å¢ƒç›®å½•ï¼š
>
> ```
> source /etc/profile.d/mypath.sh
> ```
>
> **æµ‹è¯•ï¼š**
>
> ```bash
> root@cubmaster01:~/etcd# etcd --version
> etcd Version: 3.5.4
> Git SHA: 08407ff76
> Go Version: go1.16.15
> Go OS/Arch: linux/amd64
> ```



## å®‰è£…golang (1.24åŠä»¥ä¸Šéœ€è¦golang 1.18)ï¼š

```bash
cd ~/Downloads  
wget https://golang.google.cn/dl/go1.19.3.linux-amd64.tar.gz  
sudo rm -rf /usr/local/go && sudo tar -C /usr/local -xzf go1.19.3.linux-amd64.tar.gz  

mkdir ~/go   # æ ¹ç›®å½•
mkdir ~/go/src  # æºæ–‡ä»¶å­˜æ”¾
mkdir ~/go/bin  # æˆ‘ä»¬ç”¨go get / go install å®‰è£…çš„å¯æ‰§è¡Œæ–‡ä»¶
sudo vim /etc/profile.d/mypath.sh
```

æœ€ååŠ å…¥å¦‚ä¸‹å‡ è¡Œï¼š

```bash
export GOPATH="/home/<ç”¨æˆ·å>/go"  
export GOBIN="/home/<ç”¨æˆ·å>/go/bin"  
export PATH="/usr/local/go/bin:$GOPATH/bin:${PATH}"  

source /etc/profile.d
```

::: danger
æœ‰ä¸€äº›æ¯”è¾ƒæ·±çš„è®¾ç½®ï¼š

```bash
sudo vim /etc/sudoers  
```

:::

åœ¨secure_pathä¸€è¡ŒåŠ å…¥å¦‚ä¸‹ç›®å½•ï¼š

```bash
/usr/local/go/bin ï¼ˆè¿™ä¸ªæ˜¯$GOPATH/binç›®å½•ï¼‰
/home/<ç”¨æˆ·å>/etcd ï¼ˆè¿™ä¸ªæ˜¯etcdå‘½ä»¤æ‰€åœ¨ç›®å½•ï¼‰
/home/<ç”¨æˆ·å>/go/bin ï¼ˆè¿™ä¸ªæ˜¯go getå®‰è£…çš„ç¨‹åºæ‰€åœ¨ä½ç½®ï¼‰
```

> **ğŸ’¡ç®€å•çš„ä¸€ä¸ªæ¡ˆä¾‹å¦‚ä¸‹ï¼š**
>
> ```bash
> Defaults	secure_path="/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/snap/bin:/usr/local/go/bin:/root/etcd:/root/go/bin"
> ```





### è®¾ç½®golangä»£ç†ï¼š

```bash
go env -w GO111MODULE="on"  
go env -w GOPROXY="https://goproxy.cn,direct"  
```



## å®‰è£…CFSSLï¼š

```bash
go install github.com/cloudflare/cfssl/cmd/...@latest  
```

::: tip 
cfssl ç”¨äº kubernetes çš„è¯ä¹¦ç”Ÿæˆçš„ã€‚
:::



## ä¸‹è½½kubernetesä»£ç ï¼š

```bash
mkdir $GOPATH/src/k8s.io  && cd $GOPATH/src/k8s.io
git clone https://ghproxy.com/https://github.com/kubernetes/kubernetes.git  
git checkout -b kube1.24 v1.24.0  
```

::: warning ä¸ºä»€ä¹ˆéœ€è¦åœ¨ `$GOPATH/src/k8s.io` 
kubernetes å†å²æ‚ ä¹…ï¼Œæ‰€ä»¥ï¼Œæœ€å¥½æ˜¯é€‰æ‹©æ”¾å…¥åˆ° `$GOPATH/src/k8s.io` æœ€ä¸å®¹æ˜“å‡ºç°é”™è¯¯ã€‚
:::



## è®¾ç½®git

```bash
 git remote rm origin # ä¸å»ºè®®åˆ é™¤ï¼Œå¦‚æœä½ ä½¿ç”¨çš„ä¸æ˜¯æœ€æ–°ç‰ˆ
 git remote add origin https://github.com/cubxxw/kubernetes.git
 git remote add upstream https://github.com/kubernetes/kubernetes.git
 git remote set-url --push upstream no-pushing
 git remote -v; git branch -a
```





## Kubernetes Makefile

æˆ–è®¸å¯ä»¥ç›´æ¥ç¼–è¯‘ï¼Œ äº‹å®ä¸Š Kubernetes å®˜æ–¹ä¹Ÿæ¨è Kind å·¥å…·ã€‚

åœ¨ Kubernetes ä¸­çš„ Github README.md æ–‡æ¡£ä¸­ä»‹ç»äº†ï¼š

### To start developing K8s

[ç¤¾åŒºå­˜å‚¨åº“](https://git.k8s.io/community)åŒ…å«äº†æ‰€æœ‰å…³äºä»æºä»£ç æ„å»ºKubernetesçš„ä¿¡æ¯ï¼ŒåŒ…æ‹¬å¦‚ä½•è´¡çŒ®ä»£ç å’Œæ–‡æ¡£ï¼Œè”ç³»è°ç­‰ç­‰ã€‚

**å¦‚æœæ‚¨æƒ³ç«‹å³æ„å»ºKubernetesï¼Œæœ‰ä¸¤ç§é€‰æ‹©ï¼š**

#### ä½ æœ‰ä¸€ä¸ªå·¥ä½œçš„Goè¯­è¨€ç¯å¢ƒã€‚

```go
mkdir -p $GOPATH/src/k8s.io
cd $GOPATH/src/k8s.io
git clone https://github.com/kubernetes/kubernetes
cd kubernetes
make
```



#### æ‚¨æœ‰ä¸€ä¸ªå·¥ä½œçš„Dockerç¯å¢ƒã€‚

```go
git clone https://github.com/kubernetes/kubernetes
cd kubernetes
make quick-release
```

For the full story, head over to the [developer's documentation](https://git.k8s.io/community/contributors/devel#readme).





## END é“¾æ¥
<ul><li><div><a href = '29.md' style='float:left'>â¬†ï¸ä¸Šä¸€èŠ‚ğŸ”—  </a><a href = '31.md' style='float: right'>  ï¸ä¸‹ä¸€èŠ‚ğŸ”—</a></div></li></ul>

+ [â“‚ï¸å›åˆ°ç›®å½•ğŸ ](../README.md)

+ [**ğŸ«µå‚ä¸è´¡çŒ®ğŸ’â¤ï¸â€ğŸ”¥ğŸ’–**](https://nsddd.top/archives/contributors))

+ âœ´ï¸ç‰ˆæƒå£°æ˜ &copy; ï¼šæœ¬ä¹¦æ‰€æœ‰å†…å®¹éµå¾ª[CC-BY-SA 3.0åè®®ï¼ˆç½²å-ç›¸åŒæ–¹å¼å…±äº«ï¼‰&copy;](http://zh.wikipedia.org/wiki/Wikipedia:CC-by-sa-3.0åè®®æ–‡æœ¬) 



### å‚è€ƒ

+  [https://analyticsindiamag.com/7-free-learning-resources-for-kubernetes/](https://analyticsindiamag.com/7-free-learning-resources-for-kubernetes/)

