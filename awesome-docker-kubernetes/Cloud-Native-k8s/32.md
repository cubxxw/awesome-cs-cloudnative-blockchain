+ [author](http://nsddd.top)

# ç¬¬32èŠ‚ kubernetes ç›®å½•ç»“æ„

<div><a href = '31.md' style='float:left'>â¬†ï¸ä¸Šä¸€èŠ‚ğŸ”—  </a><a href = '33.md' style='float: right'>  â¬‡ï¸ä¸‹ä¸€èŠ‚ğŸ”—</a></div>
<br>

> â¤ï¸ğŸ’•ğŸ’•æ–°æ—¶ä»£æ‹¥æŠ±äº‘åŸç”Ÿï¼Œäº‘åŸç”Ÿå…·æœ‰ç¯å¢ƒç»Ÿä¸€ã€æŒ‰éœ€ä»˜è´¹ã€å³å¼€å³ç”¨ã€ç¨³å®šæ€§å¼ºç‰¹ç‚¹ã€‚Myblog:[http://nsddd.top](http://nsddd.top/)

---
[TOC]

## åˆ†ç±»

**Kubernetes æ˜¯Goè¯­è¨€å¼€å‘çš„ï¼Œç›¸å¯¹æ¥è¯´å¤§éƒ¨åˆ†ç»“æ„è¿˜æ˜¯å¾ˆæ¸…æ™°çš„ã€‚**

Kubernetesçš„ä»£ç éƒ½åœ¨ kubernetesç›®å½•ä¸‹ï¼Œå¦‚å›¾ï¼Œæ ¹æ®åŠŸèƒ½ä¸»è¦åˆ†æˆä»¥ä¸‹å‡ ç±»ï¼š
 1ã€`æ–‡æ¡£ç±»`ï¼ˆapiã€docsã€logoï¼‰
 2ã€`å·¥å…·ç±»`ï¼ˆbuildã€clusterã€Godepsã€hackã€stagingã€translationsï¼‰
 3ã€`ä»£ç ç±»`ï¼ˆcmdã€pkgã€pluginã€testã€third_partyï¼‰

å·¥å…·ç±»ä¸»è¦ç”¨åˆ°çš„ buildç›®å½•ä¸‹çš„æ–‡ä»¶ï¼Œè‡ªå·±åŠ¨æ‰‹ç¼–è¯‘çš„æ—¶å€™ä¼šç”¨åˆ°ï¼› 

**æ ¸å¿ƒä»£ç é›†ä¸­åœ¨cmdå’Œpkgä¸­ã€‚è¿™ä¸¤ä¸ªæ˜¯ Kubernetes æœ€é‡è¦çš„ä¸¤ä¸ªåŒ…~**

cmdå†…éƒ¨åŒ…å«å„ä¸ªç»„ä»¶çš„å…¥å£ï¼Œå…·ä½“æ ¸å¿ƒçš„å®ç°éƒ¨åˆ†åœ¨pkgç›®å½•ä¸‹ã€‚

æˆ‘ä»¬æ¯ä¸€ä¸ª å¯æ‰§è¡Œæ–‡ä»¶éƒ½å¯¹åº” cmd 



**å…³äºå…¶ä»–ç›®å½•ï¼š**

`plugin` ç›®å½•ä¹‹å‰çš„ç‰ˆæœ¬åŒ…æ‹¬ `scheduler` éƒ¨åˆ†çš„ä»£ç ï¼Œå½“å‰ç‰ˆæœ¬ï¼ˆåº”è¯¥æ˜¯åœ¨1.10ä¹‹åï¼‰å·²ç»å°†scheduleréƒ¨åˆ†ä»£ç ç§»åˆ°å’Œå…¶ä»–ç»„ä»¶ä¸€è‡´çš„ `pkg` ç›®å½•ï¼Œæ‰€ä»¥ç›®å‰ `plugin` ä¸»è¦åŒ…å«çš„æ˜¯`è®¤è¯`ä¸`é‰´æƒ`éƒ¨åˆ†çš„ä»£ç ã€‚



## æ ¹ç›®å½•

```bash
root@cubmaster01:~/go/src/k8s.io/kubernetes# tree -L 1
.
â”œâ”€â”€ api
â”œâ”€â”€ build
â”œâ”€â”€ CHANGELOG
â”œâ”€â”€ CHANGELOG.md -> CHANGELOG/README.md
â”œâ”€â”€ cluster
â”œâ”€â”€ cmd
â”œâ”€â”€ code-of-conduct.md
â”œâ”€â”€ CONTRIBUTING.md
â”œâ”€â”€ docs
â”œâ”€â”€ go.mod
â”œâ”€â”€ go.sum
â”œâ”€â”€ hack
â”œâ”€â”€ LICENSE
â”œâ”€â”€ LICENSES
â”œâ”€â”€ logo
â”œâ”€â”€ Makefile -> build/root/Makefile
â”œâ”€â”€ Makefile.generated_files -> build/root/Makefile.generated_files
â”œâ”€â”€ _output
â”œâ”€â”€ OWNERS
â”œâ”€â”€ OWNERS_ALIASES
â”œâ”€â”€ pkg
â”œâ”€â”€ plugin
â”œâ”€â”€ README.md
â”œâ”€â”€ SECURITY_CONTACTS
â”œâ”€â”€ staging
â”œâ”€â”€ SUPPORT.md
â”œâ”€â”€ test
â”œâ”€â”€ third_party
â””â”€â”€ vendor
```

**makefile æ”¯æŒäº¤å‰ç¼–è¯‘çš„ï¼›**

Kubernetes çš„ç¼–è¯‘æ–¹æ³•æœ‰ä¸‰ç§ï¼Œmakefile å’Œ docker æ˜¯æ”¯æŒäº¤å‰ç¼–è¯‘çš„ã€‚



## api

é¡¾åæ€ä¹‰ï¼Œ

```bash
â¯ tree api/ -L 2
api/
â”œâ”€â”€ api-rules
â”‚   â”œâ”€â”€ aggregator_violation_exceptions.list
â”‚   â”œâ”€â”€ apiextensions_violation_exceptions.list
â”‚   â”œâ”€â”€ codegen_violation_exceptions.list
â”‚   â”œâ”€â”€ README.md
â”‚   â”œâ”€â”€ sample_apiserver_violation_exceptions.list
â”‚   â””â”€â”€ violation_exceptions.list
â”œâ”€â”€ openapi-spec
â”‚   â”œâ”€â”€ README.md
â”‚   â”œâ”€â”€ swagger.json
â”‚   â””â”€â”€ v3
â””â”€â”€ OWNERS

3 directories, 9 files
```

**æˆ‘ä»¬å¯ä»¥çœ‹åˆ° `swagger.json`**

> æˆ‘ä»¬éƒ½çŸ¥é“ api å£°æ˜éƒ½æ˜¯æœ‰ä¸€ä¸ª json æ–‡ä»¶ï¼Œé€šè¿‡å£°æ˜æ‹‰å–æ‰€æœ‰çš„ API 
>
> å¦‚æœæˆ‘ä»¬éœ€è¦çœ‹ API æ–‡æ¡£ï¼Œçœ‹ `swagger.json`



## pkg

::: tip 
å¤§é‡çš„ kubernetes çš„æºç æ‰€åœ¨ï¼Œé™¤äº†è¢«æŠ½ç¦»ä¸ºå•ç‹¬ç»„ä»¶çš„éƒ¨åˆ†ï¼Œä¾‹å¦‚ api server çš„ä»£ç ï¼Œproxy ç»„ä»¶çš„ä»£ç ï¼Œkubelet ç»„ä»¶çš„ä»£ç ã€‚

+ ä¸šåŠ¡é€»è¾‘éƒ½åœ¨ pkg
+ å‘½ä»¤è¡Œå‚æ•°éƒ½åœ¨ cmd

:::

**å…³äºä¸¤ä¸ªç»„ä»¶ï¼š `./pkg/api` å’Œ `./pkg/apis`**

::: warning 
Api æ–‡ä»¶å¤¹ä¸‹åŒ…å«å’ŒOpen API ç›¸å…³çš„æ¨¡å‹å®šä¹‰ç­‰å†…å®¹ã€‚

**åç§°ä¸ä¸€æ ·ï¼Œä½œç”¨æ˜¯å®Œå…¨ä¸ä¸€æ ·çš„ã€‚**

+ ç”¨äºæ ¹æ® OpenAPI è§„èŒƒå½¢æˆç¬¦åˆå…¶è§„å®šçš„ API 

+ apis æ˜¯åŒ…å«å†…å»º API Groups å’Œ API Objects çš„ï¼Œè€Œ scheme ç›¸å…³çš„ä»£ç å¤§éƒ¨åˆ†åœ¨è¿™é‡Œã€‚

:::



```bash
root@cubmaster01:~/go/src/k8s.io/kubernetes# tree -L 1 pkg
pkg
â”œâ”€â”€ api
â”œâ”€â”€ apis
â”œâ”€â”€ auth
â”œâ”€â”€ capabilities
â”œâ”€â”€ client
â”œâ”€â”€ cloudprovider
â”œâ”€â”€ cluster
â”œâ”€â”€ controller
â”œâ”€â”€ controlplane
â”œâ”€â”€ credentialprovider
â”œâ”€â”€ features
â”œâ”€â”€ fieldpath
â”œâ”€â”€ generated
â”œâ”€â”€ kubeapiserver
â”œâ”€â”€ kubectl
â”œâ”€â”€ kubelet
â”œâ”€â”€ kubemark
â”œâ”€â”€ OWNERS
â”œâ”€â”€ printers
â”œâ”€â”€ probe
â”œâ”€â”€ proxy
â”œâ”€â”€ quota
â”œâ”€â”€ registry
â”œâ”€â”€ routes
â”œâ”€â”€ scheduler
â”œâ”€â”€ security
â”œâ”€â”€ securitycontext
â”œâ”€â”€ serviceaccount
â”œâ”€â”€ util
â”œâ”€â”€ volume
â””â”€â”€ windows
```



### apis ç›®å½•çš„è¯¦è§£

**ç›®å½•ç»“æ„ï¼š**

```bash
root@cubmaster01:~/go/src/k8s.io/kubernetes/pkg/apis# tree -L 1
.
â”œâ”€â”€ abac
â”œâ”€â”€ admission
â”œâ”€â”€ admissionregistration
â”œâ”€â”€ apidiscovery
â”œâ”€â”€ apiserverinternal
â”œâ”€â”€ apps
â”œâ”€â”€ authentication
â”œâ”€â”€ authorization
â”œâ”€â”€ autoscaling
â”œâ”€â”€ batch
â”œâ”€â”€ certificates
â”œâ”€â”€ coordination
â”œâ”€â”€ core
â”œâ”€â”€ discovery
â”œâ”€â”€ events
â”œâ”€â”€ extensions
â”œâ”€â”€ flowcontrol
â”œâ”€â”€ imagepolicy
â”œâ”€â”€ networking
â”œâ”€â”€ node
â”œâ”€â”€ OWNERS
â”œâ”€â”€ policy
â”œâ”€â”€ rbac
â”œâ”€â”€ resource
â”œâ”€â”€ scheduling
â””â”€â”€ storage
```

åœ¨Kubernetesæºç ä¸­ï¼Œ`core`ç›®å½•å’Œ`apps`ç›®å½•æ˜¯ä¸¤ä¸ªä¸åŒçš„ç›®å½•ï¼Œç”¨äºå­˜æ”¾ä¸åŒçš„APIå¯¹è±¡ã€‚

+ `core`ç›®å½•ä¸‹å­˜æ”¾çš„æ˜¯åŸºç¡€çš„APIå¯¹è±¡ï¼Œä¾‹å¦‚ Podã€Serviceã€ReplicationController ç­‰ã€‚è¿™äº›APIå¯¹è±¡æ˜¯Kubernetesçš„æ ¸å¿ƒåŠŸèƒ½ï¼Œæä¾›äº†åŸºæœ¬çš„è°ƒåº¦ã€ç®¡ç†å’Œç›‘æ§åŠŸèƒ½ã€‚
+ `apps`ç›®å½•ä¸‹å­˜æ”¾çš„æ˜¯æ‰©å±•çš„APIå¯¹è±¡ï¼Œä¾‹å¦‚ Deploymentã€StatefulSet ç­‰ã€‚è¿™äº›APIå¯¹è±¡æ˜¯å¯¹åŸºç¡€åŠŸèƒ½çš„æ‰©å±•ï¼Œæä¾›äº†æ›´å¤šçš„è°ƒåº¦ã€ç®¡ç†å’Œç›‘æ§åŠŸèƒ½ã€‚

æ€»ä¹‹ï¼Œ`core`ç›®å½•å’Œ`apps`ç›®å½•æ˜¯ç”¨æ¥å­˜æ”¾ä¸åŒç±»å‹çš„APIå¯¹è±¡çš„ã€‚å¦‚æœä½ æƒ³äº†è§£æŸä¸ªç‰¹å®šçš„APIå¯¹è±¡çš„è¯¦ç»†ä¿¡æ¯ï¼Œå¯ä»¥åœ¨ç›¸åº”çš„ç›®å½•ä¸‹æ‰¾åˆ°å¯¹åº”çš„æ–‡ä»¶ã€‚



**ä¸»è¦ç›®å½•çš„è§£é‡Šï¼š**

`pkg/apis`ç›®å½•æ˜¯Kubernetesæºç ä¸­ç”¨äºå­˜æ”¾APIå¯¹è±¡çš„ç›®å½•ã€‚è¿™ä¸ªç›®å½•ä¸­åŒ…å«äº†å¾ˆå¤šå­ç›®å½•ï¼Œæ¯ä¸ªå­ç›®å½•å­˜æ”¾äº†ä¸åŒç±»å‹çš„APIå¯¹è±¡ã€‚

è¿™äº›å­ç›®å½•çš„åç§°é€šå¸¸ç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼Œä¾‹å¦‚ `core/v1`ã€`apps/v1` ç­‰ã€‚å‰é¢çš„éƒ¨åˆ†è¡¨ç¤ºAPIå¯¹è±¡çš„ç±»å‹ï¼Œåé¢çš„éƒ¨åˆ†è¡¨ç¤ºAPIå¯¹è±¡çš„ç‰ˆæœ¬ã€‚

ä¸‹é¢æ˜¯ä¸€äº›å¸¸è§çš„å­ç›®å½•åŠå…¶å«ä¹‰ï¼š

+ `core/v1`ï¼šè¿™ä¸ªç›®å½•ä¸‹å­˜æ”¾çš„æ˜¯åŸºç¡€çš„APIå¯¹è±¡ï¼Œä¾‹å¦‚ Podã€Serviceã€ReplicationController ç­‰ã€‚è¿™äº›APIå¯¹è±¡æ˜¯Kubernetesçš„æ ¸å¿ƒåŠŸèƒ½ï¼Œæä¾›äº†åŸºæœ¬çš„è°ƒåº¦ã€ç®¡ç†å’Œç›‘æ§åŠŸèƒ½ã€‚
+ `apps/v1`ï¼šè¿™ä¸ªç›®å½•ä¸‹å­˜æ”¾çš„æ˜¯æ‰©å±•çš„APIå¯¹è±¡ï¼Œä¾‹å¦‚ Deploymentã€StatefulSet ç­‰

+ `batch/v1`ï¼šè¿™ä¸ªç›®å½•ä¸‹å­˜æ”¾çš„æ˜¯æ‰¹å¤„ç†ç›¸å…³çš„APIå¯¹è±¡ï¼Œä¾‹å¦‚ Jobã€CronJob ç­‰ã€‚è¿™äº›APIå¯¹è±¡ä¸»è¦ç”¨äºæ‰§è¡Œæ‰¹é‡ä»»åŠ¡ï¼Œæ”¯æŒå‘¨æœŸæ€§æ‰§è¡Œã€å¤±è´¥é‡è¯•ç­‰åŠŸèƒ½ã€‚
+ `networking.k8s.io/v1`ï¼šè¿™ä¸ªç›®å½•ä¸‹å­˜æ”¾çš„æ˜¯ç½‘ç»œç›¸å…³çš„APIå¯¹è±¡ï¼Œä¾‹å¦‚ Ingressã€Service è´Ÿè½½å‡è¡¡å™¨ç­‰ã€‚è¿™äº›APIå¯¹è±¡ä¸»è¦ç”¨äºæä¾›é›†ç¾¤å†…éƒ¨åŠå¤–éƒ¨çš„ç½‘ç»œè®¿é—®èƒ½åŠ›ã€‚
+ `extensions/v1beta1`ï¼šè¿™ä¸ªç›®å½•ä¸‹å­˜æ”¾çš„æ˜¯æ‰©å±•çš„APIå¯¹è±¡ï¼Œä¾‹å¦‚ Deploymentã€Ingress ç­‰ã€‚è¿™äº›APIå¯¹è±¡æ˜¯å¯¹åŸºç¡€åŠŸèƒ½çš„æ‰©å±•ï¼Œæä¾›äº†æ›´å¤šçš„è°ƒåº¦ã€ç®¡ç†å’Œç›‘æ§åŠŸèƒ½ã€‚

è¿™äº›å­ç›®å½•åªæ˜¯éƒ¨åˆ†ç›®å½•ï¼ŒKubernetesä¸­è¿˜æœ‰è®¸å¤šå…¶ä»–å­ç›®å½•ï¼Œæ¯ä¸ªå­ç›®å½•å­˜æ”¾çš„æ˜¯ä¸åŒç±»å‹çš„APIå¯¹è±¡ã€‚å¦‚æœä½ æƒ³äº†è§£æ›´å¤šä¿¡æ¯ï¼Œå¯ä»¥åœ¨Kubernetesæºç ä»“åº“ä¸­æŸ¥çœ‹ã€‚

> åœ¨Kubernetesæºç ä¸­ï¼ŒAPIå¯¹è±¡çš„å®šä¹‰ä¸€èˆ¬éƒ½ä½äº`pkg/apis`ç›®å½•ä¸‹ã€‚ä¾‹å¦‚ï¼ŒDeploymentå¯¹è±¡çš„å®šä¹‰å°±ä½äº`pkg/apis/apps/v1/deployment.go`æ–‡ä»¶ä¸­ã€‚
>
> å…·ä½“çš„ä½ç½®å¯èƒ½ä¼šæœ‰æ‰€ä¸åŒï¼Œä½†é€šå¸¸éƒ½åœ¨è¿™ä¸ªç›®å½•æˆ–å…¶å­ç›®å½•ä¸‹ã€‚å¦‚æœä½ æƒ³æŸ¥çœ‹æŸä¸ªç‰¹å®šçš„APIå¯¹è±¡çš„å®šä¹‰ï¼Œä½ å¯ä»¥åœ¨Kubernetesæºç ä»“åº“ä¸­æœç´¢å…³é”®å­—ï¼Œæ‰¾åˆ°å¯¹åº”çš„æ–‡ä»¶ã€‚
>
> Podå¯¹è±¡çš„å®šä¹‰ä½äºKubernetesæºç ä¸­çš„`pkg/apis/core/v1/pod.go`æ–‡ä»¶ä¸­ã€‚
>
> è¿™ä¸ªæ–‡ä»¶ä¸­å®šä¹‰äº†Podå¯¹è±¡çš„æ‰€æœ‰å­—æ®µï¼ŒåŒ…æ‹¬åç§°ã€å‘½åç©ºé—´ã€çŠ¶æ€ã€å®¹å™¨åˆ—è¡¨ç­‰ã€‚å¦‚æœä½ æƒ³äº†è§£Podå¯¹è±¡çš„æ›´å¤šç»†èŠ‚ï¼Œå¯ä»¥åœ¨è¿™ä¸ªæ–‡ä»¶ä¸­æŸ¥çœ‹ã€‚



### å…¶ä»–ç›®å½•è§£é‡Š

`pkg/apis`ç›®å½•ä¸‹çš„è¿™äº›å­ç›®å½•éƒ½æ˜¯ç”¨äºå­˜æ”¾ä¸åŒç±»å‹çš„APIå¯¹è±¡çš„ã€‚

+ `abac`ç›®å½•å­˜æ”¾çš„æ˜¯æˆæƒå’Œè®¤è¯ç›¸å…³çš„APIå¯¹è±¡ï¼Œä¾‹å¦‚ AttributePoliciesã€Policy ç­‰ã€‚
+ `admission`ç›®å½•å­˜æ”¾çš„æ˜¯å…¥é—¨ç›¸å…³çš„APIå¯¹è±¡ï¼Œä¾‹å¦‚ AdmissionConfigurationã€Webhook ç­‰ã€‚
+ `admissionregistration`ç›®å½•å­˜æ”¾çš„æ˜¯å…¥é—¨æ³¨å†Œç›¸å…³çš„APIå¯¹è±¡ï¼Œä¾‹å¦‚ InitializerConfigurationã€ValidatingWebhookConfiguration ç­‰ã€‚
+ `apidiscovery`ç›®å½•å­˜æ”¾çš„æ˜¯APIå‘ç°ç›¸å…³çš„APIå¯¹è±¡ï¼Œä¾‹å¦‚ APIGroupã€APIResourceList ç­‰ã€‚
+ `apiserverinternal`ç›®å½•å­˜æ”¾çš„æ˜¯APIæœåŠ¡å™¨å†…éƒ¨ç›¸å…³çš„APIå¯¹è±¡ï¼Œä¾‹å¦‚ GroupResourcesã€ServerResources ç­‰ã€‚
+ `authentication`ç›®å½•å­˜æ”¾çš„æ˜¯èº«ä»½éªŒè¯ç›¸å…³çš„APIå¯¹è±¡ï¼Œä¾‹å¦‚ TokenReviewã€UserInfo ç­‰ã€‚
+ `authorization`ç›®å½•å­˜æ”¾çš„æ˜¯æˆæƒç›¸å…³çš„APIå¯¹è±¡ï¼Œä¾‹å¦‚ SelfSubjectAccessReviewã€SubjectAccessReview ç­‰ã€‚
+ `autoscaling`ç›®å½•å­˜æ”¾çš„æ˜¯è‡ªåŠ¨ä¼¸ç¼©ç›¸å…³çš„APIå¯¹è±¡ï¼Œä¾‹å¦‚ HorizontalPodAutoscalerã€Scale ç­‰ã€‚
+ `certificates`ç›®å½•å­˜æ”¾çš„æ˜¯è¯ä¹¦ç›¸å…³çš„APIå¯¹è±¡ï¼Œä¾‹å¦‚ CertificateSigningRequestã€CertificateSigningRequestList ç­‰ã€‚
+ `coordination`ç›®å½•å­˜æ”¾çš„æ˜¯åè°ƒç›¸å…³çš„APIå¯¹è±¡ï¼Œä¾‹å¦‚ Leaseã€Lock ç­‰ã€‚
+ `core`ç›®å½•å­˜æ”¾çš„æ˜¯åŸºç¡€çš„APIå¯¹è±¡ï¼Œä¾‹å¦‚ Podã€Serviceã€ReplicationController
+ `discovery`ç›®å½•å­˜æ”¾çš„æ˜¯å‘ç°ç›¸å…³çš„APIå¯¹è±¡ï¼Œä¾‹å¦‚ EndpointSliceã€ServiceAccountToken ç­‰ã€‚
+ `events`ç›®å½•å­˜æ”¾çš„æ˜¯äº‹ä»¶ç›¸å…³çš„APIå¯¹è±¡ï¼Œä¾‹å¦‚ Eventã€EventList ç­‰ã€‚
+ `extensions`ç›®å½•å­˜æ”¾çš„æ˜¯æ‰©å±•çš„APIå¯¹è±¡ï¼Œä¾‹å¦‚ Deploymentã€Ingress ç­‰ã€‚
+ `flowcontrol`ç›®å½•å­˜æ”¾çš„æ˜¯æµé‡æ§åˆ¶ç›¸å…³çš„APIå¯¹è±¡ï¼Œä¾‹å¦‚ FlowSchemaã€FlowSchemaList ç­‰ã€‚
+ `imagepolicy`ç›®å½•å­˜æ”¾çš„æ˜¯é•œåƒç­–ç•¥ç›¸å…³çš„APIå¯¹è±¡ï¼Œä¾‹å¦‚ ImageReviewã€ImageReviewStatus ç­‰ã€‚
+ `networking`ç›®å½•å­˜æ”¾çš„æ˜¯ç½‘ç»œç›¸å…³çš„APIå¯¹è±¡ï¼Œä¾‹å¦‚ Ingressã€Service è´Ÿè½½å‡è¡¡å™¨ç­‰ã€‚
+ `node`ç›®å½•å­˜æ”¾çš„æ˜¯èŠ‚ç‚¹ç›¸å…³çš„APIå¯¹è±¡ï¼Œä¾‹å¦‚ Nodeã€NodeList ç­‰ã€‚
+ `OWNERS`ç›®å½•å­˜æ”¾çš„æ˜¯OWNERSæ–‡ä»¶
+ `policy`ç›®å½•å­˜æ”¾çš„æ˜¯ç­–ç•¥ç›¸å…³çš„APIå¯¹è±¡ï¼Œä¾‹å¦‚ PodDisruptionBudgetã€PodSecurityPolicy ç­‰ã€‚
+ `rbac`ç›®å½•å­˜æ”¾çš„æ˜¯åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶ï¼ˆRBACï¼‰ç›¸å…³çš„APIå¯¹è±¡ï¼Œä¾‹å¦‚ ClusterRoleã€RoleBinding ç­‰ã€‚
+ `resource`ç›®å½•å­˜æ”¾çš„æ˜¯èµ„æºç›¸å…³çš„APIå¯¹è±¡ï¼Œä¾‹å¦‚ ConfigMapã€PersistentVolume ç­‰ã€‚
+ `scheduling`ç›®å½•å­˜æ”¾çš„æ˜¯è°ƒåº¦ç›¸å…³çš„APIå¯¹è±¡ï¼Œä¾‹å¦‚ PriorityClassã€Scheduling ç­‰ã€‚
+ `storage`ç›®å½•å­˜æ”¾çš„æ˜¯å­˜å‚¨ç›¸å…³çš„APIå¯¹è±¡ï¼Œä¾‹å¦‚ StorageClassã€VolumeAttachment ç­‰ã€‚
+ `pkg/apis/apps`ç›®å½•å­˜æ”¾çš„æ˜¯Kubernetesçš„æ‰©å±•APIå¯¹è±¡ã€‚è¿™äº›APIå¯¹è±¡æ˜¯å¯¹åŸºç¡€åŠŸèƒ½çš„æ‰©å±•ï¼Œæä¾›äº†æ›´å¤šçš„è°ƒåº¦ã€ç®¡ç†å’Œç›‘æ§åŠŸèƒ½ã€‚è¿™äº›APIå¯¹è±¡ä¸»è¦ç”¨äºæ”¯æŒåº”ç”¨çš„éƒ¨ç½²ã€æ‰©å±•å’Œç®¡ç†ã€‚

> ä¾‹å¦‚ï¼Œ`pkg/apis/apps/v1`ç›®å½•ä¸‹å­˜æ”¾çš„æ˜¯Deploymentã€StatefulSetã€DaemonSetç­‰APIå¯¹è±¡ã€‚è¿™äº›APIå¯¹è±¡ä¸»è¦ç”¨äºæ”¯æŒåº”ç”¨çš„éƒ¨ç½²ã€æ‰©å±•å’Œç®¡ç†ã€‚
>
> åœ¨`pkg/apis/apps`ç›®å½•ä¸‹ï¼Œä½ ä¼šå‘ç°æœ‰è®¸å¤šå­ç›®å½•ï¼Œæ¯ä¸ªå­ç›®å½•å­˜æ”¾çš„æ˜¯ä¸åŒç‰ˆæœ¬çš„APIå¯¹è±¡ã€‚ä¾‹å¦‚ï¼Œ`pkg/apis/apps/v1`ç›®å½•ä¸‹å­˜æ”¾çš„æ˜¯Deploymentã€StatefulSetã€DaemonSetç­‰APIå¯¹è±¡çš„v1ç‰ˆæœ¬ï¼Œ`pkg/apis/apps/v1beta1`ç›®å½•ä¸‹å­˜åœ¨`pkg/apis/apps`ç›®å½•ä¸‹ï¼Œä½ ä¼šå‘ç°æœ‰è®¸å¤šå­ç›®å½•ï¼Œæ¯ä¸ªå­ç›®å½•å­˜æ”¾çš„æ˜¯ä¸åŒç‰ˆæœ¬çš„APIå¯¹è±¡ã€‚ä¾‹å¦‚ï¼Œ`pkg/apis/apps/v1`ç›®å½•ä¸‹å­˜æ”¾çš„æ˜¯Deploymentã€StatefulSetã€DaemonSetç­‰APIå¯¹è±¡çš„v1ç‰ˆæœ¬ï¼Œ`pkg/apis/apps/v1beta1`ç›®å½•ä¸‹å­˜æ”¾çš„æ˜¯Deploymentã€StatefulSetã€DaemonSetç­‰APIå¯¹è±¡çš„v1beta1ç‰ˆæœ¬ã€‚
>
> è¿™äº›å­ç›®å½•æ˜¯ä¸ºäº†æ”¯æŒKubernetesçš„å¤šç‰ˆæœ¬ç‰¹æ€§è€Œè®¾è®¡çš„ã€‚åœ¨Kubernetesä¸­ï¼ŒAPIå¯¹è±¡å¯ä»¥æœ‰å¤šä¸ªç‰ˆæœ¬ï¼Œè¿™æ ·å°±å¯ä»¥åœ¨ä¸ç ´åç°æœ‰ä»£ç çš„æƒ…å†µä¸‹ï¼Œæä¾›æ–°çš„åŠŸèƒ½å’Œæ”¹è¿›ã€‚è¿™ä½¿å¾—Kubernetesæ›´åŠ çµæ´»ï¼Œä¹Ÿä½¿å¾—Kubernetesçš„æ›´æ–°å’Œå‡çº§å˜å¾—æ›´åŠ å®¹æ˜“ã€‚
>
> åœ¨`pkg/apis/apps`ç›®å½•ä¸‹ï¼Œä½ è¿˜ä¼šå‘ç°æœ‰å¾ˆå¤šæ–‡ä»¶ï¼Œè¿™äº›æ–‡ä»¶æ˜¯Kubernetesçš„ä»£ç ç”Ÿæˆå™¨ä½¿ç”¨çš„ã€‚Kubernetesçš„ä»£ç ç”Ÿæˆå™¨æ˜¯ä¸€ç§å·¥å…·ï¼Œå¯ä»¥æ ¹æ®ç”¨æˆ·çš„è¾“å…¥ç”ŸæˆKubernetesçš„APIå¯¹è±¡ä»£ç ã€‚è¿™ä½¿å¾—Kubernetesçš„APIå¯¹è±¡å¯ä»¥æ›´åŠ å¿«é€Ÿã€ç®€å•åœ°å¼€å‘ï¼Œä¹Ÿä½¿å¾—Kubernetesçš„APIå¯¹è±¡å¯ä»¥æ›´åŠ ä¸€è‡´ã€ç»Ÿä¸€åœ°ç®¡ç†ã€‚
>
> é™¤äº†`pkg/apis/apps`ç›®å½•ï¼ŒKubernetesè¿˜æœ‰è®¸å¤šå…¶ä»–ç›®å½•ï¼Œè¿™äº›ç›®å½•ä¹Ÿæ˜¯Kubernetesçš„ä»£ç ç”Ÿæˆå™¨ä½¿ç”¨çš„ã€‚ä¾‹å¦‚ï¼Œ`pkg/apis/authorization`ç›®å½•å­˜æ”¾çš„æ˜¯è®¤è¯å’Œæˆæƒç›¸å…³çš„APIå¯¹è±¡ï¼Œ`pkg/apis/batch`ç›®å½•å­˜æ”¾çš„æ˜¯æ‰¹å¤„ç†ç›¸å…³çš„APIå¯¹è±¡ï¼Œ`pkg/apis/coordination`ç›®å½•å­˜æ”¾çš„æ˜¯åè°ƒç›¸å…³çš„APIå¯¹è±¡ç­‰ã€‚

----



### RBAC

::: details about RBAC 
åœ¨ä¸Šé¢æˆ‘ä»¬çœ‹åˆ°ï¼Œ`rbac`ç›®å½•å­˜æ”¾çš„æ˜¯åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶ï¼ˆRBACï¼‰ç›¸å…³çš„APIå¯¹è±¡ï¼Œä¾‹å¦‚ ClusterRoleã€RoleBinding ç­‰ã€‚

é‚£ä¹ˆ RBAC æ˜¯ä»€ä¹ˆå‘¢ï¼Œå®ƒæ˜¯ä¸€åŸºäºè§’è‰²çš„æƒé™æ§åˆ¶ï¼Œæˆ–è®¸ä¸‹é¢çš„ä¸€å¥è¯èƒ½å¸®åŠ©ä½ ç†è§£å®ƒï¼š

**æˆ‘ä»¬éƒ½çŸ¥é“ Kubernetes ä¸­æ‰€æœ‰çš„ APIå¯¹è±¡éƒ½ä¿å­˜åœ¨ etcd ä¸­ï¼Œå¯æ˜¯ï¼Œå¯¹äºè¿™äº› API å¯¹è±¡çš„æ“ä½œä¸€å®šæ˜¯é€šè¿‡è®¿é—® kube-apiServer å®ç°çš„ã€‚å…¶ä¸­ä¸€ä¸ªéå¸¸é‡è¦çš„åŸå› å°±æ˜¯ï¼Œéœ€è¦ API Server æ¥å¸®å¿™å·¦æˆæƒå·¥ä½œã€‚è€Œåœ¨ Kubernetes çš„é¡¹ç›®ä¸­ï¼Œè´Ÿè´£å®Œæˆæˆæƒå·¥ä½œçš„æœºåˆ¶æ˜¯ RBACã€‚âš ï¸**

soï¼Œdirectory structureï¼š

```bash
root@cubmaster01:/workspces/kubernetes/pkg/apis/rbac# ls -al
total 92
drwxr-xr-x  8 root root  4096 Jan  4 06:58 .
drwxr-xr-x 27 root root  4096 Jan  4 06:58 ..
-rw-r--r--  1 root root   698 Nov 30 03:40 doc.go
drwxr-xr-x  2 root root  4096 Nov 30 03:40 fuzzer
-rw-r--r--  1 root root 12362 Nov 30 03:40 helpers.go
-rw-r--r--  1 root root  9453 Nov 30 03:40 helpers_test.go
drwxr-xr-x  2 root root  4096 Nov 30 03:40 install
-rw-r--r--  1 root root   205 Nov 30 03:40 OWNERS
-rw-r--r--  1 root root  1811 Nov 30 03:40 register.go
-rw-r--r--  1 root root  7897 Jan  4 06:58 types.go
drwxr-xr-x  2 root root  4096 Nov 30 03:40 v1
drwxr-xr-x  2 root root  4096 Nov 30 03:40 v1alpha1
drwxr-xr-x  2 root root  4096 Nov 30 03:40 v1beta1
drwxr-xr-x  2 root root  4096 Jan  4 06:58 validation
-rw-r--r--  1 root root 11402 Dec  9 09:16 zz_generated.deepcopy.go
```

ğŸ“œ å¯¹ä¸Šé¢çš„è§£é‡Šï¼š

> + `doc.go` æ–‡ä»¶åŒ…å«å¯¹æ•´ä¸ªåŒ…çš„æ–‡æ¡£çš„å¼•ç”¨ã€‚
> + `helpers.go` æ–‡ä»¶åŒ…å«ç”¨äºå®ç° RBAC åŠŸèƒ½çš„å¸®åŠ©ç¨‹åºå‡½æ•°çš„ä»£ç ã€‚
> + `helpers_test.go` æ–‡ä»¶åŒ…å«ç”¨äºæµ‹è¯• `helpers.go` ä¸­çš„å‡½æ•°çš„ä»£ç ã€‚
> + `install` ç›®å½•åŒ…å«ç”¨äºå®‰è£… RBAC API çš„ä»£ç ã€‚
> + `OWNERS` æ–‡ä»¶åŒ…å«å¯¹è¿™ä¸ªç›®å½•çš„ç»´æŠ¤è€…çš„åˆ—è¡¨ã€‚
> + `register.go` æ–‡ä»¶åŒ…å«ç”¨äºæ³¨å†Œ RBAC API çš„ä»£ç ã€‚
> + `types.go` æ–‡ä»¶åŒ…å«ç”¨äºå®šä¹‰ RBAC API å¯¹è±¡çš„ä»£ç ã€‚
> + `validation` ç›®å½•åŒ…å«ç”¨äºéªŒè¯ RBAC API å¯¹è±¡çš„ä»£ç ã€‚
> + `v1` ç›®å½•åŒ…å« v1 ç‰ˆæœ¬çš„ RBAC API å¯¹è±¡çš„å®šä¹‰ã€‚
> + `v1alpha1` ç›®å½•åŒ…å« v1alpha1 ç‰ˆæœ¬çš„ RBAC API å¯¹è±¡çš„å®šä¹‰ã€‚
> + `v1beta1` ç›®å½•åŒ…å« v1beta1 ç‰ˆæœ¬çš„ RBAC API å¯¹è±¡çš„å®šä¹‰ã€‚
> + `fuzzer` æ–‡ä»¶åŒ…å«ç”¨äºæ‰§è¡Œæ¨¡ç³Šæµ‹è¯•çš„ä»£ç ã€‚
> + `zz_generated.deepcopy.go` æ–‡ä»¶åŒ…å«ç”¨äºç”Ÿæˆæ·±æ‹·è´å‡½æ•°çš„ä»£ç ã€‚

å¯ä»¥ä½¿ç”¨ `types.go` æ–‡ä»¶ä¸­å®šä¹‰çš„ `Role` å’Œ `RoleBinding` å¯¹è±¡æ¥åˆ›å»ºå’Œç®¡ç†è§’è‰²ã€‚æ‚¨å¯ä»¥ä½¿ç”¨ `register.go` ä¸­çš„ä»£ç æ¥æ³¨å†Œ RBAC APIï¼Œä»è€Œä½¿å…¶å¯ä»¥åœ¨é›†ç¾¤ä¸­ä½¿ç”¨ã€‚æ‚¨å¯ä»¥ä½¿ç”¨ `validation` ç›®å½•ä¸­çš„ä»£ç æ¥éªŒè¯ RBAC API å¯¹è±¡ï¼Œä»¥ç¡®ä¿å®ƒä»¬ç¬¦åˆè¦æ±‚ã€‚

è¿™äº›æ–‡ä»¶å’Œç›®å½•å…±åŒæ„æˆäº† Kubernetes ä¸­çš„ RBAC åŠŸèƒ½ã€‚RBAC åŠŸèƒ½ä½¿æ‚¨å¯ä»¥åœ¨é›†ç¾¤ä¸­åˆ›å»ºå’Œç®¡ç†è§’è‰²ï¼Œå¹¶å°†è§’è‰²åˆ†é…ç»™ç”¨æˆ·å’Œç»„ï¼Œä»è€Œæ§åˆ¶å¯¹èµ„æºçš„è®¿é—®ã€‚

:::



### OWENERS ç»´æŠ¤è€…çš„åˆ—è¡¨

+ [ğŸ” GitHub md](https://github.com/kubernetes/community/blob/master/contributors/guide/owners.md)

åœ¨ `details` å†…å®¹ä¸­ï¼Œæˆ‘ä»¬çœ‹åˆ°äº† `OWNERS` æ–‡ä»¶ï¼Œé’ˆå¯¹ Kubernetes çš„é¡¹ç›®å¯¹ç»´æŠ¤è€…çš„åˆ—è¡¨æ–‡ä»¶åšå‡ºåˆ†æï¼Œè¿™ä¸ªæ–‡ä»¶ï¼Œä¸ç®€å•ï¼ â­•

```yaml
# See the OWNERS docs at https://go.k8s.io/owners

# approval on api packages bubbles to api-approvers
reviewers:
  - sig-auth-authorizers-approvers
  - sig-auth-authorizers-reviewers
labels:
  - sig/auth
```

ğŸ“œ å¯¹ä¸Šé¢çš„è§£é‡Šï¼š

OWNERS æ–‡ä»¶é€šå¸¸åŒ…å«æœ‰å…³ç›®å½•çš„ç»´æŠ¤äººå‘˜çš„ä¿¡æ¯ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒOWNERS æ–‡ä»¶åŒ…å«æœ‰å…³ `pkg/apis/rbac` ç›®å½•çš„ç»´æŠ¤äººå‘˜çš„ä¿¡æ¯ã€‚

OWNERS æ–‡ä»¶ä¸­çš„ `reviewers` å­—æ®µåŒ…å«ä¸€ä¸ªç”¨æˆ·ååˆ—è¡¨ï¼Œè¡¨ç¤ºåœ¨è¯¥ç›®å½•ä¸­æ‰€æœ‰ä»£ç æ›´æ”¹æäº¤ä¹‹å‰å¿…é¡»æä¾›æ‰¹å‡†çš„ç”¨æˆ·ã€‚è¿™äº›ç”¨æˆ·è¢«ç§°ä¸ºå®¡æ ¸å‘˜ã€‚ä¾‹å¦‚ï¼Œåœ¨æœ¬ä¾‹ä¸­ï¼Œæ‰€æœ‰ä»£ç æ›´æ”¹éƒ½å¿…é¡»åœ¨ `sig-auth-authorizers-approvers` å’Œ `sig-auth-authorizers-reviewers` ä¸¤ä¸ªç”¨æˆ·ä¸­çš„ä¸€ä¸ªæ‰¹å‡†ä¹‹åæ‰èƒ½æäº¤ã€‚

OWNERS æ–‡ä»¶ä¸­çš„ `labels` å­—æ®µåŒ…å«ä¸€ä¸ªæ ‡ç­¾åˆ—è¡¨ï¼Œè¡¨ç¤ºä¸è¯¥ç›®å½•ç›¸å…³çš„ä¸»é¢˜æˆ–å…³æ³¨ç‚¹ã€‚è¿™äº›æ ‡ç­¾å¯ä»¥å¸®åŠ©æ‚¨å¿«é€Ÿäº†è§£è¯¥ç›®å½•æ‰€å…³æ³¨çš„å†…å®¹ã€‚ä¾‹å¦‚ï¼Œåœ¨æœ¬ä¾‹ä¸­ï¼Œè¯¥ç›®å½•ä¸ `sig/auth` ä¸»é¢˜æœ‰å…³ã€‚

OWNERS æ–‡ä»¶æ˜¯ç”¨äºæè¿°ä¸ç›®å½•ç›¸å…³çš„ä¿¡æ¯çš„æ–‡ä»¶ï¼Œä¾‹å¦‚å®¡æ ¸å‘˜å’Œå…³æ³¨ç‚¹ã€‚è¿™äº›ä¿¡æ¯æœ‰åŠ©äºåè°ƒå’Œç®¡ç†è¯¥ç›®å½•ä¸­çš„ä»£ç ã€‚



â“ æˆ‘ä»¬æåˆ°äº†ä»£ç ç”Ÿæˆå™¨ï¼Œå…¶å®å† ã€Šæ·±å…¥è§£æKubernetesçš„æºç ã€‹ è¿™æœ¬ä¹¦ä¸­ï¼Œæˆ‘ä»¬äº†è§£åˆ°äº†ä»£ç ç”Ÿæˆå™¨ï¼Œä½†æ˜¯ä¹¦ä¸­å†™çš„é€»è¾‘ä¸æ˜¯å¾ˆæ¸…æ™°ï¼Œå¯¼è‡´å¯¹ ä»£ç ç”Ÿæˆå™¨ çš„ç†è§£ä¸æ˜¯å¾ˆé€å½»~

> ğŸ­ æ‰€ä»¥è¿˜æ˜¯æ¨èçœ‹ ã€Šæ·±å…¥å‰–æKubernetesã€‹



### ä»£ç ç”Ÿæˆå™¨

Kubernetesçš„ä»£ç ç”Ÿæˆå™¨æ˜¯ä¸€ç§å·¥å…·ï¼Œç”¨äºç”ŸæˆKubernetesçš„APIå¯¹è±¡ä»£ç ã€‚å®ƒå¯ä»¥æ ¹æ®ç”¨æˆ·çš„è¾“å…¥ï¼Œè‡ªåŠ¨ç”ŸæˆKubernetes APIå¯¹è±¡çš„ Go ä»£ç ã€‚Kubernetesçš„ä»£ç ç”Ÿæˆå™¨ä½¿ç”¨äº†ä¸€ç§å«åš OpenAPI çš„æŠ€æœ¯ï¼Œå¯ä»¥é€šè¿‡å®šä¹‰ API å¯¹è±¡çš„æ¨¡å‹æ¥ç”Ÿæˆä»£ç ã€‚

Kubernetesçš„ä»£ç ç”Ÿæˆå™¨æœ‰è®¸å¤šä¼˜ç‚¹ï¼Œä¾‹å¦‚ï¼š

+ å‡å°‘é‡å¤å·¥ä½œï¼šä½¿ç”¨ä»£ç ç”Ÿæˆå™¨ï¼Œå¯ä»¥å‡å°‘æ‰‹å†™ä»£ç çš„å·¥ä½œé‡ã€‚
+ æé«˜ä»£ç è´¨é‡ï¼šä½¿ç”¨ä»£ç ç”Ÿæˆå™¨ï¼Œå¯ä»¥ä¿è¯ç”Ÿæˆçš„ä»£ç è´¨é‡æ›´é«˜ï¼Œå› ä¸ºå®ƒæ˜¯æ ¹æ®æ¨¡æ¿ç”Ÿæˆçš„ã€‚
+ ä¿è¯ä»£ç ä¸€è‡´æ€§ï¼šä½¿ç”¨ä»£ç ç”Ÿæˆå™¨ï¼Œå¯ä»¥ä¿è¯ç”Ÿæˆçš„ä»£ç é£æ ¼ä¸€è‡´ï¼Œå› ä¸ºå®ƒæ˜¯æ ¹æ®æ¨¡æ¿ç”Ÿæˆçš„ã€‚

Kubernetesçš„ä»£ç ç”Ÿæˆå™¨å¯¹Kubernetesçš„ä½œç”¨éå¸¸é‡è¦ï¼Œå®ƒä½¿å¾—Kubernetesçš„APIå¯¹è±¡å¯ä»¥æ›´åŠ å¿«é€Ÿã€ç®€å•åœ°å¼€å‘ï¼Œä¹Ÿä½¿å¾—Kubernetesçš„APIå¯¹è±¡å¯ä»¥æ›´åŠ ä¸€è‡´ã€ç»Ÿä¸€åœ°ç®¡ç†ã€‚

é€šè¿‡ä½¿ç”¨ä»£ç ç”Ÿæˆå™¨ï¼ŒKubernetesçš„å¼€å‘äººå‘˜å¯ä»¥ä¸“æ³¨äºAPIå¯¹è±¡çš„ä¸šåŠ¡é€»è¾‘ï¼Œè€Œä¸å¿…æ‹…å¿ƒåº•å±‚å®ç°ç»†èŠ‚ã€‚è¿™å¤§å¤§é™ä½äº†å¼€å‘éš¾åº¦ï¼Œä¹Ÿæé«˜äº†å¼€å‘æ•ˆç‡ã€‚

æ­¤å¤–ï¼Œä½¿ç”¨ä»£ç ç”Ÿæˆå™¨è¿˜å¯ä»¥ä¿è¯Kubernetesçš„APIå¯¹è±¡ä»£ç è´¨é‡æ›´é«˜ï¼Œå› ä¸ºå®ƒæ˜¯æ ¹æ®æ¨¡æ¿ç”Ÿæˆçš„ã€‚è¿™èƒ½å¤Ÿé¿å…äººä¸ºç–å¿½å¯¼è‡´çš„ä»£ç é”™è¯¯ï¼Œä½¿å¾—Kubernetesçš„APIå¯¹è±¡æ›´åŠ å¯é ã€‚

æ€»çš„æ¥è¯´ï¼ŒKubernetesçš„ä»£ç ç”Ÿæˆå™¨æ˜¯ä¸€ç§éå¸¸æœ‰ç”¨çš„å·¥å…·ï¼Œå®ƒä¸ºKubernetesçš„APIå¯¹è±¡çš„å¼€å‘å’Œç®¡ç†å¸¦æ¥äº†å¾ˆå¤šä¾¿åˆ©ã€‚



`Kubernetes`æºç ä¸­çš„ä»£ç ç”Ÿæˆå™¨ä¾‹å­ï¼Œä»¥åŠå®ƒä»¬æ‰€åœ¨çš„åœ°å€ç›®å½•ï¼š

+ Deploymentä»£ç ç”Ÿæˆå™¨ï¼š`pkg/apis/apps/v1/codegen`
+ Serviceä»£ç ç”Ÿæˆå™¨ï¼š`pkg/apis/core/v1/codegen`
+ Podä»£ç ç”Ÿæˆå™¨ï¼š`pkg/apis/core/v1/codegen`
+ ReplicationControllerä»£ç ç”Ÿæˆå™¨ï¼š`pkg/apis/core/v1/codegen`
+ Jobä»£ç ç”Ÿæˆå™¨ï¼š`pkg/apis/batch/v1/codegen`
+ CronJobä»£ç ç”Ÿæˆå™¨ï¼š`pkg/apis/batch/v1beta1/codegen`



::: danger æé†’
æ›´å¤šå…³äºä»£ç ç”Ÿæˆå™¨çš„çŸ¥è¯†ï¼Œæ¨èé˜…è¯»ï¼š

+ [Kubernetes Deep Diveï¼šCustomResources çš„ä»£ç ç”Ÿæˆ](https://cloud.redhat.com/blog/kubernetes-deep-dive-code-generation-customresources)

## staging

è¿™ä¸ªç›®å½•å‡†ç¡®æ¥è¯´æ˜¯å­˜æ”¾æ ¸å¿ƒç»„ä»¶çš„ï¼Œä½†æ˜¯æ˜¯ä¸´æ—¶å­˜å‚¨çš„ï¼Œæˆ‘ä»¬å¯ä»¥å‚è€ƒ [README.md](https://github.com/kubernetes/kubernetes/tree/master/staging) æ–‡ä»¶

æ­¤ç›®å½•æ˜¯å·²æ‹†åˆ†åˆ°è‡ªå·±çš„å­˜å‚¨åº“çš„åŒ…çš„æš‚å­˜åŒºã€‚è¿™é‡Œçš„å†…å®¹å°†å®šæœŸå‘å¸ƒåˆ°å„è‡ªçš„é¡¶çº§ k8s.io å­˜å‚¨åº“ã€‚



ç›®å‰åœ¨æ­¤å¤„æš‚å­˜çš„å­˜å‚¨åº“ï¼š

+ [`k8s.io/api`](https://github.com/kubernetes/api)
+ [`k8s.io/apiextensions-apiserver`](https://github.com/kubernetes/apiextensions-apiserver)
+ [`k8s.io/apimachinery`](https://github.com/kubernetes/apimachinery)
+ [`k8s.io/apiserver`](https://github.com/kubernetes/apiserver)
+ [`k8s.io/cli-runtime`](https://github.com/kubernetes/cli-runtime)
+ [`k8s.io/client-go`](https://github.com/kubernetes/client-go)
+ [`k8s.io/cloud-provider`](https://github.com/kubernetes/cloud-provider)
+ [`k8s.io/cluster-bootstrap`](https://github.com/kubernetes/cluster-bootstrap)
+ [`k8s.io/code-generator`](https://github.com/kubernetes/code-generator)
+ [`k8s.io/component-base`](https://github.com/kubernetes/component-base)
+ [`k8s.io/component-helpers`](https://github.com/kubernetes/component-helpers)
+ [`k8s.io/controller-manager`](https://github.com/kubernetes/controller-manager)
+ [`k8s.io/cri-api`](https://github.com/kubernetes/cri-api)
+ [`k8s.io/csi-translation-lib`](https://github.com/kubernetes/csi-translation-lib)
+ [`k8s.io/kms`](https://github.com/kubernetes/kms)
+ [`k8s.io/kube-aggregator`](https://github.com/kubernetes/kube-aggregator)
+ [`k8s.io/kube-controller-manager`](https://github.com/kubernetes/kube-controller-manager)
+ [`k8s.io/kube-proxy`](https://github.com/kubernetes/kube-proxy)
+ [`k8s.io/kube-scheduler`](https://github.com/kubernetes/kube-scheduler)
+ [`k8s.io/kubectl`](https://github.com/kubernetes/kubectl)
+ [`k8s.io/kubelet`](https://github.com/kubernetes/kubelet)
+ [`k8s.io/legacy-cloud-providers`](https://github.com/kubernetes/legacy-cloud-providers)
+ [`k8s.io/metrics`](https://github.com/kubernetes/metrics)
+ [`k8s.io/mount-utils`](https://github.com/kubernetes/mount-utils)
+ [`k8s.io/noderesourcetopology-api`](https://github.com/kubernetes/noderesourcetopology-api)
+ [`k8s.io/pod-security-admission`](https://github.com/kubernetes/pod-security-admission)
+ [`k8s.io/sample-apiserver`](https://github.com/kubernetes/sample-apiserver)
+ [`k8s.io/sample-cli-plugin`](https://github.com/kubernetes/sample-cli-plugin)
+ [`k8s.io/sample-controller`](https://github.com/kubernetes/sample-controller)

`staging/` ç›®å½•ä¸­çš„ä»£ç æ˜¯æƒå¨çš„ï¼Œå³ä»£ç çš„å”¯ä¸€å‰¯æœ¬ã€‚æ‚¨å¯ä»¥ç›´æ¥ä¿®æ”¹æ­¤ç±»ä»£ç ã€‚



### ä½¿ç”¨ Kubernetes ä»£ç ä¸­çš„æš‚å­˜å­˜å‚¨åº“

Kubernetes ä»£ç é€šè¿‡ç›®å½•ä¸­çš„ç¬¦å·é“¾æ¥ä½¿ç”¨æ­¤ç›®å½•ä¸­çš„å­˜å‚¨åº“ `vendor/k8s.io`åˆ°æ­¤æš‚å­˜åŒºåŸŸã€‚ä¾‹å¦‚ï¼Œå½“ Kubernetes ä»£ç ä»`k8s.io/client-go`å­˜å‚¨åº“å¯¼å…¥ä¸€ä¸ªåŒ…æ—¶ï¼Œè¯¥å¯¼å…¥è¢«è§£æä¸º`staging/src/k8s.io/client-go`ç›¸å¯¹äºé¡¹ç›®æ ¹ç›®å½•ï¼š

```go
// pkg/example/some_code.go
package example

import (
  "k8s.io/client-go/dynamic" // resolves to staging/src/k8s.io/client-go/dynamic
)
```

ä¸€æ—¦å®Œæˆå‘å¤–éƒ¨å­˜å‚¨åº“çš„è½¬æ¢ï¼Œè¿™äº›å­˜å‚¨åº“å®é™…ä¸Šå°†ç”±`k8s.io/<package-name>`.



## src/k8s

src/k8s.io/ç›®å½•æ˜¯Kubernetesé¡¹ç›®çš„æ ¹ç›®å½•ï¼ŒåŒ…å«äº†Kubernetesç³»ç»Ÿçš„æ‰€æœ‰æºä»£ç ã€‚è¿™æ˜¯src/k8s.io/ç›®å½•çš„é«˜å±‚ç»“æ„ï¼š

```bash
root@cubmaster01:/workspces/kubernetes/staging/src/k8s.io# tree -L 1
.
â”œâ”€â”€ api
â”œâ”€â”€ apiextensions-apiserver
â”œâ”€â”€ apimachinery
â”œâ”€â”€ apiserver
â”œâ”€â”€ client-go
â”œâ”€â”€ cli-runtime
â”œâ”€â”€ cloud-provider
â”œâ”€â”€ cluster-bootstrap
â”œâ”€â”€ code-generator
â”œâ”€â”€ component-base
â”œâ”€â”€ component-helpers
â”œâ”€â”€ controller-manager
â”œâ”€â”€ cri-api
â”œâ”€â”€ csi-translation-lib
â”œâ”€â”€ dynamic-resource-allocation
â”œâ”€â”€ kms
â”œâ”€â”€ kube-aggregator
â”œâ”€â”€ kube-controller-manager
â”œâ”€â”€ kubectl
â”œâ”€â”€ kubelet
â”œâ”€â”€ kube-proxy
â”œâ”€â”€ kube-scheduler
â”œâ”€â”€ legacy-cloud-providers
â”œâ”€â”€ metrics
â”œâ”€â”€ mount-utils
â”œâ”€â”€ noderesourcetopology-api
â”œâ”€â”€ pod-security-admission
â”œâ”€â”€ sample-apiserver
â”œâ”€â”€ sample-cli-plugin
â””â”€â”€ sample-controller
```



**ç›®å½•åŠŸèƒ½ï¼š**

+ `api/`ç›®å½•åŒ…å«Kubernetes APIçš„å®šä¹‰ã€‚
+ `apiextensions-apiserver/`ç›®å½•åŒ…å«ç”¨äºæ‰©å±•Kubernetes APIçš„ä»£ç ã€‚
+ `apimachinery/`ç›®å½•åŒ…å«ç”¨äºæ„å»ºKubernetes APIçš„å·¥å…·ã€‚
+ `apiserver/`ç›®å½•åŒ…å«Kubernetes APIæœåŠ¡å™¨çš„æºä»£ç ã€‚
+ `client-go/`ç›®å½•åŒ…å«ç”¨äºè®¿é—®Kubernetes APIçš„å®¢æˆ·ç«¯åº“ã€‚
+ `cli-runtime/`ç›®å½•åŒ…å«ç”¨äºæ‰©å±•kubectlçš„åº“ã€‚
+ `cloud-provider/`ç›®å½•åŒ…å«ç”¨äºæ”¯æŒäº‘å¹³å°çš„ä»£ç ã€‚
+ `cluster-bootstrap/`ç›®å½•åŒ…å«ç”¨äºå¼•å¯¼æ–°é›†ç¾¤çš„å·¥å…·ã€‚
+ `code-generator/`ç›®å½•åŒ…å«ç”¨äºç”ŸæˆKubernetesä»£ç çš„å·¥å…·ã€‚
+ `component-base/`ç›®å½•åŒ…å«Kubernetesç»„ä»¶çš„åŸºç¡€åº“ã€‚
+ `component-helpers/`ç›®å½•åŒ…å«ç”¨äºå¸®åŠ©æ„å»ºKubernetesç»„ä»¶çš„åº“ã€‚
+ `controller-manager/`ç›®å½•åŒ…å«Kubernetesæ§åˆ¶å™¨ç®¡ç†å™¨çš„ä»£ç ã€‚
+ `csi-translation-lib/`ç›®å½•åŒ…å«ç”¨äºåœ¨Kuberneteså’Œå®¹å™¨å­˜å‚¨æ¥å£(CSI)ä¹‹é—´è¿›è¡Œè½¬æ¢çš„åº“ã€‚
+ `cri-api/`ç›®å½•åŒ…å«ç”¨äºè¿è¡Œå®¹å™¨çš„ä»£ç ã€‚
+ `dynamic-resource-allocation/`ç›®å½•åŒ…å«ç”¨äºåŠ¨æ€åˆ†é…èµ„æºçš„ä»£ç ã€‚
+ `kms/`ç›®å½•åŒ…å«ç”¨äºç®¡ç†åŠ å¯†å¯†é’¥çš„ä»£ç ã€‚
+ `kube-aggregator/`ç›®å½•åŒ…å«ç”¨äºæä¾›èšåˆAPIæœåŠ¡å™¨çš„ä»£ç ã€‚
+ `kube-controller-manager/`ç›®å½•åŒ…å«Kubernetesæ§åˆ¶å™¨ç®¡ç†å™¨çš„ä»£ç ã€‚
+ `kubectl/`ç›®å½•åŒ…å«kubectlå‘½ä»¤è¡Œå·¥å…·çš„æºä»£ç ã€‚
+ `kubelet/`ç›®å½•åŒ…å«kubeletçš„æºä»£ç ã€‚
+ `kube-proxy/`ç›®å½•åŒ…å«Kubernetesä»£ç†çš„ä»£ç ã€‚
+ `kube-scheduler/`ç›®å½•åŒ…å«Kubernetesè°ƒåº¦ç¨‹åºçš„ä»£ç ã€‚
+ `legacy-cloud-providers/`ç›®å½•åŒ…å«å·²åºŸå¼ƒçš„äº‘æä¾›å•†ä»£ç ã€‚
+ `metrics/`ç›®å½•åŒ…å«ç”¨äºæ”¶é›†Kubernetesåº¦é‡æŒ‡æ ‡çš„ä»£ç ã€‚
+ `mount-utils/`ç›®å½•åŒ…å«ç”¨äºæŒ‚è½½æ–‡ä»¶ç³»ç»Ÿçš„å·¥å…·ã€‚
+ `noderesourcetopology-api/`ç›®å½•åŒ…å«ç”¨äºæè¿°èŠ‚ç‚¹èµ„æºæ‹“æ‰‘ç»“æ„çš„APIã€‚
+ `pod-security-admission/`ç›®å½•åŒ…å«ç”¨äºæ§åˆ¶podå®‰å…¨æ€§çš„ä»£ç ã€‚
+ `sample-apiserver/`ç›®å½•åŒ…å«Kubernetesç¤ºä¾‹APIæœåŠ¡å™¨çš„ä»£ç ã€‚
+ `sample-cli-plugin/`ç›®å½•åŒ…å«ç”¨äºæ‰©å±•kubectlçš„ç¤ºä¾‹æ’ä»¶çš„ä»£ç ã€‚
+ `sample-controller/`ç›®å½•åŒ…å«Kubernetesç¤ºä¾‹æ§åˆ¶å™¨çš„ä»£ç ã€‚



### staging/src/k8s.io/api/

```bash
root@cubmaster01:/workspces/kubernetes/staging/src/k8s.io# ls api
admission              authorization       coordination  flowcontrol  node       roundtrip_test.go
admissionregistration  autoscaling         core          go.mod       OWNERS     scheduling
apidiscovery           batch               discovery     go.sum       policy     SECURITY_CONTACTS
apiserverinternal      certificates        doc.go        imagepolicy  rbac       storage
apps                   code-of-conduct.md  events        LICENSE      README.md  testdata
authentication         CONTRIBUTING.md     extensions    networking   resource
```



**åŠŸèƒ½ï¼š**

+ `admission/`ç›®å½•åŒ…å«ä»£ç ï¼Œç”¨äºæ§åˆ¶å¯¹èµ„æºçš„è®¿é—®ã€‚
+ `admissionregistration/`ç›®å½•åŒ…å«ä»£ç ï¼Œç”¨äºæ³¨å†Œèµ„æºè®¿é—®æ§åˆ¶ç»„ä»¶ã€‚
+ `apidiscovery/`ç›®å½•åŒ…å«ä»£ç ï¼Œç”¨äºæè¿°Kubernetes APIçš„å‘ç°æœºåˆ¶ã€‚
+ `apiserverinternal/`ç›®å½•åŒ…å«ä»£ç ï¼Œç”¨äºå®ç°Kubernetes APIæœåŠ¡å™¨çš„å†…éƒ¨åŠŸèƒ½ã€‚
+ `apps/`ç›®å½•åŒ…å«ä»£ç ï¼Œç”¨äºç®¡ç†åº”ç”¨ç¨‹åºèµ„æºã€‚
+ `authentication/`ç›®å½•åŒ…å«ä»£ç ï¼Œç”¨äºæ§åˆ¶èº«ä»½éªŒè¯ã€‚
+ `authorization/`ç›®å½•åŒ…å«ä»£ç ï¼Œç”¨äºæ§åˆ¶æˆæƒã€‚
+ `autoscaling/`ç›®å½•åŒ…å«ä»£ç ï¼Œç”¨äºæ§åˆ¶èµ„æºçš„è‡ªåŠ¨æ‰©å±•ã€‚
+ `batch/`ç›®å½•åŒ…å«ä»£ç ï¼Œç”¨äºç®¡ç†æ‰¹å¤„ç†èµ„æºã€‚
+ `certificates/`ç›®å½•åŒ…å«ä»£ç ï¼Œç”¨äºç®¡ç†è¯ä¹¦èµ„æºã€‚
+ `coordination/`ç›®å½•åŒ…å«ä»£ç ï¼Œç”¨äºç®¡ç†åˆ†å¸ƒå¼åè°ƒèµ„æºã€‚
+ `core/`ç›®å½•åŒ…å«ä»£ç ï¼Œç”¨äºç®¡ç†æ ¸å¿ƒèµ„æºã€‚
+ `rbac/`ç›®å½•åŒ…å«ä»£ç ï¼Œç”¨äºç®¡ç†è§’è‰²åŸºæœ¬è®¿é—®æ§åˆ¶(RBAC)èµ„æºã€‚
+ `scheduling/`ç›®å½•åŒ…å«ä»£ç ï¼Œç”¨äºç®¡ç†è°ƒåº¦èµ„æºã€‚
+ `storage/`ç›®å½•åŒ…å«ä»£ç ï¼Œç”¨äºç®¡ç†å­˜å‚¨èµ„æºã€‚

é™¤äº†è¿™äº›ç›®å½•ä¹‹å¤–ï¼Œè¿˜æœ‰ä¸€äº›æ–‡ä»¶ï¼Œå®ƒä»¬ä¹Ÿæ˜¯é‡è¦çš„éƒ¨åˆ†ï¼š

+ `doc.go`æ˜¯æ–‡æ¡£çš„å…¥å£æ–‡ä»¶ã€‚
+ `go.mod`å’Œ`go.sum`æ˜¯Goçš„ä¾èµ–ç®¡ç†æ–‡ä»¶ã€‚
+ `LICENSE`æ–‡ä»¶åŒ…å«Kubernetesä½¿ç”¨çš„è®¸å¯è¯ã€‚
+ `OWNERS`æ–‡ä»¶åŒ…å«è´Ÿè´£ç»´æŠ¤ç›®å½•çš„äººå‘˜åˆ—è¡¨ã€‚
+ `README.md`æ–‡ä»¶åŒ…å«æœ‰å…³ç›®å½•çš„ä¿¡æ¯ã€‚
+ `SECURITY_CONTACTS`æ–‡ä»¶åŒ…å«æœ‰å…³å®‰å…¨é—®é¢˜çš„è”ç³»äººåˆ—è¡¨ã€‚
+ `testdata/`ç›®å½•åŒ…å«æµ‹è¯•æ•°æ®ã€‚
+ `code-of-conduct.md`æ–‡ä»¶åŒ…å«æœ‰å…³Kubernetesç¤¾åŒºè¡Œä¸ºå‡†åˆ™çš„ä¿¡æ¯ã€‚
+ `CONTRIBUTING.md`æ–‡ä»¶åŒ…å«æœ‰å…³å¦‚ä½•ä¸ºKubernetesè´¡çŒ®ä»£ç çš„ä¿¡æ¯ã€‚
+ `roundtrip_test.go`æ–‡ä»¶åŒ…å«ç”¨äºæµ‹è¯•çš„ä»£ç ã€‚



**âš ï¸ ğŸ“œ å¯¹ä¸Šé¢çš„è§£é‡Šï¼š**

> æˆ‘ä»¬å¯ä»¥è¿›ä¸€æ­¥å†è§‚å¯Ÿ `apps` ç›®å½•ï¼Œè¿™ä¸ªåç§°å¾ˆçœ¼ç†Ÿï¼Œpkg/apis/apps/ ç›®å½•å’Œ staging/src/k8s.io/api/apps/ å®ƒä»¬çš„ç›®å½•ç»“æ„å¾ˆæ¥è¿‘ï¼Œè¯·é—®å®ƒä»¬æœ‰ä»€ä¹ˆä¸ä¸€æ ·ï¼Œæˆ‘æƒ³äº†è§£å®ƒä»¬çš„å¯¹æ¯”è€ŒåŠ æ·±å¯¹å®ƒä»¬çš„ç†è§£



## pkg/apis/apps/ ç›®å½•å’Œ staging/src/k8s.io/api/apps/ç›®å½•

pkg/apis/å’Œstaging/src/k8s.io/api/ç›®å½•éƒ½æ˜¯Kubernetesæºç çš„ä¸€éƒ¨åˆ†ã€‚å®ƒä»¬ä¹‹é—´çš„ä¸»è¦åŒºåˆ«æ˜¯ï¼Œpkg/apis/ç›®å½•ä¸‹çš„ä»£ç æ›´åŠ æŠ½è±¡ï¼Œé€šå¸¸æ˜¯ç”±staging/src/k8s.io/api/ç›®å½•ä¸‹çš„ä»£ç å®ç°çš„ã€‚

åœ¨Kubernetesä¸­ï¼Œpkg/apis/ç›®å½•ä¸‹çš„ä»£ç å®šä¹‰äº†APIèµ„æºçš„æŠ½è±¡æ¥å£ã€‚è¿™äº›æ¥å£æè¿°äº†èµ„æºçš„ç±»å‹ã€å­—æ®µå’Œæ“ä½œï¼Œä½†æ²¡æœ‰å®ç°å…·ä½“çš„é€»è¾‘ã€‚ç›¸åï¼Œstaging/src/k8s.io/api/ç›®å½•ä¸‹çš„ä»£ç å®ç°äº†è¿™äº›æ¥å£ã€‚è¿™äº›å®ç°æä¾›äº†èµ„æºçš„å…·ä½“åŠŸèƒ½ï¼Œå¹¶å°†å…¶ä¸Kubernetesç³»ç»Ÿçš„å…¶ä»–éƒ¨åˆ†é›†æˆåœ¨ä¸€èµ·ã€‚

ä¾‹å¦‚ï¼Œpkg/apis/apps/ç›®å½•ä¸‹å®šä¹‰äº†ä¸€ç»„æ¥å£ï¼Œç”¨äºè¡¨ç¤ºåº”ç”¨ç¨‹åºèµ„æºã€‚ staging/src/k8s.io/api/apps/ç›®å½•ä¸‹çš„ä»£ç å®ç°äº†è¿™äº›æ¥å£ï¼Œå¹¶æä¾›äº†åº”ç”¨ç¨‹åºèµ„æºçš„å…·ä½“åŠŸèƒ½ã€‚



**ä¸ºäº†è·Ÿæ¸…æ¥šçš„äº†è§£ï¼Œæˆ‘æˆªå–äº†å®ƒä»¬çš„ç›®å½•ç»“æ„ï¼š**

![image-20230107141113159](http://sm.nsddd.top/sm202301071411550.png)



**æ€»ç»“ï¼š**

1. pkg/apis/apps/ç›®å½•å’Œstaging/src/k8s.io/api/apps/ç›®å½•éƒ½æ˜¯Kubernetesæºç çš„ä¸€éƒ¨åˆ†ã€‚å®ƒä»¬éƒ½æ˜¯ç”¨äºç®¡ç†åº”ç”¨ç¨‹åºèµ„æºçš„ä»£ç ã€‚
2. pkg/apis/apps/ç›®å½•ä¸­çš„ä»£ç å®šä¹‰äº†æŠ½è±¡çš„APIæ¥å£ï¼Œç”¨äºæè¿°åº”ç”¨ç¨‹åºèµ„æºçš„ç±»å‹ã€å­—æ®µå’Œæ“ä½œã€‚å®ƒå¹¶æ²¡æœ‰æä¾›èµ„æºçš„å…·ä½“åŠŸèƒ½ã€‚
3. staging/src/k8s.io/api/apps/ç›®å½•ä¸­çš„ä»£ç å®ç°äº†pkg/apis/apps/ç›®å½•ä¸­çš„æ¥å£ã€‚å®ƒæä¾›äº†åº”ç”¨ç¨‹åºèµ„æºçš„å…·ä½“åŠŸèƒ½ï¼Œå¹¶å°†å…¶ä¸Kubernetesç³»ç»Ÿçš„å…¶ä»–éƒ¨åˆ†é›†æˆåœ¨ä¸€èµ·ã€‚
4. æ€»çš„æ¥è¯´ï¼Œpkg/apis/ç›®å½•ä¸­çš„ä»£ç æ˜¯Kubernetesä¸­APIèµ„æºçš„æŠ½è±¡æ¥å£ï¼Œè€Œstaging/src/k8s.io/api/ç›®å½•ä¸­çš„ä»£ç åˆ™æ˜¯è¿™äº›æ¥å£çš„å…·ä½“å®ç°ã€‚





## cmd

**cmd ç®—æ˜¯ å…¥å£ï¼Œä¹Ÿæ˜¯å‘½ä»¤è¡Œçš„å®šä¹‰åœ°æ–¹ã€‚**

```bash
root@cubmaster01:~/go/src/k8s.io/kubernetes# tree -L 1 cmd
cmd
â”œâ”€â”€ clicheck
â”œâ”€â”€ cloud-controller-manager
â”œâ”€â”€ dependencycheck
â”œâ”€â”€ dependencyverifier
â”œâ”€â”€ gendocs
â”œâ”€â”€ genkubedocs
â”œâ”€â”€ genman
â”œâ”€â”€ genswaggertypedocs
â”œâ”€â”€ genutils
â”œâ”€â”€ genyaml
â”œâ”€â”€ importverifier
â”œâ”€â”€ kubeadm
â”œâ”€â”€ kube-apiserver
â”œâ”€â”€ kube-controller-manager
â”œâ”€â”€ kubectl
â”œâ”€â”€ kubectl-convert
â”œâ”€â”€ kubelet
â”œâ”€â”€ kubemark
â”œâ”€â”€ kube-proxy
â”œâ”€â”€ kube-scheduler
â”œâ”€â”€ linkcheck
â”œâ”€â”€ OWNERS
â”œâ”€â”€ preferredimports
â”œâ”€â”€ prune-junit-xml
â””â”€â”€ yamlfmt
```

::: tip 
`kube-apiserver` ä¸­æœ‰ `apiserver.go` æ–‡ä»¶ï¼Œå°±æ˜¯ `apiserver` å¯åŠ¨å…¥å£

:::

cmd æœ‰å¾ˆå¤šçš„å­ç›®å½•ï¼Œä¸åŒçš„å­ç›®å½•éƒ½å¯¹åº”çš„æ¥å£ï¼Œæ¯”å¦‚ä¸Šé¢çš„ `API Server`

æˆ‘ä»¬ç”šè‡³å¯ä»¥ç›´æ¥åœ¨é‡Œé¢ `go build` ï¼š

```bash
â¯ cd cmd/kube-apiserver;ls
apiserver.go  app  OWNERS
â¯ go build apiserver.go
```



**ä¸è¿‡ä¸€èˆ¬ä½¿ç”¨ åŠŸèƒ½å¼ºå¤§ çš„ Makefile ï¼Œè€Œä¸”Makefileæ”¯æŒäº¤å‰ç¼–è¯‘ã€‚**

Kubernetes æ˜¯å¾ˆå¤šç»„ä»¶çš„ äºŒè¿›åˆ¶ ç›¸äº’é…åˆ éƒ¨ç½²èµ·æ¥çš„ã€‚



### kube-apiserver

ä»¥ kube-apiserver cmd ç›®å½•ä¸ºä¾‹ï¼š

![image-20230303135004177](http://sm.nsddd.top/sm202303031350297.png)

ğŸ“œ å¯¹ä¸Šé¢çš„è§£é‡Šï¼š

+ `options` ï¼š ä¸€èˆ¬é‡Œé¢çš„ options æ˜¯è§£æ å…¥å‚ï¼Œå¹¶ä¸”è¿›è¡Œå…¥å‚æ ¡éªŒ
+ é‡Œé¢çš„æ ¸å¿ƒéƒ½æ˜¯è°ƒåˆ° `pkg/*` ä¸‹é¢çš„ï¼Œæ¯”å¦‚è¯´ apiã€apiså¯¹è±¡



## build

```bash
root@cubmaster01:~/go/src/k8s.io/kubernetes# tree -L 1 build
build
â”œâ”€â”€ build-image
â”œâ”€â”€ common.sh
â”œâ”€â”€ copy-output.sh
â”œâ”€â”€ dependencies.yaml
â”œâ”€â”€ lib
â”œâ”€â”€ make-build-image.sh
â”œâ”€â”€ make-clean.sh
â”œâ”€â”€ nsswitch.conf
â”œâ”€â”€ OWNERS
â”œâ”€â”€ package-tarballs.sh
â”œâ”€â”€ pause
â”œâ”€â”€ README.md
â”œâ”€â”€ release-images.sh
â”œâ”€â”€ release-in-a-container.sh
â”œâ”€â”€ release.sh
â”œâ”€â”€ root
â”œâ”€â”€ run.sh
â”œâ”€â”€ server-image
â”œâ”€â”€ shell.sh
â”œâ”€â”€ tools.go
â””â”€â”€ util.sh
```



## vendor

```bash
root@cubmaster01:~/go/src/k8s.io/kubernetes# tree -L 1 vendor/
vendor/
â”œâ”€â”€ bitbucket.org
â”œâ”€â”€ cloud.google.com
â”œâ”€â”€ github.com
â”œâ”€â”€ go.etcd.io
â”œâ”€â”€ golang.org
â”œâ”€â”€ gonum.org
â”œâ”€â”€ google.golang.org
â”œâ”€â”€ go.opencensus.io
â”œâ”€â”€ go.opentelemetry.io
â”œâ”€â”€ gopkg.in
â”œâ”€â”€ go.starlark.net
â”œâ”€â”€ go.uber.org
â”œâ”€â”€ k8s.io
â”œâ”€â”€ modules.txt
â”œâ”€â”€ OWNERS
â””â”€â”€ sigs.k8s.io
```





## hack

```bash
root@cubmaster01:~/go/src/k8s.io/kubernetes# tree -L 1 hack/
hack/
â”œâ”€â”€ benchmark-go.sh
â”œâ”€â”€ boilerplate
â”œâ”€â”€ build-cross.sh
â”œâ”€â”€ build-go.sh
â”œâ”€â”€ cherry_pick_pull.sh
â”œâ”€â”€ conformance
â”œâ”€â”€ dev-build-and-push.sh
â”œâ”€â”€ dev-build-and-up.sh
â”œâ”€â”€ dev-push-conformance.sh
â”œâ”€â”€ e2e-internal
â”œâ”€â”€ e2e-node-test.sh
â”œâ”€â”€ generate-docs.sh
â”œâ”€â”€ gen-swagger-doc
â”œâ”€â”€ get-build.sh
â”œâ”€â”€ ginkgo-e2e.sh
â”œâ”€â”€ grab-profiles.sh
â”œâ”€â”€ install-etcd.sh
â”œâ”€â”€ jenkins
â”œâ”€â”€ lib
â”œâ”€â”€ lint-dependencies.sh
â”œâ”€â”€ list-feature-tests.sh
â”œâ”€â”€ local-up-cluster.sh
â”œâ”€â”€ logcheck.conf
â”œâ”€â”€ make-rules
â”œâ”€â”€ module-graph.sh
â”œâ”€â”€ OWNERS
â”œâ”€â”€ pin-dependency.sh
â”œâ”€â”€ print-workspace-status.sh
â”œâ”€â”€ README.md
â”œâ”€â”€ run-in-gopath.sh
â”œâ”€â”€ run-prometheus-on-etcd-scrapes.sh
â”œâ”€â”€ serve-prom-scrapes.sh
â”œâ”€â”€ testdata
â”œâ”€â”€ test-go.sh
â”œâ”€â”€ test-integration.sh
â”œâ”€â”€ tools
â”œâ”€â”€ unwanted-dependencies.json
â”œâ”€â”€ update-all.sh
â”œâ”€â”€ update-codegen.sh
â”œâ”€â”€ update-conformance-yaml.sh
â”œâ”€â”€ update-generated-api-compatibility-data.sh
â”œâ”€â”€ update-generated-device-plugin-dockerized.sh
â”œâ”€â”€ update-generated-device-plugin.sh
â”œâ”€â”€ update-generated-docs.sh
â”œâ”€â”€ update-generated-kms-dockerized.sh
â”œâ”€â”€ update-generated-kms.sh
â”œâ”€â”€ update-generated-kubelet-plugin-registration-dockerized.sh
â”œâ”€â”€ update-generated-kubelet-plugin-registration.sh
â”œâ”€â”€ update-generated-pod-resources-dockerized.sh
â”œâ”€â”€ update-generated-pod-resources.sh
â”œâ”€â”€ update-generated-protobuf-dockerized.sh
â”œâ”€â”€ update-generated-protobuf.sh
â”œâ”€â”€ update-generated-runtime-dockerized.sh
â”œâ”€â”€ update-generated-runtime.sh
â”œâ”€â”€ update-generated-stable-metrics.sh
â”œâ”€â”€ update-generated-swagger-docs.sh
â”œâ”€â”€ update-gofmt.sh
â”œâ”€â”€ update-import-aliases.sh
â”œâ”€â”€ update-internal-modules.sh
â”œâ”€â”€ update-kustomize.sh
â”œâ”€â”€ update-mocks.sh
â”œâ”€â”€ update-netparse-cve.sh
â”œâ”€â”€ update-openapi-spec.sh
â”œâ”€â”€ update-translations.sh
â”œâ”€â”€ update-vendor-licenses.sh
â”œâ”€â”€ update-vendor.sh
â”œâ”€â”€ update-yamlfmt.sh
â”œâ”€â”€ verify-all.sh
â”œâ”€â”€ verify-api-groups.sh
â”œâ”€â”€ verify-boilerplate.sh
â”œâ”€â”€ verify-cli-conventions.sh
â”œâ”€â”€ verify-codegen.sh
â”œâ”€â”€ verify-conformance-requirements.sh
â”œâ”€â”€ verify-conformance-yaml.sh
â”œâ”€â”€ verify-description.sh
â”œâ”€â”€ verify-e2e-test-ownership.sh
â”œâ”€â”€ verify-external-dependencies-version.sh
â”œâ”€â”€ verify-flags
â”œâ”€â”€ verify-flags-underscore.py
â”œâ”€â”€ verify-generated-device-plugin.sh
â”œâ”€â”€ verify-generated-docs.sh
â”œâ”€â”€ verify-generated-files-remake.sh
â”œâ”€â”€ verify-generated-files.sh
â”œâ”€â”€ verify-generated-kms.sh
â”œâ”€â”€ verify-generated-kubelet-plugin-registration.sh
â”œâ”€â”€ verify-generated-pod-resources.sh
â”œâ”€â”€ verify-generated-protobuf.sh
â”œâ”€â”€ verify-generated-runtime.sh
â”œâ”€â”€ verify-generated-stable-metrics.sh
â”œâ”€â”€ verify-generated-swagger-docs.sh
â”œâ”€â”€ verify-gofmt.sh
â”œâ”€â”€ verify-golangci-lint.sh
â”œâ”€â”€ verify-govet-levee.sh
â”œâ”€â”€ verify-govet.sh
â”œâ”€â”€ verify-import-aliases.sh
â”œâ”€â”€ verify-import-boss.sh
â”œâ”€â”€ verify-imports.sh
â”œâ”€â”€ verify-internal-modules.sh
â”œâ”€â”€ verify-linkcheck.sh
â”œâ”€â”€ verify-mocks.sh
â”œâ”€â”€ verify-netparse-cve.sh
â”œâ”€â”€ verify-non-mutating-validation.sh
â”œâ”€â”€ verify-no-vendor-cycles.sh
â”œâ”€â”€ verify-openapi-spec.sh
â”œâ”€â”€ verify-pkg-names.sh
â”œâ”€â”€ verify-prerelease-lifecycle-tags.sh
â”œâ”€â”€ verify-prometheus-imports.sh
â”œâ”€â”€ verify-publishing-bot.py
â”œâ”€â”€ verify-readonly-packages.sh
â”œâ”€â”€ verify-shellcheck.sh
â”œâ”€â”€ verify-spelling.sh
â”œâ”€â”€ verify-staging-meta-files.sh
â”œâ”€â”€ verify-test-code.sh
â”œâ”€â”€ verify-test-featuregates.sh
â”œâ”€â”€ verify-test-images.sh
â”œâ”€â”€ verify-typecheck-providerless.sh
â”œâ”€â”€ verify-typecheck.sh
â”œâ”€â”€ verify-vendor-licenses.sh
â”œâ”€â”€ verify-vendor.sh
â””â”€â”€ verify-yamlfmt.sh
```



## plugin

`plugin`ç›®å½•ä¹‹å‰çš„ç‰ˆæœ¬åŒ…æ‹¬ `scheduler` éƒ¨åˆ†çš„ä»£ç ï¼Œå½“å‰ç‰ˆæœ¬ï¼ˆåº”è¯¥æ˜¯åœ¨1.10ä¹‹åï¼‰å·²ç»å°†scheduleréƒ¨åˆ†ä»£ç ç§»åˆ°å’Œå…¶ä»–ç»„ä»¶ä¸€è‡´çš„pkgç›®å½•ï¼Œæ‰€ä»¥ç›®å‰ `plugin` ä¸»è¦åŒ…å«çš„æ˜¯`è®¤è¯`ä¸`é‰´æƒ`éƒ¨åˆ†çš„ä»£ç ã€‚

```bash
root@cubmaster01:~/go/src/k8s.io/kubernetes# tree plugin/ -L 4
plugin/
â”œâ”€â”€ OWNERS
â””â”€â”€ pkg
    â”œâ”€â”€ admission
    â”‚   â”œâ”€â”€ admit
    â”‚   â”‚   â”œâ”€â”€ admission.go
    â”‚   â”‚   â””â”€â”€ admission_test.go
    â”‚   â”œâ”€â”€ alwayspullimages
    â”‚   â”‚   â”œâ”€â”€ admission.go
    â”‚   â”‚   â””â”€â”€ admission_test.go
    â”‚   â”œâ”€â”€ antiaffinity
    â”‚   â”‚   â”œâ”€â”€ admission.go
    â”‚   â”‚   â”œâ”€â”€ admission_test.go
    â”‚   â”‚   â””â”€â”€ doc.go
    â”‚   â”œâ”€â”€ certificates
    â”‚   â”‚   â”œâ”€â”€ approval
    â”‚   â”‚   â”œâ”€â”€ OWNERS
    â”‚   â”‚   â”œâ”€â”€ signing
    â”‚   â”‚   â”œâ”€â”€ subjectrestriction
    â”‚   â”‚   â””â”€â”€ util.go
    â”‚   â”œâ”€â”€ defaulttolerationseconds
    â”‚   â”‚   â”œâ”€â”€ admission.go
    â”‚   â”‚   â””â”€â”€ admission_test.go
    â”‚   â”œâ”€â”€ deny
    â”‚   â”‚   â”œâ”€â”€ admission.go
    â”‚   â”‚   â””â”€â”€ admission_test.go
    â”‚   â”œâ”€â”€ eventratelimit
    â”‚   â”‚   â”œâ”€â”€ admission.go
    â”‚   â”‚   â”œâ”€â”€ admission_test.go
    â”‚   â”‚   â”œâ”€â”€ apis
    â”‚   â”‚   â”œâ”€â”€ cache.go
    â”‚   â”‚   â”œâ”€â”€ cache_test.go
    â”‚   â”‚   â”œâ”€â”€ config.go
    â”‚   â”‚   â”œâ”€â”€ doc.go
    â”‚   â”‚   â””â”€â”€ limitenforcer.go
    â”‚   â”œâ”€â”€ extendedresourcetoleration
    â”‚   â”‚   â”œâ”€â”€ admission.go
    â”‚   â”‚   â””â”€â”€ admission_test.go
    â”‚   â”œâ”€â”€ gc
    â”‚   â”‚   â”œâ”€â”€ gc_admission.go
    â”‚   â”‚   â””â”€â”€ gc_admission_test.go
    â”‚   â”œâ”€â”€ imagepolicy
    â”‚   â”‚   â”œâ”€â”€ admission.go
    â”‚   â”‚   â”œâ”€â”€ admission_test.go
    â”‚   â”‚   â”œâ”€â”€ certs_test.go
    â”‚   â”‚   â”œâ”€â”€ config.go
    â”‚   â”‚   â”œâ”€â”€ config_test.go
    â”‚   â”‚   â”œâ”€â”€ doc.go
    â”‚   â”‚   â”œâ”€â”€ gencerts.sh
    â”‚   â”‚   â””â”€â”€ OWNERS
    â”‚   â”œâ”€â”€ limitranger
    â”‚   â”‚   â”œâ”€â”€ admission.go
    â”‚   â”‚   â”œâ”€â”€ admission_test.go
    â”‚   â”‚   â””â”€â”€ interfaces.go
    â”‚   â”œâ”€â”€ namespace
    â”‚   â”‚   â”œâ”€â”€ autoprovision
    â”‚   â”‚   â””â”€â”€ exists
    â”‚   â”œâ”€â”€ network
    â”‚   â”‚   â”œâ”€â”€ defaultingressclass
    â”‚   â”‚   â””â”€â”€ denyserviceexternalips
    â”‚   â”œâ”€â”€ noderestriction
    â”‚   â”‚   â”œâ”€â”€ admission.go
    â”‚   â”‚   â”œâ”€â”€ admission_test.go
    â”‚   â”‚   â””â”€â”€ OWNERS
    â”‚   â”œâ”€â”€ nodetaint
    â”‚   â”‚   â”œâ”€â”€ admission.go
    â”‚   â”‚   â””â”€â”€ admission_test.go
    â”‚   â”œâ”€â”€ OWNERS
    â”‚   â”œâ”€â”€ podnodeselector
    â”‚   â”‚   â”œâ”€â”€ admission.go
    â”‚   â”‚   â””â”€â”€ admission_test.go
    â”‚   â”œâ”€â”€ podtolerationrestriction
    â”‚   â”‚   â”œâ”€â”€ admission.go
    â”‚   â”‚   â”œâ”€â”€ admission_test.go
    â”‚   â”‚   â”œâ”€â”€ apis
    â”‚   â”‚   â”œâ”€â”€ config.go
    â”‚   â”‚   â””â”€â”€ doc.go
    â”‚   â”œâ”€â”€ priority
    â”‚   â”‚   â”œâ”€â”€ admission.go
    â”‚   â”‚   â””â”€â”€ admission_test.go
    â”‚   â”œâ”€â”€ resourcequota
    â”‚   â”‚   â””â”€â”€ admission_test.go
    â”‚   â”œâ”€â”€ runtimeclass
    â”‚   â”‚   â”œâ”€â”€ admission.go
    â”‚   â”‚   â”œâ”€â”€ admission_test.go
    â”‚   â”‚   â””â”€â”€ OWNERS
    â”‚   â”œâ”€â”€ security
    â”‚   â”‚   â”œâ”€â”€ doc.go
    â”‚   â”‚   â”œâ”€â”€ podsecurity
    â”‚   â”‚   â””â”€â”€ podsecuritypolicy
    â”‚   â”œâ”€â”€ securitycontext
    â”‚   â”‚   â””â”€â”€ scdeny
    â”‚   â”œâ”€â”€ serviceaccount
    â”‚   â”‚   â”œâ”€â”€ admission.go
    â”‚   â”‚   â”œâ”€â”€ admission_test.go
    â”‚   â”‚   â”œâ”€â”€ doc.go
    â”‚   â”‚   â””â”€â”€ OWNERS
    â”‚   â””â”€â”€ storage
    â”‚       â”œâ”€â”€ persistentvolume
    â”‚       â”œâ”€â”€ storageclass
    â”‚       â””â”€â”€ storageobjectinuseprotection
    â””â”€â”€ auth
        â”œâ”€â”€ authenticator
        â”‚   â”œâ”€â”€ OWNERS
        â”‚   â””â”€â”€ token
        â”œâ”€â”€ authorizer
        â”‚   â”œâ”€â”€ doc.go
        â”‚   â”œâ”€â”€ node
        â”‚   â”œâ”€â”€ OWNERS
        â”‚   â””â”€â”€ rbac
        â”œâ”€â”€ doc.go
        â””â”€â”€ OWNERS
```



## test

e2e æµ‹è¯•ä»£ç 



## Kubernetes çš„ ETC ç›®å½•

Kubernetes æ˜¯ä¸€ä¸ªå¹¿æ³›ä½¿ç”¨çš„å®¹å™¨ç¼–æ’å¹³å°ï¼Œä¸‹é¢æ˜¯ Kubernetes çš„ç›®å½•å’Œæ–‡ä»¶ï¼ŒåŒ…æ‹¬äº†å¹³å°çš„æ ¸å¿ƒç»„ä»¶å’Œè¯ä¹¦ç­‰ç›¸å…³æ–‡ä»¶ã€‚

```bash
â”œâ”€â”€ audit-policy.yml
â”œâ”€â”€ controller-manager.conf
â”œâ”€â”€ kubeadm.yaml
â”œâ”€â”€ kubelet.conf
â”œâ”€â”€ manifests
â”‚   â”œâ”€â”€ etcd.yaml
â”‚   â”œâ”€â”€ kube-apiserver.yaml
â”‚   â”œâ”€â”€ kube-controller-manager.yaml
â”‚   â””â”€â”€ kube-scheduler.yaml
â”œâ”€â”€ pki
â”‚   â”œâ”€â”€ apiserver.crt
â”‚   â”œâ”€â”€ apiserver-etcd-client.crt
â”‚   â”œâ”€â”€ apiserver-etcd-client.key
â”‚   â”œâ”€â”€ apiserver.key
â”‚   â”œâ”€â”€ apiserver-kubelet-client.crt
â”‚   â”œâ”€â”€ apiserver-kubelet-client.key
â”‚   â”œâ”€â”€ ca.crt
â”‚   â”œâ”€â”€ ca.key
â”‚   â”œâ”€â”€ etcd
â”‚   â”‚   â”œâ”€â”€ ca.crt
â”‚   â”‚   â”œâ”€â”€ ca.key
â”‚   â”‚   â”œâ”€â”€ healthcheck-client.crt
â”‚   â”‚   â”œâ”€â”€ healthcheck-client.key
â”‚   â”‚   â”œâ”€â”€ peer.crt
â”‚   â”‚   â”œâ”€â”€ peer.key
â”‚   â”‚   â”œâ”€â”€ server.crt
â”‚   â”‚   â””â”€â”€ server.key
â”‚   â”œâ”€â”€ front-proxy-ca.crt
â”‚   â”œâ”€â”€ front-proxy-ca.key
â”‚   â”œâ”€â”€ front-proxy-client.crt
â”‚   â”œâ”€â”€ front-proxy-client.key
â”‚   â”œâ”€â”€ sa.key
â”‚   â””â”€â”€ sa.pub
â””â”€â”€ scheduler.conf
```

### audit-policy.yml

`audit-policy.yml` æ˜¯ Kubernetes çš„å®¡æ ¸ç­–ç•¥æ–‡ä»¶ï¼Œå®ƒè§„å®šäº†å“ªäº›äº‹ä»¶éœ€è¦è¢«è®°å½•ï¼Œä»¥åŠè®°å½•çš„å†…å®¹ã€‚

### controller-manager.conf

`controller-manager.conf` æ˜¯ Kubernetes çš„æ§åˆ¶å™¨ç®¡ç†å™¨çš„é…ç½®æ–‡ä»¶ã€‚

### kubeadm.yaml

`kubeadm.yaml` æ˜¯ Kubernetes çš„åˆå§‹åŒ–é…ç½®æ–‡ä»¶ï¼ŒåŒ…å«äº†åˆå§‹åŒ–é›†ç¾¤æ‰€éœ€è¦çš„ä¿¡æ¯ã€‚

### kubelet.conf

`kubelet.conf` æ˜¯ Kubernetes çš„ kubelet ç»„ä»¶çš„é…ç½®æ–‡ä»¶ã€‚

### manifests

`manifests` ç›®å½•åŒ…å« Kubernetes çš„æ ¸å¿ƒç»„ä»¶çš„é…ç½®æ–‡ä»¶ï¼Œå®ƒä»¬æ˜¯ï¼š

+ `etcd.yaml`: etcd æ˜¯ Kubernetes é›†ç¾¤çš„æ•°æ®åº“ï¼Œå­˜å‚¨äº†é›†ç¾¤çš„çŠ¶æ€ä¿¡æ¯ã€‚
+ `kube-apiserver.yaml`: kube-apiserver æ˜¯ Kubernetes çš„ API æœåŠ¡å™¨ï¼Œè´Ÿè´£å¤„ç† API è¯·æ±‚ã€‚
+ `kube-controller-manager.yaml`: kube-controller-manager æ˜¯ Kubernetes çš„æ§åˆ¶å™¨ç®¡ç†å™¨ï¼Œè´Ÿè´£ç®¡ç†é›†ç¾¤çš„å„ç§æ§åˆ¶å™¨ã€‚
+ `kube-scheduler.yaml`: kube-scheduler æ˜¯ Kubernetes çš„è°ƒåº¦å™¨ï¼Œè´Ÿè´£å°† Pod åˆ†é…åˆ°åˆé€‚çš„èŠ‚ç‚¹ä¸Šè¿è¡Œã€‚

### pki

`pki` ç›®å½•åŒ…å« Kubernetes çš„è¯ä¹¦å’Œå¯†é’¥æ–‡ä»¶ï¼Œå®ƒä»¬æ˜¯ï¼š

+ `apiserver.crt`: kube-apiserver çš„è¯ä¹¦ã€‚
+ `apiserver-etcd-client.crt` å’Œ `apiserver-etcd-client.key`: kube-apiserver å’Œ etcd ä¹‹é—´é€šä¿¡çš„è¯ä¹¦å’Œå¯†é’¥ã€‚
+ `apiserver.key`: kube-apiserver çš„ç§é’¥ã€‚
+ `apiserver-kubelet-client.crt` å’Œ `apiserver-kubelet-client.key`: kube-apiserver å’Œ kubelet ä¹‹é—´é€šä¿¡çš„è¯ä¹¦å’Œå¯†é’¥ã€‚
+ `ca.crt` å’Œ `ca.key`: Kubernetes çš„æ ¹è¯ä¹¦å’Œå¯†é’¥ã€‚
+ `etcd` ç›®å½•ï¼šetcd çš„è¯ä¹¦å’Œå¯†é’¥æ–‡ä»¶ã€‚
+ `front-proxy-ca.crt` å’Œ `front-proxy-ca.key`: å‰ç½®ä»£ç†çš„è¯ä¹¦å’Œå¯†é’¥ã€‚
+ `front-proxy-client.crt` å’Œ `front-proxy-client.key`: å‰ç½®ä»£ç†å’Œ kube-apiserver ä¹‹é—´é€šä¿¡çš„è¯ä¹¦å’Œå¯†é’¥ã€‚
+ `sa.key` å’Œ `sa.pub`: Kubernetes çš„ Service Account çš„è¯ä¹¦å’Œå¯†é’¥ã€‚

### scheduler.conf

`scheduler.conf` æ˜¯ Kubernetes çš„è°ƒåº¦å™¨çš„é…ç½®æ–‡ä»¶ã€‚



### è¡¥å……

è¿™é‡Œå¯ä»¥åœ¨ è¡¥å……éƒ¨åˆ† sealer çš„å®ç°å®ç°ï¼š

::: details å±•å¼€å¦‚ä¸‹ï¼š
SaveAllå‡½æ•°ç”¨äºå°†æ‰€æœ‰é…ç½®ä¿¡æ¯ä¿å­˜åˆ°æ–‡ä»¶ä¸­ã€‚

```bash
func (c *ClusterFile) SaveAll(opts SaveOptions) error {
	var (
		clusterfileBytes [][]byte
		config           []byte
		plugin           []byte
	)
	fileName := common.GetDefaultClusterfile()
	err := os.MkdirAll(filepath.Dir(fileName), os.ModePerm)
	if err != nil {
		return fmt.Errorf("failed to mkdir %s: %v", fileName, err)
	}

	cluster, err := yaml.Marshal(c.cluster)
	if err != nil {
		return err
	}
	
	clusterfileBytes = append(clusterfileBytes, cluster)

	if len(c.configs) != 0 {
		for _, cg := range c.configs {
			config, err = yaml.Marshal(cg)
			if err != nil {
				return err
			}
			clusterfileBytes = append(clusterfileBytes, config)
		}
	}

	if len(c.plugins) != 0 {
		for _, p := range c.plugins {
			plugin, err = yaml.Marshal(p)
			if err != nil {
				return err
			}
			clusterfileBytes = append(clusterfileBytes, plugin)
		}
	}

	if len(c.kubeadmConfig.InitConfiguration.TypeMeta.Kind) != 0 {
		initConfiguration, err := yaml.Marshal(c.kubeadmConfig.InitConfiguration)
		if err != nil {
			return err
		}
		clusterfileBytes = append(clusterfileBytes, initConfiguration)
	}

	if len(c.kubeadmConfig.JoinConfiguration.TypeMeta.Kind) != 0 {
		joinConfiguration, err := yaml.Marshal(c.kubeadmConfig.JoinConfiguration)
		if err != nil {
			return err
		}
		clusterfileBytes = append(clusterfileBytes, joinConfiguration)
	}
	
	if len(c.kubeadmConfig.ClusterConfiguration.TypeMeta.Kind) != 0 {
		clusterConfiguration, err := yaml.Marshal(c.kubeadmConfig.ClusterConfiguration)
		if err != nil {
			return err
		}
		clusterfileBytes = append(clusterfileBytes, clusterConfiguration)
	}

	if len(c.kubeadmConfig.KubeletConfiguration.TypeMeta.Kind) != 0 {
		kubeletConfiguration, err := yaml.Marshal(c.kubeadmConfig.KubeletConfiguration)
		if err != nil {
			return err
		}
		clusterfileBytes = append(clusterfileBytes, kubeletConfiguration)
	}

	if len(c.kubeadmConfig.KubeProxyConfiguration.TypeMeta.Kind) != 0 {
		kubeProxyConfiguration, err := yaml.Marshal(c.kubeadmConfig.KubeProxyConfiguration)
		if err != nil {
			return err
		}
		clusterfileBytes = append(clusterfileBytes, kubeProxyConfiguration)
	}

	content := bytes.Join(clusterfileBytes, []byte("---\n"))
	err = utilsos.NewCommonWriter(fileName).WriteFile(content)
	if err != nil {
		return fmt.Errorf("failed to save clusterfile to disk:%v", err)
	}

	if opts.CommitToCluster {
		return saveToCluster(content, opts.ConfPath)
	}
	return nil
}
```

æœ‰æ„æ€çš„æ˜¯ï¼šéƒ¨åˆ†çš„ Kubernetes çš„ä¿å­˜ä¸­ï¼Œconfig å’Œ plug æ˜¯ä»¥ä¸€ç»´åˆ‡ç‰‡çš„å½¢å¼å­˜å‚¨çš„ï¼Œè€ŒclusterfileBytes ç”¨æ¥æ”¶é›† æ‰€æœ‰çš„ å†…å®¹ï¼Œä½¿ç”¨çš„æ˜¯äºŒç»´æ•°ç»„çš„æ–¹å¼å­˜å‚¨çš„ï¼ŒKubeadmConfig æ˜¯éšä¾¿å­˜å‚¨çš„ã€‚è·å–åˆ° config å’Œ plug ä¹Ÿåªæ˜¯ åˆ¤æ–­æ˜¯å¦ä¸º 0

:::







## END é“¾æ¥
<ul><li><div><a href = '31.md' style='float:left'>â¬†ï¸ä¸Šä¸€èŠ‚ğŸ”—  </a><a href = '33.md' style='float: right'>  ï¸ä¸‹ä¸€èŠ‚ğŸ”—</a></div></li></ul>

+ [â“‚ï¸å›åˆ°ç›®å½•ğŸ ](../README.md)

+ [**ğŸ«µå‚ä¸è´¡çŒ®ğŸ’â¤ï¸â€ğŸ”¥ğŸ’–**](https://nsddd.top/archives/contributors))

+ âœ´ï¸ç‰ˆæƒå£°æ˜ &copy; ï¼šæœ¬ä¹¦æ‰€æœ‰å†…å®¹éµå¾ª[CC-BY-SA 3.0åè®®ï¼ˆç½²å-ç›¸åŒæ–¹å¼å…±äº«ï¼‰&copy;](http://zh.wikipedia.org/wiki/Wikipedia:CC-by-sa-3.0åè®®æ–‡æœ¬) 

