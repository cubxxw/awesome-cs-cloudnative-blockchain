+ [author](http://nsddd.top)

# ç¬¬8èŠ‚ å›¾å½¢ç•Œé¢å’Œå‘½åç©ºé—´

<div><a href = '7.md' style='float:left'>â¬†ï¸ä¸Šä¸€èŠ‚ğŸ”—  </a><a href = '9.md' style='float: right'>  â¬‡ï¸ä¸‹ä¸€èŠ‚ğŸ”—</a></div>
<br>

> â¤ï¸ğŸ’•ğŸ’•æ–°æ—¶ä»£æ‹¥æŠ±äº‘åŸç”Ÿï¼Œäº‘åŸç”Ÿå…·æœ‰ç¯å¢ƒç»Ÿä¸€ã€æŒ‰éœ€ä»˜è´¹ã€å³å¼€å³ç”¨ã€ç¨³å®šæ€§å¼ºç‰¹ç‚¹ã€‚Myblog:[http://nsddd.top](http://nsddd.top/)

---
[[toc]]

[TOC]

## K8sé›†ç¾¤è‡ªæˆ‘æ¢å¤èƒ½åŠ›æµ‹è¯•

> é›†ç¾¤çš„è‡ªæˆ‘ä¿®å¤èƒ½åŠ›å¼ºï¼šæŒ‡çš„æ˜¯å…³æœºåä»ç„¶å¯ä»¥æµ‹è¯•

æŸ¥çœ‹é›†ç¾¤çŠ¶æ€ï¼š

```
kubectl get nodes
```



æŸ¥çœ‹é›†ç¾¤è¿è¡Œä¸­çš„åº”ç”¨ï¼š

```
kubectl get pod -A
```

![image-20221020213451951](https://sm.nsddd.top/smimage-20221020213451951.png)

è¿‡ä¸€æ®µæ—¶é—´åˆå¯ç»§ç»­ä½¿ç”¨



## k8så¯è§†åŒ–ç•Œé¢dashboard

```bash
# ä¸‹è½½å¹¶åº”ç”¨æ–‡ä»¶
kubectl apply -f https://raw.githubusercontent.com/kubernetes/dashboard/v2.3.1/aio/deploy/recommended.yaml
```

> å› ä¸ºç½‘ç»œåŸå› æ²¡åŠæ³•ä¸‹è½½ï¼š
>
> **åˆ›å»ºæ–‡ä»¶ï¼š**
>
> ```bash
> [root@k8s-master01 ~]# vim dashboard.yaml
> [root@k8s-master01 ~]# kubectl apply -f dashboard.yaml 
> ```
>
> `dashboard.yaml`è¾“å…¥ä»¥ä¸‹å†…å®¹ï¼š
>
> ::: details âš¡ ç‚¹å‡»ï¼ˆå¤åˆ¶åˆ°æŒ‡å®šå³å¯~ï¼‰
> â¬‡ï¸â¬‡ï¸â¬‡ï¸
>
> ```yaml
> # Copyright 2017 The Kubernetes Authors.
> #
> # Licensed under the Apache License, Version 2.0 (the "License");
> # you may not use this file except in compliance with the License.
> # You may obtain a copy of the License at
> #
> #     http://www.apache.org/licenses/LICENSE-2.0
> #
> # Unless required by applicable law or agreed to in writing, software
> # distributed under the License is distributed on an "AS IS" BASIS,
> # WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
> # See the License for the specific language governing permissions and
> # limitations under the License.
> 
> apiVersion: v1
> kind: Namespace
> metadata:
> name: kubernetes-dashboard
> 
> ---
> 
> apiVersion: v1
> kind: ServiceAccount
> metadata:
> labels:
>  k8s-app: kubernetes-dashboard
> name: kubernetes-dashboard
> namespace: kubernetes-dashboard
> 
> ---
> 
> kind: Service
> apiVersion: v1
> metadata:
> labels:
>  k8s-app: kubernetes-dashboard
> name: kubernetes-dashboard
> namespace: kubernetes-dashboard
> spec:
> ports:
>     - port: 443
>       targetPort: 8443
>   selector:
>     k8s-app: kubernetes-dashboard
> 
> ---
> 
> apiVersion: v1
> kind: Secret
> metadata:
>   labels:
>     k8s-app: kubernetes-dashboard
>   name: kubernetes-dashboard-certs
>   namespace: kubernetes-dashboard
> type: Opaque
> 
> ---
> 
> apiVersion: v1
> kind: Secret
> metadata:
>   labels:
>     k8s-app: kubernetes-dashboard
>   name: kubernetes-dashboard-csrf
>   namespace: kubernetes-dashboard
> type: Opaque
> data:
>   csrf: ""
> 
> ---
> 
> apiVersion: v1
> kind: Secret
> metadata:
>   labels:
>     k8s-app: kubernetes-dashboard
>   name: kubernetes-dashboard-key-holder
>   namespace: kubernetes-dashboard
> type: Opaque
> 
> ---
> 
> kind: ConfigMap
> apiVersion: v1
> metadata:
>   labels:
>     k8s-app: kubernetes-dashboard
>   name: kubernetes-dashboard-settings
>   namespace: kubernetes-dashboard
> 
> ---
> 
> kind: Role
> apiVersion: rbac.authorization.k8s.io/v1
> metadata:
>   labels:
>     k8s-app: kubernetes-dashboard
>   name: kubernetes-dashboard
>   namespace: kubernetes-dashboard
> rules:
>   # Allow Dashboard to get, update and delete Dashboard exclusive secrets.
>   - apiGroups: [""]
>     resources: ["secrets"]
>     resourceNames: ["kubernetes-dashboard-key-holder", "kubernetes-dashboard-certs", "kubernetes-dashboard-csrf"]
>     verbs: ["get", "update", "delete"]
>     # Allow Dashboard to get and update 'kubernetes-dashboard-settings' config map.
>   - apiGroups: [""]
>     resources: ["configmaps"]
>     resourceNames: ["kubernetes-dashboard-settings"]
>     verbs: ["get", "update"]
>     # Allow Dashboard to get metrics.
>   - apiGroups: [""]
>     resources: ["services"]
>     resourceNames: ["heapster", "dashboard-metrics-scraper"]
>     verbs: ["proxy"]
>   - apiGroups: [""]
>     resources: ["services/proxy"]
>     resourceNames: ["heapster", "http:heapster:", "https:heapster:", "dashboard-metrics-scraper", "http:dashboard-metrics-scraper"]
>     verbs: ["get"]
> 
> ---
> 
> kind: ClusterRole
> apiVersion: rbac.authorization.k8s.io/v1
> metadata:
>   labels:
>     k8s-app: kubernetes-dashboard
>   name: kubernetes-dashboard
> rules:
>   # Allow Metrics Scraper to get metrics from the Metrics server
>   - apiGroups: ["metrics.k8s.io"]
>     resources: ["pods", "nodes"]
>     verbs: ["get", "list", "watch"]
> 
> ---
> 
> apiVersion: rbac.authorization.k8s.io/v1
> kind: RoleBinding
> metadata:
>   labels:
>     k8s-app: kubernetes-dashboard
>   name: kubernetes-dashboard
>   namespace: kubernetes-dashboard
> roleRef:
>   apiGroup: rbac.authorization.k8s.io
>   kind: Role
>   name: kubernetes-dashboard
> subjects:
>   - kind: ServiceAccount
>     name: kubernetes-dashboard
>     namespace: kubernetes-dashboard
> 
> ---
> 
> apiVersion: rbac.authorization.k8s.io/v1
> kind: ClusterRoleBinding
> metadata:
>   name: kubernetes-dashboard
> roleRef:
>   apiGroup: rbac.authorization.k8s.io
>   kind: ClusterRole
>   name: kubernetes-dashboard
> subjects:
>   - kind: ServiceAccount
>     name: kubernetes-dashboard
>     namespace: kubernetes-dashboard
> 
> ---
> 
> kind: Deployment
> apiVersion: apps/v1
> metadata:
>   labels:
>     k8s-app: kubernetes-dashboard
>   name: kubernetes-dashboard
>   namespace: kubernetes-dashboard
> spec:
>   replicas: 1
>   revisionHistoryLimit: 10
>   selector:
>     matchLabels:
>       k8s-app: kubernetes-dashboard
>   template:
>     metadata:
>       labels:
>         k8s-app: kubernetes-dashboard
>     spec:
>       containers:
>         - name: kubernetes-dashboard
>           image: kubernetesui/dashboard:v2.3.1
>           imagePullPolicy: Always
>           ports:
>             - containerPort: 8443
>               protocol: TCP
>           args:
>             - --auto-generate-certificates
>             - --namespace=kubernetes-dashboard
>             # Uncomment the following line to manually specify Kubernetes API server Host
>             # If not specified, Dashboard will attempt to auto discover the API server and connect
>             # to it. Uncomment only if the default does not work.
>             # - --apiserver-host=http://my-address:port
>           volumeMounts:
>             - name: kubernetes-dashboard-certs
>               mountPath: /certs
>               # Create on-disk volume to store exec logs
>             - mountPath: /tmp
>               name: tmp-volume
>           livenessProbe:
>             httpGet:
>               scheme: HTTPS
>               path: /
>               port: 8443
>             initialDelaySeconds: 30
>             timeoutSeconds: 30
>           securityContext:
>             allowPrivilegeEscalation: false
>             readOnlyRootFilesystem: true
>             runAsUser: 1001
>             runAsGroup: 2001
>       volumes:
>         - name: kubernetes-dashboard-certs
>           secret:
>             secretName: kubernetes-dashboard-certs
>         - name: tmp-volume
>           emptyDir: {}
>       serviceAccountName: kubernetes-dashboard
>       nodeSelector:
>         "kubernetes.io/os": linux
>       # Comment the following tolerations if Dashboard must not be deployed on master
>       tolerations:
>         - key: node-role.kubernetes.io/master
>           effect: NoSchedule
> 
> ---
> 
> kind: Service
> apiVersion: v1
> metadata:
>   labels:
>     k8s-app: dashboard-metrics-scraper
>   name: dashboard-metrics-scraper
>   namespace: kubernetes-dashboard
> spec:
>   ports:
>     - port: 8000
>       targetPort: 8000
>   selector:
>     k8s-app: dashboard-metrics-scraper
> 
> ---
> 
> kind: Deployment
> apiVersion: apps/v1
> metadata:
>   labels:
>     k8s-app: dashboard-metrics-scraper
>   name: dashboard-metrics-scraper
>   namespace: kubernetes-dashboard
> spec:
>   replicas: 1
>   revisionHistoryLimit: 10
>   selector:
>     matchLabels:
>       k8s-app: dashboard-metrics-scraper
>   template:
>     metadata:
>       labels:
>         k8s-app: dashboard-metrics-scraper
>       annotations:
>         seccomp.security.alpha.kubernetes.io/pod: 'runtime/default'
>     spec:
>       containers:
>         - name: dashboard-metrics-scraper
>           image: kubernetesui/metrics-scraper:v1.0.6
>           ports:
>             - containerPort: 8000
>               protocol: TCP
>           livenessProbe:
>             httpGet:
>               scheme: HTTP
>               path: /
>               port: 8000
>             initialDelaySeconds: 30
>             timeoutSeconds: 30
>           volumeMounts:
>           - mountPath: /tmp
>             name: tmp-volume
>           securityContext:
>             allowPrivilegeEscalation: false
>             readOnlyRootFilesystem: true
>             runAsUser: 1001
>             runAsGroup: 2001
>       serviceAccountName: kubernetes-dashboard
>       nodeSelector:
>         "kubernetes.io/os": linux
>       # Comment the following tolerations if Dashboard must not be deployed on master
>       tolerations:
>         - key: node-role.kubernetes.io/master
>           effect: NoSchedule
>       volumes:
>         - name: tmp-volume
>           emptyDir: {}
> 
> 
> ```
>
> :::



**ä¿®æ”¹é…ç½® `type: NodePort`**

> å°†ç«¯å£æš´éœ²ï¼Œç±»ä¼¼äº`docker -p`

```
kubectl edit svc kubernetes-dashboard -n kubernetes-dashboard
```



**æ‰¾åˆ°ç«¯å£ï¼Œåœ¨å®‰å…¨ç»„æ”¾è¡Œ**

```bash
kubectl get svc -A | grep kubernetes-dashboard
```

![image-20221021121539454](http://sm.nsddd.top/smimage-20221021121539454.png)

> å’Œdockerç«¯å£æ˜ å°„ä¸€ä¸ªé“ç†ï¼Œ`30250`å°±æ˜¯æˆ‘ä»¬è¦è®¿é—®`k8s`ç«¯å£ã€‚
>
> æˆ‘ä»¬å¼€æ”¾å°±å¥½ï¼ˆè‡ªå®šä¹‰å®‰å…¨ç»„æ·»åŠ ï¼‰



## å‘½åç©ºé—´ Namespace

âš¡ åç§°ç©ºé—´ç”¨æ¥éš”ç¦»èµ„æºï¼Œå¯¹èµ„æºè¿›è¡Œåˆ’åˆ†ï¼Œé»˜è®¤åªæ˜¯**éš”ç¦»èµ„æºï¼Œä¸éš”ç¦»ç½‘ç»œ**ã€‚

1. èµ„æºå¯¹è±¡çš„éš”ç¦»ï¼š`Service`ã€`Deployment`ã€`Pod`

2. èµ„æºé…é¢çš„éš”ç¦»ï¼š`Cpu`ã€`Memory`

```bash
kubectl create ns hello  #åˆ›å»ºå‘½åç©ºé—´
kubectl delete ns hello  #åˆ é™¤å‘½åç©ºé—´
```

**ä¸åŒå‘½åç©ºé—´ä¸‹çš„ `service-ip` æ˜¯å¯ä»¥äº’ç›¸è®¿é—®çš„ï¼Œä¸å‘½åç©ºé—´æ— å…³ã€‚**

**ä¸åŒå‘½åç©ºé—´ä¸‹çš„ `pod` åç§°ä¸ `dns` æ˜¯è®¿é—®ä¸åˆ°çš„ã€‚ `pod-ip` æ˜¯ä¸éš”ç¦»çš„ã€‚**



**ğŸ”¥ æŸ¥çœ‹å‘½åç©ºé—´**

```bash
kubectl get ns
```

![image-20221022115320381](http://sm.nsddd.top/smimage-20221022115320381.png)



**æ¯ä¸€ä¸ªåº”ç”¨éƒ½æœ‰è‡ªå·±çš„åç§°ç©ºé—´**

```bash
kubectl get pod -n 
```

![image-20221022122705824](http://sm.nsddd.top/smimage-20221022122705824.png)



**é»˜è®¤åç§°ç©ºé—´`default`ï¼ˆä¸å¯ä»¥åˆ é™¤ï¼‰ï¼š**

+ `-n`ï¼šæŒ‡å®šåç§°ç©ºé—´

![image-20221022122804888](http://sm.nsddd.top/smimage-20221022122804888.png)



### åˆ›å»ºä¸€ä¸ªåç§°ç©ºé—´

ğŸ’¡ç®€å•çš„ä¸€ä¸ªæ¡ˆä¾‹å¦‚ä¸‹â€”â€”åˆ›å»º`hello`åç§°ç©ºé—´ï¼š

```
vim hello.yaml
```

è¾“å…¥ä¸‹é¢å†…å®¹ <Badge text="æ¼”ç¤º" />ï¼š

```yaml
apiVersion: v1
kind: Namespace
metadata:
  name: hello
```

ğŸš€ ç¼–è¯‘ç»“æœå¦‚ä¸‹ï¼š

![image-20221022123347774](http://sm.nsddd.top/smimage-20221022123347774.png)



**åˆ é™¤é…ç½®æ–‡ä»¶æ‰€åˆ›å»ºçš„å‘½åç©ºé—´ï¼š**

```bash
# ç¬¬ä¸€ç§å’Œä¸Šé¢ä¸€æ ·
kubectl delect ns hello

# ç¬¬äºŒç§-åˆ é™¤é…ç½®æ–‡ä»¶æ‰€åˆ›å»ºçš„
kubectl delect -f hello.yaml
```



### ncå‘½ä»¤

```
nc -zv 172.31.0.2 30250
```

è®¿é—®ç›®çš„å†…ç½‘`ip:30250`ç«¯å£æ˜¯å¦æ­£å¸¸è®¿é—®



### åˆ›å»ºå’ŒæŸ¥è¯¢å‘½åç©ºé—´

::: tip 
å¦‚æœä¸€ä¸ªé›†ç¾¤ä¸­éƒ¨ç½²äº†å¤šä¸ªåº”ç”¨ï¼Œæ‰€æœ‰åº”ç”¨éƒ½åœ¨ä¸€èµ·ï¼Œå°±ä¸å¤ªå¥½ç®¡ç†ï¼Œä¹Ÿå¯ä»¥å¯¼è‡´åå­—å†²çªç­‰ã€‚
æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ namespace æŠŠåº”ç”¨åˆ’åˆ†åˆ°ä¸åŒçš„å‘½åç©ºé—´ï¼Œè·Ÿä»£ç é‡Œçš„ namespace æ˜¯ä¸€ä¸ªæ¦‚å¿µï¼Œåªæ˜¯ä¸ºäº†åˆ’åˆ†ç©ºé—´ã€‚

:::

**æ¼”ç¤º** <Badge text="æ¼”ç¤º" />

```bash
# åˆ›å»ºå‘½åç©ºé—´
kubectl create namespace testapp
# éƒ¨ç½²åº”ç”¨åˆ°æŒ‡å®šçš„å‘½åç©ºé—´
kubectl apply -f app.yml --namespace testapp
# æŸ¥è¯¢
kubectl get pod --namespace kube-system
```



### åˆ é™¤å‘½åç©ºé—´

**æˆ‘ä»¬éœ€è¦å…ˆæ‰‹åŠ¨åˆ é™¤å‘½åç©ºé—´ä¸‹çš„èµ„æºæ‰èƒ½åˆ é™¤å‘½åç©ºé—´ã€‚**



## è®¾ç½®é»˜è®¤çš„å‘½åç©ºé—´

```bash
kuberctl config set-context $(kubectl config current-context) --namespace=develop
```





## å¿«é€Ÿåˆ‡æ¢å‘½åç©ºé—´å’Œé›†ç¾¤

+ [kubens](https://github.com/ahmetb/kubectx) 

å¯ä»¥ç”¨ [kubens](https://github.com/ahmetb/kubectx) å¿«é€Ÿåˆ‡æ¢ namespace

> `kubectx` + `kubens`: Power tools for kubectl

```bash
# åˆ‡æ¢å‘½åç©ºé—´
kubens kube-system
# å›åˆ°ä¸Šä¸ªå‘½åç©ºé—´
kubens -
# åˆ‡æ¢é›†ç¾¤
kubectx minikube
```





## END é“¾æ¥

<ul><li><div><a href = '7.md' style='float:left'>â¬†ï¸ä¸Šä¸€èŠ‚ğŸ”—  </a><a href = '9.md' style='float: right'>  ï¸ä¸‹ä¸€èŠ‚ğŸ”—</a></div></li></ul>

+ [â“‚ï¸å›åˆ°ç›®å½•ğŸ ](../README.md)

+ [**ğŸ«µå‚ä¸è´¡çŒ®ğŸ’â¤ï¸â€ğŸ”¥ğŸ’–**](https://nsddd.top/archives/contributors))

+ âœ´ï¸ç‰ˆæƒå£°æ˜ &copy; ï¼šæœ¬ä¹¦æ‰€æœ‰å†…å®¹éµå¾ª[CC-BY-SA 3.0åè®®ï¼ˆç½²å-ç›¸åŒæ–¹å¼å…±äº«ï¼‰&copy;](http://zh.wikipedia.org/wiki/Wikipedia:CC-by-sa-3.0åè®®æ–‡æœ¬) 

