+ [author](http://nsddd.top)

# ç¬¬13èŠ‚ solidityç”¨æ³•æ€»ç»“

<div><a href = '12.md' style='float:left'>â¬†ï¸ä¸Šä¸€èŠ‚ğŸ”—</a><a href = '14.md' style='float: right'>â¬‡ï¸ä¸‹ä¸€èŠ‚ğŸ”—</a></div>
<br>

> â¤ï¸ğŸ’•ğŸ’•æ¬¢è¿æ¥åˆ°web3çš„æ•™ç¨‹ï¼Œåœ¨è¿™é‡Œï¼Œå°†ä¼šå­¦ä¹ åˆ°æ™ºèƒ½åˆçº¦ï¼ŒåŒºå—é“¾åº•å±‚åŸç†ï¼Œethå’Œbtcå­¦ä¹ ï¼Œweb3æˆ–å°†ä¼šé¢ è¦†ä¸–ç•ŒğŸ˜~Myblog:[http://nsddd.top](http://nsddd.top/)

---
[TOC]

## solidityå®šä¹‰å‡½æ•°

åœ¨ Solidity ä¸­å‡½æ•°å®šä¹‰çš„å¥æ³•å¦‚ä¸‹:

```solidity
function eatHamburgers(string _name, uint _amount) {

}
```

è¿™æ˜¯ä¸€ä¸ªåä¸º `eatHamburgers` çš„å‡½æ•°ï¼Œå®ƒæ¥å—ä¸¤ä¸ªå‚æ•°ï¼šä¸€ä¸ª `string`ç±»å‹çš„ å’Œ ä¸€ä¸ª `uint`ç±»å‹çš„ã€‚ç°åœ¨å‡½æ•°å†…éƒ¨è¿˜æ˜¯ç©ºçš„ã€‚

> æ³¨ï¼š: ä¹ æƒ¯ä¸Šå‡½æ•°é‡Œçš„å˜é‡éƒ½æ˜¯ä»¥(`_`)å¼€å¤´ (ä½†ä¸æ˜¯ç¡¬æ€§è§„å®š) ä»¥åŒºåˆ«å…¨å±€å˜é‡ã€‚æˆ‘ä»¬æ•´ä¸ªæ•™ç¨‹éƒ½ä¼šæ²¿ç”¨è¿™ä¸ªä¹ æƒ¯ã€‚

æˆ‘ä»¬çš„å‡½æ•°å®šä¹‰å¦‚ä¸‹:

```solidity
eatHamburgers("vitalik", 100);
```



ğŸ’¡ç®€å•çš„ä¸€ä¸ªæ¡ˆä¾‹å¦‚ä¸‹ï¼š

```solidity
pragma solidity ^0.4.19;

contract ZombieFactory {

    uint dnaDigits = 16;
    uint dnaModulus = 10 ** dnaDigits;

    struct Zombie {
        string name;
        uint dna;
    }

    Zombie[] public zombies;

    function createZombie(string _name, uint _dna) {

    }

}
```



## ä½¿ç”¨ç»“æ„ä½“å’Œæ•°ç»„

è¿˜è®°å¾—ä¸Šä¸ªä¾‹å­ä¸­çš„ `Person` ç»“æ„å—ï¼Ÿ

```solidity
struct Person {
  uint age;
  string name;
}

Person[] public people;
```

ç°åœ¨æˆ‘ä»¬å­¦ä¹ åˆ›å»ºæ–°çš„ `Person` ç»“æ„ï¼Œç„¶åæŠŠå®ƒåŠ å…¥åˆ°åä¸º `people` çš„æ•°ç»„ä¸­.

```solidity
// åˆ›å»ºä¸€ä¸ªæ–°çš„Person:
Person satoshi = Person(172, "Satoshi");

// å°†æ–°åˆ›å»ºçš„satoshiæ·»åŠ è¿›peopleæ•°ç»„:
people.push(satoshi);
```

ä½ ä¹Ÿå¯ä»¥ä¸¤æ­¥å¹¶ä¸€æ­¥ï¼Œç”¨ä¸€è¡Œä»£ç æ›´ç®€æ´:

```
people.push(Person(16, "Vitalik"));
```

> æ³¨ï¼š`array.push()` åœ¨æ•°ç»„çš„ **å°¾éƒ¨** åŠ å…¥æ–°å…ƒç´  ï¼Œæ‰€ä»¥å…ƒç´ åœ¨æ•°ç»„ä¸­çš„é¡ºåºå°±æ˜¯æˆ‘ä»¬æ·»åŠ çš„é¡ºåºï¼Œ å¦‚:

```
uint[] numbers;
numbers.push(5);
numbers.push(10);
numbers.push(15);
// numbers is now equal to [5, 10, 15]
```



ğŸ’¡ç®€å•çš„ä¸€ä¸ªæ¡ˆä¾‹å¦‚ä¸‹ï¼š

è®©æˆ‘ä»¬åˆ›å»ºåä¸ºcreateZombieçš„å‡½æ•°æ¥åšç‚¹å„¿ä»€ä¹ˆå§ã€‚

1. åœ¨å‡½æ•°ä½“é‡Œæ–°åˆ›å»ºä¸€ä¸ª `Zombie`ï¼Œ ç„¶åæŠŠå®ƒåŠ å…¥ `zombies` æ•°ç»„ä¸­ã€‚ æ–°åˆ›å»ºçš„åƒµå°¸çš„ `name` å’Œ `dna`ï¼Œæ¥è‡ªäºå‡½æ•°çš„å‚æ•°ã€‚
2. è®©æˆ‘ä»¬ç”¨ä¸€è¡Œä»£ç ç®€æ´åœ°å®Œæˆå®ƒã€‚



ğŸš€ ç¼–è¯‘ç»“æœå¦‚ä¸‹ï¼š

```solidity
pragma solidity ^0.4.19;

contract ZombieFactory {

    uint dnaDigits = 16;
    uint dnaModulus = 10 ** dnaDigits;

    struct Zombie {
        string name;
        uint dna;
    }

    Zombie[] public zombies;

    function createZombie(string _name, uint _dna) {
        // è¿™é‡Œå¼€å§‹
        zombies.push(Zombie(_name,_dna));
    }

}
```



## ç§æœ‰ã€å…¬å…±å‡½æ•°

Solidity å®šä¹‰çš„å‡½æ•°çš„å±æ€§é»˜è®¤ä¸º`å…¬å…±`ã€‚ è¿™å°±æ„å‘³ç€ä»»ä½•ä¸€æ–¹ (æˆ–å…¶å®ƒåˆçº¦) éƒ½å¯ä»¥è°ƒç”¨ä½ åˆçº¦é‡Œçš„å‡½æ•°ã€‚

æ˜¾ç„¶ï¼Œä¸æ˜¯ä»€ä¹ˆæ—¶å€™éƒ½éœ€è¦è¿™æ ·ï¼Œè€Œä¸”è¿™æ ·çš„åˆçº¦æ˜“äºå—åˆ°æ”»å‡»ã€‚ æ‰€ä»¥å°†è‡ªå·±çš„å‡½æ•°å®šä¹‰ä¸º`ç§æœ‰`æ˜¯ä¸€ä¸ªå¥½çš„ç¼–ç¨‹ä¹ æƒ¯ï¼Œåªæœ‰å½“ä½ éœ€è¦å¤–éƒ¨ä¸–ç•Œè°ƒç”¨å®ƒæ—¶æ‰å°†å®ƒè®¾ç½®ä¸º`å…¬å…±`ã€‚

å¦‚ä½•å®šä¹‰ä¸€ä¸ªç§æœ‰çš„å‡½æ•°å‘¢ï¼Ÿ

```solidity
uint[] numbers;

function _addToArray(uint _number) private {
  numbers.push(_number);
}
```

è¿™æ„å‘³ç€åªæœ‰æˆ‘ä»¬åˆçº¦ä¸­çš„å…¶å®ƒå‡½æ•°æ‰èƒ½å¤Ÿè°ƒç”¨è¿™ä¸ªå‡½æ•°ï¼Œç»™ `numbers` æ•°ç»„æ·»åŠ æ–°æˆå‘˜ã€‚

å¯ä»¥çœ‹åˆ°ï¼Œåœ¨å‡½æ•°åå­—åé¢ä½¿ç”¨å…³é”®å­— `private` å³å¯ã€‚å’Œå‡½æ•°çš„å‚æ•°ç±»ä¼¼ï¼Œç§æœ‰å‡½æ•°çš„åå­—ç”¨(`_`)èµ·å§‹ã€‚



## å‡½æ•°çš„æ›´å¤šå±æ€§

### è¿”å›å€¼

è¦æƒ³å‡½æ•°è¿”å›ä¸€ä¸ªæ•°å€¼ï¼ŒæŒ‰å¦‚ä¸‹å®šä¹‰ï¼š

```solidity
string greeting = "What's up dog";

function sayHello() public returns (string) {
  return greeting;
}
```

Solidity é‡Œï¼Œå‡½æ•°çš„å®šä¹‰é‡Œå¯åŒ…å«è¿”å›å€¼çš„æ•°æ®ç±»å‹

### å‡½æ•°çš„ä¿®é¥°ç¬¦

ä¸Šé¢çš„å‡½æ•°å®é™…ä¸Šæ²¡æœ‰æ”¹å˜ Solidity é‡Œçš„çŠ¶æ€ï¼Œå³ï¼Œå®ƒæ²¡æœ‰æ”¹å˜ä»»ä½•å€¼æˆ–è€…å†™ä»»ä½•ä¸œè¥¿ã€‚

è¿™ç§æƒ…å†µä¸‹æˆ‘ä»¬å¯ä»¥æŠŠå‡½æ•°å®šä¹‰ä¸º *view*, æ„å‘³ç€å®ƒåªèƒ½è¯»å–æ•°æ®ä¸èƒ½æ›´æ”¹æ•°æ®:

```solidity
function sayHello() public view returns (string) {
```

Solidity è¿˜æ”¯æŒ ***pure*** å‡½æ•°, è¡¨æ˜è¿™ä¸ªå‡½æ•°ç”šè‡³éƒ½ä¸è®¿é—®åº”ç”¨é‡Œçš„æ•°æ®ï¼Œä¾‹å¦‚ï¼š

```solidity
function _multiply(uint a, uint b) private pure returns (uint) {
  return a * b;
}
```

è¿™ä¸ªå‡½æ•°ç”šè‡³éƒ½ä¸è¯»å–åº”ç”¨é‡Œçš„çŠ¶æ€ â€” å®ƒçš„è¿”å›å€¼å®Œå…¨å–å†³äºå®ƒçš„è¾“å…¥å‚æ•°ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹æˆ‘ä»¬æŠŠå‡½æ•°å®šä¹‰ä¸º *pure*.

> æ³¨ï¼šå¯èƒ½å¾ˆéš¾è®°ä½ä½•æ—¶æŠŠå‡½æ•°æ ‡è®°ä¸º pure/viewã€‚ å¹¸è¿çš„æ˜¯ï¼Œ Solidity ç¼–è¾‘å™¨ä¼šç»™å‡ºæç¤ºï¼Œæé†’ä½ ä½¿ç”¨è¿™äº›ä¿®é¥°ç¬¦ã€‚



## Keccak256 å’Œ ç±»å‹è½¬æ¢

Ethereum å†…éƒ¨æœ‰ä¸€ä¸ªæ•£åˆ—å‡½æ•°`keccak256`ï¼Œå®ƒç”¨äº†`SHA3`ç‰ˆæœ¬ã€‚ä¸€ä¸ªæ•£åˆ—å‡½æ•°åŸºæœ¬ä¸Šå°±æ˜¯æŠŠä¸€ä¸ªå­—ç¬¦ä¸²è½¬æ¢ä¸ºä¸€ä¸ª256ä½çš„16è¿›åˆ¶æ•°å­—ã€‚å­—ç¬¦ä¸²çš„ä¸€ä¸ªå¾®å°å˜åŒ–ä¼šå¼•èµ·æ•£åˆ—æ•°æ®æå¤§å˜åŒ–ã€‚

```bash
//6e91ec6b618bb462a4a6ee5aa2cb0e9cf30f7a052bb467b0ba58b8748c00d2e5
keccak256("aaaab");
//b1f078126895a1424524de5321b339ab00408010b7cf0e6ed451514981e58aa9
keccak256("aaaac");
```

> *æ³¨: åœ¨åŒºå—é“¾ä¸­å®‰å…¨åœ°äº§ç”Ÿä¸€ä¸ªéšæœºæ•°æ˜¯ä¸€ä¸ªå¾ˆéš¾çš„é—®é¢˜ï¼Œ æœ¬ä¾‹çš„æ–¹æ³•ä¸å®‰å…¨ï¼Œä½†æ˜¯åœ¨æˆ‘ä»¬çš„Zombie DNAç®—æ³•é‡Œä¸æ˜¯é‚£ä¹ˆé‡è¦ï¼Œå·²ç»å¾ˆå¥½åœ°æ»¡è¶³æˆ‘ä»¬çš„éœ€è¦äº†ã€‚*

æ˜¾è€Œæ˜“è§ï¼Œè¾“å…¥å­—ç¬¦ä¸²åªæ”¹å˜äº†ä¸€ä¸ªå­—æ¯ï¼Œè¾“å‡ºå°±å·²ç»å¤©å£¤ä¹‹åˆ«äº†ã€‚

> æ³¨: åœ¨åŒºå—é“¾ä¸­**å®‰å…¨åœ°**äº§ç”Ÿä¸€ä¸ªéšæœºæ•°æ˜¯ä¸€ä¸ªå¾ˆéš¾çš„é—®é¢˜ï¼Œ æœ¬ä¾‹çš„æ–¹æ³•ä¸å®‰å…¨ï¼Œä½†æ˜¯åœ¨æˆ‘ä»¬çš„Zombie DNAç®—æ³•é‡Œä¸æ˜¯é‚£ä¹ˆé‡è¦ï¼Œå·²ç»å¾ˆå¥½åœ°æ»¡è¶³æˆ‘ä»¬çš„éœ€è¦äº†ã€‚

### ç±»å‹è½¬æ¢

æœ‰æ—¶ä½ éœ€è¦å˜æ¢æ•°æ®ç±»å‹ã€‚ä¾‹å¦‚:

```
uint8 a = 5;
uint b = 6;
// å°†ä¼šæŠ›å‡ºé”™è¯¯ï¼Œå› ä¸º a * b è¿”å› uint, è€Œä¸æ˜¯ uint8:
uint8 c = a * b;
// æˆ‘ä»¬éœ€è¦å°† b è½¬æ¢ä¸º uint8:
uint8 c = a * uint8(b);
```

ä¸Šé¢, `a * b` è¿”å›ç±»å‹æ˜¯ `uint`, ä½†æ˜¯å½“æˆ‘ä»¬å°è¯•ç”¨ `uint8` ç±»å‹æ¥æ”¶æ—¶, å°±ä¼šé€ æˆæ½œåœ¨çš„é”™è¯¯ã€‚å¦‚æœæŠŠå®ƒçš„æ•°æ®ç±»å‹è½¬æ¢ä¸º `uint8`, å°±å¯ä»¥äº†ï¼Œç¼–è¯‘å™¨ä¹Ÿä¸ä¼šå‡ºé”™ã€‚



### æ¡ˆä¾‹

ğŸ’¡ç®€å•çš„ä¸€ä¸ªæ¡ˆä¾‹å¦‚ä¸‹ï¼š

ç»™ `_generateRandomDna` å‡½æ•°æ·»åŠ ä»£ç ! å®ƒåº”è¯¥å®Œæˆå¦‚ä¸‹åŠŸèƒ½:

1. ç¬¬ä¸€è¡Œä»£ç å– `_str` çš„ `keccak256` æ•£åˆ—å€¼ç”Ÿæˆä¸€ä¸ªä¼ªéšæœºåå…­è¿›åˆ¶æ•°ï¼Œç±»å‹è½¬æ¢ä¸º `uint`, æœ€åä¿å­˜åœ¨ç±»å‹ä¸º `uint` åä¸º `rand` çš„å˜é‡ä¸­ã€‚
2. æˆ‘ä»¬åªæƒ³è®©æˆ‘ä»¬çš„DNAçš„é•¿åº¦ä¸º16ä½ (è¿˜è®°å¾— `dnaModulus`?)ã€‚æ‰€ä»¥ç¬¬äºŒè¡Œä»£ç åº”è¯¥ `return` ä¸Šé¢è®¡ç®—çš„æ•°å€¼å¯¹ `dnaModulus` æ±‚ä½™æ•°(`%`)ã€‚

ğŸš€ ç¼–è¯‘ç»“æœå¦‚ä¸‹ï¼š

```go
pragma solidity ^0.4.19;

contract ZombieFactory {

    uint dnaDigits = 16;
    uint dnaModulus = 10 ** dnaDigits;

    struct Zombie {
        string name;
        uint dna;
    }

    Zombie[] public zombies;

    function _createZombie(string _name, uint _dna) private {
        zombies.push(Zombie(_name, _dna));
    }

    function _generateRandomDna(string _str) private view returns (uint) {
        // è¿™é‡Œå¼€å§‹
        uint rand = uint(keccak256(_str));
        return rand % dnaModulus;
    }
}
```



## äº‹ä»¶

**äº‹ä»¶** æ˜¯åˆçº¦å’ŒåŒºå—é“¾é€šè®¯çš„ä¸€ç§æœºåˆ¶ã€‚ä½ çš„å‰ç«¯åº”ç”¨â€œç›‘å¬â€æŸäº›äº‹ä»¶ï¼Œå¹¶åšå‡ºååº”ã€‚

ğŸ’¡ç®€å•çš„ä¸€ä¸ªæ¡ˆä¾‹å¦‚ä¸‹ï¼š

```solidity
// è¿™é‡Œå»ºç«‹äº‹ä»¶
event IntegersAdded(uint x, uint y, uint result);

function add(uint _x, uint _y) public {
  uint result = _x + _y;
  //è§¦å‘äº‹ä»¶ï¼Œé€šçŸ¥app
  IntegersAdded(_x, _y, result);
  return result;
}
```

ä½ çš„ app å‰ç«¯å¯ä»¥ç›‘å¬è¿™ä¸ªäº‹ä»¶ã€‚JavaScript å®ç°å¦‚ä¸‹:

```solidity
YourContract.IntegersAdded(function(error, result) {
  // å¹²äº›äº‹
})
```

### å®æˆ˜æ¼”ä¹ 

æˆ‘ä»¬æƒ³æ¯å½“ä¸€ä¸ªåƒµå°¸åˆ›é€ å‡ºæ¥æ—¶ï¼Œæˆ‘ä»¬çš„å‰ç«¯éƒ½èƒ½ç›‘å¬åˆ°è¿™ä¸ªäº‹ä»¶ï¼Œå¹¶å°†å®ƒæ˜¾ç¤ºå‡ºæ¥ã€‚

1ã€‚ å®šä¹‰ä¸€ä¸ª `äº‹ä»¶` å«åš `NewZombie`ã€‚ å®ƒæœ‰3ä¸ªå‚æ•°: `zombieId` (`uint`)ï¼Œ `name` (`string`)ï¼Œ å’Œ `dna` (`uint`)ã€‚

2ã€‚ ä¿®æ”¹ `_createZombie` å‡½æ•°ä½¿å¾—å½“æ–°åƒµå°¸é€ å‡ºæ¥å¹¶åŠ å…¥ `zombies`æ•°ç»„åï¼Œç”Ÿæˆäº‹ä»¶`NewZombie`ã€‚

3ã€‚ éœ€è¦å®šä¹‰åƒµå°¸`id`ã€‚ `array.push()` è¿”å›æ•°ç»„çš„é•¿åº¦ç±»å‹æ˜¯`uint` - å› ä¸ºæ•°ç»„çš„ç¬¬ä¸€ä¸ªå…ƒç´ çš„ç´¢å¼•æ˜¯ 0ï¼Œ `array.push() - 1` å°†æ˜¯æˆ‘ä»¬åŠ å…¥çš„åƒµå°¸çš„ç´¢å¼•ã€‚ `zombies.push() - 1` å°±æ˜¯ `id`ï¼Œæ•°æ®ç±»å‹æ˜¯ `uint`ã€‚åœ¨ä¸‹ä¸€è¡Œä¸­ä½ å¯ä»¥æŠŠå®ƒç”¨åˆ° `NewZombie` äº‹ä»¶ä¸­ã€‚

ğŸ’¡ç®€å•çš„ä¸€ä¸ªæ¡ˆä¾‹å¦‚ä¸‹ï¼š

```solidity
pragma solidity ^0.4.19;

contract ZombieFactory {

    event NewZombie(uint zombieId, string name, uint dna);

    uint dnaDigits = 16;
    uint dnaModulus = 10 ** dnaDigits;

    struct Zombie {
        string name;
        uint dna;
    }

    Zombie[] public zombies;

    function _createZombie(string _name, uint _dna) private {
        uint id = zombies.push(Zombie(_name, _dna)) - 1;
        NewZombie(id, _name, _dna);
    }

    function _generateRandomDna(string _str) private view returns (uint) {
        uint rand = uint(keccak256(_str));
        return rand % dnaModulus;
    }

    function createRandomZombie(string _name) public {
        uint randDna = _generateRandomDna(_name);
        _createZombie(_name, randDna);
    }

}

```







## END é“¾æ¥

<ul><li><div><a href = '12.md' style='float:left'>â¬†ï¸ä¸Šä¸€èŠ‚ğŸ”—</a><a href = '14.md' style='float: right'>â¬‡ï¸ä¸‹ä¸€èŠ‚ğŸ”—</a></div></li></ul>

+ [â“‚ï¸å›åˆ°ç›®å½•ğŸ ](../README.md)

+ [**ğŸ«µå‚ä¸è´¡çŒ®ğŸ’â¤ï¸â€ğŸ”¥ğŸ’–**](https://nsddd.top/archives/contributors))

+ âœ´ï¸ç‰ˆæƒå£°æ˜ &copy; :æœ¬ä¹¦æ‰€æœ‰å†…å®¹éµå¾ª[CC-BY-SA 3.0åè®®ï¼ˆç½²å-ç›¸åŒæ–¹å¼å…±äº«ï¼‰&copy;](http://zh.wikipedia.org/wiki/Wikipedia:CC-by-sa-3.0åè®®æ–‡æœ¬) 

