+ [author](http://nsddd.top)

# ç¬¬16èŠ‚ é«˜çº§solidityç†è®º

<div><a href = '15.md' style='float:left'>â¬†ï¸ä¸Šä¸€èŠ‚ğŸ”—</a><a href = '17.md' style='float: right'>â¬‡ï¸ä¸‹ä¸€èŠ‚ğŸ”—</a></div>
<br>

> â¤ï¸ğŸ’•ğŸ’•æ¬¢è¿æ¥åˆ°web3çš„æ•™ç¨‹ï¼Œåœ¨è¿™é‡Œï¼Œå°†ä¼šå­¦ä¹ åˆ°æ™ºèƒ½åˆçº¦ï¼ŒåŒºå—é“¾åº•å±‚åŸç†ï¼Œethå’Œbtcå­¦ä¹ ï¼Œweb3æˆ–å°†ä¼šé¢ è¦†ä¸–ç•ŒğŸ˜~Myblog:[http://nsddd.top](http://nsddd.top/)

---
[TOC]

## æ™ºèƒ½åè®®çš„æ°¸å›ºæ€§

> æ¥ä¸‹æ¥æˆ‘ä»¬å°†ä¼šæ­£å¼ç”¨`remix`ideæ¥ç¼–å†™ç¨‹åºã€‚

åˆ°ç°åœ¨ä¸ºæ­¢ï¼Œæˆ‘ä»¬è®²çš„ Solidity å’Œå…¶ä»–è¯­è¨€æ²¡æœ‰è´¨çš„åŒºåˆ«ï¼Œå®ƒé•¿å¾—ä¹Ÿå¾ˆåƒ JavaScriptã€‚

ä½†æ˜¯ï¼Œåœ¨æœ‰å‡ ç‚¹ä»¥å¤ªåŠä¸Šçš„ DApp è·Ÿæ™®é€šçš„åº”ç”¨ç¨‹åºæœ‰ç€å¤©å£¤ä¹‹åˆ«ã€‚

ç¬¬ä¸€ä¸ªä¾‹å­ï¼Œåœ¨ä½ æŠŠæ™ºèƒ½åè®®ä¼ ä¸Šä»¥å¤ªåŠä¹‹åï¼Œå®ƒå°±å˜å¾—***ä¸å¯æ›´æ”¹***, è¿™ç§æ°¸å›ºæ€§æ„å‘³ç€ä½ çš„ä»£ç æ°¸è¿œä¸èƒ½è¢«è°ƒæ•´æˆ–æ›´æ–°ã€‚

> è¿™ä¸ªä¹Ÿç®—æ˜¯ç”¨åˆ°äº†åŒºå—é“¾çš„ä¸Šé“¾åçš„ä¸å¯ç¯¡æ”¹æ€§è´¨

ä½ ç¼–è¯‘çš„ç¨‹åºä¼šä¸€ç›´ï¼Œæ°¸ä¹…çš„ï¼Œä¸å¯æ›´æ”¹çš„ï¼Œå­˜åœ¨ä»¥å¤ªåŠä¸Šã€‚è¿™å°±æ˜¯ Solidity ä»£ç çš„å®‰å…¨æ€§å¦‚æ­¤é‡è¦çš„ä¸€ä¸ªåŸå› ã€‚å¦‚æœä½ çš„æ™ºèƒ½åè®®æœ‰ä»»ä½•æ¼æ´ï¼Œå³ä½¿ä½ å‘ç°äº†ä¹Ÿæ— æ³•è¡¥æ•‘ã€‚ä½ åªèƒ½è®©ä½ çš„ç”¨æˆ·ä»¬æ”¾å¼ƒè¿™ä¸ªæ™ºèƒ½åè®®ï¼Œç„¶åè½¬ç§»åˆ°ä¸€ä¸ªæ–°çš„ä¿®å¤åçš„åˆçº¦ä¸Šã€‚

ä½†è¿™æ°å¥½ä¹Ÿæ˜¯æ™ºèƒ½åˆçº¦çš„ä¸€å¤§ä¼˜åŠ¿ã€‚ä»£ç è¯´æ˜ä¸€åˆ‡ã€‚å¦‚æœä½ å»è¯»æ™ºèƒ½åˆçº¦çš„ä»£ç ï¼Œå¹¶éªŒè¯å®ƒï¼Œä½ ä¼šå‘ç°ï¼Œä¸€æ—¦å‡½æ•°è¢«å®šä¹‰ä¸‹æ¥ï¼Œæ¯ä¸€æ¬¡çš„è¿è¡Œï¼Œç¨‹åºéƒ½ä¼šä¸¥æ ¼éµç…§å‡½æ•°ä¸­åŸæœ‰çš„ä»£ç é€»è¾‘ä¸€ä¸ä¸è‹Ÿåœ°æ‰§è¡Œï¼Œå®Œå…¨ä¸ç”¨æ‹…å¿ƒå‡½æ•°è¢«äººç¯¡æ”¹è€Œå¾—åˆ°æ„å¤–çš„ç»“æœã€‚



## äº‹ä»¶Event

äº‹ä»¶æ˜¯èƒ½æ–¹ä¾¿åœ°è°ƒç”¨ä»¥å¤ªåŠè™šæ‹Ÿæœºæ—¥å¿—åŠŸèƒ½çš„æ¥å£ã€‚

```solidity
pragma solidity >=0.4.21 <0.9.0;
contract TinyAuction {
    event HighestBidIncreased(address bidder, uint amount); // äº‹ä»¶

    function bid() public payable {
        // ...
        emit HighestBidIncreased(msg.sender, msg.value); // è§¦å‘äº‹ä»¶
    }
}
```



**ğŸ’¡ç®€å•çš„ä¸€ä¸ªæ¡ˆä¾‹å¦‚ä¸‹ï¼š**

```solidity
pragma solidity ^0.4.16;
// a:xiongxinwei
contract SimpleStorage {
    uint storedData;

    //å®šä¹‰ä¸€ä¸ªäº‹ä»¶
    event Set(uint x);

    ///å®šä¹‰ä¸€ä¸ªç»“æ„ä½“
    struct Voter {
        uint weight;
        bool voted;
    }

    // æˆ‘çš„åœ°å€ -- è®¾ç½®ä¸ºå…¬æœ‰ 
    address public owner = 0x5B38Da6a701c568545dCfcB03FcB875f56beddC4;
    

    modifier onlyOwner() {
        require(owner == msg.sender, "only owner can call this function");
        _;
    }

    function set(uint x) public {
        storedData = x;
        //äº‹ä»¶
        emit Set(storedData);
    }

    function get() public view returns (uint) {
        return storedData;
    }
}

contract Test {
    uint x;

    function set(uint y) public {
        x = y;
    }
}
```

**ğŸš€ ç¼–è¯‘ç»“æœå¦‚ä¸‹ï¼š**

![image-20221009163942946](./images/image-20221009163942946.png)



## ç»“æ„ä½“

> å®šä¹‰ä¸€ä¸ªæŠ•ç¥¨çš„ç»“æ„ä½“

**ğŸ’¡ç®€å•çš„ä¸€ä¸ªæ¡ˆä¾‹å¦‚ä¸‹ï¼š**

```solidity
pragma solidity ^0.4.16;
// a:xiongxinwei
contract SimpleStorage {
    uint storedData;

    //å®šä¹‰ä¸€ä¸ªäº‹ä»¶
    event Set(uint x);

    ///å®šä¹‰ä¸€ä¸ªç»“æ„ä½“
    struct Voter {
        uint weight;
        bool voted;
    }

    //ç”¨ç»“æ„ä½“å®šä¹‰æ•°ç»„
    Voter[] public voter;

    // æˆ‘çš„åœ°å€ -- è®¾ç½®ä¸ºå…¬æœ‰ 
    address public owner = 0x5B38Da6a701c568545dCfcB03FcB875f56beddC4;
    

    modifier onlyOwner() {
        require(owner == msg.sender, "only owner can call this function");
        _;
    }

    function set(uint x) public {
        storedData = x;
        //äº‹ä»¶
        emit Set(storedData);
    }

    function setVoter(uint _weight, bool _voted) public {
        //ç»“æ„ä½“å†™å…¥
        voter.push(Voter(_weight,_voted));
    }

    function get() public view returns (uint) {
        return storedData;
    }
}

contract Test {
    uint x;

    function set(uint y) public {
        x = y;
    }
}
```



**ğŸš€ ç¼–è¯‘ç»“æœå¦‚ä¸‹ï¼š**

![image-20221009164821757](./images/image-20221009164821757.png)



## æšä¸¾ç±»å‹

æšä¸¾å¯ç”¨æ¥åˆ›å»ºç”±ä¸€å®šæ•°é‡çš„â€œå¸¸é‡å€¼â€æ„æˆçš„è‡ªå®šä¹‰ç±»å‹ï¼ˆå‚é˜…ç±»å‹ç« èŠ‚ä¸­çš„ [æšä¸¾ç±»å‹](https://learnblockchain.cn/docs/solidity/types.html#enums)ï¼‰ã€‚

```solidity
pragma solidity >=0.4.0 <0.9.0;

contract Upchain {
    enum State { Created, Locked, InValid } // æšä¸¾
}
```



### åŒºå—å’Œäº¤æ˜“å±æ€§

+ `blockhash(uint blockNumber) returns (bytes32)`ï¼šæŒ‡å®šåŒºå—çš„åŒºå—å“ˆå¸Œ â€”â€” ä»…å¯ç”¨äºæœ€æ–°çš„ 256 ä¸ªåŒºå—ä¸”ä¸åŒ…æ‹¬å½“å‰åŒºå—ï¼Œå¦åˆ™è¿”å› 0 ã€‚
+ `block.basefee` (`uint`): å½“å‰åŒºå—çš„åŸºç¡€è´¹ç”¨ï¼Œå‚è€ƒï¼š ([EIP-3198](https://eips.ethereum.org/EIPS/eip-3198) å’Œ [EIP-1559](https://eips.ethereum.org/EIPS/eip-1559))
+ `block.chainid` (`uint`): å½“å‰é“¾ id
+ `block.coinbase` ( `address` ): æŒ–å‡ºå½“å‰åŒºå—çš„çŸ¿å·¥åœ°å€
+ `block.difficulty` ( `uint` ): å½“å‰åŒºå—éš¾åº¦
+ `block.gaslimit` ( `uint` ): å½“å‰åŒºå— gas é™é¢
+ `block.number` ( `uint` ): å½“å‰åŒºå—å·
+ `block.timestamp` ( `uint`): è‡ª unix epoch èµ·å§‹å½“å‰åŒºå—ä»¥ç§’è®¡çš„æ—¶é—´æˆ³
+ `gasleft() returns (uint256)` ï¼šå‰©ä½™çš„ `gas`
+ `msg.data` ( `bytes` ): å®Œæ•´çš„ `calldata`
+ `msg.sender` ( `address` ): æ¶ˆæ¯å‘é€è€…ï¼ˆå½“å‰è°ƒç”¨ï¼‰
+ `msg.sig` ( `bytes4` ): `calldata` çš„å‰ `4` å­—èŠ‚ï¼ˆä¹Ÿå°±æ˜¯å‡½æ•°æ ‡è¯†ç¬¦ï¼‰
+ `msg.value` ( `uint` ): éšæ¶ˆæ¯å‘é€çš„ wÂ·ei çš„æ•°é‡
+ `tx.gasprice` (`uint`): äº¤æ˜“çš„ `gas` ä»·æ ¼
+ `tx.origin` ( `address` ): äº¤æ˜“å‘èµ·è€…ï¼ˆå®Œå…¨çš„è°ƒç”¨é“¾ï¼‰



ğŸ“œ å¯¹ä¸Šé¢çš„è§£é‡Šï¼š

å¯¹äºæ¯ä¸€ä¸ª**å¤–éƒ¨å‡½æ•°**è°ƒç”¨ï¼ŒåŒ…æ‹¬ `msg.sender` å’Œ `msg.value` åœ¨å†…æ‰€æœ‰ `msg` æˆå‘˜çš„å€¼éƒ½ä¼šå˜åŒ–ã€‚è¿™é‡ŒåŒ…æ‹¬å¯¹åº“å‡½æ•°çš„è°ƒç”¨ã€‚

å½“åˆçº¦åœ¨é“¾ä¸‹è¢«è¯„ä¼°ï¼Œè€Œä¸æ˜¯åœ¨ä¸€ä¸ªåŒºå—æ‰€åŒ…å«çš„äº¤æ˜“çš„èƒŒæ™¯ä¸‹è¢«è¯„ä¼°æ—¶ï¼Œä½ ä¸åº”è¯¥å‡å®š `block.*` å’Œ `tx.*` æ˜¯æŒ‡ä»»ä½•ç‰¹å®šåŒºå—æˆ–äº¤æ˜“ã€‚è¿™äº›å€¼æ˜¯ç”±æ‰§è¡Œåˆçº¦çš„EVMå®ç°æä¾›çš„ï¼Œå¯ä»¥æ˜¯ä»»æ„çš„ã€‚

ä¸è¦ä¾èµ– `block.timestamp` å’Œ `blockhash` äº§ç”Ÿéšæœºæ•°ï¼Œé™¤éä½ æ˜ç¡®çŸ¥é“è‡ªå·±åšçš„ç”¨æ„ã€‚

æ—¶é—´æˆ³å’ŒåŒºå—å“ˆå¸Œåœ¨ä¸€å®šç¨‹åº¦ä¸Šéƒ½å¯èƒ½å—åˆ°æŒ–çŸ¿çŸ¿å·¥å½±å“ã€‚ä¾‹å¦‚ï¼ŒæŒ–çŸ¿ç¤¾åŒºä¸­çš„æ¶æ„çŸ¿å·¥å¯ä»¥ç”¨æŸä¸ªç»™å®šçš„å“ˆå¸Œæ¥è¿è¡ŒèµŒåœºåˆçº¦çš„ payout å‡½æ•°ï¼Œè€Œå¦‚æœä»–ä»¬æ²¡æ”¶åˆ°é’±ï¼Œè¿˜å¯ä»¥ç”¨ä¸€ä¸ªä¸åŒçš„å“ˆå¸Œé‡æ–°å°è¯•ã€‚

å½“å‰åŒºå—çš„æ—¶é—´æˆ³å¿…é¡»ä¸¥æ ¼å¤§äºæœ€åä¸€ä¸ªåŒºå—çš„æ—¶é—´æˆ³ï¼Œä½†è¿™é‡Œèƒ½ç¡®ä¿ä¹Ÿéœ€è¦å®ƒæ˜¯åœ¨æƒå¨é“¾ä¸Šçš„ä¸¤ä¸ªè¿ç»­åŒºå—ã€‚

åŸºäºå¯æ‰©å±•å› ç´ ï¼ŒåŒºå—å“ˆå¸Œä¸æ˜¯å¯¹æ‰€æœ‰åŒºå—éƒ½æœ‰æ•ˆã€‚ä½ ä»…ä»…å¯ä»¥è®¿é—®æœ€è¿‘ 256 ä¸ªåŒºå—çš„å“ˆå¸Œï¼Œå…¶ä½™çš„å“ˆå¸Œå‡ä¸ºé›¶ã€‚

`blockhash` å‡½æ•°ä¹‹å‰æ˜¯ä½¿ç”¨ `block.blockhash`ï¼Œ `block.blockhash` åœ¨ 0.4.22 å¼€å§‹ä¸æ¨èä½¿ç”¨ï¼Œåœ¨ 0.5.0 å·²ç»ç§»é™¤äº†ã€‚

`gasleft` å‡½æ•°ä¹‹å‰æ˜¯ä½¿ç”¨ `msg.gas`, `msg.gas` åœ¨ 0.4.21 å¼€å§‹ä¸æ¨èä½¿ç”¨ï¼Œåœ¨ 0.5.0 å·²ç»ç§»é™¤äº†ã€‚

åœ¨ 0.7.0, `now` ( `block.timestamp` çš„åˆ«å) è¢«ç§»é™¤äº†ã€‚



## END é“¾æ¥

<ul><li><div><a href = '15.md' style='float:left'>â¬†ï¸ä¸Šä¸€èŠ‚ğŸ”—</a><a href = '17.md' style='float: right'>â¬‡ï¸ä¸‹ä¸€èŠ‚ğŸ”—</a></div></li></ul>

+ [â“‚ï¸å›åˆ°ç›®å½•ğŸ ](../README.md)

+ [**ğŸ«µå‚ä¸è´¡çŒ®ğŸ’â¤ï¸â€ğŸ”¥ğŸ’–**](https://nsddd.top/archives/contributors))

+ âœ´ï¸ç‰ˆæƒå£°æ˜ &copy; :æœ¬ä¹¦æ‰€æœ‰å†…å®¹éµå¾ª[CC-BY-SA 3.0åè®®ï¼ˆç½²å-ç›¸åŒæ–¹å¼å…±äº«ï¼‰&copy;](http://zh.wikipedia.org/wiki/Wikipedia:CC-by-sa-3.0åè®®æ–‡æœ¬) 

