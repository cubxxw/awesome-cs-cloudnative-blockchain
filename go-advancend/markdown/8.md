+ [author](https://github.com/3293172751)
# ç¬¬8èŠ‚ å†™å…¥æ¨¡å—çš„å®ç°

+ [å›åˆ°ç›®å½•](../README.md)
+ [ä¸Šä¸€èŠ‚](7.md)
> â¤ï¸ğŸ’•ğŸ’•Goè¯­è¨€é«˜çº§ç¯‡ç« ,åœ¨æ­¤ä¹‹å‰å»ºè®®æ‚¨å…ˆäº†è§£åŸºç¡€å’Œè¿›é˜¶ç¯‡ã€‚Myblog:[http://nsddd.top](http://nsddd.top/)
> ###  **[Goè¯­è¨€åŸºç¡€ç¯‡](https://github.com/3293172751/Block_Chain/blob/master/TOC.md)**
>
> ###  **[Goè¯­è¨€100ç¯‡è¿›é˜¶](https://github.com/3293172751/Block_Chain/blob/master/Gomd_super/README.md)**
---


[TOC]

###  å†™å…¥æ¨¡å—çš„å®ç°

1. åˆå§‹åŒ–Influxdb cllient
2. ä»write channelä¸­è¯»å–åˆ°ç›‘æ§æ•°æ®
3. æ„é€ æ•°æ®å¹¶ä¸”å†™å…¥åˆ°influxdb



**pullåŒ…**

```
go get github.com/influxdata/influxdb1-client/v2  
```

**å¯¼å…¥åŒ…**

```
import "github.com/influxdata/influxdb1-client/v2"
```



### å†™å…¥æ¨¡å—ç¨‹åº

```go
func (w *WriteToInfluxDB) Writer(wc chan *Message) {
	//å†™å…¥æ¨¡å—
	infSli := strings.Split(w.influxDBsn, "@") //ä½¿ç”¨@åšåˆ‡å‰²

	// Create a new HTTPClient
	c, err := client.NewHTTPClient(client.HTTPConfig{
		Addr:     infSli[0], //åœ°å€
		Username: infSli[1], //ç”¨æˆ·å
		Password: infSli[2], //å¯†ç 
	})
	if err != nil {
		log.Fatal(err)
	}
	defer c.Close()

	// Create a new point batch
	bp, err := client.NewBatchPoints(client.BatchPointsConfig{
		Database:  infSli[3],
		Precision: infSli[4],
	})
	if err != nil {
		log.Fatal(err)
	}

	for v := range wc {
		// å¾ªç¯çš„å†™å…¥æ•°æ®
		/*
			+ Tagsï¼šPath, Method, Scheme, Status
			+ Fieldsï¼šUpstreamTime, RequestTimeï¼ŒBytesSent
			+ Timeï¼šTimeLocal
		*/
		tags := map[string]string{"Path": v.Path, "Method": v.Method, "Scheme": v.Scheme, "Status": v.Status}
		fields := map[string]interface{}{
			"UpstreamTime": v.UpstreamTime,
			"RequestTime":  v.RequestTime,
			"BytesSent":    v.BytesSent,
		}

		pt, err := client.NewPoint("nginx_log", tags, fields, time.Now()) //åˆ›å»ºInfluxdbå­—æ®µ
		if err != nil {
			log.Fatal("client.NewPoint err = ", err)
		}
		bp.AddPoint(pt)

		// Write the batch
		if err := c.Write(bp); err != nil {
			log.Fatal(err)
		}

		// Close client resources
		if err := c.Close(); err != nil {
			log.Fatal(err)
		}

		log.Println("write success") //å¦‚æœå†™å…¥æˆåŠŸå°±æ‰“å°æ—¥å¿—
	}
}
```



## END é“¾æ¥
+ [å›åˆ°ç›®å½•](../README.md)
+ [ä¸Šä¸€èŠ‚](7.md)
+ [ä¸‹ä¸€èŠ‚](9.md)
---
+ [å‚ä¸è´¡çŒ®â¤ï¸ğŸ’•ğŸ’•](https://github.com/3293172751/Block_Chain/blob/master/Git/git-contributor.md)