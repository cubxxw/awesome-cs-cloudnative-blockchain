+ [author](https://github.com/3293172751)

# ç¬¬6èŠ‚ è§£ææ¨¡å—çš„å®ç°

+ [å›åˆ°ç›®å½•](../README.md)
+ [ä¸Šä¸€èŠ‚](5.md)
> â¤ï¸ğŸ’•ğŸ’•Goè¯­è¨€é«˜çº§ç¯‡ç« ,åœ¨æ­¤ä¹‹å‰å»ºè®®æ‚¨å…ˆäº†è§£åŸºç¡€å’Œè¿›é˜¶ç¯‡ã€‚Myblog:[http://nsddd.top](http://nsddd.top/)
###  **[Goè¯­è¨€åŸºç¡€ç¯‡](https://github.com/3293172751/Block_Chain/blob/master/TOC.md)**
###  **[Goè¯­è¨€100ç¯‡è¿›é˜¶](https://github.com/3293172751/Block_Chain/blob/master/Gomd_super/README.md)**
---
[TOC]

### è§£ææ¨¡å—çš„åŠŸèƒ½

1. ä»Read Channelä¸­è¯»å–æ¯è¡Œæ—¥å¿—æ•°æ®
2. æ­£åˆ™è¡¨è¾¾å¼æå–æ‰€éœ€è¦çš„ç›‘æ§æ•°æ®ï¼ˆpathï¼Œstatus,methodç­‰ï¼‰
   + [æ­£åˆ™è¡¨è¾¾å¼æ•™ç¨‹](https://github.com/3293172751/Block_Chain/blob/master/Gomd_super/zhenze.md)
3. å†™å…¥åˆ°write channel



### è§£ææ¨¡å—çš„å®ç°

```go
func (l *LogProcess) Process() {
	//è§£ææ¨¡å—
	/* è¾“å…¥æ•°æ®ï¼š
	[07/July/2022:18:01:41 +0000] http "GET /foo?query=t HTTP/1.0" 200 2133 "-"
	"KeepAliveClient" "-" 1.005 1.854
	*/
	//å¤„ç†æ•°æ®--å°†dataä¸­çš„æ‰€æœ‰å­—ç¬¦ä¿®æ”¹ä¸ºå…¶å¤§å†™æ ¼å¼ã€‚å¯¹äºéASCIIå­—ç¬¦ï¼Œå®ƒçš„å¤§å†™æ ¼å¼éœ€è¦æŸ¥è¡¨è½¬æ¢
	r := regexp.MustCompile(`\[([^\]]+)\]\s+(.*?)\s+\"(.*?)\"\s+(\d{3})\s+(\d+)\s+\"([^"]+
	)\"\s+\"(.*?)\"\s+\"([\d\.-]+)\"\s+([\d\.-]+)\s+([\d\.-]+)`)

	loc, err := time.LoadLocation("Asia/Shanghai") //æˆ‘ä»¬ç”¨çš„æ˜¯ä¸Šæµ·æ—¶åŒº
	if err != nil {                                //å¯ä»¥å¿½ç•¥errä¸€èˆ¬ä¸ä¼šæœ‰é”™
		panic(fmt.Sprintf("time error:%s", err.Error()))
	}
	for v := range l.rc {
		ret := r.FindStringSubmatch(string(v)) //åŒ¹é…æ•°æ®å†…å®¹ï¼Œæ­£åˆ™æ‹¬å·å†…å®¹åŒ¹é…åˆ°è¿”å›åˆ°
		//fmt.Println(ret)
		if len(ret) != 14 { //æ­£åˆ™è¡¨è¾¾å¼æœ‰åä¸‰ä¸ªæ‹¬å·
			log.Println("FindStringSubmatch fail:", string(v))
			continue //ç»§ç»­ä¸‹ä¸€æ¬¡åŒ¹é…
		}

		message := &Message{}
		t, err := time.ParseInLocation("09/Jan/2006:15:04:05 +0000", ret[4], loc)
		if err != nil {
			panic(fmt.Sprintf("parseninlocation error:%s", ret[4]))
		}
		message.TimeLocal = t
		byteSent, _ := strconv.Atoi(ret[8]) //å°†stringç±»å‹è½¬åŒ–ä¸ºint
		// if err != nil {
		// 	panic(fmt.Sprintf("parseninlocation error:%s", err.Error(), ret[4]))
		// }
		message.BytesSent = byteSent

		//ç¬¬å…­ä¸ªæ‹¬å·åŒ¹é…çš„æ˜¯GET /foo?query=t HTTP/1.0
		reqSli := strings.Split(ret[6], " ") //æŒ‰ç…§ç©ºæ ¼åˆ‡å‰²ç¬¬å…­ä¸ªå­—æ®µ
		if len(reqSli) != 3 {
			log.Println("strings.split fail", ret[6]) //é•¿åº¦ä¸æ˜¯3è¯´æ˜æŠ¥é”™äº†
			continue
		}

		message.Method = reqSli[0]

		u, err := url.Parse(reqSli[1])
		if err != nil {
			log.Println("url parse fail", ret[1])
			continue
		}
		message.Path = u.Path //æ­¤æ—¶å¯ä»¥ç›´æ¥ä»ç»“æ„ä½“ä¸­å–åˆ°path

		message.Scheme = ret[5] //HTTP/1.0åè®®å¯ä»¥ç›´æ¥èµ‹å€¼ç»™mess
		message.Status = ret[7]

		//UpstreamTime, RequestTime    float64   //ç›‘æ§æ•°æ®  1.005 1.854åœ¨åäºŒåˆ°åä¸‰
		upstreamTime, err := strconv.ParseFloat(ret[12], 64) //è½¬åŒ–ä¸ºfloat64
		if err != nil {
			fmt.Println("err = ", err, ret[1])
			continue
		}
		requestTime, err := strconv.ParseFloat(ret[13], 64) //è½¬åŒ–ä¸ºfloat64
		if err != nil {
			fmt.Println("err = ", err, ret[1])
			continue
		}
		message.UpstreamTime = upstreamTime
		message.RequestTime = requestTime

		l.wc <- message //dataæ˜¯byteç±»å‹ï¼Œéœ€è¦è½¬åŒ–ä¸ºstringç±»å‹
	}
}
```



## END é“¾æ¥

+ [å›åˆ°ç›®å½•](../README.md)
+ [ä¸Šä¸€èŠ‚](5.md)
+ [ä¸‹ä¸€èŠ‚](7.md)
---
+ [å‚ä¸è´¡çŒ®â¤ï¸ğŸ’•ğŸ’•](https://github.com/3293172751/Block_Chain/blob/master/Git/git-contributor.md)