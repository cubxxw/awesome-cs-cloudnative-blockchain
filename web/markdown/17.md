+ [author](https://github.com/3293172751)
# ç¬¬17èŠ‚ golangä¸­çš„socketé€šä¿¡ 
+ [å›åˆ°ç›®å½•](../README.md)
+ [å›åˆ°é¡¹ç›®é¦–é¡µ](../../README.md)
+ [ä¸Šä¸€èŠ‚](16.md)
> â¤ï¸ğŸ’•ğŸ’•è®¡ç®—æœºç½‘ç»œ--TCP/IP å­¦ä¹ ã€‚Myblog:[http://nsddd.top](http://nsddd.top/)
---
[TOC]

## TCP å®ç°

ä¸€ä¸ª TCP å®¢æˆ·ç«¯è¿›è¡Œ TCP é€šä¿¡çš„æµç¨‹å¦‚ä¸‹ï¼š

1. å»ºç«‹ä¸æœåŠ¡ç«¯çš„é“¾æ¥
2. è¿›è¡Œæ•°æ®æ”¶å‘
3. å…³é—­é“¾æ¥

### server ç«¯

```go
package main

import (
    "bufio"
    "fmt"
    "net"
)

func process(conn net.Conn) {
    // å¤„ç†å®Œå…³é—­è¿æ¥
    defer conn.Close()

    // é’ˆå¯¹å½“å‰è¿æ¥åšå‘é€å’Œæ¥å—æ“ä½œ
    for {
        reader := bufio.NewReader(conn)
        var buf [128]byte
        n, err := reader.Read(buf[:])
        if err != nil {
            fmt.Printf("read from conn failed, err:%v\n", err)
            break
        }

        recv := string(buf[:n])
        fmt.Printf("æ”¶åˆ°çš„æ•°æ®ï¼š%v\n", recv)

        // å°†æ¥å—åˆ°çš„æ•°æ®è¿”å›ç»™å®¢æˆ·ç«¯
        _, err = conn.Write([]byte("ok"))
        if err != nil {
            fmt.Printf("write from conn failed, err:%v\n", err)
            break
        }
    }
}

func main() {
    // å»ºç«‹ tcp æœåŠ¡
    listen, err := net.Listen("tcp", "127.0.0.1:9090")
    if err != nil {
        fmt.Printf("listen failed, err:%v\n", err)
        return
    }

    for {
        // ç­‰å¾…å®¢æˆ·ç«¯å»ºç«‹è¿æ¥
        conn, err := listen.Accept()
        if err != nil {
            fmt.Printf("accept failed, err:%v\n", err)
            continue
        }
        // å¯åŠ¨ä¸€ä¸ªå•ç‹¬çš„ goroutine å»å¤„ç†è¿æ¥
        go process(conn)
    }
}
```

### client ç«¯

```go
package main

import (
    "bufio"
    "fmt"
    "net"
    "os"
    "strings"
)

func main() {
    // 1ã€ä¸æœåŠ¡ç«¯å»ºç«‹è¿æ¥
    conn, err := net.Dial("tcp", "127.0.0.1:9090")
    if err != nil {
        fmt.Printf("conn server failed, err:%v\n", err)
        return
    }
    // 2ã€ä½¿ç”¨ conn è¿æ¥è¿›è¡Œæ•°æ®çš„å‘é€å’Œæ¥æ”¶
    input := bufio.NewReader(os.Stdin)
    for {
        s, _ := input.ReadString('\n')
        s = strings.TrimSpace(s)
        if strings.ToUpper(s) == "Q" {
            return
        }

        _, err = conn.Write([]byte(s))
        if err != nil {
            fmt.Printf("send failed, err:%v\n", err)
            return
        }
        // ä»æœåŠ¡ç«¯æ¥æ”¶å›å¤æ¶ˆæ¯
        var buf [1024]byte
        n, err := conn.Read(buf[:])
        if err != nil {
            fmt.Printf("read failed:%v\n", err)
            return
        }
        fmt.Printf("æ”¶åˆ°æœåŠ¡ç«¯å›å¤:%v\n", string(buf[:n]))
    }
}
```

## UDP å®ç°

UDP åè®®ï¼ˆUser Datagram Protocolï¼‰ä¸­æ–‡åç§°æ˜¯ç”¨æˆ·æ•°æ®æŠ¥åè®®ï¼Œæ˜¯OSIï¼ˆOpen System Interconnectionï¼Œå¼€æ”¾å¼ç³»ç»Ÿäº’è”ï¼‰å‚è€ƒæ¨¡å‹ä¸­ä¸€ç§**æ— è¿æ¥**çš„ä¼ è¾“å±‚åè®®ï¼Œä¸éœ€è¦å»ºç«‹è¿æ¥å°±èƒ½ç›´æ¥è¿›è¡Œæ•°æ®å‘é€å’Œæ¥æ”¶ï¼Œå±äºä¸å¯é çš„ã€æ²¡æœ‰æ—¶åºçš„é€šä¿¡ï¼Œä½†æ˜¯UDPåè®®çš„å®æ—¶æ€§æ¯”è¾ƒå¥½ï¼Œé€šå¸¸ç”¨äºè§†é¢‘ç›´æ’­ç›¸å…³é¢†åŸŸã€‚

### server ç«¯

```go
package main

import (
    "fmt"
    "net"
)

func main() {
    // å»ºç«‹ udp æœåŠ¡å™¨
    listen, err := net.ListenUDP("udp", &net.UDPAddr{
        IP:   net.IPv4(0, 0, 0, 0),
        Port: 9090,
    })
    if err != nil {
        fmt.Printf("listen failed error:%v\n", err)
        return
    }
    defer listen.Close() // ä½¿ç”¨å®Œå…³é—­æœåŠ¡

    for {
        // æ¥æ”¶æ•°æ®
        var data [1024]byte
        n, addr, err := listen.ReadFromUDP(data[:])
        if err != nil {
            fmt.Printf("read data error:%v\n", err)
            return
        }
        fmt.Printf("addr:%v\t count:%v\t data:%v\n", addr, n, string(data[:n]))
        // å‘é€æ•°æ®
        _, err = listen.WriteToUDP(data[:n], addr)
        if err != nil {
            fmt.Printf("send data error:%v\n", err)
            return
        }
    }
}
```

### client ç«¯

```go
package main

import (
    "fmt"
    "net"
)

func main() {
    // å»ºç«‹æœåŠ¡
    listen, err := net.DialUDP("udp", nil, &net.UDPAddr{
        IP:   net.IPv4(0, 0, 0, 0),
        Port: 9090,
    })
    if err != nil {
        fmt.Printf("listen udp server error:%v\n", err)
    }
    defer listen.Close()

    // å‘é€æ•°æ®
    sendData := []byte("Hello server")
    _, err = listen.Write(sendData) // å‘é€æ•°æ®
    if err != nil {
        fmt.Println("å‘é€æ•°æ®å¤±è´¥ï¼Œerr:", err)
        return
    }
```



## END é“¾æ¥
+ [å›åˆ°ç›®å½•](../README.md)
+ [ä¸Šä¸€èŠ‚](16.md)
+ [ä¸‹ä¸€èŠ‚](18.md)
---
+ [å‚ä¸è´¡çŒ®â¤ï¸ğŸ’•ğŸ’•](https://github.com/3293172751/CS_COURSE/blob/master/Git/git-contributor.md)
