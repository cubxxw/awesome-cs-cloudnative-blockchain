+ [author](https://github.com/3293172751)

# ç¬¬15èŠ‚ Cè¯­è¨€å¥—æ¥å­—é€šä¿¡

+ [å›åˆ°ç›®å½•](../README.md)
+ [å›åˆ°é¡¹ç›®é¦–é¡µ](../../README.md)
+ [ä¸Šä¸€èŠ‚](14.md)
> â¤ï¸ğŸ’•ğŸ’•è®¡ç®—æœºç½‘ç»œ--TCP/IP å­¦ä¹ ã€‚Myblog:[http://nsddd.top](http://nsddd.top/)
---
[TOC]

## select

```c
/*************************************************************************
    > File Name: c.c
    > Author: smile
    > Mail: 3293172751nss@gmail.com 
    > Created Time: Wed 20 Jul 2022 12:36:56 AM PDT
 ************************************************************************/
#include <stdio.h>
#include <stdlib.h>
#include <unistd.h>
#include <string.h>
#include <arpa/inet.h>

int main()
{
    //1. åˆ›å»ºç›‘å¬çš„å¥—æ¥å­—
    int fd = socket(AF_INET, SOCK_STREAM, 0);
    if(fd == -1)
    {
        perror("socket");
        exit(0);
        //return -1;
    }

    //2. ç»‘å®šæœ¬åœ°çš„IP,port
    struct sockaddr_in addr;
    addr.sin_family = AF_INET;
    addr.sin_port = htons(10000);   //è½¬åŒ–ä¸ºå¤§ç«¯ -- åé¢æ˜¯æŒ‡å®šçš„ç«¯å£ï¼ˆä¸èƒ½è¢«å ç”¨ä¸€èˆ¬5000ä»¥ä¸Šï¼‰

    addr.sin_addr.s_addr = INADDR_ANY;  //å®å¯¹åº”ip0ï¼š0.0.0.0å¯ä»¥ç»‘å®šæœ¬åœ°ä»»æ„ä¸€ä¸ªåœ°å€

    int ret = bind(fd, (struct sockaddr*)&addr, sizeof(addr));
    if(ret == -1)
    {
        perror("bind");
        exit(0);
        //return -1;
    }

    //3. è®¾ç½®ç›‘å¬
    ret = listen(fd, 128);  //æœ€å¤§è¿æ¥æ•°ï¼š128
    if(ret == -1)
    {
        perror("listen");
        exit(0);
        //return -1;
    }

    
    //4. é˜»å¡å¹¶ç­‰å¾…å®¢æˆ·ç«¯çš„è¿æ¥
    struct sockaddr_in cliaddr;  //åˆ›å»ºaddr_inç»“æ„ä½“æ–¹ä¾¿æ›´å¥½çš„å–å‡ºæ•°æ®
    int clilen = sizeof(cliaddr);  //å¼ºåˆ¶è½¬æ¢
    int cfd = accept(fd, (struct sockaddr*)&cliaddr, &clilen);
    if(cfd == -1)
    {
        perror("accept");
        exit(0);
        //return -1;
    }

    //è¿æ¥å»ºç«‹æˆåŠŸï¼Œæ‰“å°å®¢æˆ·ç«¯çš„IPå’Œç«¯å£
    char ip[24] = {0};
    printf("å®¢æˆ·ç«¯çš„IPåœ°å€: %s, ç«¯å£: %d\n",
           inet_ntop(AF_INET, &cliaddr.sin_addr.s_addr, ip, sizeof(ip)),
           ntohs(cliaddr.sin_port));
    
    //5. é€šä¿¡
    while(1)
    {

        char buf[1024];   //æ•°æ®å­˜æ”¾
        memset(buf, 0, sizeof(buf));
        int len = read(cfd, buf, sizeof(buf)); //å››ä¸ªå‚æ•° - end = 0
        if(len > 0)   //æ¥æ”¶æ•°æ®
        {
            printf("å®¢æˆ·ç«¯say: %s\n", buf);
            write(cfd, buf, len);
        }
        else if(len  == 0)
        {
            printf("å®¢æˆ·ç«¯æ–­å¼€äº†è¿æ¥...\n");
            break;
        }
        else
        {
            perror("read"); //æ‰“å°é”™è¯¯ä¿¡æ¯
            break;
        }
    }

    //å…³é—­æ–‡ä»¶æè¿°ç¬¦ -- é€šä¿¡çš„å’Œè¡¨è¿°çš„
    close(cfd);
    close(fd);

    return 0;
}
```



## client

```c
/*************************************************************************
    > File Name: s.c
    > Author: smile
    > Mail: 3293172751nss@gmail.com 
    > Created Time: Wed 20 Jul 2022 01:32:10 AM PDT
 ************************************************************************/
#include <stdio.h>
#include <stdlib.h>
#include <unistd.h>
#include <string.h>
#include <arpa/inet.h>

int main()
{
    //1. åˆ›å»ºé€šä¿¡çš„å¥—æ¥å­—
    int fd = socket(AF_INET, SOCK_STREAM, 0);
    if(fd == -1)
    {
        perror("socket");
        exit(0);
    }

    //2. connectè¿æ¥æœåŠ¡å™¨IP prot
    struct sockaddr_in addr;
    addr.sin_family = AF_INET;
    addr.sin_port = htons(10000);   //å®¢æˆ·ç«¯éœ€è¦è¿æ¥åˆ°çš„æœåŠ¡å™¨ç«¯å£
    //addr.sin_addr.s_addr = INADDR_ANY; //0 = 0.0.0.0  ç»‘å®šç½‘å¡çœŸå®çš„ipåœ°å€
    inet_pton(AF_INET, "192.168.137.128", &addr.sin_addr.s_addr);   //è½¬æ¢çš„å¤§ç«¯IP

    int ret = connect(fd, (struct sockaddr*)&addr, sizeof(addr));
    if(ret == -1)
    {
        perror("connect");
        exit(0);
        //return -1;
    }

    
    int number = 0;   //è®°å½•å‘é€çš„æ•°æ®ä¸ªæ•°
    while(1)
    {
        //å‘é€æ•°æ®
        char buf[1024];
        sprintf(buf, "ä½ å¥½, æœåŠ¡å™¨...%d\n", number++); 
        write(fd, buf, strlen(buf)+1);  //strlenè®¡ç®—bufé‡Œé¢å®é™…çš„å­—èŠ‚æ•°--ä¸åŒ…å«æœ€å\n

        //æ¥æ”¶æ•°æ®
        memset(buf, 0, sizeof(buf));
        int len = read(fd, buf, sizeof(buf));
        if(len > 0)
        {
            printf("æœåŠ¡å™¨say: %s\n", buf);
        }
        else if(len  == 0)
        {
            printf("æœåŠ¡å™¨æ–­å¼€äº†è¿æ¥...\n");
            break;
        }
        else
        {
            perror("read");
            break;
        }
        sleep(1); //å®¢æˆ·ç«¯å‘æ•°æ®çš„æ—¶å€™å‘æ…¢ä¸€ç‚¹  
    }

    close(fd);
    return 0;
}
```



## æµ‹è¯•

### select

```
root@ubuntu:/c/c-s# gcc -o client client.c 
root@ubuntu:/c/c-s# gcc -o sever sever.c 
root@ubuntu:/c/c-s# ./sever 
å®¢æˆ·ç«¯çš„IPåœ°å€: 192.168.137.128, ç«¯å£: 57864
å®¢æˆ·ç«¯say: ä½ å¥½, æœåŠ¡å™¨...0

å®¢æˆ·ç«¯say: ä½ å¥½, æœåŠ¡å™¨...1

å®¢æˆ·ç«¯say: ä½ å¥½, æœåŠ¡å™¨...2

å®¢æˆ·ç«¯say: ä½ å¥½, æœåŠ¡å™¨...3

å®¢æˆ·ç«¯æ–­å¼€äº†è¿æ¥...
```



### client

```
root@ubuntu:/c/c-s# ./client 
æœåŠ¡å™¨say: ä½ å¥½, æœåŠ¡å™¨...0

æœåŠ¡å™¨say: ä½ å¥½, æœåŠ¡å™¨...1

æœåŠ¡å™¨say: ä½ å¥½, æœåŠ¡å™¨...2

æœåŠ¡å™¨say: ä½ å¥½, æœåŠ¡å™¨...3
```



## END é“¾æ¥
+ [å›åˆ°ç›®å½•](../README.md)
+ [ä¸Šä¸€èŠ‚](14.md)
+ [ä¸‹ä¸€èŠ‚](16.md)
---
+ [å‚ä¸è´¡çŒ®â¤ï¸ğŸ’•ğŸ’•](https://github.com/3293172751/CS_COURSE/blob/master/Git/git-contributor.md)
