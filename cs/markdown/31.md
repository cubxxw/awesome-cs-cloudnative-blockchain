+ [author(Github)](https://github.com)

# ç¬¬31èŠ‚ è‡ªåŠ¨éƒ¨ç½²Actions CICDè®²è§£

+ [å›åˆ°ç›®å½•](../README.md)
+ [å›åˆ°é¡¹ç›®é¦–é¡µ](../../README.md)
+ [ä¸Šä¸€èŠ‚](30.md)
> â¤ï¸ğŸ’•ğŸ’•CSè‡ªå­¦æŒ‡å—,å¤§å­¦æ•™è‚²æ— è®ºæ˜¯æ·±åº¦è¿˜æ˜¯å¹¿åº¦éƒ½æ²¡æœ‰åŠæ³•æ”¯æ’‘æˆ‘ä»¬çš„èŒä¸šç´ å…»,è¿™ä¸ªæ¿å—ç®—æ˜¯è‡ªå·±åœ¨CSå­¦ä¹ ä¸­é¢å¤–è¡¥å……å’Œè®°å½•çš„ã€‚ä¸ªäººåšå®¢:[http://nsddd.top](http://nsddd.top/)
---
[TOC]

## å‰è¨€

> âš¡ å°±ä¸€å¥è¯ï¼š**æ¯å½“æˆ‘ä»¬å°†ä»£ç pushåˆ°ä»“åº“åï¼ŒCICDå°†ä¼šæ‹‰å–ä»“åº“ä»£ç å¹¶ä¸”è‡ªåŠ¨éƒ¨ç½²åˆ°æœåŠ¡å™¨ã€‚**

åœ¨å¤§å‹çš„å¼€æºé¡¹ç›®æˆ–è€…è½¯ä»¶å¼€å‘è¿‡ç¨‹ä¸­ï¼Œ å¾ˆå¤šå¼€å‘è€…éƒ½ä¼šå»æäº¤`PR`æˆ–è€…è¿›è¡Œä»£ç çš„ `push`æ“ä½œã€‚å¦‚æœå¯¹äºæ¯æ¬¡ä»£ç åˆå¹¶éƒ½éœ€è¦é¡¹ç›®çš„æ ¸å¿ƒç»´æŠ¤è€…è¿›è¡Œ `code review`ï¼Œè¿™é¡¹å·¥ä½œæ˜¯åŠå…¶å›°éš¾è€Œä¸”è€—æ—¶çš„ã€‚å› æ­¤è®¸å¤šå›¢é˜Ÿéƒ½ä¼šæŒ‡å®šä¸€å¥—ä»£ç è§„èŒƒ, ç„¶åç¼–å†™æµ‹è¯•ç”¨ä¾‹ä¸¥æ ¼çš„æ£€æŸ¥æ¯æ¬¡ä»£ç ä¿®æ”¹ï¼Œ è¿™æ ·èƒ½å¤Ÿéå¸¸æœ‰æ•ˆçš„å‡å°‘åæœŸä»£ç ç»´æŠ¤çš„æˆæœ¬ã€‚

ç°åœ¨ï¼ŒåŸºäº ***GithubAction***, æˆ‘ä»¬å¯ä»¥è‡ªåŠ¨åŒ–çš„å®Œæˆä»£ç çš„ `CI/CD` å·¥ä½œæµã€‚***Â­GithubAcÂ­tions***æ˜¯ GitHub æ¨å‡ºçš„æŒç»­é›†æˆ (ConÂ­tinÂ­uÂ­ous inÂ­teÂ­graÂ­tionï¼Œç®€ç§° CI) æœåŠ¡ï¼Œå®ƒæä¾›äº†é…ç½®éå¸¸ä¸é”™çš„è™šæ‹ŸæœåŠ¡å™¨ç¯å¢ƒï¼ŒåŸºäºå®ƒå¯ä»¥è¿›è¡Œ**æ„å»ºã€æµ‹è¯•ã€æ‰“åŒ…ã€éƒ¨ç½²**é¡¹ç›®ã€‚

Github Actions çš„æœ€å¤§ä¼˜åŠ¿å°±æ˜¯å®ƒæ˜¯ä¸ GitHub é«˜åº¦æ•´åˆçš„ï¼Œåªéœ€ä¸€ä¸ªé…ç½®æ–‡ä»¶å³å¯è‡ªåŠ¨å¼€å¯æœåŠ¡ã€‚ç”šè‡³ä½ ä¸éœ€è¦è´­ä¹°æœåŠ¡å™¨ â€”â€” GitHub Actions è‡ªå¸¦äº‘ç¯å¢ƒè¿è¡Œï¼ŒåŒ…æ‹¬ç§æœ‰ä»“åº“ä¹Ÿå¯ä»¥äº«ç”¨ï¼Œè€Œä¸”äº‘ç¯å¢ƒæ€§èƒ½ä¹Ÿéå¸¸ä¸é”™ã€‚

> åœ¨è¿™ä¸€ç¯‡ï¼Œæˆ‘å°†ä¼šä»`0`å¼€å§‹æ„å»ºä»“åº“ï¼Œä½¿ç”¨`GithubAction`å®ç°è‡ªåŠ¨åŒ–ä»£ç çš„`CI/CD`å·¥ä½œæµ
>
> æˆ‘ä¼šä½¿ç”¨çš„æ˜¯æœ€è¿‘åˆ›å»ºçš„é¡¹ç›®ï¼Œ[Goè¯­è¨€å®ç°os](https://github.com/3293172751/cubgo-os)æ¥è¿›è¡Œæ¼”ç¤º



## JenkinsåŸç†å’Œä½¿ç”¨ä»‹ç»

+ [å®‰è£…åœ°å€](jenkins.io/download/)
+ [dockeræ­å»ºjenkinså…¨æ•™ç¨‹](https://docker.nsddd.top/markdown/45.html)



æˆ‘æ˜¯ä½¿ç”¨dockerå®‰è£…çš„

```dockerfile
docker pull jenkins/jenkins
```



è¿è¡Œå°±å¥½äº†

```
docker run -d -P jenkins/jenkins
```



> æ›´å¤šè¯¦æƒ…è¯·ç§»æ­¥[dockeræ­å»ºjenkinså…¨æ•™ç¨‹](https://docker.nsddd.top/markdown/45.html)
>
> æ‰€æœ‰æ–‡ä»¶å­˜åœ¨æœ¬åœ°çš„æŸä¸ªç›®å½•



## travis

> **åœ¨äº‘ä¸­æˆ–æœ¬åœ°æµ‹è¯•å’Œéƒ¨ç½²é¡¹ç›®çš„æœ€ç®€å•æ–¹æ³•**ã€‚
>
> è½»æ¾å°†æ‚¨çš„é¡¹ç›®ä¸ Travis CI åŒæ­¥ï¼Œæ‚¨å°†åœ¨å‡ åˆ†é’Ÿå†…æµ‹è¯•ä»£ç ã€‚

`travis`ä¹Ÿæ˜¯`CI/CD`è‡ªåŠ¨åŒ–æ„å»ºå·¥å…·ã€‚

**åœ°å€ï¼š**

+ [traviså®˜æ–¹é¦–é¡µ](https://travis-ci.org)

![image-20221014115017191](http://sm.nsddd.top/smimage-20221014115017191.png?xxw@nsddd.top)



**å¼€å¯åæˆ‘ä»¬å°±å¯ä»¥å»GitHubä¸Šåˆ›å»ºæ–‡ä»¶äº†ï¼Œåˆ›å»ºçš„æ–‡ä»¶åå¿…é¡»ä»¥`.travis.yml`ç»“å°¾**

```yml
language: nodejs

before_script:
  - npm install
  
script:
  - npm test  
```

![image-20221014115234900](http://sm.nsddd.top/smimage-20221014115234900.png?xxw@nsddd.top)



## actionså…¥æ‰‹

**è¿™ä¸ªæ˜¯æˆ‘ä»¬ä»Šå¤©çš„æ­£å¼ç¯‡ğŸ’¡ğŸ’¡ğŸ’¡**

GitHubåœ¨20å¹´æ¨å‡ºçš„`actions`ï¼Œæ˜¯éå¸¸å—æ¬¢è¿çš„ï¼ŒåŠŸèƒ½ä¹Ÿæ˜¯éå¸¸å¼ºå¤§ã€‚

![image-20221014115909615](http://sm.nsddd.top/smimage-20221014115909615.png?xxw@nsddd.top)



### é€‰æ‹©è‡ªå®šä¹‰æµç¨‹

æˆ‘ä»¬é€‰æ‹©è‡ªå®šä¹‰æµç¨‹[set up a workflow yourself ](https://github.com/3293172751/cubgo-os/new/master?filename=.github%2Fworkflows%2Fmain.yml&workflow_template=blank)

```yml
name: CI

on: [push] 

jobs:
  build:
  
	  runs-on: ubuntu-latest
	  
	  steps:
	  - user: actions/checkout@v1
	  - name: Run a one-line script
	    run: echo Hello, world!
	  - name: Run a multi-line script
	    run: |
	    	echo Add other actions to build,
	    	echo test, add deploy your project.
```

> æ­¤æ—¶æˆ‘ä»¬çš„`Actions`å°±å·²ç»è¿è¡Œäº†~

â¬‡ï¸ æˆ‘ä»¬å°†ä¼šåœ¨ä¸‹é¢è¯¦ç»†ä»‹ç»ğŸ”¥ 



## è‡ªå»ºRunner

åœ¨æœ¬æ¬¡å®è·µä¸­ï¼Œå°†ä¼šæ„å»ºæœåŠ¡å™¨å’Œéƒ¨ç½²æœåŠ¡å™¨ç½®äºä¸€èµ·ï¼Œæˆ‘ä»¬å¯ä»¥è‡ªå»ºRunneråœ¨æœåŠ¡å™¨ä¸­ã€‚

![image-20221014192005371](http://sm.nsddd.top/smimage-20221014192005371.png?xxw@nsddd.top)



**åœ¨çœŸå®çš„ç¯å¢ƒä¸­ï¼Œæˆ‘ä»¬æŒ‰ç…§æ­¥éª¤æ‰§è¡Œä¸‹é¢çš„è¯­å¥ï¼š**

> æ³¨æ„åœ¨æ‰§è¡Œä¸‹é¢çš„è¯­å¥ä¸­ä¼šæŠ¥é”™`Must not run with sudo`

```
./config.sh --url https://github.com/3293172751/cubgo-os --token AURGPZ6D26FNUHMDWZF75JDDJFJ7Y
```

> æˆ‘ä»¬æ³¨é‡Šæ‰ä¸‹é¢çš„å†…å®¹å°±å¥½`vim config.sh`ï¼š
>
> ```bash
> # we want to snapshot the environment of the config user
> #if [ $user_id -eq 0 -a -z "$RUNNER_ALLOW_RUNASROOT" ]; then
> #    echo "Must not run with sudo"
> #    exit 1
> #fi
> ```



**æ¥ä¸‹æ¥æˆ‘ä»¬å°±è¦è®¤è¯äº†ï¼š**

![image-20221014193601358](http://sm.nsddd.top/smimage-20221014193601358.png?xxw@nsddd.top)



æˆ‘ä»¬ä¸€è·¯å›è½¦ï¼Œå°±å¥½äº†ï¼Œç„¶åæˆåŠŸåå›åˆ°GitHubï¼Œåˆ·æ–°Runnersé¡µé¢ï¼š

![image-20221014193805012](http://sm.nsddd.top/smimage-20221014193805012.png?xxw@nsddd.top)



## CI (Continuous integration)

äº’è”ç½‘è½¯ä»¶çš„å¼€å‘å’Œå‘å¸ƒï¼Œå·²ç»å½¢æˆäº†ä¸€å¥—æ ‡å‡†æµç¨‹ï¼Œæœ€é‡è¦çš„ç»„æˆéƒ¨åˆ†å°±æ˜¯æŒç»­é›†æˆï¼ˆContinuous integrationï¼Œç®€ç§°`CI`ï¼‰

### æ¦‚å¿µ

æŒç»­é›†æˆæŒ‡çš„æ˜¯ï¼Œé¢‘ç¹åœ°ï¼ˆä¸€å¤©å¤šæ¬¡ï¼‰å°†ä»£ç é›†æˆåˆ°ä¸»å¹²ã€‚ å®ƒçš„å¥½å¤„ä¸»è¦æœ‰ä¸¤ä¸ª

+ å¿«é€Ÿå‘ç°é”™è¯¯ã€‚æ¯å®Œæˆä¸€ç‚¹æ›´æ–°ï¼Œå°±é›†æˆåˆ°ä¸»å¹²ï¼Œå¯ä»¥å¿«é€Ÿå‘ç°é”™è¯¯ï¼Œå®šä½é”™è¯¯ä¹Ÿæ¯”è¾ƒå®¹æ˜“ã€‚
+ é˜²æ­¢åˆ†æ”¯å¤§å¹…åç¦»ä¸»å¹²ã€‚å¦‚æœä¸æ˜¯ç»å¸¸é›†æˆï¼Œä¸»å¹²åˆåœ¨ä¸æ–­æ›´æ–°ï¼Œä¼šå¯¼è‡´ä»¥åé›†æˆçš„éš¾åº¦å˜å¤§ï¼Œç”šè‡³éš¾ä»¥é›†æˆã€‚

æŒç»­é›†æˆçš„ç›®çš„ï¼Œå°±æ˜¯è®©äº§å“å¯ä»¥å¿«é€Ÿè¿­ä»£ï¼ŒåŒæ—¶è¿˜èƒ½ä¿æŒé«˜è´¨é‡ã€‚å®ƒçš„æ ¸å¿ƒæªæ–½æ˜¯ï¼Œä»£ç é›†æˆåˆ°ä¸»å¹²ä¹‹å‰ï¼Œå¿…é¡»é€šè¿‡è‡ªåŠ¨åŒ–æµ‹è¯•ã€‚åªè¦æœ‰ä¸€ä¸ªæµ‹è¯•ç”¨ä¾‹å¤±è´¥ï¼Œå°±ä¸èƒ½é›†æˆã€‚

### æŒç»­äº¤ä»˜

æŒç»­äº¤ä»˜ï¼ˆ`CD`â€“Continuous deliveryï¼‰æŒ‡çš„æ˜¯ï¼Œé¢‘ç¹åœ°å°†è½¯ä»¶çš„æ–°ç‰ˆæœ¬ï¼Œäº¤ä»˜ç»™è´¨é‡å›¢é˜Ÿæˆ–è€…ç”¨æˆ·ï¼Œä»¥ä¾›è¯„å®¡ã€‚å¦‚æœè¯„å®¡é€šè¿‡ï¼Œä»£ç å°±è¿›å…¥ç”Ÿäº§é˜¶æ®µã€‚ æŒç»­äº¤ä»˜å¯ä»¥çœ‹ä½œæŒç»­é›†æˆçš„ä¸‹ä¸€æ­¥ã€‚å®ƒå¼ºè°ƒçš„æ˜¯ï¼Œä¸ç®¡æ€ä¹ˆæ›´æ–°ï¼Œè½¯ä»¶æ˜¯éšæ—¶éšåœ°å¯ä»¥äº¤ä»˜çš„ã€‚

### æŒç»­éƒ¨ç½²

æŒç»­éƒ¨ç½²ï¼ˆcontinuous deploymentï¼‰æ˜¯æŒç»­äº¤ä»˜çš„ä¸‹ä¸€æ­¥ï¼ŒæŒ‡çš„æ˜¯ä»£ç é€šè¿‡è¯„å®¡ä»¥åï¼Œè‡ªåŠ¨éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒã€‚

æŒç»­éƒ¨ç½²çš„ç›®æ ‡æ˜¯ï¼Œä»£ç åœ¨ä»»ä½•æ—¶åˆ»éƒ½æ˜¯å¯éƒ¨ç½²çš„ï¼Œå¯ä»¥è¿›å…¥ç”Ÿäº§é˜¶æ®µã€‚

### æµç¨‹

æ ¹æ®æŒç»­é›†æˆçš„è®¾è®¡ï¼Œä»£ç ä»æäº¤åˆ°ç”Ÿäº§ï¼Œæ•´ä¸ªè¿‡ç¨‹æœ‰ä»¥ä¸‹å‡ æ­¥ã€‚

ï¼ˆ1ï¼‰æäº¤

æµç¨‹çš„ç¬¬ä¸€æ­¥ï¼Œæ˜¯å¼€å‘è€…å‘ä»£ç ä»“åº“æäº¤ä»£ç ã€‚æ‰€æœ‰åé¢çš„æ­¥éª¤éƒ½å§‹äºæœ¬åœ°ä»£ç çš„ä¸€æ¬¡æäº¤ï¼ˆcommitï¼‰ã€‚

ï¼ˆ2ï¼‰æµ‹è¯•ï¼ˆç¬¬ä¸€è½®ï¼‰

ä»£ç ä»“åº“å¯¹commitæ“ä½œé…ç½®äº†é’©å­ï¼ˆhookï¼‰ï¼Œåªè¦æäº¤ä»£ç æˆ–è€…åˆå¹¶è¿›ä¸»å¹²ï¼Œå°±ä¼šè·‘è‡ªåŠ¨åŒ–æµ‹è¯•ã€‚ æµ‹è¯•æœ‰å¥½å‡ ç§ã€‚

+ å•å…ƒæµ‹è¯•ï¼šé’ˆå¯¹å‡½æ•°æˆ–æ¨¡å—çš„æµ‹è¯•
+ é›†æˆæµ‹è¯•ï¼šé’ˆå¯¹æ•´ä½“äº§å“çš„æŸä¸ªåŠŸèƒ½çš„æµ‹è¯•ï¼Œåˆç§°åŠŸèƒ½æµ‹è¯•
+ ç«¯å¯¹ç«¯æµ‹è¯•ï¼šä»ç”¨æˆ·ç•Œé¢ç›´è¾¾æ•°æ®åº“çš„å…¨é“¾è·¯æµ‹è¯•

(3) æ„å»º

é€šè¿‡ç¬¬ä¸€è½®æµ‹è¯•ï¼Œä»£ç å°±å¯ä»¥åˆå¹¶è¿›ä¸»å¹²ï¼Œå°±ç®—å¯ä»¥äº¤ä»˜äº†ã€‚ äº¤ä»˜åï¼Œå°±å…ˆè¿›è¡Œæ„å»ºï¼ˆbuildï¼‰ï¼Œå†è¿›å…¥ç¬¬äºŒè½®æµ‹è¯•ã€‚æ‰€è°“æ„å»ºï¼ŒæŒ‡çš„æ˜¯å°†æºç è½¬æ¢ä¸ºå¯ä»¥è¿è¡Œçš„å®é™…ä»£ç ï¼Œæ¯”å¦‚å®‰è£…ä¾èµ–ï¼Œé…ç½®å„ç§èµ„æºï¼ˆæ ·å¼è¡¨ã€JSè„šæœ¬ã€å›¾ç‰‡ï¼‰ç­‰ç­‰ã€‚ å¸¸ç”¨çš„æ„å»ºå·¥å…·å¦‚ä¸‹ã€‚

+ Jenkinsï¼ˆæœ€è€ä½†æ˜¯æœ€å¤šç”¨ï¼‰
+ Travis.ci ï¼ˆgithubé›†æˆå·¥å…·ï¼‰
+ Codeship
+ Strider

(4) æµ‹è¯•ï¼ˆç¬¬äºŒè½®ï¼‰

æ„å»ºå®Œæˆï¼Œå°±è¦è¿›è¡Œç¬¬äºŒè½®æµ‹è¯•ã€‚å¦‚æœç¬¬ä¸€è½®å·²ç»æ¶µç›–äº†æ‰€æœ‰æµ‹è¯•å†…å®¹ï¼Œç¬¬äºŒè½®å¯ä»¥çœç•¥ï¼Œå½“ç„¶ï¼Œè¿™æ—¶æ„å»ºæ­¥éª¤ä¹Ÿè¦ç§»åˆ°ç¬¬ä¸€è½®æµ‹è¯•å‰é¢ã€‚

ç¬¬äºŒè½®æ˜¯å…¨é¢æµ‹è¯•ï¼Œå•å…ƒæµ‹è¯•å’Œé›†æˆæµ‹è¯•éƒ½ä¼šè·‘ï¼Œæœ‰æ¡ä»¶çš„è¯ï¼Œä¹Ÿè¦åšç«¯å¯¹ç«¯æµ‹è¯•ã€‚æ‰€æœ‰æµ‹è¯•ä»¥è‡ªåŠ¨åŒ–ä¸ºä¸»ï¼Œå°‘æ•°æ— æ³•è‡ªåŠ¨åŒ–çš„æµ‹è¯•ç”¨ä¾‹ï¼Œå°±è¦äººå·¥è·‘ã€‚

éœ€è¦å¼ºè°ƒçš„æ˜¯ï¼Œæ–°ç‰ˆæœ¬çš„æ¯ä¸€ä¸ªæ›´æ–°ç‚¹éƒ½å¿…é¡»æµ‹è¯•åˆ°ã€‚å¦‚æœæµ‹è¯•çš„è¦†ç›–ç‡ä¸é«˜ï¼Œè¿›å…¥åé¢çš„éƒ¨ç½²é˜¶æ®µåï¼Œå¾ˆå¯èƒ½ä¼šå‡ºç°ä¸¥é‡çš„é—®é¢˜ã€‚

(5) éƒ¨ç½²

é€šè¿‡äº†ç¬¬äºŒè½®æµ‹è¯•ï¼Œå½“å‰ä»£ç å°±æ˜¯ä¸€ä¸ªå¯ä»¥ç›´æ¥éƒ¨ç½²çš„ç‰ˆæœ¬ï¼ˆartifactï¼‰ã€‚å°†è¿™ä¸ªç‰ˆæœ¬çš„æ‰€æœ‰æ–‡ä»¶æ‰“åŒ…ï¼ˆ tar filename.tar * ï¼‰å­˜æ¡£ï¼Œå‘åˆ°ç”Ÿäº§æœåŠ¡å™¨ã€‚

(6) å›æ»š

ä¸€æ—¦å½“å‰ç‰ˆæœ¬å‘ç”Ÿé—®é¢˜ï¼Œå°±è¦å›æ»šåˆ°ä¸Šä¸€ä¸ªç‰ˆæœ¬çš„æ„å»ºç»“æœã€‚æœ€ç®€å•çš„åšæ³•å°±æ˜¯ä¿®æ”¹ä¸€ä¸‹ç¬¦å·é“¾æ¥ï¼ŒæŒ‡å‘ä¸Šä¸€ä¸ªç‰ˆæœ¬çš„ç›®å½•ã€‚



## Github Action

### GitHub Actions æ˜¯ä»€ä¹ˆï¼Ÿ

Github Actionsæ˜¯ç”±Githubåˆ›å»ºçš„ `CI/CD`æœåŠ¡ã€‚ å®ƒçš„ç›®çš„æ˜¯ä½¿æ‰€æœ‰è½¯ä»¶å¼€å‘å·¥ä½œæµç¨‹çš„è‡ªåŠ¨åŒ–å˜å¾—å®¹æ˜“ã€‚ ç›´æ¥ä»GitHubæ„å»ºï¼Œæµ‹è¯•å’Œéƒ¨ç½²ä»£ç ã€‚CIï¼ˆæŒç»­é›†æˆï¼‰ç”±å¾ˆå¤šæ“ä½œç»„æˆï¼Œæ¯”å¦‚ä»£ç åˆå¹¶ã€è¿è¡Œæµ‹è¯•ã€ç™»å½•è¿œç¨‹æœåŠ¡å™¨ï¼Œå‘å¸ƒåˆ°ç¬¬ä¸‰æ–¹æœåŠ¡ç­‰ç­‰ã€‚GitHub æŠŠè¿™äº›æ“ä½œå°±ç§°ä¸º actionsã€‚

å¾ˆå¤šæ“ä½œåœ¨ä¸åŒé¡¹ç›®é‡Œé¢æ˜¯ç±»ä¼¼çš„ï¼Œå®Œå…¨å¯ä»¥å…±äº«ã€‚GitHub å…è®¸å¼€å‘è€…æŠŠæ¯ä¸ªæ“ä½œå†™æˆç‹¬ç«‹çš„è„šæœ¬æ–‡ä»¶ï¼Œå­˜æ”¾åˆ°ä»£ç ä»“åº“ï¼Œä½¿å¾—å…¶ä»–å¼€å‘è€…å¯ä»¥å¼•ç”¨ã€‚

å¦‚æœä½ éœ€è¦æŸä¸ª actionï¼Œä¸å¿…è‡ªå·±å†™å¤æ‚çš„è„šæœ¬ï¼Œç›´æ¥å¼•ç”¨ä»–äººå†™å¥½çš„ action å³å¯ï¼Œæ•´ä¸ªæŒç»­é›†æˆè¿‡ç¨‹ï¼Œå°±å˜æˆäº†ä¸€ä¸ª actions çš„ç»„åˆã€‚è¿™å°±æ˜¯ GitHub Actions æœ€ç‰¹åˆ«çš„åœ°æ–¹ã€‚

GitHub åšäº†ä¸€ä¸ª[ğŸ§· GitHub Marketplace](https://github.com/marketplace?type=actions) ï¼Œå¯ä»¥æœç´¢åˆ°ä»–äººæäº¤çš„ actionsã€‚å¦å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ªğŸ§· [Awesome Actions](https://github.com/sdras/awesome-actions)çš„ä»“åº“ï¼Œä¹Ÿå¯ä»¥æ‰¾åˆ°ä¸å°‘ actionã€‚

### åŸºç¡€æ¦‚å¿µ

GitHub Actions æœ‰ä¸€äº›è‡ªå·±çš„æœ¯è¯­ã€‚

+ workflow ï¼ˆå·¥ä½œæµç¨‹ï¼‰ï¼šæŒç»­é›†æˆä¸€æ¬¡è¿è¡Œçš„è¿‡ç¨‹ã€‚
+ job ï¼ˆä»»åŠ¡ï¼‰ï¼šä¸€ä¸ª workflow ç”±ä¸€ä¸ªæˆ–å¤šä¸ª job æ„æˆï¼Œå«ä¹‰æ˜¯ä¸€æ¬¡æŒç»­é›†æˆçš„è¿è¡Œï¼Œå¯ä»¥å®Œæˆå¤šä¸ªä»»åŠ¡ã€‚
+ stepï¼ˆæ­¥éª¤ï¼‰ï¼šæ¯ä¸ª job ç”±å¤šä¸ª step æ„æˆï¼Œä¸€æ­¥æ­¥å®Œæˆã€‚
+ action ï¼ˆåŠ¨ä½œï¼‰ï¼šæ¯ä¸ª step å¯ä»¥ä¾æ¬¡æ‰§è¡Œä¸€ä¸ªæˆ–å¤šä¸ªå‘½ä»¤ï¼ˆactionï¼‰ã€‚

### è™šæ‹Ÿç¯å¢ƒ

GitHub AcÂ­tions ä¸ºæ¯ä¸ªä»»åŠ¡ (job) éƒ½æä¾›äº†ä¸€ä¸ªè™šæ‹Ÿæœºæ¥æ‰§è¡Œï¼Œæ¯å°è™šæ‹Ÿæœºéƒ½æœ‰ç›¸åŒçš„ç¡¬ä»¶èµ„æºï¼š

+ `2-core CPU`, `7 GB RAM` å†…å­˜, 14 GB SSD ç¡¬ç›˜ç©ºé—´
+ ç¡¬ç›˜æ€»å®¹é‡ä¸º90Gå·¦å³ï¼Œå¯ç”¨ç©ºé—´ä¸º30Gå·¦å³ï¼Œè¯„æµ‹è¯¦è§ï¼šã€ŠGitHub Actions è™šæ‹ŸæœåŠ¡å™¨ç¯å¢ƒç®€å•è¯„æµ‹ã€‹

ä½¿ç”¨é™åˆ¶ï¼š

+ æ¯ä¸ªä»“åº“åªèƒ½åŒæ—¶æ”¯æŒ`20`ä¸ª workflow å¹¶è¡Œã€‚
+ æ¯å°æ—¶å¯ä»¥è°ƒç”¨1000æ¬¡ GitHub API ã€‚
+ æ¯ä¸ª job æœ€å¤šå¯ä»¥æ‰§è¡Œ6ä¸ªå°æ—¶ã€‚
+ å…è´¹ç‰ˆçš„ç”¨æˆ·æœ€å¤§æ”¯æŒ20ä¸ª job å¹¶å‘æ‰§è¡Œï¼ŒmacOS æœ€å¤§åªæ”¯æŒ5ä¸ªã€‚
+ ç§æœ‰ä»“åº“æ¯æœˆç´¯è®¡ä½¿ç”¨æ—¶é—´ä¸º2000åˆ†é’Ÿï¼Œè¶…è¿‡å$ 0.008/åˆ†é’Ÿï¼Œå…¬å…±ä»“åº“åˆ™æ— é™åˆ¶ã€‚
+ æ“ä½œç³»ç»Ÿæ–¹é¢å¯é€‰æ‹© WinÂ­dows serverã€Linuxã€maÂ­cOSï¼Œå¹¶é¢„è£…äº†å¤§é‡è½¯ä»¶åŒ…å’Œå·¥å…·ã€‚

> TIPSï¼š è™½ç„¶åç§°å«æŒç»­é›†æˆï¼Œä½†å½“æ‰€æœ‰ä»»åŠ¡ç»ˆæ­¢å’Œå®Œæˆæ—¶ï¼Œè™šæ‹Ÿç¯å¢ƒå†…çš„æ•°æ®ä¼šéšä¹‹æ¸…ç©ºï¼Œå¹¶ä¸ä¼šæŒç»­ã€‚å³æ¯ä¸ªæ–°ä»»åŠ¡éƒ½æ˜¯ä¸€ä¸ªå…¨>æ–°çš„è™šæ‹Ÿç¯å¢ƒã€‚

### workflow æ–‡ä»¶

GitHub AcÂ­tions çš„é…ç½®æ–‡ä»¶å«åš workÂ­flow æ–‡ä»¶ï¼Œå­˜æ”¾åœ¨ä»£ç ä»“åº“çš„`.github/workflows` ç›®å½•ä¸­ã€‚

workÂ­flow æ–‡ä»¶é‡‡ç”¨ `YAML` æ ¼å¼ï¼Œæ–‡ä»¶åå¯ä»¥ä»»æ„å–ï¼Œä½†æ˜¯åç¼€åç»Ÿä¸€ä¸º`.yml`ï¼Œæ¯”å¦‚ `build.yml`ã€‚ä¸€ä¸ªåº“å¯ä»¥æœ‰å¤šä¸ª workÂ­flow æ–‡ä»¶ï¼ŒGitHub åªè¦å‘ç°`.github/workflows` ç›®å½•é‡Œé¢æœ‰`.yml` æ–‡ä»¶ï¼Œå°±ä¼š**æŒ‰ç…§æ–‡ä»¶ä¸­æ‰€æŒ‡å®šçš„è§¦å‘æ¡ä»¶åœ¨ç¬¦åˆæ¡ä»¶æ—¶è‡ªåŠ¨è¿è¡Œè¯¥æ–‡ä»¶ä¸­çš„å·¥ä½œæµç¨‹ã€‚**

åœ¨ AcÂ­tions é¡µé¢å¯ä»¥çœ‹åˆ°å¾ˆå¤šç§è¯­è¨€çš„ workÂ­flow æ–‡ä»¶çš„æ¨¡ç‰ˆï¼Œå¯ä»¥ç”¨äºç®€å•çš„æ„å»ºä¸æµ‹è¯•ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„ workÂ­flow æ–‡ä»¶ç¤ºä¾‹ï¼š

```sh
name: Hello World
on: push
jobs:
  my_first_job:
    name: My first job
    runs-on: ubuntu-latest
    steps:
    - name: checkout
      uses: actions/checkout@master
    - name: Run a single-line script
      run: echo "Hello World!"
  my_second_job:
    name: My second job
    runs-on: macos-latest
    steps:
    - name: Run a multi-line script
      env:
        MY_VAR: Hello World!
        MY_NAME: P3TERX
      run: |
        echo $MY_VAR
        echo My name is $MY_NAME
```

### workflow è¯­æ³•

**(1) name**

name å­—æ®µæ˜¯ workÂ­flow çš„åç§°ã€‚è‹¥å¿½ç•¥æ­¤å­—æ®µï¼Œåˆ™é»˜è®¤ä¼šè®¾ç½®ä¸º workÂ­flow æ–‡ä»¶åã€‚

```sh
name: GitHub Actions Demo
```

**(2) on**

on å­—æ®µæŒ‡å®š workÂ­flow çš„è§¦å‘æ¡ä»¶ï¼Œé€šå¸¸æ˜¯æŸäº›äº‹ä»¶ï¼Œæ¯”å¦‚ç¤ºä¾‹ä¸­çš„è§¦å‘äº‹ä»¶æ˜¯ pushï¼Œå³åœ¨ä»£ç  push åˆ°ä»“åº“åè¢«è§¦å‘ã€‚on å­—æ®µä¹Ÿå¯ä»¥æ˜¯äº‹ä»¶çš„æ•°ç»„ï¼Œå¤šç§äº‹ä»¶è§¦å‘ï¼Œæ¯”å¦‚åœ¨ push æˆ– pull_request æ—¶è§¦å‘ï¼š

```sh
on: [push, pull_request]
```

+ push æŒ‡å®šåˆ†æ”¯è§¦å‘

> åœ¨æŒ‡å®šåˆ†æ”¯ä¸‹`master`è§¦å‘äº‹ä»¶ï¼Œä¹Ÿå¯ä»¥æ”¹æˆ`tags`

```sh
on:
  push:
    branches:
      - master
```

+ push tag æ—¶è§¦å‘

```sh
on:
  push:
    tags:
    - 'v*'
```

å®Œæ•´çš„äº‹ä»¶åˆ—è¡¨ï¼Œè¯·æŸ¥çœ‹[å®˜æ–¹æ–‡æ¡£](https://docs.github.com/en/actions/using-workflows/events-that-trigger-workflows)ã€‚é™¤äº†ä»£ç åº“äº‹ä»¶ï¼ŒGitHub Actions ä¹Ÿæ”¯æŒå¤–éƒ¨äº‹ä»¶è§¦å‘ï¼Œæˆ–è€…å®šæ—¶è¿è¡Œã€‚

æŒ‡å®šæŸä¸ªç›®å½•`src`ä¸‹æ–‡ä»¶æ”¹åŠ¨è§¦å‘`pushs`

```yacas
name MYCI
on:
  push:
    branches:
	- master
	paths:
	- src/*
```

**(3) jobs**

jobs è¡¨ç¤ºè¦æ‰§è¡Œçš„ä¸€é¡¹æˆ–å¤šé¡¹ä»»åŠ¡ã€‚æ¯ä¸€é¡¹ä»»åŠ¡å¿…é¡»å…³è”ä¸€ä¸ª `ID (job_id)`ï¼Œæ¯”å¦‚ç¤ºä¾‹ä¸­çš„ my_first_job å’Œ my_second_jobã€‚job_id é‡Œé¢çš„ name å­—æ®µæ˜¯ä»»åŠ¡çš„åç§°ã€‚job_id ä¸èƒ½æœ‰ç©ºæ ¼ï¼Œåªèƒ½ä½¿ç”¨æ•°å­—ã€è‹±æ–‡å­—æ¯å’Œ - æˆ–_ç¬¦å·ï¼Œè€Œ name å¯ä»¥éšæ„ï¼Œè‹¥å¿½ç•¥ name å­—æ®µï¼Œåˆ™é»˜è®¤ä¼šè®¾ç½®ä¸º job_idã€‚

å½“æœ‰å¤šä¸ªä»»åŠ¡æ—¶ï¼Œå¯ä»¥æŒ‡å®šä»»åŠ¡çš„ä¾èµ–å…³ç³»ï¼Œå³è¿è¡Œé¡ºåºï¼Œå¦åˆ™æ˜¯åŒæ—¶è¿è¡Œã€‚

```yaml
jobs:
  job1:
  job2:
    needs: job1
  job3:
    needs: [job1, job2]
```

ä¸Šé¢ä»£ç ä¸­ï¼Œjob1 å¿…é¡»å…ˆäº job2 å®Œæˆï¼Œè€Œ job3 ç­‰å¾… job1 å’Œ job2 çš„å®Œæˆæ‰èƒ½è¿è¡Œã€‚å› æ­¤ï¼Œè¿™ä¸ª workÂ­flow çš„è¿è¡Œé¡ºåºä¾æ¬¡ä¸ºï¼šjob1ã€job2ã€job3ã€‚

**(4) runs-on**

> è¿™æ˜¯ä¸€ä¸ªéå¸¸é‡è¦çš„å‚æ•°ï¼Œè€Œä¸”æ˜¯ä¸€ä¸ªæšä¸¾ç±»å‹

```sh
runs-on: ubuntu-18.04
```

runs-on å­—æ®µæŒ‡å®šä»»åŠ¡è¿è¡Œæ‰€éœ€è¦çš„è™šæ‹ŸæœåŠ¡å™¨ç¯å¢ƒï¼Œæ˜¯å¿…å¡«å­—æ®µï¼Œç›®å‰å¯ç”¨çš„è™šæ‹Ÿæœºå¦‚ä¸‹ï¼š

**(5)steps**

steps å­—æ®µæŒ‡å®šæ¯ä¸ªä»»åŠ¡çš„è¿è¡Œæ­¥éª¤ï¼Œå¯ä»¥åŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªæ­¥éª¤ã€‚æ­¥éª¤å¼€å¤´ä½¿ç”¨ - ç¬¦å·ã€‚æ¯ä¸ªæ­¥éª¤å¯ä»¥æŒ‡å®šä»¥ä¸‹å­—æ®µ:

+ nameï¼šæ­¥éª¤åç§°ã€‚
+ usesï¼šè¯¥æ­¥éª¤å¼•ç”¨çš„actionæˆ– Docker é•œåƒã€‚
+ runï¼šè¯¥æ­¥éª¤è¿è¡Œçš„ bash å‘½ä»¤ã€‚
+ envï¼šè¯¥æ­¥éª¤æ‰€éœ€çš„ç¯å¢ƒå˜é‡ã€‚ å…¶ä¸­ uses å’Œ run æ˜¯å¿…å¡«å­—æ®µï¼Œæ¯ä¸ªæ­¥éª¤åªèƒ½æœ‰å…¶ä¸€ã€‚åŒæ ·åç§°ä¹Ÿæ˜¯å¯ä»¥å¿½ç•¥çš„ã€‚

**(6)on.scheduleå®šæ—¶è§¦å‘**

è¡¨ç¤ºå¤šé•¿æ—¶é—´å°±è§¦å‘æµç¨‹

```xml
on:
  schedule:
  - cron: '*/15 * * * *'
```

> `cron`ï¼šè¡¨ç¤º**åˆ† æ—¶ æ—¥ æœˆæ˜Ÿ**



### action

`action` æ˜¯ GitHub AcÂ­tions ä¸­çš„é‡è¦ç»„æˆéƒ¨åˆ†ï¼Œè¿™ç‚¹ä»åç§°ä¸­å°±å¯ä»¥çœ‹å‡ºï¼Œactions æ˜¯ action çš„å¤æ•°å½¢å¼ã€‚å®ƒæ˜¯å·²ç»ç¼–å†™å¥½çš„æ­¥éª¤è„šæœ¬ï¼Œå­˜æ”¾åœ¨ GitHub ä»“åº“ä¸­ã€‚

> æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å¾ˆå¤šæœ‰æ„æ€çš„è„šæœ¬ï¼Œæ¯”å¦‚è¯´`wakatime`
>
> ```yaml
> - name: wakatime-sync
>   uses: superman66/wakatime-sync@v1.0.0
> ```
>
> ![image-20221014185355936](http://sm.nsddd.top/smimage-20221014185355936.png?xxw@nsddd.top)

å¯¹äºåˆå­¦è€…æ¥è¯´å¯ä»¥ç›´æ¥å¼•ç”¨å…¶å®ƒå¼€å‘è€…å·²ç»å†™å¥½çš„ actionï¼Œå¯ä»¥åœ¨å®˜æ–¹ action ä»“åº“æˆ–è€… [GitHub Marketplace](https://github.com/marketplace?type=actions) å»è·å–ã€‚æ­¤å¤– [Awesome Actions](https://github.com/sdras/awesome-actions) è¿™ä¸ªé¡¹ç›®æ”¶é›†äº†å¾ˆå¤šéå¸¸ä¸é”™çš„ actionã€‚ æ—¢ç„¶ action æ˜¯ä»£ç ä»“åº“ï¼Œå½“ç„¶å°±æœ‰ç‰ˆæœ¬çš„æ¦‚å¿µã€‚å¼•ç”¨æŸä¸ªå…·ä½“ç‰ˆæœ¬çš„ actionï¼š

```sh
steps:
  - uses: actions/setup-node@74bc508 # æŒ‡å®šä¸€ä¸ª commit
  - uses: actions/setup-node@v1.2    # æŒ‡å®šä¸€ä¸ª tag
  - uses: actions/setup-node@master  # æŒ‡å®šä¸€ä¸ªåˆ†æ”¯
```



## Git hooks

### ä»€ä¹ˆæ˜¯ Git hooks

Git hooks æ˜¯ Git åœ¨äº‹ä»¶ä¹‹å‰æˆ–ä¹‹åæ‰§è¡Œçš„è„šæœ¬, ç”¨äºæ§åˆ¶ git å·¥ä½œçš„æµç¨‹ã€‚`Git hooks` è„šæœ¬å¯¹äºæˆ‘ä»¬æäº¤`code review` ä¹‹å‰è¯†åˆ«ä¸€äº›ç®€å•çš„é—®é¢˜å¾ˆæœ‰ç”¨ã€‚ æˆ‘ä»¬åœ¨æ¯æ¬¡æäº¤ä»£ç æ—¶éƒ½ä¼šè§¦å‘è¿™äº› hooksï¼Œä»¥è‡ªåŠ¨æŒ‡å‡ºä»£ç ä¸­çš„é—®é¢˜ï¼Œä¾‹å¦‚ç¼ºå°‘åˆ†å·ï¼Œå°¾éšç©ºç™½å’Œè°ƒè¯•è¯­å¥ã€‚é€šè¿‡åœ¨`code review` ä¹‹å‰æŒ‡å‡ºè¿™äº›é—®é¢˜ï¼Œä»£ç å®¡é˜…è€…å¯ä»¥ä¸“æ³¨äºä»£ç ç»“æ„å’ŒåŠŸèƒ½çš„æ›´æ”¹ï¼Œè€Œä¸éœ€è¦æµªè´¹æ—¶é—´æ¥å®¡æŸ¥è¿™äº›æ ¼å¼é—®é¢˜ã€‚

Git hooks åˆ†ä¸ºå®¢æˆ·ç«¯é’©å­å’ŒæœåŠ¡ç«¯é’©å­ã€‚å®¢æˆ·ç«¯é’©å­ç”±è¯¸å¦‚æäº¤å’Œåˆå¹¶è¿™æ ·çš„æ“ä½œæ‰€è°ƒç”¨ï¼Œè€ŒæœåŠ¡å™¨ç«¯é’©å­ä½œç”¨äºè¯¸å¦‚æ¥æ”¶è¢«æ¨é€çš„æäº¤è¿™æ ·çš„è”ç½‘æ“ä½œã€‚

å®¢æˆ·ç«¯é’©å­ï¼š`pre-commit`ã€`prepare-commit-msg`ã€`commit-msg`ã€`post-commit`ç­‰ï¼Œä¸»è¦ç”¨äºæ§åˆ¶å®¢æˆ·ç«¯ git çš„æäº¤å’Œåˆå¹¶è¿™æ ·çš„æ“ä½œã€‚

æœåŠ¡ç«¯é’©å­ï¼špre-receiveã€post-receiveã€updateï¼Œä¸»è¦åœ¨æœåŠ¡ç«¯æ¥æ”¶æäº¤å¯¹è±¡æ—¶ã€æ¨é€åˆ°æœåŠ¡å™¨ä¹‹å‰è°ƒç”¨ã€‚

+ pre-commit: Check the commit message for spelling errors.
+ pre-receive: Enforce project coding standards.
+ post-commit: Email/SMS team members of a new commit.
+ post-receive: Push the code to production.

### Git hooks å¦‚ä½•å·¥ä½œï¼Ÿ

æ¯ä¸ªGitå­˜å‚¨åº“éƒ½æœ‰ä¸€ä¸ª`.git/hooks`æ–‡ä»¶å¤¹ï¼Œå…¶ä¸­åŒ…å«å¯ä»¥ç»‘å®šåˆ°çš„æ¯ä¸ªé’©å­çš„è„šæœ¬ã€‚æ‚¨å¯ä»¥æ ¹æ®éœ€è¦éšæ„æ›´æ”¹æˆ–æ›´æ–°è¿™äº›è„šæœ¬ï¼ŒGitå°†åœ¨è¿™äº›äº‹ä»¶å‘ç”Ÿæ—¶æ‰§è¡Œå®ƒä»¬ã€‚è¿›å»`.git/hooks` åä¼šçœ‹åˆ°ä¸€äº› `hooks` çš„å®˜æ–¹ç¤ºä¾‹ï¼Œä»–ä»¬éƒ½æ˜¯ä»¥`.sample`ç»“å°¾çš„æ–‡ä»¶åã€‚

æ³¨æ„è¿™äº›ä»¥`.sample`ç»“å°¾çš„ç¤ºä¾‹è„šæœ¬æ˜¯ä¸ä¼šæ‰§è¡Œçš„ï¼Œå¦‚æœä½ æƒ³å¯ç”¨å®ƒä»¬ï¼Œå¾—å…ˆç§»é™¤è¿™ä¸ªåç¼€ã€‚

ä¾‹å¦‚ä¸‹é¢çš„æ–‡ä»¶åˆ—è¡¨æ˜¯ `git init` åœ¨ `.git/hooks` æ–‡ä»¶å¤¹ä¸‹è‡ªåŠ¨åˆ›å»ºçš„ `hooks` æ–¹æ³•ã€‚

```python
-rwxrwxr-x 1 robin robin  478 Jun  1 17:54 applypatch-msg.sample*
-rwxrwxr-x 1 robin robin  896 Jun  1 17:54 commit-msg.sample*
-rwxrwxr-x 1 robin robin  189 Jun  1 17:54 post-update.sample*
-rwxrwxr-x 1 robin robin  424 Jun  1 17:54 pre-applypatch.sample*
-rwxrwxr-x 1 robin robin 1642 Jun  1 17:54 pre-commit.sample*
-rwxrwxr-x 1 robin robin 1239 Jun  1 17:54 prepare-commit-msg.sample*
-rwxrwxr-x 1 robin robin 1348 Jun  1 17:54 pre-push.sample*
-rwxrwxr-x 1 robin robin 4898 Jun  1 17:54 pre-rebase.sample*
-rwxrwxr-x 1 robin robin 3610 Jun  1 17:54 update.sample*
```

ä¾‹å¦‚ä¸‹é¢çš„æ–‡ä»¶åˆ—è¡¨ä¸­å¤šäº†ä¸€ä¸ª `pre-commit` çš„æ–‡ä»¶ï¼Œ æ˜¯æˆ‘æ·»åŠ çš„ç”¨äºä»£ç æ£€æŸ¥çš„ `pre-commit hook`æ–¹æ³•ã€‚

```python
-rwxrwxr-x 1 robin robin  478 Sep  7 10:25 applypatch-msg.sample*
-rwxrwxr-x 1 robin robin  896 Sep  7 10:25 commit-msg.sample*
-rwxrwxr-x 1 robin robin  189 Sep  7 10:25 post-update.sample*
-rwxrwxr-x 1 robin robin  424 Sep  7 10:25 pre-applypatch.sample*
-rwxrwxr-x 1 robin robin 1475 Sep  8 20:13 pre-commit*
-rwxrwxr-x 1 robin robin 1642 Sep  7 10:25 pre-commit.sample*
-rwxrwxr-x 1 robin robin 1239 Sep  7 10:25 prepare-commit-msg.sample*
-rwxrwxr-x 1 robin robin 1348 Sep  7 10:25 pre-push.sample*
-rwxrwxr-x 1 robin robin 4898 Sep  7 10:25 pre-rebase.sample*
-rwxrwxr-x 1 robin robin 3610 Sep  7 10:25 update.sample*
```

### pre-commit ç®€ä»‹

`pre-commit`æ˜¯å®¢æˆ·ç«¯hooksä¹‹ä¸€ï¼Œ`pre-commit` åœ¨ `git add`æäº¤ä¹‹åï¼Œç„¶åæ‰§è¡Œ `git commit` æ—¶æ‰§è¡Œ, å®ç°å¯¹ä»£ç çš„å®¡æŸ¥ã€‚ è„šæœ¬æ‰§è¡Œæ²¡æŠ¥é”™å°±ç»§ç»­æäº¤ï¼Œåä¹‹å°±é©³å›æäº¤çš„æ“ä½œã€‚

è¿™ä¸ªé’©å­è„šæœ¬å¯ç”¨äºå¤„ç†ç®€å•é—®é¢˜ï¼šå¯¹å°†è¦æäº¤çš„ä»£ç è¿›è¡Œæ£€æŸ¥ã€ä¼˜åŒ–ä»£ç æ ¼å¼, ä¾‹å¦‚æ£€æŸ¥æ˜¯å­—ç¬¦æ•°æ˜¯å¦è¶…å‡ºé™åˆ¶ï¼Œå°¾éšç©ºæ ¼å’Œè°ƒè¯•è¯­å¥ç­‰ã€‚

Gité’©å­ã€‚æˆ‘ä»¬åœ¨æ¯æ¬¡æäº¤æ—¶è¿è¡Œæˆ‘ä»¬çš„é’©å­ï¼Œä»¥ã€‚æœ¬æ–‡ä»¥python é¡¹ç›®ä¸ºä¾‹ã€‚

### å®‰è£…

```python
## ä½¿ç”¨ pip å®‰è£…:
pip install pre-commit
```

### é…ç½®

åœ¨é¡¹ç›®æ ¹ç›®å½•å¡«åŠ  `.pre-commit-config.yaml` æ–‡ä»¶, è¿™é‡Œä»¥ `mmdetection` çš„é…ç½®æ–‡ä»¶ä¸ºä¾‹æ¥åšè¯´æ˜ï¼š

```python
repos:
  - repo: https://gitlab.com/pycqa/flake8.git
    rev: 3.8.3
    hooks:
      - id: flake8
  - repo: https://github.com/asottile/seed-isort-config
    rev: v2.2.0
    hooks:
      - id: seed-isort-config
  - repo: https://github.com/timothycrosley/isort
    rev: 4.3.21
    hooks:
      - id: isort
  - repo: https://github.com/pre-commit/mirrors-yapf
    rev: v0.30.0
    hooks:
      - id: yapf
  - repo: https://github.com/pre-commit/pre-commit-hooks
    rev: v3.1.0
    hooks:
      - id: trailing-whitespace
      - id: check-yaml
      - id: end-of-file-fixer
      - id: requirements-txt-fixer
      - id: double-quote-string-fixer
      - id: check-merge-conflict
      - id: fix-encoding-pragma
        args: ["--remove"]
      - id: mixed-line-ending
        args: ["--fix=lf"]
  - repo: https://github.com/myint/docformatter
    rev: v1.3.1
    hooks:
      - id: docformatter
        args: ["--in-place", "--wrap-descriptions", "79"]
```

å…¶ä¸­ flake8 æ ¹æ® flake8 ç»™å‡ºçš„ä»£ç è§„åˆ™æ£€æŸ¥ä»£ç .

###  å®‰è£… git hook scripts

```python
# pre-commit install
pre-commit install
# pre-commit installed at .git/hooks/pre-commit
```

ç¬¬ä¸€æ¬¡ pre-commit è¿è¡Œæ—¶ï¼Œå°†ä¼šè‡ªåŠ¨ä¸‹è½½ã€å®‰è£…å¹¶ä¸”è¿è¡Œ hookã€‚å®‰è£…å®Œæˆä¹‹åï¼Œ`pre-commit` å°†ä¼šåœ¨æ¯æ¬¡è¿è¡Œ`git commit`å‘½ä»¤æ—¶è‡ªåŠ¨æ‰§è¡Œã€‚ æ³¨æ„ï¼š æ¯æ¬¡ clone ä»£ç åï¼Œéƒ½éœ€è¦æ‰§è¡Œ `pre-commit install`ã€‚

### æ‰‹åŠ¨è§¦å‘

ç¬¬ä¸€æ¬¡ï¼Œéœ€è¦è§¦å‘å…¨éƒ¨ï¼š

```python
(pytorch) robin@robin-Z390-UD:~/jianzh/ApulisVision$ pre-commit run --all-files
flake8...................................................................Passed
seed isort known_third_party.............................................Passed
isort....................................................................Passed
yapf.....................................................................Passed
Trim Trailing Whitespace.................................................Failed
- hook id: trailing-whitespace
- exit code: 1
- files were modified by this hook

Fixing docs/GithubAction.md

Check Yaml...............................................................Passed
Fix End of Files.........................................................Passed
Fix requirements.txt.....................................................Passed
Fix double quoted strings................................................Passed
Check for merge conflicts................................................Passed
Fix python encoding pragma...............................................Passed
Mixed line ending........................................................Passed
docformatter.............................................................Passed
```

å¯ä»¥çœ‹åˆ°ï¼Œ æˆ‘çš„æ–‡æ¡£ä¸­ï¼Œ å­˜åœ¨ä¸€äº› `trailing whitespace`

### æ”¯æŒè¯­è¨€

```
docker
docker_image
fail
golang
node
python
python_venv
ruby
rust
swift
pcre
pygrep
script
system
```



## END é“¾æ¥
+ [å›åˆ°ç›®å½•](../README.md)
+ [ä¸Šä¸€èŠ‚](30.md)
+ [ä¸‹ä¸€èŠ‚](32.md)
---
+ [å‚ä¸è´¡çŒ®â¤ï¸ğŸ’•ğŸ’•](https://github.com/3293172751/Block_Chain/blob/master/Git/git-contributor.md)