# 1. IOæ“ä½œ

### 1.1.1. è¾“å…¥è¾“å‡ºçš„åº•å±‚åŸç†

- ç»ˆç«¯å…¶å®æ˜¯ä¸€ä¸ªæ–‡ä»¶ï¼Œç›¸å…³å®ä¾‹å¦‚ä¸‹ï¼š
  - `os.Stdin`ï¼šæ ‡å‡†è¾“å…¥çš„æ–‡ä»¶å®ä¾‹ï¼Œç±»å‹ä¸º`*File`
  - `os.Stdout`ï¼šæ ‡å‡†è¾“å‡ºçš„æ–‡ä»¶å®ä¾‹ï¼Œç±»å‹ä¸º`*File`
  - `os.Stderr`ï¼šæ ‡å‡†é”™è¯¯è¾“å‡ºçš„æ–‡ä»¶å®ä¾‹ï¼Œç±»å‹ä¸º`*File`

ä»¥æ–‡ä»¶çš„æ–¹å¼æ“ä½œç»ˆç«¯:

```go
package main

import "os"

func main() {
    var buf [16]byte
    os.Stdin.Read(buf[:])
    os.Stdin.WriteString(string(buf[:]))
}
```

### 1.1.2. æ–‡ä»¶æ“ä½œç›¸å…³API

- ```
  func Create(name string) (file *File, err Error)
  ```

  - æ ¹æ®æä¾›çš„æ–‡ä»¶ååˆ›å»ºæ–°çš„æ–‡ä»¶ï¼Œè¿”å›ä¸€ä¸ªæ–‡ä»¶å¯¹è±¡ï¼Œé»˜è®¤æƒé™æ˜¯0666

- ```
  func NewFile(fd uintptr, name string) *File
  ```

  - æ ¹æ®æ–‡ä»¶æè¿°ç¬¦åˆ›å»ºç›¸åº”çš„æ–‡ä»¶ï¼Œè¿”å›ä¸€ä¸ªæ–‡ä»¶å¯¹è±¡

- ```
  func Open(name string) (file *File, err Error)
  ```

  - åªè¯»æ–¹å¼æ‰“å¼€ä¸€ä¸ªåç§°ä¸ºnameçš„æ–‡ä»¶

- ```
  func OpenFile(name string, flag int, perm uint32) (file *File, err Error)
  ```

  - æ‰“å¼€åç§°ä¸ºnameçš„æ–‡ä»¶ï¼Œflagæ˜¯æ‰“å¼€çš„æ–¹å¼ï¼Œåªè¯»ã€è¯»å†™ç­‰ï¼Œpermæ˜¯æƒé™

- ```
  func (file *File) Write(b []byte) (n int, err Error)
  ```

  - å†™å…¥byteç±»å‹çš„ä¿¡æ¯åˆ°æ–‡ä»¶

- ```
  func (file *File) WriteAt(b []byte, off int64) (n int, err Error)
  ```

  - åœ¨æŒ‡å®šä½ç½®å¼€å§‹å†™å…¥byteç±»å‹çš„ä¿¡æ¯

- ```
  func (file *File) WriteString(s string) (ret int, err Error)
  ```

  - å†™å…¥stringä¿¡æ¯åˆ°æ–‡ä»¶

- ```
  func (file *File) Read(b []byte) (n int, err Error)
  ```

  - è¯»å–æ•°æ®åˆ°bä¸­

- ```
  func (file *File) ReadAt(b []byte, off int64) (n int, err Error)
  ```

  - ä»offå¼€å§‹è¯»å–æ•°æ®åˆ°bä¸­

- ```
  func Remove(name string) Error
  ```

  - åˆ é™¤æ–‡ä»¶åä¸ºnameçš„æ–‡ä»¶

### 1.1.3. æ‰“å¼€å’Œå…³é—­æ–‡ä»¶

`os.Open()`å‡½æ•°èƒ½å¤Ÿæ‰“å¼€ä¸€ä¸ªæ–‡ä»¶ï¼Œè¿”å›ä¸€ä¸ª`*File`å’Œä¸€ä¸ª`err`ã€‚å¯¹å¾—åˆ°çš„æ–‡ä»¶å®ä¾‹è°ƒç”¨close()æ–¹æ³•èƒ½å¤Ÿå…³é—­æ–‡ä»¶ã€‚

```go
package main

import (
    "fmt"
    "os"
)

func main() {
    // åªè¯»æ–¹å¼æ‰“å¼€å½“å‰ç›®å½•ä¸‹çš„main.goæ–‡ä»¶
    file, err := os.Open("./main.go")
    if err != nil {
        fmt.Println("open file failed!, err:", err)
        return
    }
    // å…³é—­æ–‡ä»¶
    file.Close()
}
```

### 1.1.4. å†™æ–‡ä»¶

```go
package main

import (
    "fmt"
    "os"
)

func main() {
    // æ–°å»ºæ–‡ä»¶
    file, err := os.Create("./xxx.txt")
    if err != nil {
        fmt.Println(err)
        return
    }
    defer file.Close()
    for i := 0; i < 5; i++ {
        file.WriteString("ab\n")
        file.Write([]byte("cd\n"))
    }
}
```

### 1.1.5. è¯»æ–‡ä»¶

æ–‡ä»¶è¯»å–å¯ä»¥ç”¨file.Read()å’Œfile.ReadAt()ï¼Œè¯»åˆ°æ–‡ä»¶æœ«å°¾ä¼šè¿”å›io.EOFçš„é”™è¯¯

```go
package main

import (
    "fmt"
    "io"
    "os"
)

func main() {
    // æ‰“å¼€æ–‡ä»¶
    file, err := os.Open("./xxx.txt")
    if err != nil {
        fmt.Println("open file err :", err)
        return
    }
    defer file.Close()
    // å®šä¹‰æ¥æ”¶æ–‡ä»¶è¯»å–çš„å­—èŠ‚æ•°ç»„
    var buf [128]byte
    var content []byte
    for {
        n, err := file.Read(buf[:])
        if err == io.EOF {
            // è¯»å–ç»“æŸ
            break
        }
        if err != nil {
            fmt.Println("read file err ", err)
            return
        }
        content = append(content, buf[:n]...)
    }
    fmt.Println(string(content))
}
```

### 1.1.6. æ‹·è´æ–‡ä»¶

```go
package main

import (
    "fmt"
    "io"
    "os"
)

func main() {
    // æ‰“å¼€æºæ–‡ä»¶
    srcFile, err := os.Open("./xxx.txt")
    if err != nil {
        fmt.Println(err)
        return
    }
    // åˆ›å»ºæ–°æ–‡ä»¶
    dstFile, err2 := os.Create("./abc2.txt")
    if err2 != nil {
        fmt.Println(err2)
        return
    }
    // ç¼“å†²è¯»å–
    buf := make([]byte, 1024)
    for {
        // ä»æºæ–‡ä»¶è¯»æ•°æ®
        n, err := srcFile.Read(buf)
        if err == io.EOF {
            fmt.Println("è¯»å–å®Œæ¯•")
            break
        }
        if err != nil {
            fmt.Println(err)
            break
        }
        //å†™å‡ºå»
        dstFile.Write(buf[:n])
    }
    srcFile.Close()
    dstFile.Close()
}
```

### 1.1.7. bufio

- bufioåŒ…å®ç°äº†å¸¦ç¼“å†²åŒºçš„è¯»å†™ï¼Œæ˜¯å¯¹æ–‡ä»¶è¯»å†™çš„å°è£…
- bufioç¼“å†²å†™æ•°æ®

| æ¨¡å¼        | å«ä¹‰     |
| ----------- | -------- |
| os.O_WRONLY | åªå†™     |
| os.O_CREATE | åˆ›å»ºæ–‡ä»¶ |
| os.O_RDONLY | åªè¯»     |
| os.O_RDWR   | è¯»å†™     |
| os.O_TRUNC  | æ¸…ç©º     |
| os.O_APPEND | è¿½åŠ      |

- bufioè¯»æ•°æ®

```go
package main

import (
    "bufio"
    "fmt"
    "io"
    "os"
)

func wr() {
    // å‚æ•°2ï¼šæ‰“å¼€æ¨¡å¼ï¼Œæ‰€æœ‰æ¨¡å¼déƒ½åœ¨ä¸Šé¢
    // å‚æ•°3æ˜¯æƒé™æ§åˆ¶
    // wå†™ rè¯» xæ‰§è¡Œ   w  2   r  4   x  1
    file, err := os.OpenFile("./xxx.txt", os.O_CREATE|os.O_WRONLY, 0666)
    if err != nil {
        return
    }
    defer file.Close()
    // è·å–writerå¯¹è±¡
    writer := bufio.NewWriter(file)
    for i := 0; i < 10; i++ {
        writer.WriteString("hello\n")
    }
    // åˆ·æ–°ç¼“å†²åŒºï¼Œå¼ºåˆ¶å†™å‡º
    writer.Flush()
}

func re() {
    file, err := os.Open("./xxx.txt")
    if err != nil {
        return
    }
    defer file.Close()
    reader := bufio.NewReader(file)
    for {
        line, _, err := reader.ReadLine()
        if err == io.EOF {
            break
        }
        if err != nil {
            return
        }
        fmt.Println(string(line))
    }

}

func main() {
    re()
}
```

### 1.1.8. ioutilå·¥å…·åŒ…

- å·¥å…·åŒ…å†™æ–‡ä»¶
- å·¥å…·åŒ…è¯»å–æ–‡ä»¶

```go
package main

import (
   "fmt"
   "io/ioutil"
)

func wr() {
   err := ioutil.WriteFile("./yyy.txt", []byte("www.5lmh.com"), 0666)
   if err != nil {
      fmt.Println(err)
      return
   }
}

func re() {
   content, err := ioutil.ReadFile("./yyy.txt")
   if err != nil {
      fmt.Println(err)
      return
   }
   fmt.Println(string(content))
}

func main() {
   re()
}
```

### 1.1.9. ä¾‹å­

#### å®ç°ä¸€ä¸ªcatå‘½ä»¤

ä½¿ç”¨æ–‡ä»¶æ“ä½œç›¸å…³çŸ¥è¯†ï¼Œæ¨¡æ‹Ÿå®ç°linuxå¹³å°catå‘½ä»¤çš„åŠŸèƒ½ã€‚

```go
package main

import (
    "bufio"
    "flag"
    "fmt"
    "io"
    "os"
)

// catå‘½ä»¤å®ç°
func cat(r *bufio.Reader) {
    for {
        buf, err := r.ReadBytes('\n') //æ³¨æ„æ˜¯å­—ç¬¦
        if err == io.EOF {
            break
        }
        fmt.Fprintf(os.Stdout, "%s", buf)
    }
}

func main() {
    flag.Parse() // è§£æå‘½ä»¤è¡Œå‚æ•°
    if flag.NArg() == 0 {
        // å¦‚æœæ²¡æœ‰å‚æ•°é»˜è®¤ä»æ ‡å‡†è¾“å…¥è¯»å–å†…å®¹
        cat(bufio.NewReader(os.Stdin))
    }
    // ä¾æ¬¡è¯»å–æ¯ä¸ªæŒ‡å®šæ–‡ä»¶çš„å†…å®¹å¹¶æ‰“å°åˆ°ç»ˆç«¯
    for i := 0; i < flag.NArg(); i++ {
        f, err := os.Open(flag.Arg(i))
        if err != nil {
            fmt.Fprintf(os.Stdout, "reading from %s failed, err:%v\n", flag.Arg(i), err)
            continue
        }
        cat(bufio.NewReader(f))
    }
}
```

## END é“¾æ¥
<ul><li><div><a href = '57.md' style='float:left'>â¬†ï¸ä¸Šä¸€èŠ‚ğŸ”—</a><a href = '59.md' style='float: right'>â¬‡ï¸ä¸‹ä¸€èŠ‚ğŸ”—</a></div></li></ul>

+ [â“‚ï¸å›åˆ°é¦–é¡µğŸ ](../README.md)

+ [**ğŸ«µå‚ä¸è´¡çŒ®ğŸ’â¤ï¸â€ğŸ”¥ğŸ’–**](https://nsddd.top/archives/contributors))

+ âœ´ï¸ç‰ˆæƒå£°æ˜ &copy; :æœ¬ä¹¦æ‰€æœ‰å†…å®¹éµå¾ª[CC-BY-SA 3.0åè®®ï¼ˆç½²å-ç›¸åŒæ–¹å¼å…±äº«ï¼‰&copy;](http://zh.wikipedia.org/wiki/Wikipedia:CC-by-sa-3.0åè®®æ–‡æœ¬) 

