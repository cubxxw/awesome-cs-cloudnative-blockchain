# 1. TCPç¼–ç¨‹

## Goè¯­è¨€å®ç°TCPé€šä¿¡

### TCPåè®®

TCP/IP(Transmission Control Protocol/Internet Protocol) å³ä¼ è¾“æ§åˆ¶åè®®/ç½‘é—´åè®®ï¼Œæ˜¯ä¸€ç§é¢å‘è¿æ¥ï¼ˆè¿æ¥å¯¼å‘ï¼‰çš„ã€å¯é çš„ã€åŸºäºå­—èŠ‚æµçš„ä¼ è¾“å±‚ï¼ˆTransport layerï¼‰é€šä¿¡åè®®ï¼Œå› ä¸ºæ˜¯é¢å‘è¿æ¥çš„åè®®ï¼Œæ•°æ®åƒæ°´æµä¸€æ ·ä¼ è¾“ï¼Œä¼šå­˜åœ¨é»åŒ…é—®é¢˜ã€‚

### TCPæœåŠ¡ç«¯

ä¸€ä¸ªTCPæœåŠ¡ç«¯å¯ä»¥åŒæ—¶è¿æ¥å¾ˆå¤šä¸ªå®¢æˆ·ç«¯ï¼Œä¾‹å¦‚ä¸–ç•Œå„åœ°çš„ç”¨æˆ·ä½¿ç”¨è‡ªå·±ç”µè„‘ä¸Šçš„æµè§ˆå™¨è®¿é—®æ·˜å®ç½‘ã€‚å› ä¸ºGoè¯­è¨€ä¸­åˆ›å»ºå¤šä¸ªgoroutineå®ç°å¹¶å‘éå¸¸æ–¹ä¾¿å’Œé«˜æ•ˆï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥æ¯å»ºç«‹ä¸€æ¬¡é“¾æ¥å°±åˆ›å»ºä¸€ä¸ªgoroutineå»å¤„ç†ã€‚

TCPæœåŠ¡ç«¯ç¨‹åºçš„å¤„ç†æµç¨‹ï¼š

```
    1.ç›‘å¬ç«¯å£
    2.æ¥æ”¶å®¢æˆ·ç«¯è¯·æ±‚å»ºç«‹é“¾æ¥
    3.åˆ›å»ºgoroutineå¤„ç†é“¾æ¥ã€‚
```

æˆ‘ä»¬ä½¿ç”¨Goè¯­è¨€çš„netåŒ…å®ç°çš„TCPæœåŠ¡ç«¯ä»£ç å¦‚ä¸‹ï¼š

```go
// tcp/server/main.go

// TCP serverç«¯

// å¤„ç†å‡½æ•°
func process(conn net.Conn) {
    defer conn.Close() // å…³é—­è¿æ¥
    for {
        reader := bufio.NewReader(conn)
        var buf [128]byte
        n, err := reader.Read(buf[:]) // è¯»å–æ•°æ®
        if err != nil {
            fmt.Println("read from client failed, err:", err)
            break
        }
        recvStr := string(buf[:n])
        fmt.Println("æ”¶åˆ°clientç«¯å‘æ¥çš„æ•°æ®ï¼š", recvStr)
        conn.Write([]byte(recvStr)) // å‘é€æ•°æ®
    }
}

func main() {
    listen, err := net.Listen("tcp", "127.0.0.1:20000")
    if err != nil {
        fmt.Println("listen failed, err:", err)
        return
    }
    for {
        conn, err := listen.Accept() // å»ºç«‹è¿æ¥
        if err != nil {
            fmt.Println("accept failed, err:", err)
            continue
        }
        go process(conn) // å¯åŠ¨ä¸€ä¸ªgoroutineå¤„ç†è¿æ¥
    }
}
```

å°†ä¸Šé¢çš„ä»£ç ä¿å­˜ä¹‹åç¼–è¯‘æˆserveræˆ–server.exeå¯æ‰§è¡Œæ–‡ä»¶ã€‚

### TCPå®¢æˆ·ç«¯

ä¸€ä¸ªTCPå®¢æˆ·ç«¯è¿›è¡ŒTCPé€šä¿¡çš„æµç¨‹å¦‚ä¸‹ï¼š

```
    1.å»ºç«‹ä¸æœåŠ¡ç«¯çš„é“¾æ¥
    2.è¿›è¡Œæ•°æ®æ”¶å‘
    3.å…³é—­é“¾æ¥
```

ä½¿ç”¨Goè¯­è¨€çš„netåŒ…å®ç°çš„TCPå®¢æˆ·ç«¯ä»£ç å¦‚ä¸‹ï¼š

```go
// tcp/client/main.go

// å®¢æˆ·ç«¯
func main() {
    conn, err := net.Dial("tcp", "127.0.0.1:20000")
    if err != nil {
        fmt.Println("err :", err)
        return
    }
    defer conn.Close() // å…³é—­è¿æ¥
    inputReader := bufio.NewReader(os.Stdin)
    for {
        input, _ := inputReader.ReadString('\n') // è¯»å–ç”¨æˆ·è¾“å…¥
        inputInfo := strings.Trim(input, "\r\n")
        if strings.ToUpper(inputInfo) == "Q" { // å¦‚æœè¾“å…¥qå°±é€€å‡º
            return
        }
        _, err = conn.Write([]byte(inputInfo)) // å‘é€æ•°æ®
        if err != nil {
            return
        }
        buf := [512]byte{}
        n, err := conn.Read(buf[:])
        if err != nil {
            fmt.Println("recv failed, err:", err)
            return
        }
        fmt.Println(string(buf[:n]))
    }
}
```

å°†ä¸Šé¢çš„ä»£ç ç¼–è¯‘æˆclientæˆ–client.exeå¯æ‰§è¡Œæ–‡ä»¶ï¼Œå…ˆå¯åŠ¨serverç«¯å†å¯åŠ¨clientç«¯ï¼Œåœ¨clientç«¯è¾“å…¥ä»»æ„å†…å®¹å›è½¦ä¹‹åå°±èƒ½å¤Ÿåœ¨serverç«¯çœ‹åˆ°clientç«¯å‘é€çš„æ•°æ®ï¼Œä»è€Œå®ç°TCPé€šä¿¡ã€‚

## END é“¾æ¥
<ul><li><div><a href = '2.md' style='float:left'>â¬†ï¸ä¸Šä¸€èŠ‚ğŸ”—</a><a href = '4.md' style='float: right'>â¬‡ï¸ä¸‹ä¸€èŠ‚ğŸ”—</a></div></li></ul>

+ [â“‚ï¸å›åˆ°é¦–é¡µğŸ ](../README.md)

+ [**ğŸ«µå‚ä¸è´¡çŒ®ğŸ’â¤ï¸â€ğŸ”¥ğŸ’–**](https://nsddd.top/archives/contributors))

+ âœ´ï¸ç‰ˆæƒå£°æ˜ &copy; :æœ¬ä¹¦æ‰€æœ‰å†…å®¹éµå¾ª[CC-BY-SA 3.0åè®®ï¼ˆç½²å-ç›¸åŒæ–¹å¼å…±äº«ï¼‰&copy;](http://zh.wikipedia.org/wiki/Wikipedia:CC-by-sa-3.0åè®®æ–‡æœ¬) 

