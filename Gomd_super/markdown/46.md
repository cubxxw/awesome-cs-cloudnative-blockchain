# 1. Workæ¨¡å¼ï¼ˆå·¥ä½œæ¨¡å¼ï¼Œä¸€ä¸ªæ¶ˆæ¯åªèƒ½è¢«ä¸€ä¸ªæ¶ˆè´¹è€…è·å–ï¼‰

![img](https://www.topgoer.com/static/9.3/2.png)

- æ¶ˆæ¯äº§ç”Ÿè€…å°†æ¶ˆæ¯æ”¾å…¥é˜Ÿåˆ—æ¶ˆè´¹è€…å¯ä»¥æœ‰å¤šä¸ª,æ¶ˆè´¹è€…1,æ¶ˆè´¹è€…2,åŒæ—¶ç›‘å¬åŒä¸€ä¸ªé˜Ÿåˆ—,æ¶ˆæ¯è¢«æ¶ˆè´¹?C1 C2å…±åŒäº‰æŠ¢å½“å‰çš„æ¶ˆæ¯é˜Ÿåˆ—å†…å®¹,è°å…ˆæ‹¿åˆ°è°è´Ÿè´£æ¶ˆè´¹æ¶ˆæ¯(éšæ‚£,é«˜å¹¶å‘æƒ…å†µä¸‹,é»˜è®¤ä¼šäº§ç”ŸæŸä¸€ä¸ªæ¶ˆæ¯è¢«å¤šä¸ªæ¶ˆè´¹è€…å…±åŒä½¿ç”¨,å¯ä»¥è®¾ç½®ä¸€ä¸ªå¼€å…³(syncronize,ä¸åŒæ­¥é”çš„æ€§èƒ½ä¸ä¸€æ ·) ä¿è¯ä¸€æ¡æ¶ˆæ¯åªèƒ½è¢«ä¸€ä¸ªæ¶ˆè´¹è€…ä½¿ç”¨)
- åº”ç”¨åœºæ™¯:çº¢åŒ…;å¤§é¡¹ç›®ä¸­çš„èµ„æºè°ƒåº¦(ä»»åŠ¡åˆ†é…ç³»ç»Ÿä¸éœ€çŸ¥é“å“ªä¸€ä¸ªä»»åŠ¡æ‰§è¡Œç³»ç»Ÿåœ¨ç©ºé—²,ç›´æ¥å°†ä»»åŠ¡æ‰”åˆ°æ¶ˆæ¯é˜Ÿåˆ—ä¸­,ç©ºé—²çš„ç³»ç»Ÿè‡ªåŠ¨äº‰æŠ¢)

ç›®å½•ç»“æ„

![img](https://www.topgoer.com/static/9.3/36.png)

kuteng-RabbitMQ

-RabbitMQ

--rabitmq.go //è¿™ä¸ªæ˜¯RabbitMQçš„å°è£…å’ŒSimpleæ¨¡å¼ä»£ç ä¸€æ ·

-SimlpePublish

--mainSimlpePublish.go //Publish å…ˆå¯åŠ¨

-SimpleRecieve1

--mainSimpleRecieve.go

-SimpleRecieve2

--mainSimpleRecieve.go

**æ³¨æ„**

Workæ¨¡å¼å’ŒSimpleæ¨¡å¼ç›¸æ¯”ä»£ç å¹¶æ²¡æœ‰å‘ç”Ÿå˜åŒ–åªæ˜¯å¤šäº†ä¸€ä¸ªæ¶ˆè´¹è€…

rabitmq.goä»£ç 

```go
package RabbitMQ

import (
    "fmt"
    "log"

    "github.com/streadway/amqp"
)

//è¿æ¥ä¿¡æ¯amqp://kuteng:kuteng@127.0.0.1:5672/kutengè¿™ä¸ªä¿¡æ¯æ˜¯å›ºå®šä¸å˜çš„amqp://äº‹å›ºå®šå‚æ•°åé¢ä¸¤ä¸ªæ˜¯ç”¨æˆ·åå¯†ç ipåœ°å€ç«¯å£å·Virtual Host
const MQURL = "amqp://kuteng:kuteng@127.0.0.1:5672/kuteng"

//rabbitMQç»“æ„ä½“
type RabbitMQ struct {
    conn    *amqp.Connection
    channel *amqp.Channel
    //é˜Ÿåˆ—åç§°
    QueueName string
    //äº¤æ¢æœºåç§°
    Exchange string
    //bind Key åç§°
    Key string
    //è¿æ¥ä¿¡æ¯
    Mqurl string
}

//åˆ›å»ºç»“æ„ä½“å®ä¾‹
func NewRabbitMQ(queueName string, exchange string, key string) *RabbitMQ {
    return &RabbitMQ{QueueName: queueName, Exchange: exchange, Key: key, Mqurl: MQURL}
}

//æ–­å¼€channel å’Œ connection
func (r *RabbitMQ) Destory() {
    r.channel.Close()
    r.conn.Close()
}

//é”™è¯¯å¤„ç†å‡½æ•°
func (r *RabbitMQ) failOnErr(err error, message string) {
    if err != nil {
        log.Fatalf("%s:%s", message, err)
        panic(fmt.Sprintf("%s:%s", message, err))
    }
}

//åˆ›å»ºç®€å•æ¨¡å¼ä¸‹RabbitMQå®ä¾‹
func NewRabbitMQSimple(queueName string) *RabbitMQ {
    //åˆ›å»ºRabbitMQå®ä¾‹
    rabbitmq := NewRabbitMQ(queueName, "", "")
    var err error
    //è·å–connection
    rabbitmq.conn, err = amqp.Dial(rabbitmq.Mqurl)
    rabbitmq.failOnErr(err, "failed to connect rabb"+
        "itmq!")
    //è·å–channel
    rabbitmq.channel, err = rabbitmq.conn.Channel()
    rabbitmq.failOnErr(err, "failed to open a channel")
    return rabbitmq
}

//ç›´æ¥æ¨¡å¼é˜Ÿåˆ—ç”Ÿäº§
func (r *RabbitMQ) PublishSimple(message string) {
    //1.ç”³è¯·é˜Ÿåˆ—ï¼Œå¦‚æœé˜Ÿåˆ—ä¸å­˜åœ¨ä¼šè‡ªåŠ¨åˆ›å»ºï¼Œå­˜åœ¨åˆ™è·³è¿‡åˆ›å»º
    _, err := r.channel.QueueDeclare(
        r.QueueName,
        //æ˜¯å¦æŒä¹…åŒ–
        false,
        //æ˜¯å¦è‡ªåŠ¨åˆ é™¤
        false,
        //æ˜¯å¦å…·æœ‰æ’ä»–æ€§
        false,
        //æ˜¯å¦é˜»å¡å¤„ç†
        false,
        //é¢å¤–çš„å±æ€§
        nil,
    )
    if err != nil {
        fmt.Println(err)
    }
    //è°ƒç”¨channel å‘é€æ¶ˆæ¯åˆ°é˜Ÿåˆ—ä¸­
    r.channel.Publish(
        r.Exchange,
        r.QueueName,
        //å¦‚æœä¸ºtrueï¼Œæ ¹æ®è‡ªèº«exchangeç±»å‹å’Œroutekeyè§„åˆ™æ— æ³•æ‰¾åˆ°ç¬¦åˆæ¡ä»¶çš„é˜Ÿåˆ—ä¼šæŠŠæ¶ˆæ¯è¿”è¿˜ç»™å‘é€è€…
        false,
        //å¦‚æœä¸ºtrueï¼Œå½“exchangeå‘é€æ¶ˆæ¯åˆ°é˜Ÿåˆ—åå‘ç°é˜Ÿåˆ—ä¸Šæ²¡æœ‰æ¶ˆè´¹è€…ï¼Œåˆ™ä¼šæŠŠæ¶ˆæ¯è¿”è¿˜ç»™å‘é€è€…
        false,
        amqp.Publishing{
            ContentType: "text/plain",
            Body:        []byte(message),
        })
}

//simple æ¨¡å¼ä¸‹æ¶ˆè´¹è€…
func (r *RabbitMQ) ConsumeSimple() {
    //1.ç”³è¯·é˜Ÿåˆ—ï¼Œå¦‚æœé˜Ÿåˆ—ä¸å­˜åœ¨ä¼šè‡ªåŠ¨åˆ›å»ºï¼Œå­˜åœ¨åˆ™è·³è¿‡åˆ›å»º
    q, err := r.channel.QueueDeclare(
        r.QueueName,
        //æ˜¯å¦æŒä¹…åŒ–
        false,
        //æ˜¯å¦è‡ªåŠ¨åˆ é™¤
        false,
        //æ˜¯å¦å…·æœ‰æ’ä»–æ€§
        false,
        //æ˜¯å¦é˜»å¡å¤„ç†
        false,
        //é¢å¤–çš„å±æ€§
        nil,
    )
    if err != nil {
        fmt.Println(err)
    }

    //æ¥æ”¶æ¶ˆæ¯
    msgs, err := r.channel.Consume(
        q.Name, // queue
        //ç”¨æ¥åŒºåˆ†å¤šä¸ªæ¶ˆè´¹è€…
        "", // consumer
        //æ˜¯å¦è‡ªåŠ¨åº”ç­”
        true, // auto-ack
        //æ˜¯å¦ç‹¬æœ‰
        false, // exclusive
        //è®¾ç½®ä¸ºtrueï¼Œè¡¨ç¤º ä¸èƒ½å°†åŒä¸€ä¸ªConenctionä¸­ç”Ÿäº§è€…å‘é€çš„æ¶ˆæ¯ä¼ é€’ç»™è¿™ä¸ªConnectionä¸­ çš„æ¶ˆè´¹è€…
        false, // no-local
        //åˆ—æ˜¯å¦é˜»å¡
        false, // no-wait
        nil,   // args
    )
    if err != nil {
        fmt.Println(err)
    }

    forever := make(chan bool)
    //å¯ç”¨åç¨‹å¤„ç†æ¶ˆæ¯
    go func() {
        for d := range msgs {
            //æ¶ˆæ¯é€»è¾‘å¤„ç†ï¼Œå¯ä»¥è‡ªè¡Œè®¾è®¡é€»è¾‘
            log.Printf("Received a message: %s", d.Body)

        }
    }()

    log.Printf(" [*] Waiting for messages. To exit press CTRL+C")
    <-forever

}
```

mainSimlpePublish.goä»£ç 

```go
package main

import (
    "fmt"
    "strconv"
    "time"

    "github.com/student/kuteng-RabbitMQ/RabbitMQ"
)

func main() {
    rabbitmq := RabbitMQ.NewRabbitMQSimple("" +
        "kuteng")

    for i := 0; i <= 100; i++ {
        rabbitmq.PublishSimple("Hello kuteng!" + strconv.Itoa(i))
        time.Sleep(1 * time.Second)
        fmt.Println(i)
    }
}
```

mainSimpleRecieve.goä»£ç (ä¸¤ä¸ªæ¶ˆè´¹ç«¯çš„ä»£ç æ˜¯ä¸€æ ·çš„)

```go
package main

import "github.com/student/kuteng-RabbitMQ/RabbitMQ"

func main() {
    rabbitmq := RabbitMQ.NewRabbitMQSimple("" +
        "kuteng")
    rabbitmq.ConsumeSimple()
}
```

## END é“¾æ¥
<ul><li><div><a href = '45.md' style='float:left'>â¬†ï¸ä¸Šä¸€èŠ‚ğŸ”—</a><a href = '47.md' style='float: right'>â¬‡ï¸ä¸‹ä¸€èŠ‚ğŸ”—</a></div></li></ul>

+ [â“‚ï¸å›åˆ°é¦–é¡µğŸ ](../README.md)

+ [**ğŸ«µå‚ä¸è´¡çŒ®ğŸ’â¤ï¸â€ğŸ”¥ğŸ’–**](https://nsddd.top/archives/contributors))

+ âœ´ï¸ç‰ˆæƒå£°æ˜ &copy; :æœ¬ä¹¦æ‰€æœ‰å†…å®¹éµå¾ª[CC-BY-SA 3.0åè®®ï¼ˆç½²å-ç›¸åŒæ–¹å¼å…±äº«ï¼‰&copy;](http://zh.wikipedia.org/wiki/Wikipedia:CC-by-sa-3.0åè®®æ–‡æœ¬) 

