# 1. Goroutineæ± 

### 1.1.1. worker poolï¼ˆgoroutineæ± ï¼‰

- æœ¬è´¨ä¸Šæ˜¯ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å‹
- å¯ä»¥æœ‰æ•ˆæ§åˆ¶goroutineæ•°é‡ï¼Œé˜²æ­¢æš´æ¶¨
- éœ€æ±‚ï¼š
  - è®¡ç®—ä¸€ä¸ªæ•°å­—çš„å„ä¸ªä½æ•°ä¹‹å’Œï¼Œä¾‹å¦‚æ•°å­—123ï¼Œç»“æœä¸º1+2+3=6
  - éšæœºç”Ÿæˆæ•°å­—è¿›è¡Œè®¡ç®—
- æ§åˆ¶å°è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š

![img](https://s2.loli.net/2022/04/10/A9DCygv1YtTZ7Qd.png)

```go
package main

import (
    "fmt"
    "math/rand"
)

type Job struct {
    // id
    Id int
    // éœ€è¦è®¡ç®—çš„éšæœºæ•°
    RandNum int
}

type Result struct {
    // è¿™é‡Œå¿…é¡»ä¼ å¯¹è±¡å®ä¾‹
    job *Job
    // æ±‚å’Œ
    sum int
}

func main() {
    // éœ€è¦2ä¸ªç®¡é“
    // 1.jobç®¡é“
    jobChan := make(chan *Job, 128)
    // 2.ç»“æœç®¡é“
    resultChan := make(chan *Result, 128)
    // 3.åˆ›å»ºå·¥ä½œæ± 
    createPool(64, jobChan, resultChan)
    // 4.å¼€ä¸ªæ‰“å°çš„åç¨‹
    go func(resultChan chan *Result) {
        // éå†ç»“æœç®¡é“æ‰“å°
        for result := range resultChan {
            fmt.Printf("job id:%v randnum:%v result:%d\n", result.job.Id,
                result.job.RandNum, result.sum)
        }
    }(resultChan)
    var id int
    // å¾ªç¯åˆ›å»ºjobï¼Œè¾“å…¥åˆ°ç®¡é“
    for {
        id++
        // ç”Ÿæˆéšæœºæ•°
        r_num := rand.Int()
        job := &Job{
            Id:      id,
            RandNum: r_num,
        }
        jobChan <- job
    }
}

// åˆ›å»ºå·¥ä½œæ± 
// å‚æ•°1ï¼šå¼€å‡ ä¸ªåç¨‹
func createPool(num int, jobChan chan *Job, resultChan chan *Result) {
    // æ ¹æ®å¼€åç¨‹ä¸ªæ•°ï¼Œå»è·‘è¿è¡Œ
    for i := 0; i < num; i++ {
        go func(jobChan chan *Job, resultChan chan *Result) {
            // æ‰§è¡Œè¿ç®—
            // éå†jobç®¡é“æ‰€æœ‰æ•°æ®ï¼Œè¿›è¡Œç›¸åŠ 
            for job := range jobChan {
                // éšæœºæ•°æ¥è¿‡æ¥
                r_num := job.RandNum
                // éšæœºæ•°æ¯ä¸€ä½ç›¸åŠ 
                // å®šä¹‰è¿”å›å€¼
                var sum int
                for r_num != 0 {
                    tmp := r_num % 10
                    sum += tmp
                    r_num /= 10
                }
                // æƒ³è¦çš„ç»“æœæ˜¯Result
                r := &Result{
                    job: job,
                    sum: sum,
                }
                //è¿ç®—ç»“æœæ‰”åˆ°ç®¡é“
                resultChan <- r
            }
        }(jobChan, resultChan)
    }
}
```

## END é“¾æ¥
<ul><li><div><a href = '11.md' style='float:left'>â¬†ï¸ä¸Šä¸€èŠ‚ğŸ”—</a><a href = '13.md' style='float: right'>â¬‡ï¸ä¸‹ä¸€èŠ‚ğŸ”—</a></div></li></ul>

+ [â“‚ï¸å›åˆ°é¦–é¡µğŸ ](../README.md)

+ [**ğŸ«µå‚ä¸è´¡çŒ®ğŸ’â¤ï¸â€ğŸ”¥ğŸ’–**](https://nsddd.top/archives/contributors))

+ âœ´ï¸ç‰ˆæƒå£°æ˜ &copy; :æœ¬ä¹¦æ‰€æœ‰å†…å®¹éµå¾ª[CC-BY-SA 3.0åè®®ï¼ˆç½²å-ç›¸åŒæ–¹å¼å…±äº«ï¼‰&copy;](http://zh.wikipedia.org/wiki/Wikipedia:CC-by-sa-3.0åè®®æ–‡æœ¬) 

