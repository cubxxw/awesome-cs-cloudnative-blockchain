# dockeræ­å»ºGitlab æœåŠ¡å™¨

[[toc]]

[toc]

## è­¦å‘Šï¼

::: danger âš ï¸ è­¦å‘Š
ä¸ªäººçº¯å±çˆ±å¥½ï¼Œæ­å»ºä¸ªäººçš„gitlabæœåŠ¡å™¨ï¼Œgitlabå¾ˆæ¶ˆè€—å†…å­˜

:::

## å‰è¨€

æˆ‘éœ€è¦åœ¨æœåŠ¡å™¨ä¸Šé¢éƒ¨ç½²ä¸€ä¸ªä»“åº“ï¼Œæ–¹ä¾¿æäº¤ï¼Œè€Œä¸”ä¾›ä¸»æœºå’ŒæœåŠ¡å™¨ä¹‹é—´çš„æ•°æ®ä¼ è¾“

+ ç³»ç»Ÿï¼šcentos



## å®‰è£…é•œåƒ

:finland:**æŸ¥æ‰¾é•œåƒ**

```
# æŸ¥æ‰¾Gitlabé•œåƒ
docker search gitlab
```



**ğŸ¤æ‹‰å–Gitlabé•œåƒ**

```
docker pull gitlab/gitlab-ce:latest
```



**:stars:å¯åŠ¨dockeré•œåƒ**

```bash
# å¯åŠ¨å®¹å™¨
docker run \
 -itd  \
 -p 9980:80 \
 -p 9922:22 \
 -v D:\docker\gitlab\etc:/etc/gitlab  \
 -v D:\docker\gitlab\log:/var/log/gitlab \
 -v D:\docker\gitlab\opt:/var/opt/gitlab \
 --restart always \
 --privileged=true \
 --name gitlab \
 gitlab/gitlab-ce
```

```
# å¯åŠ¨å®¹å™¨
docker run -itd -p 9980:80 -p 9922:22 -v D:\docker\gitlab\etc:/etc/gitlab -v D:\docker\gitlab\log:/var/log/gitlab -v D:\docker\gitlab\opt:/var/opt/gitlab  --restart always --privileged=true --name gitlab gitlab/gitlab-ce
```

ğŸˆ è§£é‡Šï¼š

| å‘½ä»¤                            | æè¿°                                                         |
| ------------------------------- | ------------------------------------------------------------ |
| -i                              | ä»¥äº¤äº’æ¨¡å¼è¿è¡Œå®¹å™¨ï¼Œé€šå¸¸ä¸ -t åŒæ—¶ä½¿ç”¨å‘½ä»¤è§£é‡Š               |
| -t                              | ä¸ºå®¹å™¨é‡æ–°åˆ†é…ä¸€ä¸ªä¼ªè¾“å…¥ç»ˆç«¯ï¼Œé€šå¸¸ä¸ -i åŒæ—¶ä½¿ç”¨             |
| -d                              | åå°è¿è¡Œå®¹å™¨ï¼Œå¹¶è¿”å›å®¹å™¨ ID                                  |
| -p 9980:80                      | å°†å®¹å™¨å†… 80 ç«¯å£æ˜ å°„è‡³å®¿ä¸»æœº 9980 ç«¯å£ï¼Œè¿™æ˜¯è®¿é—® gitlab çš„ç«¯å£ |
| -p 9922:22                      | å°†å®¹å™¨å†… 22 ç«¯å£æ˜ å°„è‡³å®¿ä¸»æœº 9922 ç«¯å£ï¼Œè¿™æ˜¯è®¿é—® ssh çš„ç«¯å£  |
| -v /home/gitlab/etc:/etc/gitlab | å°†å®¹å™¨ / etc/gitlab ç›®å½•æŒ‚è½½åˆ°å®¿ä¸»æœº / usr/local/gitlab-test/etc ç›®å½•ä¸‹ï¼Œè‹¥å®¿ä¸»æœºå†…æ­¤ç›®å½•ä¸å­˜åœ¨å°†ä¼šè‡ªåŠ¨åˆ›å»ºï¼Œå…¶ä»–ä¸¤ä¸ªæŒ‚è½½åŒè¿™ä¸ªä¸€æ · |
| --restart always                | å®¹å™¨è‡ªå¯åŠ¨                                                   |
| --privileged=true               | è®©å®¹å™¨è·å–å®¿ä¸»æœº root æƒé™                                   |
| --name gitlab                   | è®¾ç½®å®¹å™¨åç§°ä¸º gitlab                                        |
| gitlab/gitlab-ce                | é•œåƒçš„åç§°ï¼Œè¿™é‡Œä¹Ÿå¯ä»¥å†™é•œåƒ ID                              |



**:selfie:ä¿®æ”¹é…ç½®**

```bash
#è¿›å®¹å™¨å†…éƒ¨
docker exec -it gitlab /bin/bash
 
#ä¿®æ”¹gitlab.rb
vi /etc/gitlab/gitlab.rb
```

â¤ï¸ åŠ å…¥å¦‚ä¸‹

```bash
#gitlabè®¿é—®åœ°å€ï¼Œå¯ä»¥å†™åŸŸåã€‚å¦‚æœç«¯å£ä¸å†™çš„è¯é»˜è®¤ä¸º80ç«¯å£
external_url 'http://192.168.124.194'

#sshä¸»æœºip
gitlab_rails['gitlab_ssh_host'] = '192.168.124.194'

#sshè¿æ¥ç«¯å£
gitlab_rails['gitlab_shell_ssh_port'] = 9922
```



ğŸ¤è®©é…ç½®ç”Ÿæ•ˆ

```
gitlab-ctl reconfigure
```



> :warning: æ³¨æ„ä¸è¦é‡å¯ï¼Œ`/etc/gitlab/gitlab.rb`æ–‡ä»¶çš„é…ç½®ä¼šæ˜ å°„åˆ°`gitlab.yml`è¿™ä¸ªæ–‡ä»¶ï¼Œç”±äºå’±ä»¬åœ¨[docker](https://so.csdn.net/so/search?q=docker&spm=1001.2101.3001.7020)ä¸­è¿è¡Œï¼Œåœ¨`gitlab`ä¸Šç”Ÿæˆçš„`http`åœ°å€åº”è¯¥æ˜¯http://192.168.124.194:9980,æ‰€ä»¥ï¼Œè¦ä¿®æ”¹ä¸‹é¢æ–‡ä»¶

```
# ä¿®æ”¹httpå’Œsshé…ç½®
vi /opt/gitlab/embedded/service/gitlab-rails/config/gitlab.yml
 
  gitlab:
    host: 192.168.124.194
    port: 9980 # è¿™é‡Œæ”¹ä¸º9980
    https: false
```

![image-20220924225234548](http://sm.nsddd.top/smimage-20220924225234548.png?xxw@nsddd.top)





ğŸ¤è®©é…ç½®ç”Ÿæ•ˆ å¹¶ä¸”é€€å‡ºå®¹å™¨

```
gitlab-ctl reconfigure
exit
```



## æµè§ˆå™¨è®¿é—® 

è·¯å¾„è®¿é—®ï¼šhttp://192.168.124.194:9980/

> :warning: æœºå™¨é…ç½®è¦å¤§äº`4g`ï¼Œå¦åˆ™å¾ˆå®¹æ˜“å¯åŠ¨ä¸äº†ï¼ŒæŠ¥`502`
>
> + ç¬¬ä¸€æ¬¡è®¿é—®ï¼Œä¼šè®©ä¿®æ”¹rootå¯†ç 
> + ä¿®æ”¹åä»¥rootç”¨æˆ·ç™»å½•å³å¯ 



### ä¿®æ”¹å¯†ç 

**è¿›å…¥å®¹å™¨å†…éƒ¨ï¼š**

```
docker exec -it gitlab /bin/bash
```



**è¿›å…¥æ§åˆ¶å°ï¼š**

```
gitlab-rails console -e production
```



**æŸ¥è¯¢idä¸º1çš„ç”¨æˆ·ï¼Œidä¸º1çš„ç”¨æˆ·æ˜¯è¶…çº§ç®¡ç†å‘˜ï¼š**

```
user = User.where(id:1).first
```

![image-20220924230110134](http://sm.nsddd.top/smimage-20220924230110134.png?xxw@nsddd.top)



**ä¿®æ”¹å¯†ç ä¸º`1234`ï¼š**

```
user.password='1234' 
```



**ä¿å­˜ï¼š**

```
user.save!
```



**é€€å‡ºï¼š**

```
exit
```

![image-20220924230332131](http://sm.nsddd.top/smimage-20220924230332131.png?xxw@nsddd.top)





## é‡ç½®ç®¡ç†å‘˜å¯†ç 

**è¿›å…¥docker gitlab å®¹å™¨ä¸­**

```
docker exec -it gitlabï¼ˆå®¹å™¨åå­—ï¼‰ bash
```



**è¿›å…¥gitlab æ§åˆ¶å°**

```
gitlab-rails console -e production   #å¯èƒ½ä¼šç­‰å¥½å‡ ç§’é’Ÿ 
```



**æœç´¢ç”¨æˆ·**

```bash
#è¿™é‡Œæä¾›ä¸¤ç§æœç´¢æ–¹å¼  é€šè¿‡id
user = User.where(id:1).first
#æˆ–è€… é€šè¿‡ç”µå­é‚®ä»¶æœç´¢  æˆ–è€…ç”¨æˆ·å
user = User.find_by(email:'admin@example.com')
```

![asdf](http://sm.nsddd.top/smsmimage-20220924231302178.png?xxw@nsddd.top)



**ä¿®æ”¹å¯†ç **

> :warning: æ³¨æ„ï¼šå¯†ç ä¸èƒ½è®¾ç½®å¤ªç®€å•ï¼Œæ•°æ®åº“æ²¡åŠæ³•é€šè¿‡

```bash
#æ³¨æ„è¿™ä¸¤ä¸ªé€‰é¡¹éƒ½å¾—è®¾ç½®,1234ä¸ºä½ è¦è®¾ç½®çš„å¯†ç 
user.password ='1234'
user.password_confirmation ='1234'
```



**ä¿å­˜é€€å‡ºï¼šwq**

```
user.save!
exit
```

![image-20220924232113215](http://sm.nsddd.top/smimage-20220924232113215.png?xxw@nsddd.top)



**ç™»é™†æˆåŠŸğŸ˜˜ğŸ˜˜**![image-20220924233008364](http://sm.nsddd.top/smimage-20220924233008364.png?xxw@nsddd.top)



