+ [author](http://nsddd.top)

# ç¬¬9èŠ‚ Pod

<div><a href = '8.md' style='float:left'>â¬†ï¸ä¸Šä¸€èŠ‚ğŸ”—  </a><a href = '10.md' style='float: right'>  â¬‡ï¸ä¸‹ä¸€èŠ‚ğŸ”—</a></div>
<br>

> â¤ï¸ğŸ’•ğŸ’•æ–°æ—¶ä»£æ‹¥æŠ±äº‘åŸç”Ÿï¼Œäº‘åŸç”Ÿå…·æœ‰ç¯å¢ƒç»Ÿä¸€ã€æŒ‰éœ€ä»˜è´¹ã€å³å¼€å³ç”¨ã€ç¨³å®šæ€§å¼ºç‰¹ç‚¹ã€‚Myblog:[http://nsddd.top](http://nsddd.top/)

---
[[toc]]

[TOC]

## ç†è§£Pod

> ä»€ä¹ˆæ˜¯podï¼Ÿ
>
> ![img](http://sm.nsddd.top/sm981878-20181221191353859-412884495.png)

podæ˜¯**è¿è¡Œä¸­çš„ä¸€ç»„å®¹å™¨**ï¼Œpodæ˜¯kubernetesä¸­åº”ç”¨çš„æœ€å°å•ä½ã€‚



> ä»€ä¹ˆæ˜¯CRIï¼Ÿï¼ˆcontainer runtime interfaceï¼‰

æˆ–è®¸ä½ å¯ä»¥ç†è§£æ˜¯dockerï¼Œ**CRIå°±æ˜¯å®¹å™¨è¿è¡Œæ—¶çš„ç¯å¢ƒ**ã€‚æˆ‘ä»¬å¼€å‘çš„åº”ç”¨å°±èƒ½ä»¥å®¹å™¨åŒ–çš„æ–¹å¼è¿è¡Œ~



::: tip 
ğŸ’¡ é‚£ä¹ˆk8sä¸ºäº†ç®¡ç†æ–¹ä¾¿ï¼Œåˆå°è£…äº†podï¼Œæ‰€ä»¥è¯´podæ˜¯å®¹å™¨è¿è¡Œçš„æœ€å°å•ä½~

+ æ¯ä¸€ä¸ªå®¹å™¨å°è£…æˆä¸€ä¸ªpod
+ æ¯ä¸ªpodå¯èƒ½æœ‰ä¸€ä¸ªæˆ–è€…å¤šä¸ªå®¹å™¨ï¼Œä½†æ˜¯ä¹Ÿç§°ä¹‹ä¸ºä¸€ç»„å®¹å™¨

> podæ˜¯å¯ä»¥æœ‰å¤šä¸ªå®¹å™¨çš„ï¼Œè€Œä¸”ç»„æˆåŸå­ï¼Œè¿™ä¸ªæ˜¯å’Œå®¹å™¨çš„åŒºåˆ«~

:::



âš¡ æè¿°æŸä¸€ä¸ªpodæ˜¯å¦‚ä½•è¿è¡Œçš„

```bash
kubectl describe pod my-nginx-7fb96c846b-m9rjp
```



::: details å±•å¼€æŸ¥çœ‹è¯¦æƒ…ğŸ’¡ 

```bash
[root@k8s-master03 ~]# kubectl get pod
NAME                        READY   STATUS    RESTARTS      AGE
my-nginx-7fb96c846b-cnhbz   1/1     Running   2 (92m ago)   38h
my-nginx-7fb96c846b-g55km   1/1     Running   2 (92m ago)   38h
my-nginx-7fb96c846b-m9rjp   1/1     Running   2 (92m ago)   38h
[root@k8s-master03 ~]# kubectl describe pod my-nginx-7fb96c846b-m9rjp
Name:             my-nginx-7fb96c846b-m9rjp
Namespace:        default
Priority:         0
Service Account:  default
Node:             k8s-master03/192.168.0.4
Start Time:       Thu, 20 Oct 2022 22:05:22 +0800
Labels:           app=nginx
                  pod-template-hash=7fb96c846b
Annotations:      cni.projectcalico.org/containerID: 66626e89ebcb580eeef3f2e75d7d860fe14ee213458642f7b25a860e164ea9a3
                  cni.projectcalico.org/podIP: 100.66.195.18/32
                  cni.projectcalico.org/podIPs: 100.66.195.18/32
Status:           Running
IP:               100.66.195.18
IPs:
  IP:           100.66.195.18
Controlled By:  ReplicaSet/my-nginx-7fb96c846b
Containers:
  nginx:
    Container ID:   containerd://85c401a1bca6531519ad09b539ee57bb2b508b370d71053926a1df0b5421597e
    Image:          nginx:1.14.2
    Image ID:       docker.io/library/nginx@sha256:f7988fb6c02e0ce69257d9bd9cf37ae20a60f1df7563c3a2a6abe24160306b8d
    Port:           80/TCP
    Host Port:      0/TCP
    State:          Running
      Started:      Sat, 22 Oct 2022 11:27:59 +0800
    Last State:     Terminated
      Reason:       Unknown
      Exit Code:    255
      Started:      Fri, 21 Oct 2022 11:10:13 +0800
      Finished:     Sat, 22 Oct 2022 11:27:01 +0800
    Ready:          True
    Restart Count:  2
    Environment:    <none>
    Mounts:
      /var/run/secrets/kubernetes.io/serviceaccount from kube-api-access-x77br (ro)
Conditions:
  Type              Status
  Initialized       True 
  Ready             True 
  ContainersReady   True 
  PodScheduled      True 
Volumes:
  kube-api-access-x77br:
    Type:                    Projected (a volume that contains injected data from multiple sources)
    TokenExpirationSeconds:  3607
    ConfigMapName:           kube-root-ca.crt
    ConfigMapOptional:       <nil>
    DownwardAPI:             true
QoS Class:                   BestEffort
Node-Selectors:              <none>
Tolerations:                 node.kubernetes.io/not-ready:NoExecute op=Exists for 300s
                             node.kubernetes.io/unreachable:NoExecute op=Exists for 300s
Events:                      <none>
```

:::



**æˆ‘ä»¬åªè¦çœ‹`Events`å°±å¥½äº†~**

å¯ä»¥æŸ¥çœ‹çŠ¶æ€å’ŒåŸå› ï¼Œå¯ä»¥å»æ’æŸ¥äº‹æ•…åŸå› 



## åˆ é™¤pod

::: tip ç”±äºk8sçš„æ¦‚å¿µå¾ˆå¤šï¼Œåˆ é™¤éœ€è¦æŒ‡å®šæ¦‚å¿µ

+ æŒ‡å®šå‘½åç©ºé—´ï¼Œä¸æŒ‡å®šæ˜¯é»˜è®¤
+ æŒ‡å®šåˆ é™¤`pod`

```bash
kubectl delete pod mypodName -n xxxNamespace
```

:::



## ç®¡ç†å¯¹è±¡çš„ä¸¤ç§æ–¹å¼

### å‘½ä»¤è¡ŒæŒ‡ä»¤

ä½¿ç”¨ `kubectl` å‘½ä»¤æ¥åˆ›å»ºå’Œç®¡ç† `kubernetes` å¯¹è±¡

ç®€å•ã€é«˜æ•ˆå¿«é€Ÿä½†æ˜¯åŠŸèƒ½æœ‰é™ï¼Œæ“ä½œä¸å®¹æ˜“è¿½æº¯ï¼Œå¤šç”¨äºå¼€å‘å’Œè°ƒè¯•ã€‚



### å£°æ˜å¼é…ç½®

`kubernetes` ä½¿ç”¨ `yaml` æ–‡ä»¶æ¥æè¿° `kubernetes` å¯¹è±¡

å£°æ˜å¼é…ç½®å°±å¥½æ¯”ç”³è¯·è¡¨ï¼Œå­¦ä¹ éš¾åº¦å¤§è€Œä¸”é…ç½®éº»çƒ¦

å¥½å¤„æ˜¯æ“ä½œç•™ç—•è¿¹ï¼Œé€‚åˆæ“ä½œå¤æ‚çš„å¯¹è±¡ï¼Œå¤šç”¨äºç”Ÿäº§



## yaml è¯­æ³•

+ ç¼©è¿›ä»£è¡¨ä¸Šä¸‹çº§å…³ç³»
+ ç¼©è¿›æ—¶ä½¿ç”¨ç©ºæ ¼ï¼Œä¸è¦ä½¿ç”¨tabï¼Œé€šå¸¸ä½¿ç”¨2ä¸ªç©ºæ ¼
+ ä½¿ç”¨åŒå¼•å·ï¼Œä¸è¦ä½¿ç”¨å•å¼•å·
+ `:` é”®å€¼å¯¹çš„åˆ†éš”ç¬¦ï¼Œå‰é¢ä¸è¦æœ‰ç©ºæ ¼ï¼Œåé¢è¦æœ‰ç©ºæ ¼
+ `-` æ•°ç»„çš„åˆ†éš”ç¬¦ï¼Œå‰åéƒ½è¦æœ‰ç©ºæ ¼
+ `#` æ³¨é‡Šï¼Œåé¢è¦æœ‰ç©ºæ ¼
+ `|` å¤šè¡Œæ–‡æœ¬ï¼Œåé¢è¦æœ‰ç©ºæ ¼ï¼Œåé¢å¯ä»¥æœ‰æ¢è¡Œ
+ `>` å¤šè¡Œæ–‡æœ¬ï¼Œåé¢è¦æœ‰ç©ºæ ¼
+ `---` yamlæ–‡ä»¶çš„åˆ†éš”ç¬¦ï¼Œå‰åéƒ½è¦æœ‰ç©ºæ ¼



## é…ç½®å¯¹è±¡

**åœ¨åˆ›å»º Kubernetes å¯¹è±¡æ‰€å¯¹åº”çš„ `yaml` æ–‡ä»¶ä¸­ï¼Œéœ€è¦é…ç½®çš„å­—æ®µï¼š**

+ `apiVersion` ï¼šKubernetes API ç‰ˆæœ¬
+ `Kind` ï¼šå¯¹è±¡ç±»åˆ«ï¼Œä¾‹å¦‚ `Pod` ã€`Deployment` 
+ `metadata` ï¼šæè¿°å¯¹è±¡çš„å…ƒæ•°æ®ï¼ŒåŒ…æ‹¬ä¸€ä¸ª name å­—ç¬¦ä¸²ã€UID å’Œ å¯é€‰çš„`namespace`
+ `spec` ï¼šå¯¹è±¡çš„é…ç½®



## é…ç½®æ–‡ä»¶åˆ›å»ºpod

æˆ‘ä»¬æˆ–è®¸å¯ä»¥ç”¨é…ç½®æ–‡ä»¶çš„æ–¹å¼å»åˆ›å»ºä¸€ä¸ªpod~

```bash
[root@k8s-master01 ~]# vim pod.yaml 
[root@k8s-master01 ~]# kubectl apply -f pod.yaml 
```

::: tip yamlåˆ›å»ºpodæ ¼å¼

```yaml
apiVersion: v1
kind: Pod  # èµ„æºç±»å‹
metadata:  
  labels:
    run: myapp
  name: myapp  # podåç§°
spec: # podè¯¦ç»†é…ç½®ä¿¡æ¯
  containers: # å¯åŠ¨ä¸€ä¸ªå®¹å™¨
  - image: nginx # å¯åŠ¨nginx
    name: mynginx
  - image: tomcat:8.5.68
    name: mytomcat
  - image: redis
    name: myredis
```

![image-20221022153945150](http://sm.nsddd.top/smimage-20221022153945150.png)

> å¯èƒ½ä¼šå‡ºç°podçŠ¶æ€å¤„äºContainerCreatingçš„æƒ…å†µï¼Œå¸¸è§çš„åŸå› ä¹‹ä¸€æ˜¯é•œåƒæ‹‰å–å¤±è´¥ã€‚

:::



ğŸ’¡å®¹å™¨çš„åˆ›å»ºè¯¦æƒ…æŸ¥çœ‹å¦‚ä¸‹ï¼š

```bash
kubectl describe pod mynginx
```

::: details âš¡ å±•å¼€æŸ¥çœ‹è¯¦æƒ…

```bash
[root@k8s-master01 ~]# kubectl describe pod mynginx
Name:             mynginx
Namespace:        default
Priority:         0
Service Account:  default
Node:             k8s-master03/192.168.0.4
Start Time:       Sat, 22 Oct 2022 13:20:17 +0800
Labels:           run=mynginx
Annotations:      cni.projectcalico.org/containerID: 9fc6db4dd24c4816b28be43c1f2907c89adea8fadb36fb49844fea42142671e7
                  cni.projectcalico.org/podIP: 100.66.195.25/32
                  cni.projectcalico.org/podIPs: 100.66.195.25/32
Status:           Running
IP:               100.66.195.25
IPs:
  IP:  100.66.195.25
Containers:
  mynginx:
    Container ID:   containerd://69b25d59d551f94e8f7cc659ef3b740765e23673b60f45de7353cfbc13d52420
    Image:          nginx
    Image ID:       docker.io/library/nginx@sha256:5ffb682b98b0362b66754387e86b0cd31a5cb7123e49e7f6f6617690900d20b2
    Port:           <none>
    Host Port:      <none>
    State:          Running
      Started:      Sat, 22 Oct 2022 13:21:13 +0800
    Ready:          True
    Restart Count:  0
    Environment:    <none>
    Mounts:
      /var/run/secrets/kubernetes.io/serviceaccount from kube-api-access-m6rqn (ro)
  myredis:
    Container ID:   containerd://e72e35e2f7dda8d6108a89e98c41da32b4678eab31cf26c8406eeaee5e3ecc3c
    Image:          redis
    Image ID:       docker.io/library/redis@sha256:c95835a74c37b3a784fb55f7b2c211bd20c650d5e55dae422c3caa9c01eb39fa
    Port:           <none>
    Host Port:      <none>
    State:          Running
      Started:      Sat, 22 Oct 2022 13:21:47 +0800
    Ready:          True
    Restart Count:  0
    Environment:    <none>
    Mounts:
      /var/run/secrets/kubernetes.io/serviceaccount from kube-api-access-m6rqn (ro)
Conditions:
  Type              Status
  Initialized       True 
  Ready             True 
  ContainersReady   True 
  PodScheduled      True 
Volumes:
  kube-api-access-m6rqn:
    Type:                    Projected (a volume that contains injected data from multiple sources)
    TokenExpirationSeconds:  3607
    ConfigMapName:           kube-root-ca.crt
    ConfigMapOptional:       <nil>
    DownwardAPI:             true
QoS Class:                   BestEffort
Node-Selectors:              <none>
Tolerations:                 node.kubernetes.io/not-ready:NoExecute op=Exists for 300s
                             node.kubernetes.io/unreachable:NoExecute op=Exists for 300s
Events:
  Type    Reason     Age   From               Message
  ----    ------     ----  ----               -------
  Normal  Scheduled  113s  default-scheduler  Successfully assigned default/mynginx to k8s-master03
  Normal  Pulling    112s  kubelet            Pulling image "nginx"
  Normal  Pulled     58s   kubelet            Successfully pulled image "nginx" in 54.707721222s
  Normal  Created    57s   kubelet            Created container mynginx
  Normal  Started    57s   kubelet            Started container mynginx
  Normal  Pulling    57s   kubelet            Pulling image "redis"
  Normal  Pulled     23s   kubelet            Successfully pulled image "redis" in 33.819467112s
  Normal  Created    23s   kubelet            Created container myredis
  Normal  Started    23s   kubelet            Started container myredis
```

:::

![image-20221022132504701](http://sm.nsddd.top/smimage-20221022132504701.png)



## å¯è§†åŒ–ç•Œé¢åˆ›å»ºpod

::: danger æ³¨æ„
è¿™ä¸ªæ¿å—å¾…è¡¥å……~ æ¬¢è¿pr
:::



## podæ—¥å¿—

å¥½åƒåªæœ‰podæœ‰æ—¥å¿—æŠŠï¼Ÿ

> å’Œdockerçš„æ—¥å¿—ä¸€æ ·ç”¨æ³•

æˆ‘ä»¬æŸ¥çœ‹podæ—¥å¿—ï¼š

```bash
kubectl logs mynginx
```

![image-20221022133031267](http://sm.nsddd.top/smimage-20221022133031267.png)



âš¡ å¯ä»¥åŠ ä¸Š `-f` è¿½è¸ªå¼æ—¥å¿—

```
kubectl logs -f  mynginx
```

![image-20221022133159587](http://sm.nsddd.top/smimage-20221022133159587.png)



## pod - IP

âš¡ æ¯ä¸ªpod â€“ k8séƒ½ä¼šåˆ†é…ä¸€ä¸ªipï¼Œä½¿ç”¨ä¸‹é¢å‘½ä»¤æŸ¥çœ‹ï¼š

```bash
kubectl get pod -owide
```

![image-20221022150442624](https://sm.nsddd.top/smimage-20221022150442624.png)



## è¿›å…¥podå¹¶ä¿®æ”¹pod

ğŸ—“ï¸ å›å¿†æˆ‘ä»¬dockerä¿®æ”¹å®¹å™¨å†…éƒ¨

```bash
docker exec -it idName #/bin/bash
```



**ä½¿ç”¨K8sè¿›å…¥podå‘½ä»¤ï¼š**

> å’Œdockerå‘½ä»¤å¤§è‡´ä¸€æ ·ï¼Œæ³¨æ„åé¢æœ‰ `â€“`

```bash
kubectl exec -it mynginx -- /bin/bash
```

![image-20221022151001187](http://sm.nsddd.top/smimage-20221022151001187.png)



::: tip å¯è§†åŒ–ç•Œé¢
å¯ä»¥ç›´æ¥è¿›å»k8sçš„å¯è§†åŒ–ç•Œé¢è¿›è¡Œä¿®æ”¹~

:::



## å¤šå®¹å™¨podç»†èŠ‚

::: warning æé†’âš ï¸ 
åœ¨`Kubernetes`ä¸­éƒ¨ç½²åº”ç”¨æ—¶ï¼Œéƒ½æ˜¯ä»¥`pod`è¿›è¡Œè°ƒåº¦çš„ï¼Œå®ƒä»¬åŸºæœ¬ä¸Šæ˜¯å•ä¸ªå®¹å™¨çš„åŒ…è£…æˆ–æˆ¿å­ã€‚ä»æŸç§æ„ä¹‰ä¸Šè¯´ï¼Œå®¹å™¨çš„å®¹å™¨ã€‚ `pod`æ˜¯ä¸€ä¸ªé€»è¾‘åŒ…è£…å®ä½“ï¼Œç”¨äºåœ¨`K8s`é›†ç¾¤ä¸Šæ‰§è¡Œå®¹å™¨ã€‚å¯ä»¥æŠŠæ¯ä¸ª`pod`æƒ³è±¡æˆä¸€ä¸ªé€æ˜çš„åŒ…è£…ï¼Œä¸ºå®¹å™¨æä¾›ä¸€ä¸ªæ’æ§½ã€‚`pod`æ˜¯`Kubernetes`æœ€å°çš„å¯éƒ¨ç½²å•ä½ã€‚`pod`æ˜¯ä¸€ç»„ä¸€ä¸ªæˆ–å¤šä¸ªå®¹å™¨ï¼Œå…·æœ‰å…±äº«çš„å­˜å‚¨/ç½‘ç»œèµ„æºï¼Œä»¥åŠå¦‚ä½•è¿è¡Œå®¹å™¨çš„è§„èŒƒã€‚å› æ­¤ï¼Œæœ€ç®€å•åœ°è¯´ï¼Œ`pod`æ˜¯ä¸€ä¸ªå®¹å™¨å¦‚ä½•åœ¨`Kubernetes`ä¸­â€œç”¨èµ·æ¥â€çš„æœºåˆ¶ã€‚

+ podæ˜¯k8sçš„æœ€å°å•å…ƒï¼Œå®¹å™¨åŒ…å«åœ¨podä¸­ï¼Œä¸€ä¸ªpodä¸­æœ‰ä¸€ä¸ªpauseå®¹å™¨å’Œè‹¥å¹²ä¸ªä¸šåŠ¡å®¹å™¨ï¼Œè€Œå®¹å™¨æ˜¯å•ç‹¬çš„ä¸€ä¸ªå®¹å™¨ï¼Œç®€è€Œè¨€ä¹‹ï¼Œpodæ˜¯ä¸€ç»„å®¹å™¨çš„é›†åˆã€‚

+ podç›¸å½“äºé€»è¾‘ä¸»æœºï¼Œæ¯ä¸ªpodéƒ½æœ‰è‡ªå·±çš„ipåœ°å€

+ **podå†…çš„å®¹å™¨å…±äº«ç›¸åŒçš„ipå’Œç«¯å£**

+ é»˜è®¤æƒ…å†µä¸‹ï¼Œæ¯ä¸ªå®¹å™¨çš„æ–‡ä»¶ç³»ç»Ÿä¸å…¶ä»–å®¹å™¨å®Œå…¨éš”ç¦»

+ **podæ˜¯ä¸€ç»„å®¹å™¨ï¼Œä¸€ä¸ªpodä¹Ÿæ˜¯å¯ä»¥éƒ¨ç½²ä¸¤ä¸ªç”šè‡³æ˜¯å¤šä¸ªå®¹å™¨**

:::



## æ›´å¤šå‘½ä»¤

**æ›´å¤šå‘½ä»¤ï¼š**

```bash
# æŸ¥çœ‹å…¨éƒ¨
kubectl get all

# é‡æ–°éƒ¨ç½²
kubectl rollout restart deployment test-k8s

# å‘½ä»¤ä¿®æ”¹é•œåƒï¼Œ--record è¡¨ç¤ºæŠŠè¿™ä¸ªå‘½ä»¤è®°å½•åˆ°æ“ä½œå†å²ä¸­
kubectl set image deployment test-k8s test-k8s=ccr.ccs.tencentyun.com/k8s-tutorial/test-k8s:v2-with-error --record

# æš‚åœè¿è¡Œï¼Œæš‚åœåï¼Œå¯¹ deployment çš„ä¿®æ”¹ä¸ä¼šç«‹åˆ»ç”Ÿæ•ˆï¼Œæ¢å¤åæ‰åº”ç”¨è®¾ç½®
kubectl rollout pause deployment test-k8s

# æ¢å¤
kubectl rollout resume deployment test-k8s

# è¾“å‡ºåˆ°æ–‡ä»¶
kubectl get deployment test-k8s -o yaml >> app2.yaml

# åˆ é™¤å…¨éƒ¨èµ„æº
kubectl delete all --all
```



::: details é—ç•™é—®é¢˜ï¼š

+ æ¯æ¬¡åªèƒ½è®¿é—®ä¸€ä¸ª podï¼Œæ²¡æœ‰è´Ÿè½½å‡è¡¡è‡ªåŠ¨è½¬å‘åˆ°ä¸åŒ pod
+ è®¿é—®è¿˜éœ€è¦ç«¯å£è½¬å‘
+ Pod é‡åˆ›å IP å˜äº†ï¼Œåå­—ä¹Ÿå˜äº†

:::



## END é“¾æ¥

<ul><li><div><a href = '8.md' style='float:left'>â¬†ï¸ä¸Šä¸€èŠ‚ğŸ”—  </a><a href = '10.md' style='float: right'>  ï¸ä¸‹ä¸€èŠ‚ğŸ”—</a></div></li></ul>

+ [â“‚ï¸å›åˆ°ç›®å½•ğŸ ](../README.md) 

+ [**ğŸ«µå‚ä¸è´¡çŒ®ğŸ’â¤ï¸â€ğŸ”¥ğŸ’–**](https://nsddd.top/archives/contributors))

+ âœ´ï¸ç‰ˆæƒå£°æ˜ &copy; ï¼šæœ¬ä¹¦æ‰€æœ‰å†…å®¹éµå¾ª[CC-BY-SA 3.0åè®®ï¼ˆç½²å-ç›¸åŒæ–¹å¼å…±äº«ï¼‰&copy;](http://zh.wikipedia.org/wiki/Wikipedia:CC-by-sa-3.0åè®®æ–‡æœ¬) 

