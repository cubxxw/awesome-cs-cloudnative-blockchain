+ [author](http://nsddd.top)

# ç¬¬11èŠ‚ service

<div><a href = '10.md' style='float:left'>â¬†ï¸ä¸Šä¸€èŠ‚ğŸ”—  </a><a href = '12.md' style='float: right'>  â¬‡ï¸ä¸‹ä¸€èŠ‚ğŸ”—</a></div>
<br>

> â¤ï¸ğŸ’•ğŸ’•æ–°æ—¶ä»£æ‹¥æŠ±äº‘åŸç”Ÿï¼Œäº‘åŸç”Ÿå…·æœ‰ç¯å¢ƒç»Ÿä¸€ã€æŒ‰éœ€ä»˜è´¹ã€å³å¼€å³ç”¨ã€ç¨³å®šæ€§å¼ºç‰¹ç‚¹ã€‚Myblog:[http://nsddd.top](http://nsddd.top/)

---
[[toc]]

[TOC]

## service

> æˆ‘ä»¬å‘ç°ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯ä½¿ç”¨`pod -owide`æŸ¥çœ‹çš„`ip`æ˜¯æ¯ä¸€ä¸ª`pod`ç»“ç‚¹éƒ½ä¸ä¸€æ ·çš„ï¼Œé‚£ä¹ˆæ˜¯ä¸æ˜¯ä¼šå‡ºç°ä¸€ä¸ªé—®é¢˜ï¼šå°±æ˜¯å½“æˆ‘ä»¬æœ‰ä¸€ä¸ª`pod`ç»“ç‚¹å®•æœºäº†ï¼Œè¿™ä¸ªå²‚ä¸æ˜¯å‡‰å‡‰äº†ï¼ˆè¿˜éœ€è¦ä¿®æ”¹å‰ç«¯çš„åœ°å€å˜›ï¼Ÿï¼‰å¤ªéº»çƒ¦äº†ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨`service`å¯¹å¤–æš´éœ²ä¸€ä¸ªå…¬å¼€ä¸ºç½‘ç»œæœåŠ¡çš„æŠ½è±¡æ–¹æ³•ã€‚

 ğŸ”¥Serviceï¼šPodçš„æœåŠ¡å‘ç°å’Œè´Ÿè½½å‡è¡¡

+ Service é€šè¿‡ label å…³è”å¯¹åº”çš„ Pod
+ Servcie ç”Ÿå‘½å‘¨æœŸä¸è·Ÿ Pod ç»‘å®šï¼Œä¸ä¼šå› ä¸º Pod é‡åˆ›æ”¹å˜ IP
+ æä¾›äº†è´Ÿè½½å‡è¡¡åŠŸèƒ½ï¼Œè‡ªåŠ¨è½¬å‘æµé‡åˆ°ä¸åŒ Pod
+ å¯å¯¹é›†ç¾¤å¤–éƒ¨æä¾›è®¿é—®ç«¯å£
+ é›†ç¾¤å†…éƒ¨å¯é€šè¿‡æœåŠ¡åå­—è®¿é—®

![img](http://sm.nsddd.top/smkwpuoh0h.png)



## å°†podç»Ÿä¸€æš´éœ²æˆä¸€ç»„æœåŠ¡

### ä¿®æ”¹nginxé…ç½®æ–‡ä»¶

::: tip è¿›å…¥nginxå¹¶ä¸”ä¿®æ”¹é…ç½®æ–‡ä»¶è®¿é—®
æŸ¥çœ‹å½“å‰podè¯¦ç»†ä¿¡æ¯ï¼š

```
kubectl get pod -owide
```

![image-20221022175600469](http://sm.nsddd.top/smimage-20221022175600469.png)

è¿›å…¥å®¹å™¨å†…éƒ¨å‘½ä»¤ï¼š

```bash
kubectl exec -it my-dep-6d4ddbf4f7-bllhd -- /bin/bash
```

ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼ˆindex.htmlï¼‰ï¼š

```bash
[root@k8s-master01 ~]# kubectl exec -it my-dep-6d4ddbf4f7-bllhd -- /bin/bash
root@my-dep-6d4ddbf4f7-bllhd:/# cd /usr/share/nginx/html/
root@my-dep-6d4ddbf4f7-bllhd:/usr/share/nginx/html# echo "my name is xiongxinwei email:xxw@nsddd.top" > index.html 
root@my-dep-6d4ddbf4f7-bllhd:/usr/share/nginx/html# exit 
exit
[root@k8s-master01 ~]# curl 100.66.195.43
my name is xiongxinwei email:xxw@nsddd.top
```

> æ­¤æ—¶å·²ç»ä¿®æ”¹æˆåŠŸ~

åŒæ ·çš„æ–¹å¼ä¿®æ”¹ï¼š

+ my-dep-6d4ddbf4f7-dckmw
+ my-dep-6d4ddbf4f7-vvxt8

:::



### ä½¿ç”¨serviceé…ç½®å…¬å…±åœ°å€

**æŸ¥çœ‹ä¿¡æ¯ï¼š**

![image-20221022180728395](http://sm.nsddd.top/smimage-20221022180728395.png)



**æš´éœ²æˆä¸ºä¸€ä¸ªå›ºå®šçš„ipï¼š**

```bash
[root@k8s-master01 ~]# kubectl expose deploy my-dep --port=8000 --target-port=80
service/my-dep exposed
```



**æŸ¥çœ‹serviceçš„IPï¼š**

```
kubectl get service
```

![image-20221022181104154](http://sm.nsddd.top/smimage-20221022181104154.png)



::: tip æˆ‘ä»¬è®¿é—® `10.96.2.163:8000` 

```bash
curl 10.96.2.163:8000
```

**æ•ˆæœï¼š**

![image-20221022181355962](http://sm.nsddd.top/smimage-20221022181355962.png)

**è¿™æ ·å°±å®ç°äº†è´Ÿè½½å‡è¡¡äº†~**

:::



## yamlé…ç½®æ–‡ä»¶å®ç°service

**ç¼–å†™yamlæ–‡ä»¶ï¼š**

```yaml
apiVersion: v1
kind: Service
metadata:
  labels:
  	app: my-dep
  name: my-dep
spec:
  selector: 
  	app: my-dep
  ports:
  - port: 8000
  	protocol: TCP
  	targetPort: 80
```

::: danger ç‰¹åˆ«æ³¨æ„çš„å‚æ•°
:::



**âš ï¸ åœ¨å®¹å™¨å†…éƒ¨ä¹Ÿå¯ä½¿ç”¨åŸŸåè®¿é—®ï¼š**

```bash
[root@k8s-master01 ~]# kubectl exec -it  my-dep-6d4ddbf4f7-dckmw  -- bin/bash
root@my-dep-6d4ddbf4f7-dckmw:/# curl 100.66.195.42  # ipæ–¹å¼è®¿é—®
my name is xiongxinwei email:3293172751@qq.com
root@my-dep-6d4ddbf4f7-dckmw:/# curl my-dep.default.svc:8000  # åŸŸåæ–¹å¼è®¿é—®
my name is xiongxinwei email:xiongxinwei@mail.com
root@my-dep-6d4ddbf4f7-dckmw:/# curl my-dep.default.svc:8000 #ä¹Ÿèƒ½å®ç°è´Ÿè½½å‡è¡¡
my name is xiongxinwei email:xxw@nsddd.top
```

::: danger æ³¨æ„
åœ¨æœºå™¨ä¸Šæ˜¯æ²¡åŠæ³•è¿™æ ·è®¿é—®çš„

![image-20221022192356049](http://sm.nsddd.top/smimage-20221022192356049.png)

:::



## æµ‹è¯•serviceçš„æœåŠ¡å‘ç°

::: tip
æˆ‘ä»¬æµ‹è¯•ä¸€ä¸‹å…¶ä¸­ä¸€å°ä¸»æœºä¸‹çº¿ï¼Œserviceç»§ç»­å®ç°è´Ÿè½½å‡è¡¡

å†å¼€å¯ä¹Ÿæ˜¯æ¢å¤åˆ°äº†é»˜è®¤é¡µé¢ï¼Œæ–°å¼€å¯çš„nginxè€Œä¸æ˜¯ä»¥å‰çš„~

:::



## serviceæœåŠ¡æš´éœ²å…¬ç½‘nodeport

::: warning æ³¨æ„
æˆ‘ä»¬ä¹‹å‰çš„è¿˜æ˜¯åªèƒ½åœ¨æœåŠ¡å™¨å†…éƒ¨è®¿é—®ï¼Œè¦æƒ³å®ç°åœ¨å…¬ç½‘è®¿é—®ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ç”¨å¦å¤–ä¸€ç§æ–¹å¼

:::

**åˆ é™¤ä¹‹å‰çš„`my-dep`service**

![image-20221022193330095](http://sm.nsddd.top/smimage-20221022193330095.png)



**é‡æ–°æš´éœ²ï¼š**

```bash
kubectl expose deploy my-dep --port=8000 --target-port=80 --type=NodePort
```

::: danger è­¦å‘Šserviceé»˜è®¤æ¨¡å¼

+ `--type=NodePort`ï¼šé»˜è®¤æƒ…å†µï¼Œé›†ç¾¤å†…éƒ¨çš„è®¿é—®
+ `--type=ClusterIP`ï¼šè®¾ç½®ä¸ºé›†ç¾¤å¤–éƒ¨å¯ä»¥è®¿é—®

```bash
kubectl expose deploy my-dep --port=8000 --target-port=80 --type=NodePort
kubectl expose deploy my-dep --port=8000 --target-port=80 --type=ClusterIP
kubectl expose deploy my-dep --port=8000 --target-port=80 #é»˜è®¤æƒ…å†µï¼Œé›†ç¾¤å†…éƒ¨çš„è®¿é—®
```

![image-20221022193953537](http://sm.nsddd.top/smimage-20221022193953537.png)

:::

æˆ‘ä»¬è¿˜å¯ä»¥çœ‹åˆ°æš´éœ²çš„å¤šäº†ä¸€ä¸ªç«¯å£`80:31729/TCP  `ï¼Œè¿™ä¸ªæ˜¯éšæœºå¼€æ”¾çš„ç«¯å£ã€‚è¿™æ ·çš„è¯ï¼Œæˆ‘ä»¬è®¿é—®ä»»ä½•ä¸€å°æœºå™¨çš„`30948`ç«¯å£éƒ½å¯ä»¥è®¿é—®~

> è¿™ä¸ªç«¯å£æ˜¯éšæœºæš´éœ²çš„ï¼Œ ä½†æ˜¯ä¹Ÿæ˜¯æœ‰èŒƒå›´ï¼Œå°±æ˜¯`30000 - 32767`ä¹‹é—´ï¼Œæˆ‘ä»¬å¯ä»¥å¼€å¯é˜²ç«å¢™å’Œvpcçš„ç«¯å£è½¬åŒ–ã€‚

 ğŸ”¥æˆ‘ä»¬å¯ä»¥ç›´æ¥åœ¨æµè§ˆå™¨ä¸Šé¢è®¿é—®è¿™ä¸ªé¡µé¢äº†~

<img src="http://sm.nsddd.top/smimage-20221022194722363.png" alt="image-20221022194722363" style="zoom:80%;" />

## å¤šç«¯å£

å¤šç«¯å£æ—¶å¿…é¡»é…ç½® nameï¼Œ [æ–‡æ¡£](https://kubernetes.io/zh/docs/concepts/services-networking/service/#multi-port-services)

```yaml
apiVersion: v1
kind: Service
metadata:
  name: test-k8s
spec:
  selector:
    app: test-k8s
  type: NodePort
  ports:
    - port: 8080        # æœ¬ Service çš„ç«¯å£
      name: test-k8s    # å¿…é¡»é…ç½®
      targetPort: 8080  # å®¹å™¨ç«¯å£
      nodePort: 31000   # èŠ‚ç‚¹ç«¯å£ï¼ŒèŒƒå›´å›ºå®š 30000 ~ 32767
    - port: 8090
      name: test-other
      targetPort: 8090
      nodePort: 32000
```

![image-20221103212958297](http://sm.nsddd.top/smimage-20221103212958297.png)

::: tip è¯´æ˜
ä¸ä¸€èˆ¬çš„Kubernetesåç§°ä¸€æ ·ï¼Œç«¯å£åç§°åªèƒ½åŒ…å«å°å†™å­—æ¯æ•°å­—å­—ç¬¦ å’Œ `-`ã€‚ ç«¯å£åç§°è¿˜å¿…é¡»ä»¥å­—æ¯æ•°å­—å­—ç¬¦å¼€å¤´å’Œç»“å°¾ã€‚

ä¾‹å¦‚ï¼Œåç§° `123-abc` å’Œ `web` æœ‰æ•ˆï¼Œä½†æ˜¯ `123_abc` å’Œ `-web` æ— æ•ˆã€‚

:::



## åˆ é™¤service

```
kubectl delete svc/kubernetes-bootcamp
```

![image-20221103213132408](http://sm.nsddd.top/smimage-20221103213132408.png)



## END é“¾æ¥

<ul><li><div><a href = '10.md' style='float:left'>â¬†ï¸ä¸Šä¸€èŠ‚ğŸ”—  </a><a href = '12.md' style='float: right'>  ï¸ä¸‹ä¸€èŠ‚ğŸ”—</a></div></li></ul>

+ [â“‚ï¸å›åˆ°ç›®å½•ğŸ ](../README.md)

+ [**ğŸ«µå‚ä¸è´¡çŒ®ğŸ’â¤ï¸â€ğŸ”¥ğŸ’–**](https://nsddd.top/archives/contributors))

+ âœ´ï¸ç‰ˆæƒå£°æ˜ &copy; ï¼šæœ¬ä¹¦æ‰€æœ‰å†…å®¹éµå¾ª[CC-BY-SA 3.0åè®®ï¼ˆç½²å-ç›¸åŒæ–¹å¼å…±äº«ï¼‰&copy;](http://zh.wikipedia.org/wiki/Wikipedia:CC-by-sa-3.0åè®®æ–‡æœ¬) 

