+ [author](http://nsddd.top)

# ç¬¬12èŠ‚ Ingress

<div><a href = '11.md' style='float:left'>â¬†ï¸ä¸Šä¸€èŠ‚ğŸ”—  </a><a href = '13.md' style='float: right'>  â¬‡ï¸ä¸‹ä¸€èŠ‚ğŸ”—</a></div>
<br>

> â¤ï¸ğŸ’•ğŸ’•æ–°æ—¶ä»£æ‹¥æŠ±äº‘åŸç”Ÿï¼Œäº‘åŸç”Ÿå…·æœ‰ç¯å¢ƒç»Ÿä¸€ã€æŒ‰éœ€ä»˜è´¹ã€å³å¼€å³ç”¨ã€ç¨³å®šæ€§å¼ºç‰¹ç‚¹ã€‚Myblog:[http://nsddd.top](http://nsddd.top/)

---
[[toc]]

[TOC]

## Ingress

**Ingressï¼šserviceçš„ç»Ÿä¸€ç½‘å…³å…¥å£ï¼ˆnginxå®ç°ï¼‰**

::: tip è§£é‡Š

+ Ingress æ˜¯å¯¹é›†ç¾¤ä¸­æœåŠ¡çš„å¤–éƒ¨è®¿é—®è¿›è¡Œç®¡ç†çš„ API å¯¹è±¡ï¼Œå…¸å‹çš„è®¿é—®æ–¹å¼æ˜¯ HTTPã€‚
+ Ingress å¯ä»¥æä¾›è´Ÿè½½å‡è¡¡ã€SSL ç»ˆç»“å’ŒåŸºäºåç§°çš„è™šæ‹Ÿæ‰˜ç®¡ã€‚

> K8så¸Œæœ›`Ingress`æˆä¸ºé›†ç¾¤æµé‡çš„å”¯ä¸€å…¥å£ã€‚

:::



::: warning ä½œç”¨

1. å¸®åŠ©ä½äºé›†ç¾¤ä¸­çš„`Service`èƒ½å¤Ÿæœ‰ä¸€ä¸ªå¯¹å¤–å¯è¾¾çš„`url`ï¼Œå³è®©é›†ç¾¤å¤–çš„å®¢æˆ·ç«¯ä¹Ÿå¯ä»¥è®¿é—®åˆ°è‡ªå·±ã€‚(wxyï¼šå¯¹äºè¿™ä¸€ç‚¹ï¼Œ`NodePort`ç±»å‹çš„`Service`ä¹Ÿå¯ä»¥ï¼Œåé¢ä¼šè¯´åˆ°)

2. åšä¸“ä¸šçš„è´Ÿè½½å‡è¡¡ï¼Œæ¯•ç«Ÿ`Service`çš„è´Ÿè½½å‡è¡¡è¿˜æ˜¯å¾ˆåˆçº§çš„

3. ç»ˆç»“`ssl/tls`ã€‚æ„æ€æ˜¯è¯´å¯¹äºé‚£äº›ä¸šåŠ¡ä¸æä¾›`https`çš„ï¼Œä¸ºäº†å®‰å…¨ï¼Œå¯ä»¥æœ‰ä¸“é—¨æœºæ„å¸®æˆ‘ä»¬åšå®‰å…¨æ–¹é¢çš„äº‹ï¼Œä¸šåŠ¡åªéœ€è¦ä¸“æ³¨ä¸šåŠ¡å°±è¡Œäº†ï¼Œæ‰€ä»¥å¯ä»¥è¯´æ˜¯"è¿‡æ»¤"`ssl/tls`

4. åŸºäºåç§°çš„è™šæ‹Ÿ`hosting`ã€‚è¿™ä¸ªæˆ‘ç†è§£å°±æ˜¯æˆ‘ä»¬å¸¸è¯´çš„Ingressæ˜¯ä¸€ä¸ªåŸºäºåº”ç”¨å±‚æä¾›æœåŠ¡çš„ï¼Œå› ä¸º`Ingress`ä¸ä»…è´Ÿè´£ä¸€ä¸ªä¸šåŠ¡/Service, è€Œæ˜¯å¯ä»¥æ ¹æ®åç§°åŒºåˆ†ä¸åŒçš„"hosting"....ï¼ˆwxy: ç»§ç»­çœ‹çœ‹å¯èƒ½å°±ç†è§£äº†ï¼‰

:::



::: tip ingressè§£å†³äº†ä»€ä¹ˆé—®é¢˜ï¼Ÿ

1. **åŠ¨æ€é…ç½®æœåŠ¡**

   > å¦‚æœæŒ‰ç…§ä¼ ç»Ÿæ–¹å¼, å½“æ–°å¢åŠ ä¸€ä¸ªæœåŠ¡æ—¶, æˆ‘ä»¬å¯èƒ½éœ€è¦åœ¨æµé‡å…¥å£åŠ ä¸€ä¸ªåå‘ä»£ç†æŒ‡å‘æˆ‘ä»¬æ–°çš„k8sæœåŠ¡. è€Œå¦‚æœç”¨äº†Ingress, åªéœ€è¦é…ç½®å¥½è¿™ä¸ªæœåŠ¡, å½“æœåŠ¡å¯åŠ¨æ—¶, ä¼šè‡ªåŠ¨æ³¨å†Œåˆ°Ingressçš„ä¸­, ä¸éœ€è¦è€Œå¤–çš„æ“ä½œ.

2. **å‡å°‘ä¸å¿…è¦çš„ç«¯å£æš´éœ²**

   > é…ç½®è¿‡k8sçš„éƒ½æ¸…æ¥š, ç¬¬ä¸€æ­¥æ˜¯è¦å…³é—­é˜²ç«å¢™çš„, ä¸»è¦åŸå› æ˜¯k8sçš„å¾ˆå¤šæœåŠ¡ä¼šä»¥NodePortæ–¹å¼æ˜ å°„å‡ºå», è¿™æ ·å°±ç›¸å½“äºç»™å®¿ä¸»æœºæ‰“äº†å¾ˆå¤šå­”, æ—¢ä¸å®‰å…¨ä¹Ÿä¸ä¼˜é›…. è€ŒIngresså¯ä»¥é¿å…è¿™ä¸ªé—®é¢˜, é™¤äº†Ingressè‡ªèº«æœåŠ¡å¯èƒ½éœ€è¦æ˜ å°„å‡ºå», å…¶ä»–æœåŠ¡éƒ½ä¸è¦ç”¨NodePortæ–¹å¼

:::



## ç»Ÿä¸€ç½‘å…³

`Ingress`å’Œ`Pod`å…³ç³»

+ `pod`å’Œ`Ingress`é€šè¿‡`service`å…³è”ï¼Œ`Ingress`ä½œä¸ºä¸€ä¸ªç»Ÿä¸€å…¥å£é€šè¿‡åŸŸåï¼Œç”±`service`å…³è”ä¸€ç»„`Pod`



`Ingress` å…¬å¼€ä»é›†ç¾¤å¤–éƒ¨åˆ°é›†ç¾¤å†…æœåŠ¡çš„ HTTP å’Œ HTTPS è·¯ç”±ã€‚ æµé‡è·¯ç”±ç”± `Ingress` èµ„æºä¸Šå®šä¹‰çš„è§„åˆ™æ§åˆ¶ã€‚

::: tip
æˆ‘ä»¬å¯ä»¥çœ‹åˆ°`Ingress`æ˜¯`Service`çš„ä¸Šå±‚ï¼Œ`Ingress`æä¾›äº†æ›´å¥½çš„è´Ÿè½½å‡è¡¡ä½“éªŒ~

![image-20221022201520335](http://sm.nsddd.top/smimage-20221022201520335.png)

> Ingressæ˜¯åŸºäºnginxçš„å®ç°äº†æ–¹å‘ä»£ç†ã€‚å†…ç½‘é€šè¿‡`Service`è®¿é—®ï¼Œ`Service`å®ç°äº†è´Ÿè½½å‡è¡¡ã€‚
>
> Ingresså…¶å®ä¹Ÿå¯ä»¥è¯´`lngress controller` ï¼Œä¹Ÿå°±æ˜¯`Ingressæ§åˆ¶å™¨`ï¼ŒåŒ…å«äº†`nginx`ï¼Œæˆ‘ä»¬å¹³å¸¸ä¼ ç»Ÿé…ç½®`nginx`ï¼Œå°±æ˜¯é…ç½®åå‘ä»£ç†è§„åˆ™ã€‚

:::

## yamlæ–‡ä»¶

ä¸€ä¸ªæœ€å°çš„ Ingress èµ„æºç¤ºä¾‹ï¼š

[`service/networking/minimal-ingress.yaml`](https://raw.githubusercontent.com/kubernetes/website/main/content/zh-cn/examples/service/networking/minimal-ingress.yaml) 

```yaml
apiVersion: networking.k8s.io/v1
kind: Ingress  
metadata:
  name: minimal-ingress
  annotations:
    nginx.ingress.kubernetes.io/rewrite-target: /
spec:
  ingressClassName: nginx-example
  rules:
  - http:
      paths:
      - path: /testpath
        pathType: Prefix
        backend:  # ç›‘å¬çš„åç«¯åç§°æ˜¯
          service:
            name: test
            port:
              number: 80
```



::: tip æç¤ºï¼š
`lngress controller`ä¼šè‡ªåŠ¨ç›‘å¬`yaml`æ–‡ä»¶ï¼Œç„¶åä¸‹å‘ä»»åŠ¡ï¼Œé…ç½®ï¼Œè¿™æ ·æ‰€æœ‰çš„æµé‡å°±ä¼šæ‰“åˆ°`controller`ï¼Œä¸éœ€è¦ç›´æ¥é…ç½®`nginx`ã€‚

Ingress éœ€è¦æŒ‡å®š apiVersionã€kindã€ metadataå’Œ spec å­—æ®µã€‚ Ingress å¯¹è±¡çš„å‘½åå¿…é¡»æ˜¯åˆæ³•çš„ DNS å­åŸŸååç§°ã€‚ å…³äºå¦‚ä½•ä½¿ç”¨é…ç½®æ–‡ä»¶ï¼Œè¯·å‚è§éƒ¨ç½²åº”ç”¨ã€ é…ç½®å®¹å™¨ã€ ç®¡ç†èµ„æºã€‚ Ingress ç»å¸¸ä½¿ç”¨æ³¨è§£ï¼ˆannotationsï¼‰æ¥é…ç½®ä¸€äº›é€‰é¡¹ï¼Œå…·ä½“å–å†³äº Ingress æ§åˆ¶å™¨ï¼Œä¾‹å¦‚é‡å†™ç›®æ ‡æ³¨è§£ã€‚ ä¸åŒçš„ Ingress æ§åˆ¶å™¨æ”¯æŒä¸åŒçš„æ³¨è§£ã€‚ æŸ¥çœ‹ä½ æ‰€é€‰çš„ Ingress æ§åˆ¶å™¨çš„æ–‡æ¡£ï¼Œä»¥äº†è§£å…¶æ”¯æŒå“ªäº›æ³¨è§£ã€‚

:::



**ç¼–è¯‘æ–‡ä»¶**ï¼š

![image-20221023202032124](http://sm.nsddd.top/smimage-20221023202032124.png)



## å®‰è£…nginxæµ‹è¯•

::: details ingress 80ç«¯å£å®ä¾‹
åˆ›å»ºåº”ç”¨podã€service

```dockerfile
kubectl create deplyment web01 --image=nginx:1.14
kubectl expose deployment web02  --port=80 --protocol=TCP
```

å…³è” `ingress 80` ç«¯å£ï¼š

```yaml
apiVersion: networking.k8s.io/v1beta1
kind: Ingress
metadata:
  name: web01-ingress
spec:
  rules:
  - host: nginx.didi.cn			# åŸŸå
    http:
      paths:
      - backend:
          serviceName: web01			# åç«¯serviceåç§°
          servicePort: 80					# åç«¯serviceç«¯å£

```

æŸ¥çœ‹ï¼š

```
kubectl apply *.yaml
```

:::



::: danger æ³¨æ„svc
å› ä¸º`ingress`éœ€è¦æ¥æ”¶æ‰€æœ‰çš„è¯·æ±‚æµé‡ï¼Œæ‰€ä»¥`Ingress`å°±éœ€è¦ä¸€ä¸ªç«¯å£æ¥æ¥æ”¶æ‰€æœ‰çš„æµé‡ï¼Œè¿™ä¸ªç«¯å£è¿˜æ˜¯ä»¥`NodePort`æ–¹å¼æš´éœ²å‡ºå»çš„~

```
kubectl get svc -A
```

:::





## END é“¾æ¥

<ul><li><div><a href = '11.md' style='float:left'>â¬†ï¸ä¸Šä¸€èŠ‚ğŸ”—  </a><a href = '13.md' style='float: right'>  ï¸ä¸‹ä¸€èŠ‚ğŸ”—</a></div></li></ul>

+ [â“‚ï¸å›åˆ°ç›®å½•ğŸ ](../README.md)

+ [**ğŸ«µå‚ä¸è´¡çŒ®ğŸ’â¤ï¸â€ğŸ”¥ğŸ’–**](https://nsddd.top/archives/contributors))

+ âœ´ï¸ç‰ˆæƒå£°æ˜ &copy; ï¼šæœ¬ä¹¦æ‰€æœ‰å†…å®¹éµå¾ª[CC-BY-SA 3.0åè®®ï¼ˆç½²å-ç›¸åŒæ–¹å¼å…±äº«ï¼‰&copy;](http://zh.wikipedia.org/wiki/Wikipedia:CC-by-sa-3.0åè®®æ–‡æœ¬) 

