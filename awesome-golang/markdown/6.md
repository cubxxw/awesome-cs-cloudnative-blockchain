# å‡½æ•°ã€é—­åŒ…ï¼Œé”™è¯¯å¤„ç†

[[toc]]

[toc]

ğŸ˜¶â€ğŸŒ«ï¸goè¯­è¨€å®˜æ–¹ç¼–ç¨‹æŒ‡å—ï¼š[https://pkg.go.dev/std](https://pkg.go.dev/std)

>   goè¯­è¨€çš„å®˜æ–¹æ–‡æ¡£å­¦ä¹ ç¬”è®°å¾ˆå…¨ï¼Œæ¨èå»å®˜ç½‘å­¦ä¹ 

ğŸ˜¶â€ğŸŒ«ï¸æˆ‘çš„å­¦ä¹ ç¬”è®°ï¼šgithub: [https://github.com/3293172751/golang-rearn](https://github.com/3293172751/golang-rearn)

---

**åŒºå—é“¾æŠ€æœ¯ï¼ˆä¹Ÿç§°ä¹‹ä¸ºåˆ†å¸ƒå¼è´¦æœ¬æŠ€æœ¯ï¼‰**ï¼Œæ˜¯ä¸€ç§äº’è”ç½‘æ•°æ®åº“æŠ€æœ¯ï¼Œå…¶ç‰¹ç‚¹æ˜¯å»ä¸­å¿ƒåŒ–ï¼Œå…¬å¼€é€æ˜ï¼Œè®©æ¯ä¸€ä¸ªäººå‡å¯å‚ä¸çš„æ•°æ®åº“è®°å½•

>   â¤ï¸ğŸ’•ğŸ’•å…³äºåŒºå—é“¾æŠ€æœ¯ï¼Œå¯ä»¥å…³æ³¨æˆ‘ï¼Œå…±åŒå­¦ä¹ æ›´å¤šçš„åŒºå—é“¾æŠ€æœ¯ã€‚åšå®¢[http://nsddd.top](http://nsddd.top)

## åŒ¿åå‡½æ•°

::: details å¿«é€Ÿä¸Šæ‰‹ï¼šåŒ¿åå‡½æ•°
**Go è¯­è¨€æ”¯æŒåŒ¿åå‡½æ•°ï¼Œå¯ä½œä¸ºé—­åŒ…ã€‚åŒ¿åå‡½æ•°æ˜¯ä¸€ä¸ª"å†…è”"è¯­å¥æˆ–è¡¨è¾¾å¼ã€‚åŒ¿åå‡½æ•°çš„ä¼˜è¶Šæ€§åœ¨äºå¯ä»¥ç›´æ¥ä½¿ç”¨å‡½æ•°å†…çš„å˜é‡ï¼Œä¸å¿…ç”³æ˜ã€‚**

ä»¥ä¸‹å®ä¾‹ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†å‡½æ•° `getSequence()` ï¼Œè¿”å›å¦å¤–ä¸€ä¸ªå‡½æ•°ã€‚è¯¥å‡½æ•°çš„ç›®çš„æ˜¯åœ¨é—­åŒ…ä¸­é€’å¢ `i` å˜é‡ï¼Œä»£ç å¦‚ä¸‹ï¼š

ğŸ’¡ç®€å•çš„ä¸€ä¸ªæ¡ˆä¾‹å¦‚ä¸‹ï¼š

```go
package main

import "fmt"

func getSequence() func() int {
  //å®šä¹‰åŒ¿åå‡½æ•° getSequence() è¿”å›ç±»å‹int
  i:=0
  return func() int {
  i+=1
  return i 
  }
}

func main(){
  /* nextNumber ä¸ºä¸€ä¸ªå‡½æ•°ï¼Œå‡½æ•° i ä¸º 0 */
  nextNumber := getSequence() 

  /* è°ƒç”¨ nextNumber å‡½æ•°ï¼Œi å˜é‡è‡ªå¢ 1 å¹¶è¿”å› */
  fmt.Println(nextNumber())
  fmt.Println(nextNumber())
  fmt.Println(nextNumber())

  /* åˆ›å»ºæ–°çš„å‡½æ•° nextNumber1ï¼Œå¹¶æŸ¥çœ‹ç»“æœ */
  nextNumber1 := getSequence() 
  fmt.Println(nextNumber1())
  fmt.Println(nextNumber1())
}


```

ä»¥ä¸Šä»£ç æ‰§è¡Œç»“æœä¸ºï¼š

```
1
2
3
1
2
```

:::



::: tip ä»€ä¹ˆæ˜¯åŒ¿åå‡½æ•°

**åŒ¿åå‡½æ•°æœ›æ–‡ç”Ÿæ„ï¼Œå°±æ˜¯æ²¡æœ‰åå­—çš„å‡½æ•°ï¼Œå¦‚æœæˆ‘ä»¬å¸Œæœ›æŸä¸ªå‡½æ•°åªä½¿ç”¨ä¸€æ¬¡ï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨åŒ¿åå‡½æ•°ï¼Œä½†ä¹Ÿå¯ä»¥å¤šæ¬¡ä½¿ç”¨**

:::



### ä¸€æ¬¡æ€§åŒ¿åå‡½æ•°

**åœ¨å®šä¹‰åŒ¿åå‡½æ•°çš„æ—¶å€™å°±è°ƒç”¨ï¼Œæ­¤æ—¶åŒ¿åå‡½æ•°å°±åªèƒ½ä½¿ç”¨ä¸€æ¬¡**

```go
fun main(){
	//å®šä¹‰å³è°ƒç”¨
    func(n1 int,n2 int)int{
        return n1 + n2
    }(10,20)
	//æ­¤æ—¶åœ¨å®šä¹‰çš„æ—¶å€™åŒæ—¶è°ƒç”¨
}
```

ğŸš€ ç¼–è¯‘ç»“æœå¦‚ä¸‹ï¼š

```
30
```



### ç»™å˜é‡è°ƒç”¨

**è¿™ç§æ–¹å¼çš„åŒ¿åå‡½æ•°å¯ä»¥å¤šæ¬¡è°ƒç”¨ï¼Œä¹‹å‰æˆ‘ä»¬è¯´è¿‡å‡½æ•°ä¹Ÿæ˜¯ä¸€ç§æ•°æ®ç±»å‹ï¼Œé‚£ä¹ˆå°†è¿™ä¸ªå‡½æ•°ç›´æ¥å®šä¹‰ä¸€ä¸ªå˜é‡ç„¶åèµ‹å€¼**

```go
fun main(){
	//å®šä¹‰å³è°ƒç”¨
    a := func(n1 int,n2 int)int{
        return n1 - n2
    }
	//æ­¤æ—¶åœ¨å®šä¹‰çš„æ—¶å€™åŒæ—¶è°ƒç”¨
    res := a(30,20)
    fmt.Println("res="res)
    res2 := a(30,40)
    fmt.Println("res3=",res3)
}
```

```
res= 10
res3= -10
```



### å…¨å±€åŒ¿åå‡½æ•°

```go
var(
	Fun1 = func(n1 int,n2 int)int{
		return n1 * n2
		}
	)          //å®šä¹‰å…¨å±€åŒ¿åå‡½æ•°'F'è¦å¤§å†™

//è°ƒç”¨
func main(){
    a := Fun1(10,100)
    fmt.Println("a=",a)
}
```

ğŸš€ ç¼–è¯‘ç»“æœå¦‚ä¸‹ï¼š

```
a=1000
```



### åŒ¿åæ€»ç»“å®æˆ˜

```go
package main

import (
	"fmt"
)
//å…¨å±€åŒ¿åå‡½æ•°
var(
  t = func(a int, b int) int {
    return a + b 
  }
)
var t3 = func(a int, b int) int {
    return a * b 
  }(123,123)

func main() {
  fmt.Println("Hello, World!")
  a := 1
  b := (^a+1)  //å–å
  fmt.Println(b)
  fmt.Println("*t = ",t) //è¿™ä¸ªåœ°æ–¹æ˜¯å®ƒçš„åœ°å€
  fmt.Println("func t = ",t(10,26))
  fmt.Println("func t3= ",t3)
  
  //ä¸€æ¬¡æ€§åŒ¿å
  t2 := func(a int, b int) int {
    return a + b 
  }(12,312)
  fmt.Println("func t2 = ",t2)

  func(a int, b int) int {
    return a * b 
  }(12,312)
  
  //å¤šæ¬¡ä½¿ç”¨çš„åŒ¿å
  t5:= func(a int, b int) int {
  return a + b 
  }
  fmt.Println("func t5 = ",t5(234,123421))
}

```
![image-20221003140115396](./images/image-20221003140115396.png)



## é—­åŒ…

::: tip é—­åŒ…çš„ç†è§£ï¼š

**é—­åŒ…å°±æ˜¯ä¸€ä¸ªå‡½æ•°ä¸ç›¸å…³çš„å¼•ç”¨ç¯å¢ƒç»„æˆçš„ä¸€ä¸ªæ•´ä½“ï¼ˆå®ä½“ï¼‰**

Go è¯­è¨€æ”¯æŒåŒ¿åå‡½æ•°ï¼Œå¯ä½œä¸ºé—­åŒ…ã€‚åŒ¿åå‡½æ•°æ˜¯ä¸€ä¸ª"å†…è”"è¯­å¥æˆ–è¡¨è¾¾å¼ã€‚åŒ¿åå‡½æ•°çš„ä¼˜è¶Šæ€§åœ¨äºå¯ä»¥ç›´æ¥ä½¿ç”¨å‡½æ•°å†…çš„å˜é‡ï¼Œä¸å¿…ç”³æ˜ã€‚

> åœ¨æœ¬è´¨ä¸Šï¼Œé—­åŒ…æ˜¯å‡½æ•°å†…éƒ¨å’Œå‡½æ•°å¤–éƒ¨è¿æ¥èµ·æ¥çš„æ¡¥æ¢ï¼Œæˆ–è€…è¯´æ˜¯å‡½æ•°å’Œå…¶å¼•ç”¨ç¯å¢ƒçš„ç»„åˆä½“

**æˆ‘ä»¬é’ˆå¯¹å…¨å±€å˜é‡å’Œå±€éƒ¨å˜é‡çš„ç‰¹ç‚¹ï¼š**

> æˆ‘ä»¬å¼€å§‹åœ¨æƒ³ï¼šæœ‰äº›æ—¶å€™ä¸æ’é™¤æŸäº›å˜é‡ä»€ä¹ˆæ—¶å€™ä¼šä½¿ç”¨ï¼Œæˆ‘ä»¬æˆ–è®¸ä¼šä½¿ç”¨å…¨å±€å˜é‡ï¼ˆå› ä¸ºå®ƒå³ä½¿æ²¡æœ‰èµ‹å€¼ä¹Ÿä¸ä¼šæŠ¥é”™ï¼‰

ğŸ’¡ **å…¨å±€å˜é‡**ï¼š

+ å¸¸é©»å†…å­˜
+ æ±¡æŸ“å…¨å±€

ğŸ’¡ **å±€éƒ¨å˜é‡**ï¼š

+ ä¸å¸¸é©»å†…å­˜
+ ä¸æ±¡æŸ“å…¨å±€



ğŸ”¥ é—­åŒ…çš„è§£å†³ï¼š

+ å¯ä»¥è®©ä¸€ä¸ªå˜é‡å¸¸é©»å†…å­˜
+ å¯ä»¥è®©ä¸€ä¸ªå˜é‡ä¸æ±¡æŸ“å…¨å±€

:::



### å®šä¹‰ä¸€ä¸ªé—­åŒ…ç†è§£

**å†™æ³•ï¼šå‡½æ•°é‡Œé¢åµŒå¥—ä¸€ä¸ªå‡½æ•°ï¼Œæœ€åè¿”å›é‡Œé¢çš„å‡½æ•°ã€‚**

::: warning æˆ‘ä»¬éœ€è¦è¿”å›ä¸€ä¸ªæ–¹æ³•
**å®šä¹‰ä¸€ä¸ªæ–¹æ³•`addr()`ï¼Œæˆ‘ä»¬è¿”å›ä¸€ä¸ªæ–¹æ³•ï¼ˆä¸æ¥å—å‚æ•°ï¼‰**

ğŸ’¡ç®€å•çš„ä¸€ä¸ªæ¡ˆä¾‹å¦‚ä¸‹ï¼š

```go
/*
 * @Description:é—­åŒ…çš„è§£å†³æ–¹æ³•
 * @Author: xiongxinwei 3293172751nss@gmail.com
 * @Date: 2022-10-04 21:37:41
 * @LastEditTime: 2022-10-24 12:15:22
 * @FilePath: \code\go-super\8-main.go
 * @Github_Address: https://github.com/3293172751/cs-awesome-Block_Chain
 * Copyright (c) 2022 by xiongxinwei 3293172751nss@gmail.com, All Rights Reserved. @blog: http://nsddd.top
 */
package main

import "fmt"

func adder() func(int) int {
	//func(int) int ä»£è¡¨è¿™ä¸ªå‡½æ•°æ¥æ”¶ä¸€ä¸ªintç±»å‹çš„å‚æ•°ï¼Œè¿”å›ä¸€ä¸ªintç±»å‹çš„å€¼
	var x int = 10
	return func(y int) int {
		x += y
		return x
	}
}

func adder2() func() int {
	var x int = 10
	return func() int {
		return x
	}
}

func main() {
	//å®šä¹‰ä¸€ä¸ªé—­åŒ…ï¼Œä½œç”¨æ˜¯è¿”å›ä¸€ä¸ªå‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°å¯ä»¥ç´¯åŠ ï¼Œæ¯æ¬¡ç´¯åŠ çš„å€¼æ˜¯ä¸Šæ¬¡ç´¯åŠ çš„å€¼åŠ ä¸Šæœ¬æ¬¡ä¼ å…¥çš„å€¼

	var add = func(x, y int) int {
		return x + y
	}
	//è°ƒç”¨é—­åŒ…
	var result = add(1, 2)
	println(result)

	//è°ƒç”¨adderå‡½æ•°ï¼Œè¿”å›ä¸€ä¸ªé—­åŒ…
	fmt.Println("è°ƒç”¨adderå‡½æ•°ï¼Œè¿”å›ä¸€ä¸ªé—­åŒ…")
	var f = adder()   //æ³¨æ„è¿™é‡Œè¡¨ç¤ºæ‰§è¡Œæ–¹æ³•~
    fmt.Println(f(1)) //10 + 1 = 11
	fmt.Println(f(2)) //11 + 2 = 13
	fmt.Println(f(3)) //13 + 3 = 16

	//è°ƒç”¨adder2å‡½æ•°ï¼Œè¿”å›ä¸€ä¸ªé—­åŒ…
	fmt.Println("è°ƒç”¨adder2å‡½æ•°ï¼Œè¿”å›ä¸€ä¸ªé—­åŒ…")
	var f2 = adder2()
	fmt.Println(f2()) //10
	fmt.Println(f2()) //10
	fmt.Println(f2()) //10
}
```

**ğŸš€ ç¼–è¯‘ç»“æœå¦‚ä¸‹ï¼š**

```bash
3
è°ƒç”¨adderå‡½æ•°ï¼Œè¿”å›ä¸€ä¸ªé—­åŒ…
11
13
16
è°ƒç”¨adder2å‡½æ•°ï¼Œè¿”å›ä¸€ä¸ªé—­åŒ…
10
10
10
```

**ğŸ“œ å¯¹ä¸Šé¢çš„è§£é‡Šï¼š**

> **`var x int = 10`å¯ä»¥å¸¸é©»å†…å­˜è€Œä¸”ä¸ä¼šæ±¡æŸ“å…¨å±€ã€‚**

:::

>   ä»¥ä¸‹å®ä¾‹ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†å‡½æ•° `getSequence()` ï¼Œè¿”å›å¦å¤–ä¸€ä¸ªå‡½æ•°ã€‚è¯¥å‡½æ•°çš„ç›®çš„æ˜¯åœ¨é—­åŒ…ä¸­é€’å¢ i å˜é‡ã€‚

ğŸ’¡ç®€å•çš„ä¸€ä¸ªæ¡ˆä¾‹å¦‚ä¸‹ï¼š

```go
package main

import "fmt"

func getSequence() func() int {
    i:=0               //func()æ˜¯ä¸€ä¸ªåŒ¿åå‡½æ•°
    //getSequence()æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œè¿”å›çš„æ•°æ®ç±»å‹æ˜¯func()int
   return func() int {
     i+=1 
     return i 
   }
}

func main(){
   /* nextNumber ä¸ºä¸€ä¸ªå‡½æ•°ï¼Œå‡½æ•° i ä¸º 0 */
   nextNumber := getSequence()  //å°†å‡½æ•°ç»™å˜é‡Nex,ç›¸å½“äºåŒ¿åå‡½æ•°

   /* è°ƒç”¨ nextNumber å‡½æ•°ï¼Œi å˜é‡è‡ªå¢ 1 å¹¶è¿”å› */
   fmt.Println(nextNumber())
   fmt.Println(nextNumber())
   fmt.Println(nextNumber())

   /* åˆ›å»ºæ–°çš„å‡½æ•° nextNumber1ï¼Œå¹¶æŸ¥çœ‹ç»“æœ */
   nextNumber1 := getSequence()  
   fmt.Println(nextNumber1())
   fmt.Println(nextNumber1())
}
```

**ä»¥ä¸Šä»£ç æ‰§è¡Œç»“æœä¸ºï¼š**

```
1
2
3
1
2
```

### é—­åŒ…çš„è¯´æ˜

```go
func getSequence() func() int {   //getSequence()æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œè¿”å›çš„æ•°æ®ç±»å‹æ˜¯func()int
	i:=0               //func()æ˜¯ä¸€ä¸ªåŒ¿åå‡½æ•°
	 
    return func() int {
     i+=1 
     return i  
 }
```

**è¿”å›çš„æ˜¯ä¸€ä¸ªåŒ¿åå‡½æ•°ï¼ŒåŒæ—¶è¿™ä¸ªåŒ¿åå‡½æ•°å¼•ç”¨åˆ°å‡½æ•°å¤–çš„iï¼Œå› æ­¤è¿™ä¸ªåŒ¿åå‡½æ•°å’Œiå½¢æˆä¸€ä¸ªæ•´ä½“ï¼Œæ„æˆ é—­åŒ…**

>   å¯ä»¥è¿™æ ·ç†è§£ï¼šé—­åŒ…æ˜¯ä¸€ä¸ªç±»classï¼Œè€Œiæ˜¯å­—æ®µï¼Œå‡½æ•°æ˜¯ä¸€ä¸ªæ“ä½œï¼Œè€Œå‡½æ•°å’Œè¿™ä¸ªiæ„æˆé—­åŒ…

**å½“æˆ‘ä»¬åå¤çš„è°ƒç”¨få‡½æ•°ï¼Œå› ä¸ºiåªæ˜¯åˆå§‹åŒ–ä¸€æ¬¡ï¼Œå› æ­¤æ¯è°ƒç”¨æ­¤ä¸€æ¬¡å°±ç´¯åŠ ä¸€æ¬¡**

**å…³é”®ï¼šå°±æ˜¯è¿”å›çš„å‡½æ•°å¼•ç”¨åˆ°å“ªäº›å˜é‡ï¼Œå‡½æ•°ä¸å“ªäº›å˜é‡æ„æˆé—­åŒ…**

ğŸ’¡ç®€å•çš„ä¸€ä¸ªæ¡ˆä¾‹å¦‚ä¸‹ï¼š

![image-20220109141602331](./images/4lTbFmDxeBMI8E9.png)



::: danger æ³¨æ„å‚æ•°çš„è§„èŒƒæ€§ï¼š
æˆ‘ä»¬ä¸ºäº†è§„èŒƒæ€§ï¼Œå»ºè®®ä¸ä½¿ç”¨å‚æ•°çš„å®šä¹‰

`func(y int) int` â¡ï¸  `func(int)`

```go
func adder() func(int) int {
	//func(int) int ä»£è¡¨è¿™ä¸ªå‡½æ•°æ¥æ”¶ä¸€ä¸ªintç±»å‹çš„å‚æ•°ï¼Œè¿”å›ä¸€ä¸ªintç±»å‹çš„å€¼
	var x int = 10
	return func(y int) int {
		x += y
		return x
	}
}
```

:::



## é—­åŒ…çš„èŠ±æ ·ç©æ³•

+ [å‚è€ƒä¸€ç¯‡å†™çš„éå¸¸æ£’çš„æ–‡ç« ](https://zhuanlan.zhihu.com/p/92634505)

::: tip 
a **closure** is a record storing **a function** together with **an environment**.
**é—­åŒ…**æ˜¯ç”±**å‡½æ•°**å’Œä¸å…¶ç›¸å…³çš„å¼•ç”¨**ç¯å¢ƒ**ç»„åˆè€Œæˆçš„å®ä½“ ã€‚
:::



å®šä¹‰`foo1()`åˆ°`foo7()`ä¸€å…±7ä¸ªå‡½æ•°ï¼Œçœ‹çœ‹æœ‰ä½•ä¸åŒ~

**case 1ï¼š**

```go
package main

import "fmt"

func main() {
	val := 3 // val is a local variable
	for i := 0; i < 3; i++ {
		foo1(&val)()
	}
	foo1(&val) // æ³¨æ„è¿™é‡Œæ²¡æœ‰æ‹¬å·
}

func foo1(x *int) func() {
	return func() {
		*x = *x + 1
		fmt.Printf("foo1 val = %d\n", *x)
	}
}
```

ğŸš€ ç¼–è¯‘ç»“æœå¦‚ä¸‹ï¼š

```
foo1 val = 4
foo1 val = 5
foo1 val = 6
```



**case 2ï¼š**

```go
func main() {
    val := 3
	for i := 0; i < 3; i++ {
		foo2(val)()
	}
	foo2(val) // æ³¨æ„è¿™é‡Œæ²¡æœ‰æ‹¬å·
}

func foo2(x int) func() {
  return func() {
    x = x + 1
    fmt.Printf("foo2 val = %d\n", x)
  }
}
```

ğŸš€ ç¼–è¯‘ç»“æœå¦‚ä¸‹ï¼š

```
foo2 val = 4
foo2 val = 4
foo2 val = 4
```



**case 3ï¼š**

```go
package main

import "fmt"

func main() {
	foo3()
	foo3()()
}

func foo3() func() {
	values := []int{1, 2, 3}
	for _, val := range values {
		fmt.Printf("foo3 val = %d\n", val)
	}
	return func() {
		fmt.Println("return func() foo3")
	}
}
```

ğŸš€ ç¼–è¯‘ç»“æœå¦‚ä¸‹ï¼š

```bash
foo3 val = 1
foo3 val = 2
foo3 val = 3
foo3 val = 1
foo3 val = 2
foo3 val = 3
return func() foo3
```



**case 4ï¼š**

```go
func main() {
	foo4()

}

func show(v interface{}) {
	fmt.Printf("foo4 val = %v\n", v)
}

func foo4() {
	values := []int{1, 2, 3, 5}
	for _, val := range values {
		go show(val)
	}
	for {
	}
}
```

ğŸš€ ç¼–è¯‘ç»“æœå¦‚ä¸‹ï¼š

```
foo4 val = 2
foo4 val = 1
foo4 val = 3
foo4 val = 5
```



**case 5ï¼š**

```go
func foo5() {
  values := []int{1, 2, 3, 5}
  for _, val := range values {
    go func() {
      fmt.Printf("foo5 val = %v\n", val)
    }()
  }
}

//ğŸš€ ç¼–è¯‘ç»“æœä¸º `ç©ºçš„~`
```


**case 6ï¼š**

```go
var foo6Chan = make(chan int, 10)
func foo6() {
  for val := range foo6Chan {
    go func() {
      fmt.Printf("foo6 val = %d\n", val)
    }()
  }
}
//err
```



**case 7ï¼š**

```go
package main

import (
	"fmt"
)

func main() {
	fmt.Println(foo7(12))
	fmt.Println(foo7(13))
	// éå†
	for i := 0; i < 3; i++ {
		foo7(12)[i]()
	}
}

func foo7(x int) (fs []func()) {
	values := []int{1, 2, 3}

	for _, val := range values {
		fs = append(fs, func() { //æ·»åŠ ä¸€ä¸ªåŒ¿åå‡½æ•°åˆ°fsä¸­
			fmt.Printf("foo7 val = %d\n", x+val)
		})
	}

	return
}

```

ğŸš€ ç¼–è¯‘ç»“æœå¦‚ä¸‹ï¼š

```
[0x45ff60 0x45ff60 0x45ff60]
[0x45ff60 0x45ff60 0x45ff60]
foo7 val = 15
foo7 val = 15
foo7 val = 15
```

::: warning ğŸ“œ å¯¹ä¸Šé¢çš„è§£é‡Šï¼ˆ**é—­åŒ…å»¶è¿Ÿç»‘å®š**ï¼‰
whatï¼Ÿ

ä¸ºä»€ä¹ˆæ‰“å°çš„éƒ½æ˜¯ä¸€æ ·çš„~ whatï¼Œwhat

ä¸æ˜¯è¯´**é—­åŒ…**æ˜¯ä¸€æ®µ**å‡½æ•°**å’Œ**ç›¸å…³çš„å¼•ç”¨ç¯å¢ƒ**çš„å®ä½“ã€‚case7çš„é—®é¢˜ä¸­ï¼Œå‡½æ•°æ˜¯æ‰“å°å˜é‡`val`çš„å€¼ï¼Œå¼•ç”¨ç¯å¢ƒæ˜¯å˜é‡`val`ã€‚ä»…ä»…æ˜¯è¿™æ ·çš„è¯ï¼Œéå†åˆ°val=1çš„æ—¶å€™ï¼Œè®°å½•çš„ä¸åº”è¯¥æ˜¯val=1çš„ç¯å¢ƒå—ï¼Ÿ

ä¸Šæ–‡åœ¨é—­åŒ…è§£é‡Šæœ€åï¼Œè¿˜æœ‰ä¸€å¥è¯ï¼šé—­åŒ…ä¿å­˜/è®°å½•äº†å®ƒ**äº§ç”Ÿ**æ—¶çš„å¤–éƒ¨å‡½æ•°çš„æ‰€æœ‰ç¯å¢ƒã€‚å¦‚åŒæ™®é€šå˜é‡/å‡½æ•°çš„**å®šä¹‰**å’Œå®é™…**èµ‹å€¼/è°ƒç”¨æˆ–è€…è¯´æ‰§è¡Œ**ï¼Œæ˜¯ä¸¤ä¸ªé˜¶æ®µã€‚é—­åŒ…ä¹Ÿæ˜¯ä¸€æ ·ï¼Œfor-loopå†…éƒ¨ä»…ä»…æ˜¯å£°æ˜äº†ä¸€ä¸ªé—­åŒ…ï¼Œ`foo7()`è¿”å›çš„ä¹Ÿä»…ä»…æ˜¯ä¸€æ®µé—­åŒ…çš„å‡½æ•°å®šä¹‰ï¼Œåªæœ‰åœ¨å¤–éƒ¨æ‰§è¡Œäº†`f7()`æ—¶æ‰çœŸæ­£æ‰§è¡Œäº†é—­åŒ…ï¼Œæ­¤æ—¶æ‰é—­åŒ…å†…éƒ¨çš„å˜é‡æ‰ä¼šè¿›è¡Œèµ‹å€¼çš„æ“ä½œã€‚å“ï¼Œå¦‚æœè¿™ä¹ˆè¯´çš„è¯ï¼Œå²‚ä¸æ˜¯åº”è¯¥æŠ›å‡ºå¼‚å¸¸å—ï¼Ÿå› ä¸º`val`æ˜¯ä¸€ä¸ªæ¯”`foo7()`ç”Ÿå‘½å‘¨æœŸæ›´çŸ­çš„å˜é‡å•Šï¼Ÿ

è¿™å°±æ˜¯é—­åŒ…çš„ç¥å¥‡ä¹‹å¤„ï¼Œå®ƒä¼šä¿å­˜ç›¸å…³å¼•ç”¨çš„ç¯å¢ƒï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œ`val`è¿™ä¸ªå˜é‡åœ¨é—­åŒ…å†…çš„ç”Ÿå‘½å‘¨æœŸå¾—åˆ°äº†ä¿è¯ã€‚å› æ­¤åœ¨æ‰§è¡Œè¿™ä¸ªé—­åŒ…çš„æ—¶å€™ï¼Œä¼šå»å¤–éƒ¨ç¯å¢ƒå¯»æ‰¾æœ€æ–°çš„æ•°å€¼ï¼ä½ æ˜¯ä¸æ˜¯ä¸ç›¸ä¿¡ï¼Ÿæ¥æ¥æ¥ï¼Œæˆ‘ä»¬é©¬ä¸Šå†™ä¸ªä¸´æ—¶çš„caseæ‰§è¡Œä¸‹åˆ†åˆ†é’Ÿå°±æ˜ç™½äº†ï¼š

```go
package main

import (
	"fmt"
)

func main() {
	foo0()()
	foo0()()
}

func foo0() func() {
	x := 1
	f := func() {
		fmt.Printf("foo0 val = %d\n", x)
	}
	x = 11
	return f
}

```

ğŸš€ ç¼–è¯‘ç»“æœå¦‚ä¸‹ï¼š

```
foo0 val = 11
foo0 val = 11
```

:::



::: tip 
ç©¶ç«Ÿæ˜¯å¦‚ä½•å–å‡ºæœ€è¿‘çš„å€¼çš„ï¼š

```go
package main

import (
	"fmt"
)

func main() {
	// Q1ç¬¬ä¸€ç»„å®éªŒ
	x := 133
	f1 := foo1(&x)
	f2 := foo2(x)
	f1()
	f2()
	f1()
	f2()
	fmt.Println("--------------------------------")
	// Q1ç¬¬äºŒç»„
	x = 233
	f1()
	f2()
	f1()
	f2()
	fmt.Println("--------------------------------")
	// Q1ç¬¬ä¸‰ç»„
	foo1(&x)()
	foo2(x)()
	foo1(&x)()
	foo2(x)()
	foo2(x)()

	fmt.Println("--------------------------------")
	foo2(x)()
	foo3(x)()
	foo1(&x)()
	foo3(x)()

}

func foo1(x *int) func() {
	return func() {
		*x = *x + 1
		fmt.Printf("foo1 val = %d\n", *x)
	}
}
func foo2(x int) func() {
	return func() {
		x = x + 1
		fmt.Printf("foo1 val = %d\n", x)
	}
}

func foo3(x int) func() {
	return func() {
		x = x + 1
		fmt.Printf("foo2 val = %d\n", x)
	}
}

```

:::



## for & åŒ¿åå‡½æ•°ï¼ˆé—­åŒ…ï¼Ÿï¼‰

å¦‚æœæˆ‘å°† åŒ¿åå‡½æ•° æ”¾åœ¨ `for range` ä¸­ï¼Œæˆ‘å¾ˆå¥½å¥‡ä¼šå‘ç”Ÿä»€ä¹ˆæ ·çš„äº‹æƒ…ï¼Ÿ

```go
func foo5() {
    values := []int{1, 2, 3, 5}
    for _, val := range values {
        go func() {
            fmt.Printf("foo5 val = %v\n", val)
        }()
    }
}
â€‹
foo5()
//foo3 val = 5
//foo3 val = 5
//foo3 val = 5
//foo3 val = 5
```

å¯ä»¥çœ‹åˆ°æœ€ç»ˆæ‰“å°çš„éƒ½æ˜¯ 5 ï¼Œè¿™æ ·å°±å¾ˆå¥‡æ€ªäº†ï¼Œ1ï¼Œ2ï¼Œ3ï¼Œ4 å»å“ªé‡Œäº†ï¼Ÿï¼Ÿï¼Ÿï¼Ÿ

**Go Routineçš„å»¶è¿Ÿç»‘å®š**ï¼š

å…¶å®è¿™ä¸ªé—®é¢˜çš„æœ¬è´¨åŒ**é—­åŒ…çš„å»¶è¿Ÿç»‘å®š**ï¼Œæˆ–è€…è¯´ï¼Œè¿™æ®µåŒ¿åå‡½æ•°çš„å¯¹è±¡å°±æ˜¯**é—­åŒ…**ã€‚åœ¨æˆ‘ä»¬è°ƒç”¨`go func() { xxx }()`çš„æ—¶å€™ï¼Œåªè¦æ²¡æœ‰çœŸæ­£å¼€å§‹æ‰§è¡Œè¿™æ®µä»£ç ï¼Œé‚£å®ƒè¿˜åªæ˜¯ä¸€æ®µå‡½æ•°å£°æ˜ã€‚è€Œåœ¨è¿™æ®µåŒ¿åå‡½æ•°è¢«æ‰§è¡Œçš„æ—¶å€™ï¼Œæ‰æ˜¯å†…éƒ¨å˜é‡å¯»æ‰¾çœŸæ­£èµ‹å€¼çš„æ—¶å€™ã€‚

åœ¨**case5**ä¸­ï¼Œfor-loopçš„éå†å‡ ä¹æ˜¯â€œç¬æ—¶â€å®Œæˆçš„ï¼Œ4ä¸ªGo RoutineçœŸæ­£è¢«æ‰§è¡Œåœ¨å…¶åã€‚**çŸ›ç›¾æ˜¯ä¸æ˜¯äº§ç”Ÿäº†ï¼Ÿ**è¿™ä¸ªæ—¶å€™for-loopç»“æŸäº†å‘€ï¼Œ`val`ç”Ÿå‘½å‘¨æœŸæ—©å·²ç»“æŸäº†ï¼Œç¨‹åºåº”è¯¥æŠ¥é”™æ‰å¯¹å‘€ï¼Ÿ

å›å¿†ä¸Šä¸€ç« ï¼Œæ˜¯ä¸æ˜¯ä¸€ä¸ªç›¸åŒçš„æƒ…å¢ƒï¼Ÿæ˜¯çš„ï¼Œè¿™ä¸ªåŒ¿åå‡½æ•°å¯ä¸å°±æ˜¯ä¸€ä¸ªé—­åŒ…å—ï¼Ÿä¸€åˆ‡å°±è§£é‡Šé€šäº†ï¼š**é—­åŒ…**çœŸæ­£è¢«æ‰§è¡Œçš„æ—¶å€™ï¼Œfor-loopç»“æŸäº†ï¼Œä½†æ˜¯`val`çš„ç”Ÿå‘½å‘¨æœŸåœ¨é—­åŒ…å†…éƒ¨è¢«å»¶é•¿äº†ä¸”è¢«èµ‹å€¼åˆ°æœ€æ–°çš„æ•°å€¼5ã€‚



**å¦‚æœå°†åŒ¿åå‡½æ•°æ¢æˆå‡½æ•°è°ƒç”¨ï¼Œè¿™æ ·å°±å¾ˆä¸ä¸€æ ·äº†ï¼š**

```go
func show(v interface{}) {
    fmt.Printf("foo4 val = %v\n", v)
}
func foo4() {
    values := []int{1, 2, 3, 5}
    for _, val := range values {
        go show(val)
    }
}
â€‹
foo4()
//foo3 val = 2
//foo3 val = 3
//foo3 val = 1
//foo3 val = 5
```



::: warning æ‰€ä»¥è¯´
**Go Routineçš„åŒ¿åå‡½æ•°çš„å»¶è¿Ÿç»‘å®šæœ¬è´¨å°±æ˜¯é—­åŒ…ï¼Œå®é™…ç”Ÿæˆä¸­æ³¨æ„ä¸‹è¿™ç§å†™æ³•~**

> æœ€åï¼Œé—­åŒ…æ˜¯ä¸ªå¸¸è§çš„ç©æ„å„¿ï¼Œä½†æ˜¯å®é™…ä»£ç ä¸­ä¸å¤ªå»ºè®®ä½¿ç”¨ï¼Œä¸€ä¸å°å¿ƒå†™äº†ä¸ªå†…å­˜æ³„æ¼æŸ¥éƒ½æŸ¥ä¸åˆ°ã€‚ç‰¹åˆ«æ˜¯ä¸è¦ä¸ºäº†ç‚«æŠ€æ•…æ„å†™ä¸ªé—­åŒ…ï¼Œå®åœ¨æ²¡æœ‰å¿…è¦ã€‚

:::



## å‡½æ•°defer

**åœ¨å‡½æ•°ä¸­ï¼Œé€šå¸¸é€‰ç”¨åˆ›å»ºèµ„æºï¼ˆæ¯”å¦‚ï¼šæ•°æ®åº“è¿æ¥ï¼Œæ–‡ä»¶ç­‰ï¼‰ï¼Œä¸ºäº†åœ¨å‡½æ•°æ‰§è¡Œå®Œæ¯•åï¼Œå³ä½¿çš„é‡Šæ”¾èµ„æºï¼ŒGoæä¾›äº†deferï¼ˆå»¶æ—¶æœºåˆ¶ï¼‰** â€”>  `æ ˆ`

```go
package main
import "fmt"

func sum(n1 int, n2 int) int{
	defer fmt.Println("ok1 n1=",n1)		//1
	defer fmt.Println("ok1 n2=",n2)		//2
	res := n1 + n2 
	fmt.Println("ok1 res=",res)			//3
	return res
}

func main(){
	res := sum(10,20)
	fmt.Println("res=",res)				//4
}
```

ğŸš€ ç¼–è¯‘ç»“æœå¦‚ä¸‹ï¼š

![image-20221002155239446](./images/image-20221002155239446.png)



::: details æ‰©å±•ç¨‹åº

```go
/*
 * @Description:defer
 * @Author: xiongxinwei 3293172751nss@gmail.com
 * @Date: 2022-10-04 21:37:41
 * @LastEditTime: 2022-10-24 16:13:14
 * @FilePath: \code\go-super\11-main.go
 * @Github_Address: https://github.com/3293172751/cs-awesome-Block_Chain
 * Copyright (c) 2022 by xiongxinwei 3293172751nss@gmail.com, All Rights Reserved. @blog: http://nsddd.top
 */
package main

import "fmt"

func f1() int {
	defer func() {
		fmt.Println("f1 defer")
	}()

	fmt.Println("f1")
	return 1
}

func f2() (r int) {
	t := 5
	defer func() {
		t = t + 5
	}()
	return t
}

func f3() (r int) {
	defer func(r int) {
		r = r + 5
	}(r)
	return 1
}

func f4() (r int) {
	t := 5
	defer func() {
		t = t + 5
	}()
	return t
}

func main() {
	fmt.Println("Hello World!")	 
	fmt.Println(f1()) //f1 f1 defer 1
	fmt.Println(f2()) //5
	fmt.Println(f3()) //1
	fmt.Println(f4()) //5
	fmt.Println("main end") //main end

}

```

ğŸš€ ç¼–è¯‘ç»“æœå¦‚ä¸‹ï¼š

```go
[Running] go run "d:\æ–‡æ¡£\æœ€è¿‘çš„\awesome-golang\docs\code\go-super\11-main.go"
Hello World!
f1
f1 defer
1
5
1
5
main end
```

:::



::: danger âš ï¸ æ³¨æ„ï¼š
**æé†’ä½ ï¼š**

1.   å½“æ‰§è¡Œåˆ°`defer`æ—¶å€™ï¼Œç³»ç»Ÿä¼šå°†`defer`è¯­å¥å‹å…¥åˆ°ä¸€ä¸ªç‹¬ç«‹çš„æ ˆä¸­ï¼ˆ`defer`æ ˆï¼‰ï¼Œæš‚æ—¶ä¸æ‰§è¡Œ
2.   å½“å‡½æ•°æ‰§è¡Œå®Œæ¯•åå†ä»`defer`ä¸­æŒ‰ç…§**å…ˆå…¥åå‡º**çš„æ–¹å¼å‡ºæ ˆï¼Œç„¶åæ‰§è¡Œ
3.   å‡½æ•°ä¸­çš„`res` æœ€å…ˆæ‰§è¡Œï¼Œè¾“å‡º`30`
4.   æœ€åæ‰§è¡Œ`main`ä¸­çš„è¯­å¥
5.   åœ¨`defer`è¯­å¥å…¥æ ˆçš„æ—¶å€™ï¼Œä¹Ÿä¼šå°†ç›¸å…³çš„å€¼åŒæ—¶æ”¾å…¥åˆ°æ ˆ

>   æˆ‘å¤§æ¦‚è®¤ä¸ºå°±è·ŸC++ä¸­çš„æ„é€ å‡½æ•° å’Œææ„å‡½æ•°`~`ç±»ä¼¼

**å³deferä½œç”¨æ˜¯åœ¨å‡½æ•°æ‰§è¡Œå®Œæ¯•åï¼Œå¯ä»¥åŠæ—¶çš„é‡Šæ”¾å‡½æ•°åˆ›å»ºçš„èµ„æº**

```go
//æ–‡ä»¶æ“ä½œ
defer file Close()

//æ•°æ®åº“æ“ä½œ
defer connect.close()       //connectæ˜¯æ•°æ®åº“çš„æ¸¸æ ‡
```

:::


## å­—ç¬¦ä¸²å¸¸ç”¨çš„ç³»ç»Ÿå‡½æ•°

```go
package utils
import (
	"fmt"
	"strconv"
	"strings"
)

var str string = "å­¦golangä½¿æˆ‘å¿«ä¹ï¼"

// å…³äºstringçš„å¸¸ç”¨å‡½æ•°

// 1. len(str) å†…å»ºå‡½æ•°ï¼Œè¿”å›å­—ç¬¦ä¸²é•¿åº¦ï¼ŒæŒ‰å­—èŠ‚ï¼Œ1ä¸ªæ±‰å­—3å­—èŠ‚ï¼Œ1å­—æ¯1å­—èŠ‚
//è¿™ä¸ªå‡½æ•°æ˜¯å†…å»ºå‡½æ•°ï¼ˆå’Œprintfä¸€æ ·ï¼‰  //åªéœ€è¦`fmt`åŒ…
func F1(){
    fmt.Println(len(str))
}

// 2. range []rune(str)  å­—ç¬¦ä¸²éå†ï¼Œå¤„ç†ä¸­æ–‡é—®é¢˜ è½¬æˆruneåˆ‡ç‰‡
func F2() {
	for _,value := range []rune(str) {
		fmt.Printf("%c \n",value)
	}
}

// 3. stringè½¬æ•´æ•° strconv.Atoi(str) è¿™ä¸ªå‡½æ•°æ˜¯ strconv.ParseInt(s string, base int, bitSize int) (i int64 err error)çš„ç®€åŒ–ç‰ˆ
func F3() {
	num, _ := strconv.Atoi("666")
	fmt.Printf("num type is %T,value is %v", num, num) 
    // num type is int,value is 666

}

// 4. æ•´æ•°è½¬string strconv.Itoa(666) æ˜¯strconv.FormatInt(i int64, base int) stringçš„ç®€åŒ–ç‰ˆ

// 5. string to []byte  b := []byte(str)
func F5(){
	 b := []byte(str)
	 fmt.Printf("%T %v\n", b, b) // type of b is []uint8
}

// 6. []byte to string   s := string([]byte{77,88,99})
func F6(){
	 s := string([]byte{77,88,99})
	 fmt.Printf("%T %v\n", s, s) // string MXc
}

// 7. åè¿›åˆ¶æ•°è½¬2 8 16è¿›åˆ¶å­—ç¬¦ä¸²  strconv.FormatInt(i int64, base int) string  base->2,8,16

// 8. åˆ¤æ–­å­—ç¬¦ä¸²sæ˜¯å¦åŒ…å«å­ä¸²substr strings.Contains(s, substr string) bool

// 9. ç»Ÿè®¡å­ä¸²å‡ºç°æ¬¡æ•° strings.Count(s, sep string) int
func F9() {
	s := "A man who helps you when you are in trouble and who leaves you when you are successful is a real friend."

	fmt.Println(strings.Count(s,"you")) // 4

	s = "lv"
	fmt.Println(strings.Count(s,"")) // 3

}

// 10. åˆ¤æ–­è¿ä¸ªå­—ç¬¦ä¸²æ˜¯å¦ç›¸ç­‰ str1 == str2 åŒºåˆ†å¤§å°å†™ï¼Œ ä¸åŒºåˆ†å¤§å°å†™æ–¹å¼strings.EqualFold(s, t string) bool

// 11. å­ä¸²sepåœ¨å­—ç¬¦ä¸²sä¸­ç¬¬ä¸€æ¬¡/æœ€åä¸€æ¬¡å‡ºç°çš„ä½ç½®ï¼Œä¸å­˜åœ¨åˆ™è¿”å›-1  Index(s, sep string) int/LastIndex(s, sep string) int

// 12. å°†nä¸ªoldå­ä¸²æ›¿æ¢ä¸ºnewå­—ç¬¦ä¸²ï¼Œn<0ä¼šæ›¿æ¢æ‰€æœ‰oldå­ä¸² strings.Replace(s, old, new string, n int) string

// 13. å¤§å°å†™è½¬æ¢ strings.ToUpper  /ToLower

// 14. æŒ‰sepæ‹†åˆ†å­—ç¬¦ä¸²ï¼Œè¿”å›ä¸€ä¸ªslice  strings.Split(s, sep string) []string

// 15. å°†å­—ç¬¦ä¸²sliceä»¥sepä¸ºåˆ†éš”ç¬¦ç»„åˆæˆä¸€ä¸ªå­—ç¬¦ä¸² strings.Join(a []string, sep string) string

// 16. Trimç³»åˆ— Trim(s string, cutset string) string å»é™¤å·¦å³ä¸¤è¾¹æŒ‡å®šå­—ç¬¦ä¸²  TrimRight/TrimLeft
// 	TrimSpace(s string) string å»é™¤å·¦å³ä¸¤è¾¹ç©ºç™½
//  TrimPrefix(s, prefix string) string /TrimSuffix(s, suffix string) string å»é™¤å‰/åç¼€

// 17. åˆ¤æ–­sæ˜¯å¦æœ‰å‰ç¼€/åç¼€å­—ç¬¦ä¸²prefix   HasPrefix(s, prefix string) bool  / HasSuffix
func main(){
    
}
```



## æ—¥æœŸå’Œæ—¶é—´ç›¸å…³å‡½æ•°

1.   æ—¶é—´å’Œæ—¥æœŸç›¸å…³çš„å‡½æ•°éœ€è¦å¯¼å…¥timeåŒ…[https://pkg.go.dev/time@go1.17.6](https://pkg.go.dev/time@go1.17.6)

2.   time.Time ç±»å‹ï¼Œç”¨äºè¡¨ç¤ºæ—¶é—´

     ```go
     package main
     import(
     	"fmt"
     	"time"
     )
     func main(){
         now := time.Time()
         fmt.Printf("now=%v now type=%T",now,now)
     
         fmt.Println(now.Year())      //è·å–åˆ°å¹´
         fmt.Println(int(now.Month()))      //è·å–åˆ°æœˆ
         fmt.Println(now.Day())      //è·å–åˆ°æ—¥
         fmt.Println(now.Hour())      //è·å–åˆ°æ—¶
         fmt.Println(now.Minute())      //è·å–åˆ°åˆ†
         fmt.Println(now.Second())      //è·å–åˆ°ç§’
     }
     ```

     ğŸš€ ç¼–è¯‘ç»“æœå¦‚ä¸‹ï¼š
     
     ![image-20220109151948003](./images/SebIThU4GB3xXCH.png)



### æ—¶é—´å¸¸é‡

**å¸¸é‡å°±æ˜¯åœ¨ç¨‹åºä¸­å¯ç”¨äºè·å–æŒ‡å®šæ—¶é—´å•ä½çš„æ—¶é—´**

```go
const (
	Nanosecond  Duration = 1
	Microsecond          = 1000 * Nanosecond
	Millisecond          = 1000 * Microsecond
	Second               = 1000 * Millisecond
	Minute               = 60 * Second
	Hour                 = 60 * Minute
)
```

>   æ¯”å¦‚æƒ³æ‹¿åˆ°100æ¯«ç§’

```
100 * time.Millisecond
```

**å¦‚æœæˆ‘ä»¬æƒ³è¦ä¼‘çœ ä¸€æ®µæ—¶é—´ï¼Œå¿…é¡»è¦ä½¿ç”¨åˆ°æ—¶é—´å¸¸é‡**



### ç»“åˆsleepæ¥ä½¿ç”¨æ—¶é—´å¸¸é‡

>   éœ€æ±‚ï¼šæ¯éš”ä¸€ç§’é’Ÿæ‰“å°ä¸€ä¸ªæ•°å­—ï¼Œæ‰“å°åˆ°10æ—¶å°±é€€å‡º
>
>   æ¯éš”0.1ç§’æ‰“å°ä¸€ä¸ªæ•°å­—ï¼Œæ‰“å°5ç§’é€€å‡º**ï¼ˆä¸å¯ä»¥ä½¿ç”¨`time.Second * 0.1`,ç¼–è¯‘ä¸èƒ½é€šè¿‡ï¼Œåªèƒ½ç”¨`millisecond(æ¯«ç§’) * 100`)**

```go
package main
import (
    "fmt"
    "time"
)

func main(){
i := 0
j := 0
 for{
     i++
     fmt.Println(i)  //æ‰“å°
     time.Sleep(time.Second)   //ä¼‘çœ ï¼Œæ¯ç§’é’Ÿæ‰§è¡Œä¸€æ¬¡
     if i == 10{
         break
     }
 }
    for{
        j++
        fmt.Println(j)
        time.Sleep(time.Millisecond * 100)
        if i == 20{
            break
        }
    }
}
```

![image-20220109154141855](./images/kQdxJsaft5wM4nB.png)



### unixæ—¶é—´æˆ³å’Œunixnanoæ—¶é—´æˆ³

**ä½œç”¨æ˜¯ï¼šè·å–éšæœºæ•°å­—**

>   **unix :è·å–ç§’æ•°éšæœº**
>
>   **unixnano:è·å–çº³ç§’éšå³æ•°**

```
now = time.Now()
fmt.Printf("unixæ—¶é—´æˆ³ä¸º=%v \n unixnanoæ—¶é—´æ“=%v",now.unix(),now.unixnano())
```

![image-20220109160542484](./images/nwSfaEKBhON96gD.png)

âš ï¸ func (Time) Unix

```
func (t Time) Unix() int64
```

Unix returns t as a Unix time, the number of seconds elapsed since January 1, 1970 UTC. The result does not depend on the location associated with t. Unix-like operating systems often record time as a 32-bit count of seconds, but since the method here returns a 64-bit value it is valid for billions of years into the past or future.

```go
package main

import (
	"fmt"
	"time"
)

func main() {
	// 1 billion seconds of Unix, three ways.
	fmt.Println(time.Unix(1e9, 0).UTC())     // 1e9 seconds
	fmt.Println(time.Unix(0, 1e18).UTC())    // 1e18 nanoseconds
	fmt.Println(time.Unix(2e9, -1e18).UTC()) // 2e9 seconds - 1e18 nanoseconds

    t := time.Date(2001, time.September, 9, 1, 46, 40, 0, time.UTC)
    fmt.Println(t.Unix())     // seconds since 1970
    fmt.Println(t.UnixNano()) // nanoseconds since 1970
}
```



### ç”¨æ³•

âš ï¸func (Time) UnixMicro added in go1.17

```
func (t Time) UnixMicro() int64
```

UnixMicro returns t as a Unix time, the number of microseconds elapsed since January 1, 1970 UTC. The result is undefined if the Unix time in microseconds cannot be represented by an int64 (a date before year -290307 or after year 294246). The result does not depend on the location associated with t.

âš ï¸func (Time) UnixMilli added in go1.17

```
func (t Time) UnixMilli() int64
```

UnixMilli returns t as a Unix time, the number of milliseconds elapsed since January 1, 1970 UTC. The result is undefined if the Unix time in milliseconds cannot be represented by an int64 (a date more than 292 million years before or after 1970). The result does not depend on the location associated with t.

âš ï¸func (Time) UnixNano 

```
func (t Time) UnixNano() int64
```

UnixNano returns t as a Unix time, the number of nanoseconds elapsed since January 1, 1970 UTC. The result is undefined if the Unix time in nanoseconds cannot be represented by an int64 (a date before the year 1678 or after 2262). Note that this means the result of calling UnixNano on the zero Time is undefined. The result does not depend on the location associated with t.



### ç»Ÿè®¡ä»£ç æ‰§è¡Œæ—¶é—´

>   ç¼–å†™ä¸€ä¸ªä»£ç æ¥ç»Ÿè®¡å‡½æ•°`test`æ‰§è¡Œçš„æ—¶é—´

```go
package main

import (
	"fmt"
	"time"
    "strconv"         //ç”¨æ¥è½¬æ¢
)
func test(){
    str := ""
    for i :=0;i < 1000; i++{
        str += "hello" + strconv.Itoa(i)
        fmt.Println(str)
    }
}
func main() {
    start := time.Now().Unix()
    test()
    end := time.Now().Unix()
    fmt.Println("æ‰§è¡Œtestæ¶ˆè€—çš„æ—¶é—´ä¸º(s)ï¼š",end - start)
}    
```

ğŸš€ ç¼–è¯‘ç»“æœå¦‚ä¸‹ï¼š![image-20221003180746809](./images/image-20221003180746809.png)



## Golangå†…ç½®å‡½æ•°

Golangåœ°å€ï¼šhttps://pkg.go.dev/builtin@go1.17.6

âš ï¸ func new 

```
func new(Type) *Type
```

The new built-in function allocates memory. The first argument is a type, not a value, and the value returned is a pointer to a newly allocated zero value of that type.

>   **`new` ä¸»è¦ç”¨æ¥åˆ†é…å†…å­˜ï¼Œä¸»è¦æ˜¯ç”¨æ¥åˆ†é…å€¼ç±»å‹,æœ¬èº«æ˜¯ä¸€ä¸ªåœ°å€ï¼Œé»˜è®¤æ˜¯å­˜æ”¾`0`è¿™ä¸ªæ•°æ®ç©ºé—´çš„åœ°å€,åœ°å€æ˜¯ç”±ç³»ç»Ÿåˆ†é…çš„**

```go
package main
import "fmt"
func main(){
	num1 := 100
	fmt.Printf("num1çš„ç±»å‹ä¸º:%T,\n num1çš„å€¼ä¸º:%v,\n num1çš„åœ°å€ä¸º:%v\n",num1,num1,&num1)
    
    var num2 *int		//æ³¨æ„ï¼šä½¿ç”¨newåˆ†é…å€¼ç±»å‹éœ€è¦æ˜¯æŒ‡é’ˆç±»å‹
    num2 = new(int)
    fmt.Printf("num2çš„ç±»å‹ä¸º:%T,\n num2çš„å€¼ä¸º:%v,\n num2çš„åœ°å€ä¸º:%v\n",num2,num2,&num2)  	
    /*intç±»å‹å€¼ä¸ºæŒ‡å‘ç©ºé—´çš„åœ°å€ æœ¬çœçš„åœ°å€ä¸ºæŒ‡é’ˆçš„åœ°å€ */
}
```

ğŸš€ ç¼–è¯‘ç»“æœå¦‚ä¸‹ï¼š

```bash
[root@VM-4-6-centos c]# go run b.go 
 num1çš„ç±»å‹ä¸º:int,
 num1çš„å€¼ä¸º:100,
 num1çš„åœ°å€ä¸º:0xc0000a6000
 num2çš„ç±»å‹ä¸º:*int,
 num2çš„å€¼ä¸º:0xc0000a6008,
 num2çš„åœ°å€ä¸º:0xc0000a0020

```



**æ€ä¹ˆå°†num2çš„å€¼å–å‡ºï¼Ÿ -- `*`å–åœ°å€çš„å€¼**

```go
fmt.Printf("num2çš„å€¼ä¸º:%v",*num2)    
//num2çš„å€¼ä¸ºï¼š0   

//ä¿®æ”¹
*num2 = 100
```

ğŸ“œ å¯¹ä¸Šé¢çš„è§£é‡Šï¼š

> **Goè¯­è¨€çš„markå’ŒnewåŒºåˆ«ï¼š**
>
> åœ¨goè¯­è¨€ä¸­ï¼Œ`make`å’Œ`new`éƒ½æ˜¯å†…å­˜çš„åˆ†é…ï¼ˆå †ä¸Šï¼‰ï¼Œä½†æ˜¯`make`åªç”¨äº`slice`ã€`map`ä»¥åŠ`channel`çš„åˆå§‹åŒ–ï¼ˆéé›¶å€¼ï¼‰ï¼›è€Œ`new`ç”¨äºç±»å‹çš„å†…å­˜åˆ†é…ï¼Œå¹¶ä¸”å†…å­˜ç½®ä¸ºé›¶ã€‚`make`è¿”å›çš„æ˜¯å¼•ç”¨ç±»å‹æœ¬èº«ï¼›è€Œnewè¿”å›çš„æ˜¯æŒ‡å‘ç±»å‹çš„æŒ‡é’ˆã€‚



## Golangé”™è¯¯å¤„ç†æœºåˆ¶

**å¤„ç†æ–¹å¼ï¼š`defer`ï¼Œ`panic`ï¼Œ`recover`**   ï¼Œ**è®©ç¨‹åºæ›´åŠ å¥å£®**

**Goä¸­å¯ä»¥æŠ›å‡ºä¸€ä¸ª`panic`çš„å¼‚å¸¸ï¼Œç„¶ååœ¨`defer`ä¸­é€šè¿‡`recover`æ•è·è¿™ä¸ªå¼‚å¸¸ï¼Œç„¶åæ­£å¸¸å¤„ç†**

ä½¿ç”¨`defer`å’Œ`recover`æ¥å¤„ç†å¼‚å¸¸ã€‚

 âš ï¸func panic 

**`panic`å†…ç½®å‡½æ•°æ¥å—ä¸€ä¸ª`interface{}`ç±»å‹çš„å€¼ä½œä¸ºå‚æ•°,å¯ä»¥æ¥æ”¶`error`ç±»å‹å˜é‡ï¼Œè¾“å‡ºé”™è¯¯ä¿¡æ¯ï¼Œå¹¶é€€å‡ºç¨‹åº**

```go
func panic(v interface{})
```

::: details  ğŸ’¡ç®€å•çš„ä¸€ä¸ªæ¡ˆä¾‹å¦‚ä¸‹ï¼š
**ç¨‹åºé‡åˆ°`panic`å‡½æ•°å°±ä¼šç»ˆæ­¢æ‰§è¡Œè€Œä¸”æŠ›å‡ºå¼‚å¸¸**

```go
/*
 * @Description:å¼‚å¸¸å¤„ç†
 * @Author: xiongxinwei 3293172751nss@gmail.com
 * @Date: 2022-10-04 21:37:41
 * @LastEditTime: 2022-10-24 16:24:23
 * @FilePath: \code\go-super\12-main.go
 * @Github_Address: https://github.com/3293172751/cs-awesome-Block_Chain
 * Copyright (c) 2022 by xiongxinwei 3293172751nss@gmail.com, All Rights Reserved. @blog: http://nsddd.top
 */
package main

import "fmt"

func fn1() {
	fmt.Println("fn1")
}

func fn2() {
	panic("fn2")
}

func main() {
	fn1()
	fn2()
	fmt.Println("end	main")
}
```

ğŸš€ ç¼–è¯‘ç»“æœå¦‚ä¸‹ï¼š

```
[Running] go run "d:\æ–‡æ¡£\æœ€è¿‘çš„\awesome-golang\docs\code\go-super\12-main.go"
fn1
panic: fn2

goroutine 1 [running]:
main.fn2(...)
	d:/æ–‡æ¡£/æœ€è¿‘çš„/awesome-golang/docs/code/go-super/12-main.go:19
main.main()
	d:/æ–‡æ¡£/æœ€è¿‘çš„/awesome-golang/docs/code/go-super/12-main.go:24 +0x66
exit status 2
```

:::



::: details è®©ç¨‹åºç»§ç»­æ‰§è¡Œä½¿ç”¨recover
**æ³¨æ„ï¼š`recover`**åªæœ‰åœ¨`defer`è°ƒç”¨çš„å‡½æ•°ä¸­æœ‰æ•ˆ

```go
/*
 * @Description:å¼‚å¸¸å¤„ç†
 * @Author: xiongxinwei 3293172751nss@gmail.com
 * @Date: 2022-10-04 21:37:41
 * @LastEditTime: 2022-10-24 16:29:01
 * @FilePath: \code\go-super\12-main.go
 * @Github_Address: https://github.com/3293172751/cs-awesome-Block_Chain
 * Copyright (c) 2022 by xiongxinwei 3293172751nss@gmail.com, All Rights Reserved. @blog: http://nsddd.top
 */
package main

import "fmt"

func fn1() {
	fmt.Println("fn1")
}

func fn2() {
	defer func() {
		if err := recover(); err != nil {
			fmt.Println("æœ‰é”™è¯¯ err", err)
		}
	}()
	panic("fn2")
}

func main() {
	fn1()
	fn2()
	fmt.Println("end	main")
}
```

ğŸš€ ç¼–è¯‘ç»“æœå¦‚ä¸‹ï¼š

```bash
[Running] go run "d:\æ–‡æ¡£\æœ€è¿‘çš„\awesome-golang\docs\code\go-super\12-main.go"
fn1
æœ‰é”™è¯¯ err fn2
end	main
```

:::



::: tip å¼‚å¸¸æœ‰ä»€ä¹ˆç”¨ï¼Ÿ
æ¯”å¦‚ä¸€ä¸ªå¾ˆæ˜æ˜¾çš„ï¼šç¼–è¯‘å‹è¯­è¨€çš„é”™è¯¯ï¼ˆè§£é‡Šå‹è¯­è¨€å¯èƒ½å…è®¸ï¼‰  10/0

ğŸ’¡ç®€å•çš„ä¸€ä¸ª **æŠ¥é”™** æ¡ˆä¾‹å¦‚ä¸‹ï¼š

```go
package main

import "fmt"

func fn1(a int, b int) int {
	return a / b
}

func main() {
	fmt.Println(fn1(10, 0))
}

```



ğŸ’¡ç®€å•çš„ä¸€ä¸ªçš„ä½¿ç”¨å¼‚å¸¸å¤„ç†æ¡ˆä¾‹å¦‚ä¸‹ï¼š

```go
package main

import "fmt"

func fn1(a int, b int) int {
	defer func() {
		if err := recover(); err != nil {
			fmt.Println("æœ‰é”™è¯¯ err", err)
		}
	}()
	return a / b
}

func main() {
	fmt.Println(fn1(10, 0))
	fmt.Println("end	main")
}
```

ğŸš€ ç¼–è¯‘ç»“æœå¦‚ä¸‹ï¼š

```bash
[Running] go run "d:\æ–‡æ¡£\æœ€è¿‘çš„\awesome-golang\docs\code\go-super\13-main.go"
æœ‰é”™è¯¯ err runtime error: integer divide by zero
0
end	main
```

:::



> **The panic built-in function stops normal execution of the current goroutine.** When a function F calls panic, normal execution of F stops immediately. Any functions whose execution was deferred by F are run in the usual way, and then F returns to its caller. To the caller G, the invocation of F then behaves like a call to panic, terminating G's execution and running any deferred functions. This continues until all functions in the executing goroutine have stopped, in reverse order. At that point, the program is terminated with a non-zero exit code. This termination sequence is called panicking and can be controlled by the built-in function recover.

```go
defer func(){
	/*åŒ¿åå‡½æ•°*/ 
	err := recover()   //å†…ç½®å‡½æ•°ï¼Œå¯ä»¥æ•è·åˆ°å¼‚å¸¸
    if err != ni{//è¯´æ˜æ•è·åˆ°å¼‚å¸¸
        fmt.Println("err=",err) 
        fmt.Println("å‘é€é‚®ä»¶ç»™3293172751@qq,com")
    }         		//è¿™é‡Œå¯ä»¥å°†é”™è¯¯å‘é€ç»™ç®¡ç†å‘˜
}()     	  		//åŒ¿åå‡½æ•°çš„è°ƒç”¨
num := 10/0         //é”™è¯¯ä»£ç 
```



### è‡ªå®šä¹‰é”™è¯¯

```
errors.New("é”™è¯¯ç±»å‹")    //è¿”å›ä¸€ä¸ªerrorç±»å‹çš„å€¼ï¼Œè¡¨ç¤ºä¸€ä¸ªé”™è¯¯
```

>   å‡½æ•°è¯»å–`init.config`ä¿¡æ¯ï¼Œå¦‚æœæ–‡ä»¶åä¼ å…¥ä¸æ­£ç¡®ï¼Œè¿”å›ä¸€ä¸ªè‡ªå®šä¹‰é”™è¯¯

```go
/*
 * @Description: è‡ªå®šä¹‰é”™è¯¯
 * @Author: xiongxinwei 3293172751nss@gmail.com
 * @Date: 2022-10-04 21:37:41
 * @LastEditTime: 2022-10-24 16:45:55
 * @FilePath: \code\go-super\14-main.go
 * @Github_Address: https://github.com/3293172751/cs-awesome-Block_Chain
 * Copyright (c) 2022 by xiongxinwei 3293172751nss@gmail.com, All Rights Reserved. @blog: http://nsddd.top
 */
package main

import (
	"errors"
	"fmt"
)

func readConf(name string) (err error) {
	if name == "config.ini" {
		//"è¯»å–"
		return nil
	} else {
		//è¿”å›ä¸€ä¸ªè‡ªå®šä¹‰é”™è¯¯
		return errors.New("è¯»å–æ–‡ä»¶é”™è¯¯")
	}
	fmt.Println(name)
	return
}

func test02() {
	err := readConf("config.ini")
	if err != nil {
		//å¦‚æœå‘ç”Ÿé”™è¯¯ï¼Œå°±è¾“å‡ºé”™è¯¯å¹¶ä¸”ç»ˆæ­¢ç¨‹åºï¼Œæ­¤æ—¶ä½¿ç”¨panic
		panic(err)
	}
	//ä¸å‘ç”Ÿé”™è¯¯
	fmt.Println("test02()ç»§ç»­æ‰§è¡Œ...")
}
func mian() {
	//æµ‹è¯•
	test02()
}
```



## END é“¾æ¥

<ul><li><div><a href = '5.md' style='float:left'>â¬†ï¸ä¸Šä¸€èŠ‚ğŸ”—</a><a href = '7.md' style='float: right'>â¬‡ï¸ä¸‹ä¸€èŠ‚ğŸ”—</a></div></li></ul>

+ [â“‚ï¸å›åˆ°ç›®å½•ğŸ ](../README.md)

+ [**ğŸ«µå‚ä¸è´¡çŒ®ğŸ’â¤ï¸â€ğŸ”¥ğŸ’–**](https://nsddd.top/archives/contributors))

+ âœ´ï¸ç‰ˆæƒå£°æ˜ &copy; :æœ¬ä¹¦æ‰€æœ‰å†…å®¹éµå¾ª[CC-BY-SA 3.0åè®®ï¼ˆç½²å-ç›¸åŒæ–¹å¼å…±äº«ï¼‰&copy;](http://zh.wikipedia.org/wiki/Wikipedia:CC-by-sa-3.0åè®®æ–‡æœ¬) 

