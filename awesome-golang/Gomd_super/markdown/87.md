# 1. å‘é‚®ä»¶

### 1.1.1. ä»‹ç»

ç”µå­é‚®ä»¶çš„åº”ç”¨éå¸¸å¹¿æ³›ï¼Œå¸¸è§çš„å¦‚åœ¨æŸç½‘ç«™æ³¨å†Œäº†ä¸€ä¸ªè´¦æˆ·ï¼Œè‡ªåŠ¨å‘é€ä¸€å°æ¿€æ´»é‚®ä»¶ï¼Œé€šè¿‡é‚®ä»¶æ‰¾å›å¯†ç ï¼Œè‡ªåŠ¨æ‰¹é‡å‘é€æ´»åŠ¨ä¿¡æ¯ç­‰ã€‚å¾ˆæ˜¾ç„¶è¿™äº›åº”ç”¨ä¸å¯èƒ½å’Œæˆ‘ä»¬è‡ªå·±å¹³æ—¶å‘é‚®ä»¶ä¸€æ ·ï¼Œå…ˆæ‰“å¼€æµè§ˆå™¨ï¼Œç™»å½•é‚®ç®±ï¼Œåˆ›å»ºé‚®ä»¶å†å‘é€ã€‚æœ¬æ–‡å°†ç®€å•ä»‹ç»å¦‚ä½•é€šè¿‡goä»£ç æ¥åˆ›å»ºç”µå­é‚®ä»¶ï¼Œå¹¶è¿æ¥é‚®ä»¶æœåŠ¡å™¨å‘é€é‚®ä»¶ã€‚

ç”µå­é‚®ä»¶åœ¨ç½‘ç»œä¸­ä¼ è¾“å’Œç½‘é¡µä¸€æ ·éœ€è¦éµä»ç‰¹å®šçš„åè®®ï¼Œå¸¸ç”¨çš„ç”µå­é‚®ä»¶åè®®åŒ…æ‹¬ SMTPï¼ŒPOP3ï¼ŒIMAPã€‚å…¶ä¸­é‚®ä»¶çš„åˆ›å»ºå’Œå‘é€åªéœ€è¦ç”¨åˆ° SMTPåè®®ï¼Œæ‰€ä»¥æœ¬æ–‡ä¹Ÿåªä¼šæ¶‰åŠåˆ°SMTPåè®®ã€‚SMTP æ˜¯ Simple Mail Transfer Protocol çš„ç®€ç§°ï¼Œå³ç®€å•é‚®ä»¶ä¼ è¾“åè®®ã€‚

### 1.1.2. ç‰¹å¾

- å‘ä»¶äººï¼Œæ”¶ä»¶äººï¼Œå¯†ä»¶æŠ„é€å’ŒæŠ„é€å­—æ®µ
- æ–‡å­—å’ŒHTMLé‚®ä»¶æ­£æ–‡
- é™„ä»¶
- é˜…è¯»æ”¶æ®
- è‡ªå®šä¹‰æ ‡é¢˜

### 1.1.3. å®‰è£…

```
    go get github.com/jordan-wright/email
```

*æ³¨æ„ï¼šæ­¤åº“çš„ç‰ˆæœ¬éœ€è¦Go v1.5æˆ–æ›´é«˜ç‰ˆæœ¬ã€‚* *å¦‚æœéœ€è¦ä¸ä»¥å‰çš„Goç‰ˆæœ¬å…¼å®¹ï¼Œåˆ™å¯ä»¥åœ¨gopkg.in/jordan-wright/email.v1ä¸­ä½¿ç”¨ä»¥å‰çš„è½¯ä»¶åŒ…ã€‚*

æˆ‘ä»¬éœ€è¦é¢å¤–ä¸€äº›å·¥ä½œã€‚æˆ‘ä»¬çŸ¥é“é‚®ç®±ä½¿ç”¨SMTP/POP3/IMAPç­‰åè®®ä»é‚®ä»¶æœåŠ¡å™¨ä¸Šæ‹‰å–é‚®ä»¶ã€‚é‚®ä»¶å¹¶ä¸æ˜¯ç›´æ¥å‘é€åˆ°é‚®ç®±çš„ï¼Œè€Œæ˜¯é‚®ç®±è¯·æ±‚æ‹‰å–çš„ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬éœ€è¦é…ç½®SMTP/POP3/IMAPæœåŠ¡å™¨ã€‚ä»å¤´æ­å»ºå›ºç„¶å¯è¡Œï¼Œè€Œä¸”ä¹Ÿæœ‰ç°æˆçš„å¼€æºåº“ï¼Œä½†æ˜¯æ¯”è¾ƒéº»çƒ¦ã€‚ç°åœ¨ä¸€èˆ¬çš„é‚®ç®±æœåŠ¡å•†éƒ½å¼€æ”¾äº†SMTP/POP3/IMAPæœåŠ¡å™¨ã€‚æˆ‘è¿™é‡Œæ‹¿ QQ é‚®ç®±æ¥ä¸¾ä¾‹ã€‚

- é¦–å…ˆæˆ‘ä»¬ç™»å½•QQé‚®ç®±ï¼Œè®¾ç½®->è´¦æˆ· æ‰¾åˆ°å›¾ç‰‡çš„ä½ç½®å¼€å¯`POP3/SMTP/IMAP`å¹¶ä¸”æŒ‰ç…§è¦æ±‚ç”Ÿäº§æˆæƒç 

![img](https://www.topgoer.com/static/xiangmu/image_3.png)

### 1.1.4. ä»£ç 

1.å®ç°ç®€å•çš„é‚®ä»¶å‘é€ï¼š

```go
package main

import (
    "log"
    "net/smtp"

    "github.com/jordan-wright/email"
)

func main() {
    e := email.NewEmail()
    //è®¾ç½®å‘é€æ–¹çš„é‚®ç®±
    e.From = "dj <XXX@qq.com>"
    // è®¾ç½®æ¥æ”¶æ–¹çš„é‚®ç®±
    e.To = []string{"XXX@qq.com"}
    //è®¾ç½®ä¸»é¢˜
    e.Subject = "è¿™æ˜¯ä¸»é¢˜"
    //è®¾ç½®æ–‡ä»¶å‘é€çš„å†…å®¹
    e.Text = []byte("www.topgoer.comæ˜¯ä¸ªä¸é”™çš„goè¯­è¨€ä¸­æ–‡æ–‡æ¡£")
    //è®¾ç½®æœåŠ¡å™¨ç›¸å…³çš„é…ç½®
    err := e.Send("smtp.qq.com:25", smtp.PlainAuth("", "ä½ çš„é‚®ç®±è´¦å·", "è¿™å—æ˜¯ä½ çš„æˆæƒç ", "smtp.qq.com"))
    if err != nil {
        log.Fatal(err)
    }
}
```

è¿è¡Œç¨‹åºå°±ä¼šç»™ä½ è®¾ç½®çš„é‚®ç®±å‘é€ä¸€ä¸ªé‚®ä»¶ï¼Œæœ‰çš„é‚®ç®±ä¼šæŠŠé‚®ä»¶å½“æˆåƒåœ¾é‚®ä»¶å‘åˆ°åƒåœ¾ç®±é‡Œé¢ï¼Œå¦‚æœæ‰¾ä¸åˆ°é‚®ä»¶å¯ä»¥å»åƒåœ¾ç®±çœ‹ä¸‹ã€‚

2.å®ç°æŠ„é€åŠŸèƒ½

è¯¥æ’ä»¶æœ‰ä¸¤ç§æŠ„é€æ¨¡å¼å³ CCï¼ˆCarbon Copyï¼‰å’Œ BCC ï¼ˆBlind Carbon Copyï¼‰

æŠ„é€åŠŸèƒ½åªéœ€è¦æ·»åŠ ä¸¤ä¸ªå‚æ•°å°±å¥½äº†

```
    e.Cc = []string{"XXX@qq.com",XXX@qq.com}
    e.Bcc = []string{"XXX@qq.com"}
```

å…¨éƒ¨ä»£ç ï¼š

```go
package main

import (
    "log"
    "net/smtp"

    "github.com/jordan-wright/email"
)

func main() {
    e := email.NewEmail()
    //è®¾ç½®å‘é€æ–¹çš„é‚®ç®±
    e.From = "dj <XXX@qq.com>"
    // è®¾ç½®æ¥æ”¶æ–¹çš„é‚®ç®±
    e.To = []string{"XXX@qq.com"}
    //è®¾ç½®æŠ„é€å¦‚æœæŠ„é€å¤šäººé€—å·éš”å¼€
    e.Cc = []string{"XXX@qq.com",XXX@qq.com}
    //è®¾ç½®ç§˜å¯†æŠ„é€
    e.Bcc = []string{"XXX@qq.com"}
    //è®¾ç½®ä¸»é¢˜
    e.Subject = "è¿™æ˜¯ä¸»é¢˜"
    //è®¾ç½®æ–‡ä»¶å‘é€çš„å†…å®¹
    e.Text = []byte("www.topgoer.comæ˜¯ä¸ªä¸é”™çš„goè¯­è¨€ä¸­æ–‡æ–‡æ¡£")
    //è®¾ç½®æœåŠ¡å™¨ç›¸å…³çš„é…ç½®
    err := e.Send("smtp.qq.com:25", smtp.PlainAuth("", "ä½ çš„é‚®ç®±è´¦å·", "è¿™å—æ˜¯ä½ çš„æˆæƒç ", "smtp.qq.com"))
    if err != nil {
        log.Fatal(err)
    }
}
```

3.å‘é€htmlä»£ç çš„é‚®ä»¶

ä»£ç å®ç°ï¼š

```go
package main

import (
    "log"
    "net/smtp"

    "github.com/jordan-wright/email"
)

func main() {
    e := email.NewEmail()
    //è®¾ç½®å‘é€æ–¹çš„é‚®ç®±
    e.From = "dj <XXX@qq.com>"
    // è®¾ç½®æ¥æ”¶æ–¹çš„é‚®ç®±
    e.To = []string{"XXX@qq.com"}
    //è®¾ç½®ä¸»é¢˜
    e.Subject = "è¿™æ˜¯ä¸»é¢˜"
    //è®¾ç½®æ–‡ä»¶å‘é€çš„å†…å®¹
    e.HTML = []byte(`
    <h1><a href="http://www.topgoer.com/">goè¯­è¨€ä¸­æ–‡ç½‘ç«™</a></h1>    
    `)
    //è®¾ç½®æœåŠ¡å™¨ç›¸å…³çš„é…ç½®
    err := e.Send("smtp.qq.com:25", smtp.PlainAuth("", "ä½ çš„é‚®ç®±è´¦å·", "è¿™å—æ˜¯ä½ çš„æˆæƒç ", "smtp.qq.com"))
    if err != nil {
        log.Fatal(err)
    }
}
```

4.å®ç°é‚®ä»¶é™„ä»¶çš„å‘é€

ç›´æ¥è°ƒç”¨`AttachFile`å³å¯

```go
package main

import (
    "log"
    "net/smtp"

    "github.com/jordan-wright/email"
)

func main() {
    e := email.NewEmail()
    //è®¾ç½®å‘é€æ–¹çš„é‚®ç®±
    e.From = "dj <XXX@qq.com>"
    // è®¾ç½®æ¥æ”¶æ–¹çš„é‚®ç®±
    e.To = []string{"XXX@qq.com"}
    //è®¾ç½®ä¸»é¢˜
    e.Subject = "è¿™æ˜¯ä¸»é¢˜"
    //è®¾ç½®æ–‡ä»¶å‘é€çš„å†…å®¹
    e.HTML = []byte(`
    <h1><a href="http://www.topgoer.com/">goè¯­è¨€ä¸­æ–‡ç½‘ç«™</a></h1>    
    `)
    //è¿™å—æ˜¯è®¾ç½®é™„ä»¶
    e.AttachFile("./test.txt")
    //è®¾ç½®æœåŠ¡å™¨ç›¸å…³çš„é…ç½®
    err := e.Send("smtp.qq.com:25", smtp.PlainAuth("", "ä½ çš„é‚®ç®±è´¦å·", "è¿™å—æ˜¯ä½ çš„æˆæƒç ", "smtp.qq.com"))
    if err != nil {
        log.Fatal(err)
    }
}
```

5.è¿æ¥æ± 

å®é™…ä¸Šæ¯æ¬¡è°ƒç”¨Sendæ—¶éƒ½ä¼šå’Œ SMTP æœåŠ¡å™¨å»ºç«‹ä¸€æ¬¡è¿æ¥ï¼Œå¦‚æœå‘é€é‚®ä»¶å¾ˆå¤šå¾ˆé¢‘ç¹çš„è¯å¯èƒ½ä¼šæœ‰æ€§èƒ½é—®é¢˜ã€‚emailæä¾›äº†è¿æ¥æ± ï¼Œå¯ä»¥å¤ç”¨ç½‘ç»œè¿æ¥ï¼š

```go
package main

import (
    "fmt"
    "log"
    "net/smtp"
    "os"
    "sync"
    "time"

    "github.com/jordan-wright/email"
)

func main() {
    ch := make(chan *email.Email, 10)
    p, err := email.NewPool(
        "smtp.qq.com:25",
        4,
        smtp.PlainAuth("", "XXX@qq.com", "ä½ çš„æˆæƒç ", "smtp.qq.com"),
    )

    if err != nil {
        log.Fatal("failed to create pool:", err)
    }

    var wg sync.WaitGroup
    wg.Add(4)
    for i := 0; i < 4; i++ {
        go func() {
            defer wg.Done()
            for e := range ch {
                err := p.Send(e, 10*time.Second)
                if err != nil {
                    fmt.Fprintf(os.Stderr, "email:%v sent error:%v\n", e, err)
                }
            }
        }()
    }

    for i := 0; i < 10; i++ {
        e := email.NewEmail()
        e.From = "dj <XXX@qq.com>"
        e.To = []string{"XXX@qq.com"}
        e.Subject = "Awesome web"
        e.Text = []byte(fmt.Sprintf("Awesome Web %d", i+1))
        ch <- e
    }

    close(ch)
    wg.Wait()
}
```

ä¸Šé¢ç¨‹åºä¸­ï¼Œæˆ‘ä»¬åˆ›å»º 4 goroutine å…±ç”¨ä¸€ä¸ªè¿æ¥æ± å‘é€é‚®ä»¶ï¼Œå‘é€ 10 å°é‚®ä»¶åç¨‹åºé€€å‡ºã€‚ä¸ºäº†ç­‰é‚®ä»¶éƒ½å‘é€å®Œæˆæˆ–å¤±è´¥ï¼Œç¨‹åºæ‰é€€å‡ºï¼Œæˆ‘ä»¬ä½¿ç”¨äº†sync.WaitGroupã€‚ç”±äºä½¿ç”¨äº† goroutineï¼Œé‚®ä»¶é¡ºåºä¸èƒ½ä¿è¯ã€‚

å‚è€ƒï¼šhttps://github.com/darjun/go-daily-lib

## END é“¾æ¥
<ul><li><div><a href = '86.md' style='float:left'>â¬†ï¸ä¸Šä¸€èŠ‚ğŸ”—</a><a href = '88.md' style='float: right'>â¬‡ï¸ä¸‹ä¸€èŠ‚ğŸ”—</a></div></li></ul>

+ [â“‚ï¸å›åˆ°é¦–é¡µğŸ ](../README.md)

+ [**ğŸ«µå‚ä¸è´¡çŒ®ğŸ’â¤ï¸â€ğŸ”¥ğŸ’–**](https://nsddd.top/archives/contributors))

+ âœ´ï¸ç‰ˆæƒå£°æ˜ &copy; :æœ¬ä¹¦æ‰€æœ‰å†…å®¹éµå¾ª[CC-BY-SA 3.0åè®®ï¼ˆç½²å-ç›¸åŒæ–¹å¼å…±äº«ï¼‰&copy;](http://zh.wikipedia.org/wiki/Wikipedia:CC-by-sa-3.0åè®®æ–‡æœ¬) 

