# 1. Topicæ¨¡å¼ï¼ˆè¯é¢˜æ¨¡å¼ï¼Œä¸€ä¸ªæ¶ˆæ¯è¢«å¤šä¸ªæ¶ˆè´¹è€…è·å–ï¼Œæ¶ˆæ¯çš„ç›®æ ‡queueå¯ç”¨BindingKeyä»¥é€šé…ç¬¦ï¼Œï¼ˆ#ï¼šä¸€ä¸ªæˆ–å¤šä¸ªè¯ï¼Œ*ï¼šä¸€ä¸ªè¯ï¼‰çš„æ–¹å¼æŒ‡å®š

![img](https://s2.loli.net/2022/04/10/qHPNTDr6FUklQhi.jpg)

- æ˜Ÿå·äº•å·ä»£è¡¨é€šé…ç¬¦
- æ˜Ÿå·ä»£è¡¨å¤šä¸ªå•è¯,äº•å·ä»£è¡¨ä¸€ä¸ªå•è¯
- è·¯ç”±åŠŸèƒ½æ·»åŠ æ¨¡ç³ŠåŒ¹é…
- æ¶ˆæ¯äº§ç”Ÿè€…äº§ç”Ÿæ¶ˆæ¯,æŠŠæ¶ˆæ¯äº¤ç»™äº¤æ¢æœº
- äº¤æ¢æœºæ ¹æ®keyçš„è§„åˆ™æ¨¡ç³ŠåŒ¹é…åˆ°å¯¹åº”çš„é˜Ÿåˆ—,ç”±é˜Ÿåˆ—çš„ç›‘å¬æ¶ˆè´¹è€…æ¥æ”¶æ¶ˆæ¯æ¶ˆè´¹

ç›®å½•ç»“æ„

![img](https://s2.loli.net/2022/04/10/bTEpswgJ5KqCetM.png)

kuteng-RabbitMQ

-RabbitMQ

--rabitmq.go //è¿™ä¸ªæ˜¯RabbitMQçš„å°è£…

-publish

--mainpublish.go //Publish å…ˆå¯åŠ¨

-recieve1

--mainrecieve.go

-recieve2

--mainrecieve.go

rabitmq.goä»£ç 

```go
package RabbitMQ

import (
    "fmt"
    "log"

    "github.com/streadway/amqp"
)

//è¿æ¥ä¿¡æ¯
const MQURL = "amqp://kuteng:kuteng@127.0.0.1:5672/kuteng"

//rabbitMQç»“æ„ä½“
type RabbitMQ struct {
    conn    *amqp.Connection
    channel *amqp.Channel
    //é˜Ÿåˆ—åç§°
    QueueName string
    //äº¤æ¢æœºåç§°
    Exchange string
    //bind Key åç§°
    Key string
    //è¿æ¥ä¿¡æ¯
    Mqurl string
}

//åˆ›å»ºç»“æ„ä½“å®ä¾‹
func NewRabbitMQ(queueName string, exchange string, key string) *RabbitMQ {
    return &RabbitMQ{QueueName: queueName, Exchange: exchange, Key: key, Mqurl: MQURL}
}

//æ–­å¼€channel å’Œ connection
func (r *RabbitMQ) Destory() {
    r.channel.Close()
    r.conn.Close()
}

//é”™è¯¯å¤„ç†å‡½æ•°
func (r *RabbitMQ) failOnErr(err error, message string) {
    if err != nil {
        log.Fatalf("%s:%s", message, err)
        panic(fmt.Sprintf("%s:%s", message, err))
    }
}

//è¯é¢˜æ¨¡å¼
//åˆ›å»ºRabbitMQå®ä¾‹
func NewRabbitMQTopic(exchangeName string, routingKey string) *RabbitMQ {
    //åˆ›å»ºRabbitMQå®ä¾‹
    rabbitmq := NewRabbitMQ("", exchangeName, routingKey)
    var err error
    //è·å–connection
    rabbitmq.conn, err = amqp.Dial(rabbitmq.Mqurl)
    rabbitmq.failOnErr(err, "failed to connect rabbitmq!")
    //è·å–channel
    rabbitmq.channel, err = rabbitmq.conn.Channel()
    rabbitmq.failOnErr(err, "failed to open a channel")
    return rabbitmq
}

//è¯é¢˜æ¨¡å¼å‘é€æ¶ˆæ¯
func (r *RabbitMQ) PublishTopic(message string) {
    //1.å°è¯•åˆ›å»ºäº¤æ¢æœº
    err := r.channel.ExchangeDeclare(
        r.Exchange,
        //è¦æ”¹æˆtopic
        "topic",
        true,
        false,
        false,
        false,
        nil,
    )

    r.failOnErr(err, "Failed to declare an excha"+
        "nge")

    //2.å‘é€æ¶ˆæ¯
    err = r.channel.Publish(
        r.Exchange,
        //è¦è®¾ç½®
        r.Key,
        false,
        false,
        amqp.Publishing{
            ContentType: "text/plain",
            Body:        []byte(message),
        })
}

//è¯é¢˜æ¨¡å¼æ¥å—æ¶ˆæ¯
//è¦æ³¨æ„key,è§„åˆ™
//å…¶ä¸­â€œ*â€ç”¨äºåŒ¹é…ä¸€ä¸ªå•è¯ï¼Œâ€œ#â€ç”¨äºåŒ¹é…å¤šä¸ªå•è¯ï¼ˆå¯ä»¥æ˜¯é›¶ä¸ªï¼‰
//åŒ¹é… kuteng.* è¡¨ç¤ºåŒ¹é… kuteng.hello, kuteng.hello.oneéœ€è¦ç”¨kuteng.#æ‰èƒ½åŒ¹é…åˆ°
func (r *RabbitMQ) RecieveTopic() {
    //1.è¯•æ¢æ€§åˆ›å»ºäº¤æ¢æœº
    err := r.channel.ExchangeDeclare(
        r.Exchange,
        //äº¤æ¢æœºç±»å‹
        "topic",
        true,
        false,
        false,
        false,
        nil,
    )
    r.failOnErr(err, "Failed to declare an exch"+
        "ange")
    //2.è¯•æ¢æ€§åˆ›å»ºé˜Ÿåˆ—ï¼Œè¿™é‡Œæ³¨æ„é˜Ÿåˆ—åç§°ä¸è¦å†™
    q, err := r.channel.QueueDeclare(
        "", //éšæœºç”Ÿäº§é˜Ÿåˆ—åç§°
        false,
        false,
        true,
        false,
        nil,
    )
    r.failOnErr(err, "Failed to declare a queue")

    //ç»‘å®šé˜Ÿåˆ—åˆ° exchange ä¸­
    err = r.channel.QueueBind(
        q.Name,
        //åœ¨pub/subæ¨¡å¼ä¸‹ï¼Œè¿™é‡Œçš„keyè¦ä¸ºç©º
        r.Key,
        r.Exchange,
        false,
        nil)

    //æ¶ˆè´¹æ¶ˆæ¯
    messges, err := r.channel.Consume(
        q.Name,
        "",
        true,
        false,
        false,
        false,
        nil,
    )

    forever := make(chan bool)

    go func() {
        for d := range messges {
            log.Printf("Received a message: %s", d.Body)
        }
    }()

    fmt.Println("é€€å‡ºè¯·æŒ‰ CTRL+C\n")
    <-forever
}
```

mainpublish.goä»£ç 

```go
package main

import (
    "fmt"
    "strconv"
    "time"

    "github.com/student/kuteng-RabbitMQ/RabbitMQ"
)

func main() {
    kutengOne := RabbitMQ.NewRabbitMQTopic("exKutengTopic", "kuteng.topic.one")
    kutengTwo := RabbitMQ.NewRabbitMQTopic("exKutengTopic", "kuteng.topic.two")
    for i := 0; i <= 100; i++ {
        kutengOne.PublishTopic("Hello kuteng topic one!" + strconv.Itoa(i))
        kutengTwo.PublishTopic("Hello kuteng topic Two!" + strconv.Itoa(i))
        time.Sleep(1 * time.Second)
        fmt.Println(i)
    }

}
```

recieve1/mainrecieve.goä»£ç 

```go
package main

import "github.com/student/kuteng-RabbitMQ/RabbitMQ"

func main() {
    kutengOne := RabbitMQ.NewRabbitMQTopic("exKutengTopic", "#")
    kutengOne.RecieveTopic()
}
```

recieve2/mainrecieve.goä»£ç 

```go
package main

import "github.com/student/kuteng-RabbitMQ/RabbitMQ"

func main() {
    kutengOne := RabbitMQ.NewRabbitMQTopic("exKutengTopic", "kuteng.*.two")
    kutengOne.RecieveTopic()
}
```

## END é“¾æ¥
<ul><li><div><a href = '48.md' style='float:left'>â¬†ï¸ä¸Šä¸€èŠ‚ğŸ”—</a><a href = '50.md' style='float: right'>â¬‡ï¸ä¸‹ä¸€èŠ‚ğŸ”—</a></div></li></ul>

+ [â“‚ï¸å›åˆ°é¦–é¡µğŸ ](../README.md)

+ [**ğŸ«µå‚ä¸è´¡çŒ®ğŸ’â¤ï¸â€ğŸ”¥ğŸ’–**](https://nsddd.top/archives/contributors))

+ âœ´ï¸ç‰ˆæƒå£°æ˜ &copy; :æœ¬ä¹¦æ‰€æœ‰å†…å®¹éµå¾ª[CC-BY-SA 3.0åè®®ï¼ˆç½²å-ç›¸åŒæ–¹å¼å…±äº«ï¼‰&copy;](http://zh.wikipedia.org/wiki/Wikipedia:CC-by-sa-3.0åè®®æ–‡æœ¬) 

