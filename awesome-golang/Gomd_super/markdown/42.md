# 1. æ“ä½œKafka

### 1.1.1. sarama

Goè¯­è¨€ä¸­è¿æ¥kafkaä½¿ç”¨ç¬¬ä¸‰æ–¹åº“: github.com/Shopify/saramaã€‚

### 1.1.2. ä¸‹è½½åŠå®‰è£…

```
    go get github.com/Shopify/sarama
```

æ³¨æ„äº‹é¡¹: sarama v1.20ä¹‹åçš„ç‰ˆæœ¬åŠ å…¥äº†zstdå‹ç¼©ç®—æ³•ï¼Œéœ€è¦ç”¨åˆ°cgoï¼Œåœ¨Windowså¹³å°ç¼–è¯‘æ—¶ä¼šæç¤ºç±»ä¼¼å¦‚ä¸‹é”™è¯¯ï¼š github.com/DataDog/zstd exec: "gcc":executable file not found in %PATH% æ‰€ä»¥åœ¨Windowså¹³å°è¯·ä½¿ç”¨v1.19ç‰ˆæœ¬çš„saramaã€‚(å¦‚æœä¸ä¼šç‰ˆæœ¬æ§åˆ¶è¯·æŸ¥çœ‹åšå®¢é‡Œé¢çš„go moduleç« èŠ‚)

### 1.1.3. è¿æ¥kafkaå‘é€æ¶ˆæ¯

```go
package main

import (
    "fmt"

    "github.com/Shopify/sarama"
)

// åŸºäºsaramaç¬¬ä¸‰æ–¹åº“å¼€å‘çš„kafka client

func main() {
    config := sarama.NewConfig()
    config.Producer.RequiredAcks = sarama.WaitForAll          // å‘é€å®Œæ•°æ®éœ€è¦leaderå’Œfollowéƒ½ç¡®è®¤
    config.Producer.Partitioner = sarama.NewRandomPartitioner // æ–°é€‰å‡ºä¸€ä¸ªpartition
    config.Producer.Return.Successes = true                   // æˆåŠŸäº¤ä»˜çš„æ¶ˆæ¯å°†åœ¨success channelè¿”å›

    // æ„é€ ä¸€ä¸ªæ¶ˆæ¯
    msg := &sarama.ProducerMessage{}
    msg.Topic = "web_log"
    msg.Value = sarama.StringEncoder("this is a test log")
    // è¿æ¥kafka
    client, err := sarama.NewSyncProducer([]string{"127.0.0.1:9092"}, config)
    if err != nil {
        fmt.Println("producer closed, err:", err)
        return
    }
    defer client.Close()
    // å‘é€æ¶ˆæ¯
    pid, offset, err := client.SendMessage(msg)
    if err != nil {
        fmt.Println("send msg failed, err:", err)
        return
    }
    fmt.Printf("pid:%v offset:%v\n", pid, offset)
}
```

### 1.1.4. è¿æ¥kafkaæ¶ˆè´¹æ¶ˆæ¯

```go
package main

import (
    "fmt"

    "github.com/Shopify/sarama"
)

// kafka consumer

func main() {
    consumer, err := sarama.NewConsumer([]string{"127.0.0.1:9092"}, nil)
    if err != nil {
        fmt.Printf("fail to start consumer, err:%v\n", err)
        return
    }
    partitionList, err := consumer.Partitions("web_log") // æ ¹æ®topicå–åˆ°æ‰€æœ‰çš„åˆ†åŒº
    if err != nil {
        fmt.Printf("fail to get list of partition:err%v\n", err)
        return
    }
    fmt.Println(partitionList)
    for partition := range partitionList { // éå†æ‰€æœ‰çš„åˆ†åŒº
        // é’ˆå¯¹æ¯ä¸ªåˆ†åŒºåˆ›å»ºä¸€ä¸ªå¯¹åº”çš„åˆ†åŒºæ¶ˆè´¹è€…
        pc, err := consumer.ConsumePartition("web_log", int32(partition), sarama.OffsetNewest)
        if err != nil {
            fmt.Printf("failed to start consumer for partition %d,err:%v\n", partition, err)
            return
        }
        defer pc.AsyncClose()
        // å¼‚æ­¥ä»æ¯ä¸ªåˆ†åŒºæ¶ˆè´¹ä¿¡æ¯
        go func(sarama.PartitionConsumer) {
            for msg := range pc.Messages() {
                fmt.Printf("Partition:%d Offset:%d Key:%v Value:%v", msg.Partition, msg.Offset, msg.Key, msg.Value)
            }
        }(pc)
    }
}
```

## END é“¾æ¥
<ul><li><div><a href = '41.md' style='float:left'>â¬†ï¸ä¸Šä¸€èŠ‚ğŸ”—</a><a href = '43.md' style='float: right'>â¬‡ï¸ä¸‹ä¸€èŠ‚ğŸ”—</a></div></li></ul>

+ [â“‚ï¸å›åˆ°é¦–é¡µğŸ ](../README.md)

+ [**ğŸ«µå‚ä¸è´¡çŒ®ğŸ’â¤ï¸â€ğŸ”¥ğŸ’–**](https://nsddd.top/archives/contributors))

+ âœ´ï¸ç‰ˆæƒå£°æ˜ &copy; :æœ¬ä¹¦æ‰€æœ‰å†…å®¹éµå¾ª[CC-BY-SA 3.0åè®®ï¼ˆç½²å-ç›¸åŒæ–¹å¼å…±äº«ï¼‰&copy;](http://zh.wikipedia.org/wiki/Wikipedia:CC-by-sa-3.0åè®®æ–‡æœ¬) 

