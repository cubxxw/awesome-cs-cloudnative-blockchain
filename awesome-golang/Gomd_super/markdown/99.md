# æµ‹è¯•æŠ€å·§ï¼šç½‘ç»œæµ‹è¯•

## 1. TCP/HTTP

å‡è®¾éœ€è¦æµ‹è¯•æŸä¸ª API æ¥å£çš„ handler èƒ½å¤Ÿæ­£å¸¸å·¥ä½œï¼Œä¾‹å¦‚ helloHandler

```
func helloHandler(w http.ResponseWriter, r *http.Request) {
    w.Write([]byte("hello world"))
}
```

é‚£æˆ‘ä»¬å¯ä»¥åˆ›å»ºçœŸå®çš„ç½‘ç»œè¿æ¥è¿›è¡Œæµ‹è¯•ï¼š

```
// test code
import (
    "io/ioutil"
    "net"
    "net/http"
    "testing"
)

func handleError(t *testing.T, err error) {
    t.Helper()
    if err != nil {
        t.Fatal("failed", err)
    }
}

func TestConn(t *testing.T) {
    ln, err := net.Listen("tcp", "127.0.0.1:0")
    handleError(t, err)
    defer ln.Close()

    http.HandleFunc("/hello", helloHandler)
    go http.Serve(ln, nil)

    resp, err := http.Get("http://" + ln.Addr().String() + "/hello")
    handleError(t, err)

    defer resp.Body.Close()
    body, err := ioutil.ReadAll(resp.Body)
    handleError(t, err)

    if string(body) != "hello world" {
        t.Fatal("expected hello world, but got", string(body))
    }
}
```

- `net.Listen("tcp", "127.0.0.1:0")`ï¼šç›‘å¬ä¸€ä¸ªæœªè¢«å ç”¨çš„ç«¯å£ï¼Œå¹¶è¿”å› Listenerã€‚
- è°ƒç”¨ `http.Serve(ln, nil)` å¯åŠ¨ http æœåŠ¡ã€‚
- ä½¿ç”¨ `http.Get` å‘èµ·ä¸€ä¸ª Get è¯·æ±‚ï¼Œæ£€æŸ¥è¿”å›å€¼æ˜¯å¦æ­£ç¡®ã€‚
- å°½é‡ä¸å¯¹ `http` å’Œ `net` åº“ä½¿ç”¨ mockï¼Œè¿™æ ·å¯ä»¥è¦†ç›–è¾ƒä¸ºçœŸå®çš„åœºæ™¯ã€‚

## 2. httptest

é’ˆå¯¹ http å¼€å‘çš„åœºæ™¯ï¼Œä½¿ç”¨æ ‡å‡†åº“ `net/http/httptest` è¿›è¡Œæµ‹è¯•æ›´ä¸ºé«˜æ•ˆã€‚

ä¸Šè¿°çš„æµ‹è¯•ç”¨ä¾‹æ”¹å†™å¦‚ä¸‹ï¼š

```
// test code
import (
    "io/ioutil"
    "net/http"
    "net/http/httptest"
    "testing"
)

func TestConn(t *testing.T) {
    req := httptest.NewRequest("GET", "http://example.com/foo", nil)
    w := httptest.NewRecorder()
    helloHandler(w, req)
    bytes, _ := ioutil.ReadAll(w.Result().Body)

    if string(bytes) != "hello world" {
        t.Fatal("expected hello world, but got", string(bytes))
    }
}
```

ä½¿ç”¨ httptest æ¨¡æ‹Ÿè¯·æ±‚å¯¹è±¡(req)å’Œå“åº”å¯¹è±¡(w)ï¼Œè¾¾åˆ°äº†ç›¸åŒçš„ç›®çš„ã€‚

## END é“¾æ¥
<ul><li><div><a href = '98.md' style='float:left'>â¬†ï¸ä¸Šä¸€èŠ‚ğŸ”—</a><a href = '100.md' style='float: right'>â¬‡ï¸ä¸‹ä¸€èŠ‚ğŸ”—</a></div></li></ul>

+ [â“‚ï¸å›åˆ°é¦–é¡µğŸ ](../README.md)

+ [**ğŸ«µå‚ä¸è´¡çŒ®ğŸ’â¤ï¸â€ğŸ”¥ğŸ’–**](https://nsddd.top/archives/contributors))

+ âœ´ï¸ç‰ˆæƒå£°æ˜ &copy; :æœ¬ä¹¦æ‰€æœ‰å†…å®¹éµå¾ª[CC-BY-SA 3.0åè®®ï¼ˆç½²å-ç›¸åŒæ–¹å¼å…±äº«ï¼‰&copy;](http://zh.wikipedia.org/wiki/Wikipedia:CC-by-sa-3.0åè®®æ–‡æœ¬) 

