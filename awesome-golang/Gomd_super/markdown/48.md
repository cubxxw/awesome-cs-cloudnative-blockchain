# 1. Routingæ¨¡å¼(è·¯ç”±æ¨¡å¼ï¼Œä¸€ä¸ªæ¶ˆæ¯è¢«å¤šä¸ªæ¶ˆè´¹è€…è·å–ï¼Œå¹¶ä¸”æ¶ˆæ¯çš„ç›®æ ‡é˜Ÿåˆ—å¯è¢«ç”Ÿäº§è€…æŒ‡å®š)

![img](https://s2.loli.net/2022/04/10/nYBeCqWGEQahLv2.jpg)

- æ¶ˆæ¯ç”Ÿäº§è€…å°†æ¶ˆæ¯å‘é€ç»™äº¤æ¢æœºæŒ‰ç…§è·¯ç”±åˆ¤æ–­,è·¯ç”±æ˜¯å­—ç¬¦ä¸²(info) å½“å‰äº§ç”Ÿçš„æ¶ˆæ¯æºå¸¦è·¯ç”±å­—ç¬¦(å¯¹è±¡çš„æ–¹æ³•),äº¤æ¢æœºæ ¹æ®è·¯ç”±çš„key,åªèƒ½åŒ¹é…ä¸Šè·¯ç”±keyå¯¹åº”çš„æ¶ˆæ¯é˜Ÿåˆ—,å¯¹åº”çš„æ¶ˆè´¹è€…æ‰èƒ½æ¶ˆè´¹æ¶ˆæ¯;
- æ ¹æ®ä¸šåŠ¡åŠŸèƒ½å®šä¹‰è·¯ç”±å­—ç¬¦ä¸²
- ä»ç³»ç»Ÿçš„ä»£ç é€»è¾‘ä¸­è·å–å¯¹åº”çš„åŠŸèƒ½å­—ç¬¦ä¸²,å°†æ¶ˆæ¯ä»»åŠ¡æ‰”åˆ°å¯¹åº”çš„é˜Ÿåˆ—ä¸­ä¸šåŠ¡åœºæ™¯:error é€šçŸ¥;EXCEPTION;é”™è¯¯é€šçŸ¥çš„åŠŸèƒ½;ä¼ ç»Ÿæ„ä¹‰çš„é”™è¯¯é€šçŸ¥;å®¢æˆ·é€šçŸ¥;åˆ©ç”¨keyè·¯ç”±,å¯ä»¥å°†ç¨‹åºä¸­çš„é”™è¯¯å°è£…æˆæ¶ˆæ¯ä¼ å…¥åˆ°æ¶ˆæ¯é˜Ÿåˆ—ä¸­,å¼€å‘è€…å¯ä»¥è‡ªå®šä¹‰æ¶ˆè´¹è€…,å®æ—¶æ¥æ”¶é”™è¯¯;

ç›®å½•ç»“æ„

![img](https://s2.loli.net/2022/04/10/ksinpReM7vay6q8.png)

kuteng-RabbitMQ

-RabbitMQ

--rabitmq.go //è¿™ä¸ªæ˜¯RabbitMQçš„å°è£…

-publish

--mainpublish.go //Publish å…ˆå¯åŠ¨

-recieve1

--mainrecieve.go

-recieve2

--mainrecieve.go

rabitmq.goä»£ç 

```go
package RabbitMQ

import (
    "fmt"
    "log"

    "github.com/streadway/amqp"
)

//è¿æ¥ä¿¡æ¯
const MQURL = "amqp://kuteng:kuteng@127.0.0.1:5672/kuteng"

//rabbitMQç»“æ„ä½“
type RabbitMQ struct {
    conn    *amqp.Connection
    channel *amqp.Channel
    //é˜Ÿåˆ—åç§°
    QueueName string
    //äº¤æ¢æœºåç§°
    Exchange string
    //bind Key åç§°
    Key string
    //è¿æ¥ä¿¡æ¯
    Mqurl string
}

//åˆ›å»ºç»“æ„ä½“å®ä¾‹
func NewRabbitMQ(queueName string, exchange string, key string) *RabbitMQ {
    return &RabbitMQ{QueueName: queueName, Exchange: exchange, Key: key, Mqurl: MQURL}
}

//æ–­å¼€channel å’Œ connection
func (r *RabbitMQ) Destory() {
    r.channel.Close()
    r.conn.Close()
}

//é”™è¯¯å¤„ç†å‡½æ•°
func (r *RabbitMQ) failOnErr(err error, message string) {
    if err != nil {
        log.Fatalf("%s:%s", message, err)
        panic(fmt.Sprintf("%s:%s", message, err))
    }
}

//è·¯ç”±æ¨¡å¼
//åˆ›å»ºRabbitMQå®ä¾‹
func NewRabbitMQRouting(exchangeName string, routingKey string) *RabbitMQ {
    //åˆ›å»ºRabbitMQå®ä¾‹
    rabbitmq := NewRabbitMQ("", exchangeName, routingKey)
    var err error
    //è·å–connection
    rabbitmq.conn, err = amqp.Dial(rabbitmq.Mqurl)
    rabbitmq.failOnErr(err, "failed to connect rabbitmq!")
    //è·å–channel
    rabbitmq.channel, err = rabbitmq.conn.Channel()
    rabbitmq.failOnErr(err, "failed to open a channel")
    return rabbitmq
}

//è·¯ç”±æ¨¡å¼å‘é€æ¶ˆæ¯
func (r *RabbitMQ) PublishRouting(message string) {
    //1.å°è¯•åˆ›å»ºäº¤æ¢æœº
    err := r.channel.ExchangeDeclare(
        r.Exchange,
        //è¦æ”¹æˆdirect
        "direct",
        true,
        false,
        false,
        false,
        nil,
    )

    r.failOnErr(err, "Failed to declare an excha"+
        "nge")

    //2.å‘é€æ¶ˆæ¯
    err = r.channel.Publish(
        r.Exchange,
        //è¦è®¾ç½®
        r.Key,
        false,
        false,
        amqp.Publishing{
            ContentType: "text/plain",
            Body:        []byte(message),
        })
}

//è·¯ç”±æ¨¡å¼æ¥å—æ¶ˆæ¯
func (r *RabbitMQ) RecieveRouting() {
    //1.è¯•æ¢æ€§åˆ›å»ºäº¤æ¢æœº
    err := r.channel.ExchangeDeclare(
        r.Exchange,
        //äº¤æ¢æœºç±»å‹
        "direct",
        true,
        false,
        false,
        false,
        nil,
    )
    r.failOnErr(err, "Failed to declare an exch"+
        "ange")
    //2.è¯•æ¢æ€§åˆ›å»ºé˜Ÿåˆ—ï¼Œè¿™é‡Œæ³¨æ„é˜Ÿåˆ—åç§°ä¸è¦å†™
    q, err := r.channel.QueueDeclare(
        "", //éšæœºç”Ÿäº§é˜Ÿåˆ—åç§°
        false,
        false,
        true,
        false,
        nil,
    )
    r.failOnErr(err, "Failed to declare a queue")

    //ç»‘å®šé˜Ÿåˆ—åˆ° exchange ä¸­
    err = r.channel.QueueBind(
        q.Name,
        //éœ€è¦ç»‘å®škey
        r.Key,
        r.Exchange,
        false,
        nil)

    //æ¶ˆè´¹æ¶ˆæ¯
    messges, err := r.channel.Consume(
        q.Name,
        "",
        true,
        false,
        false,
        false,
        nil,
    )

    forever := make(chan bool)

    go func() {
        for d := range messges {
            log.Printf("Received a message: %s", d.Body)
        }
    }()

    fmt.Println("é€€å‡ºè¯·æŒ‰ CTRL+C\n")
    <-forever
}
```

mainpublish.goä»£ç 

```go
package main

import (
    "fmt"
    "strconv"
    "time"

    "github.com/student/kuteng-RabbitMQ/RabbitMQ"
)

func main() {
    kutengone := RabbitMQ.NewRabbitMQRouting("kuteng", "kuteng_one")
    kutengtwo := RabbitMQ.NewRabbitMQRouting("kuteng", "kuteng_two")
    for i := 0; i <= 100; i++ {
        kutengone.PublishRouting("Hello kuteng one!" + strconv.Itoa(i))
        kutengtwo.PublishRouting("Hello kuteng Two!" + strconv.Itoa(i))
        time.Sleep(1 * time.Second)
        fmt.Println(i)
    }

}
```

recieve1/mainrecieve.goä»£ç 

```go
package main

import "github.com/student/kuteng-RabbitMQ/RabbitMQ"

func main() {
    kutengone := RabbitMQ.NewRabbitMQRouting("kuteng", "kuteng_one")
    kutengone.RecieveRouting()
}
```

recieve2/mainrecieve.goä»£ç 

```go
package main

import "github.com/student/kuteng-RabbitMQ/RabbitMQ"

func main() {
    kutengtwo := RabbitMQ.NewRabbitMQRouting("kuteng", "kuteng_two")
    kutengtwo.RecieveRouting()
}
```

## END é“¾æ¥
<ul><li><div><a href = '47.md' style='float:left'>â¬†ï¸ä¸Šä¸€èŠ‚ğŸ”—</a><a href = '49.md' style='float: right'>â¬‡ï¸ä¸‹ä¸€èŠ‚ğŸ”—</a></div></li></ul>

+ [â“‚ï¸å›åˆ°é¦–é¡µğŸ ](../README.md)

+ [**ğŸ«µå‚ä¸è´¡çŒ®ğŸ’â¤ï¸â€ğŸ”¥ğŸ’–**](https://nsddd.top/archives/contributors))

+ âœ´ï¸ç‰ˆæƒå£°æ˜ &copy; :æœ¬ä¹¦æ‰€æœ‰å†…å®¹éµå¾ª[CC-BY-SA 3.0åè®®ï¼ˆç½²å-ç›¸åŒæ–¹å¼å…±äº«ï¼‰&copy;](http://zh.wikipedia.org/wiki/Wikipedia:CC-by-sa-3.0åè®®æ–‡æœ¬) 

