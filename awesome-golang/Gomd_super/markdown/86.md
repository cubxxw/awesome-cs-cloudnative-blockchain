# 1. éªŒè¯ç 

éªŒè¯ç å¥—ä»¶å¯å®ç°å›¾åƒå’ŒéŸ³é¢‘éªŒè¯ç çš„ç”Ÿæˆå’ŒéªŒè¯ã€‚

éªŒè¯ç è§£å†³æ–¹æ¡ˆæ˜¯å…·æœ‰å®šä¹‰é•¿åº¦çš„æ•°å­—åºåˆ—0-9ã€‚éªŒè¯ç æœ‰ä¸¤ç§è¡¨ç¤ºå½¢å¼ï¼šå›¾åƒå’ŒéŸ³é¢‘ã€‚

å›¾åƒè¡¨ç¤ºæ˜¯ç»è¿‡PNGç¼–ç çš„å›¾åƒï¼Œä¸Šé¢å°æœ‰è§£å†³æ–¹æ¡ˆï¼Œä½¿å¾—è®¡ç®—æœºéš¾ä»¥ä½¿ç”¨OCRå¯¹å…¶è¿›è¡Œæ±‚è§£ã€‚

éŸ³é¢‘è¡¨ç¤ºå½¢å¼æ˜¯WAVEç¼–ç ï¼ˆ8 kHzæ— ç¬¦å·8ä½ï¼‰å£°éŸ³ï¼Œå¸¦æœ‰è¯­éŸ³è§£å†³æ–¹æ¡ˆï¼ˆå½“å‰ä¸ºè‹±è¯­ï¼Œä¿„è¯­ï¼Œä¸­æ–‡å’Œæ—¥è¯­ï¼‰ã€‚ä¸ºäº†ä½¿è®¡ç®—æœºéš¾ä»¥è§£å†³éŸ³é¢‘éªŒè¯ç ï¼Œå‘éŸ³æ•°å­—çš„å£°éŸ³å…·æœ‰éšæœºçš„é€Ÿåº¦å’ŒéŸ³è°ƒï¼Œå¹¶ä¸”å£°éŸ³ä¸­éšæœºæ··æœ‰èƒŒæ™¯å™ªå£°ã€‚

è¯¥ç¨‹åºåŒ…ä¸éœ€è¦å¤–éƒ¨æ–‡ä»¶æˆ–åº“æ¥ç”ŸæˆéªŒè¯ç è¡¨ç¤ºå½¢å¼ã€‚å®ƒæ˜¯ç‹¬ç«‹çš„ã€‚

ä¸ºäº†ä¸€æ¬¡æ€§è·å¾—éªŒè¯ç ï¼Œè¯¥ç¨‹åºåŒ…åŒ…æ‹¬ä¸€ä¸ªå­˜å‚¨éªŒè¯ç IDï¼Œå…¶è§£å†³æ–¹æ¡ˆå’Œåˆ°æœŸæ—¶é—´çš„å†…å­˜å­˜å‚¨ã€‚åœ¨è°ƒç”¨Verifyæˆ–VerifyStringä¹‹åï¼Œç«‹å³å°†ä½¿ç”¨è¿‡çš„éªŒè¯ç ä»å­˜å‚¨ä¸­åˆ é™¤ï¼Œè€Œæœªä½¿ç”¨çš„éªŒè¯ç ï¼ˆç”¨æˆ·ä½¿ç”¨éªŒè¯ç åŠ è½½é¡µé¢ä½†æœªæäº¤è¡¨å•ï¼‰å°†åœ¨é¢„å®šä¹‰çš„åˆ°æœŸæ—¶é—´åè‡ªåŠ¨æ”¶é›†ã€‚å¼€å‘äººå‘˜è¿˜å¯ä»¥é€šè¿‡å®ç°Storeæ¥å£å¹¶å‘SetCustomStoreæ³¨å†Œå¯¹è±¡æ¥æä¾›è‡ªå®šä¹‰å­˜å‚¨ï¼ˆä¾‹å¦‚ï¼Œåœ¨æ•°æ®åº“ä¸­ä¿å­˜éªŒè¯ç IDå’Œè§£å†³æ–¹æ¡ˆï¼‰ã€‚

éªŒè¯ç æ˜¯é€šè¿‡è°ƒç”¨Newåˆ›å»ºçš„ï¼Œè¯¥å‡½æ•°è¿”å›éªŒè¯ç IDã€‚ä½†æ˜¯ï¼Œå®ƒä»¬çš„è¡¨ç¤ºæ˜¯é€šè¿‡è°ƒç”¨WriteImageæˆ–WriteAudioå‡½æ•°å³æ—¶åˆ›å»ºçš„ã€‚åˆ›å»ºçš„è¡¨ç¤ºå½¢å¼ä¸ä¼šå­˜å‚¨åœ¨ä»»ä½•åœ°æ–¹ï¼Œä½†æ˜¯éšåå¯¹å…·æœ‰ç›¸åŒIDçš„è¿™äº›å‡½æ•°çš„è°ƒç”¨å°†ç¼–å†™ç›¸åŒçš„éªŒè¯ç è§£å†³æ–¹æ¡ˆã€‚é‡æ–°åŠ è½½åŠŸèƒ½å°†ä¸ºæä¾›çš„éªŒè¯ç åˆ›å»ºä¸€ä¸ªæ–°çš„ä¸åŒè§£å†³æ–¹æ¡ˆï¼Œå¦‚æœç”¨æˆ·åœ¨ä¸é‡æ–°åŠ è½½æ•´ä¸ªé¡µé¢çš„æƒ…å†µä¸‹æ— æ³•è§£å†³æ˜¾ç¤ºçš„éªŒè¯ç ï¼Œåˆ™å…è®¸ç”¨æˆ·â€œé‡æ–°åŠ è½½â€éªŒè¯ç ã€‚éªŒè¯å’ŒVerifyStringç”¨äºéªŒè¯ç»™å®šçš„è§£å†³æ–¹æ¡ˆæ˜¯ç»™å®šçš„éªŒè¯ç IDçš„æ­£ç¡®è§£å†³æ–¹æ¡ˆã€‚

æœåŠ¡å™¨æä¾›äº†ä¸€ä¸ªhttp.Handlerï¼Œå¯ä»¥ä»URLè‡ªåŠ¨æä¾›éªŒè¯ç çš„å›¾åƒå’ŒéŸ³é¢‘è¡¨ç¤ºã€‚å®ƒä¹Ÿå¯ä»¥ç”¨æ¥é‡æ–°åŠ è½½éªŒè¯ç ã€‚æœ‰å…³è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…æœåŠ¡å™¨åŠŸèƒ½æ–‡æ¡£ï¼Œæˆ–æŸ¥çœ‹â€œ capexampleâ€å­ç›®å½•ä¸­çš„ç¤ºä¾‹ã€‚

### 1.1.1. å›¾ç‰‡å®ä¾‹

![img](https://s2.loli.net/2022/04/11/sjCnNHJ73pVwQhO.png)

### 1.1.2. æ›´å¤š

æŸ¥çœ‹å®˜ç½‘åœ°å€ï¼šhttps://github.com/dchest/captcha

### 1.1.3. å®ä¾‹

#### ä½¿ç”¨ï¼š

```
    go get github.com/dchest/captcha
```

### 1.1.4. ä»£ç 

å…·ä½“å®ä¾‹å¯ä»¥æŸ¥çœ‹capexampleç›®å½•ï¼Œæœ‰ç”Ÿæˆçš„éªŒè¯ç å›¾ç‰‡ã€‚

```go
package main

import (
    "fmt"
    "github.com/dchest/captcha"
    "io"
    "log"
    "net/http"
    "text/template"
)

var formTemplate = template.Must(template.New("example").Parse(formTemplateSrc))

func showFormHandler(w http.ResponseWriter, r *http.Request) {
    if r.URL.Path != "/" {
        http.NotFound(w, r)
        return
    }
    d := struct {
        CaptchaId string
    }{
        captcha.New(),
    }
    if err := formTemplate.Execute(w, &d); err != nil {
        http.Error(w, err.Error(), http.StatusInternalServerError)
    }
}

func processFormHandler(w http.ResponseWriter, r *http.Request) {
    w.Header().Set("Content-Type", "text/html; charset=utf-8")
    if !captcha.VerifyString(r.FormValue("captchaId"), r.FormValue("captchaSolution")) {
        io.WriteString(w, "Wrong captcha solution! No robots allowed!\n")
    } else {
        io.WriteString(w, "Great job, human! You solved the captcha.\n")
    }
    io.WriteString(w, "<br><a href='/'>Try another one</a>")
}

func main() {
    http.HandleFunc("/", showFormHandler)
    http.HandleFunc("/process", processFormHandler)
    http.Handle("/captcha/", captcha.Server(captcha.StdWidth, captcha.StdHeight))
    fmt.Println("Server is at localhost:8666")
    if err := http.ListenAndServe("localhost:8666", nil); err != nil {
        log.Fatal(err)
    }
}

const formTemplateSrc = `<!doctype html>
<head><title>Captcha Example</title></head>
<body>
<script>
function setSrcQuery(e, q) {
    var src  = e.src;
    var p = src.indexOf('?');
    if (p >= 0) {
        src = src.substr(0, p);
    }
    e.src = src + "?" + q
}
function playAudio() {
    var le = document.getElementById("lang");
    var lang = le.options[le.selectedIndex].value;
    var e = document.getElementById('audio')
    setSrcQuery(e, "lang=" + lang)
    e.style.display = 'block';
    e.autoplay = 'true';
    return false;
}
function changeLang() {
    var e = document.getElementById('audio')
    if (e.style.display == 'block') {
        playAudio();
    }
}
function reload() {
    setSrcQuery(document.getElementById('image'), "reload=" + (new Date()).getTime());
    setSrcQuery(document.getElementById('audio'), (new Date()).getTime());
    return false;
}
</script>
<select id="lang" onchange="changeLang()">
    <option value="en">English</option>
    <option value="ja">Japanese</option>
    <option value="ru">Russian</option>
    <option value="zh">Chinese</option>
</select>
<form action="/process" method=post>
<p>Type the numbers you see in the picture below:</p>
<p><img id=image src="/captcha/{{.CaptchaId}}.png" alt="Captcha image"></p>
<a href="#" onclick="reload()">Reload</a> | <a href="#" onclick="playAudio()">Play Audio</a>
<audio id=audio controls style="display:none" src="/captcha/{{.CaptchaId}}.wav" preload=none>
  You browser doesn't support audio.
  <a href="/captcha/download/{{.CaptchaId}}.wav">Download file</a> to play it in the external player.
</audio>
<input type=hidden name=captchaId value="{{.CaptchaId}}"><br>
<input name=captchaSolution>
<input type=submit value=Submit>
</form>
`
```

## END é“¾æ¥
<ul><li><div><a href = '85.md' style='float:left'>â¬†ï¸ä¸Šä¸€èŠ‚ğŸ”—</a><a href = '87.md' style='float: right'>â¬‡ï¸ä¸‹ä¸€èŠ‚ğŸ”—</a></div></li></ul>

+ [â“‚ï¸å›åˆ°é¦–é¡µğŸ ](../README.md)

+ [**ğŸ«µå‚ä¸è´¡çŒ®ğŸ’â¤ï¸â€ğŸ”¥ğŸ’–**](https://nsddd.top/archives/contributors))

+ âœ´ï¸ç‰ˆæƒå£°æ˜ &copy; :æœ¬ä¹¦æ‰€æœ‰å†…å®¹éµå¾ª[CC-BY-SA 3.0åè®®ï¼ˆç½²å-ç›¸åŒæ–¹å¼å…±äº«ï¼‰&copy;](http://zh.wikipedia.org/wiki/Wikipedia:CC-by-sa-3.0åè®®æ–‡æœ¬) 

