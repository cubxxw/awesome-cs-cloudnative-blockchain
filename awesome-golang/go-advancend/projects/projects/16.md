+ [ğŸ”¥ å¼€æºåœ°å€](https://github.com/cubxxw/iam)

# ç¬¬16èŠ‚ Gin æ¡†æ¶

<br>

<div><a href = '15.md' style='float:left'>â¬†ï¸ä¸Šä¸€èŠ‚ğŸ”—  </a><a href = '17.md' style='float: right'>  â¬‡ï¸ä¸‹ä¸€èŠ‚ğŸ”—</a></div>
<br>

> â¤ï¸ğŸ’•ğŸ’•During the winter vacation, I followed up and learned two projects: tiktok project and IAM project, and summarized and practiced the CloudNative project and Go language. I learned a lot in the process.Myblog:[http://nsddd.top](http://nsddd.top/)

---
[[TOC]]

[TOC]

## å¼€å§‹

åœ¨ Go é¡¹ç›®å¼€å‘ä¸­ï¼Œç»å¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬æ˜¯åœ¨å†™èƒ½æä¾›æŸç§åŠŸèƒ½çš„åç«¯æœåŠ¡ï¼Œè¿™äº›åŠŸèƒ½ä»¥ RPC API æ¥å£æˆ–è€… RESTful API æ¥å£çš„å½¢å¼å¯¹å¤–æä¾›ï¼Œèƒ½æä¾›è¿™ä¸¤ç§ API æ¥å£çš„æœåŠ¡ä¹Ÿç»Ÿç§°ä¸º Web æœåŠ¡ã€‚ä»Šå¤©è¿™ä¸€è®²ï¼Œæˆ‘å°±é€šè¿‡ä»‹ç» **RESTful API** é£æ ¼çš„ Web æœåŠ¡ï¼Œæ¥ç»™ä½ ä»‹ç»ä¸‹å¦‚ä½•å®ç° Web æœåŠ¡çš„æ ¸å¿ƒåŠŸèƒ½ã€‚

é‚£ä»Šå¤©æˆ‘ä»¬å°±æ¥çœ‹ä¸‹ï¼ŒWeb æœåŠ¡çš„æ ¸å¿ƒåŠŸèƒ½æœ‰å“ªäº›ï¼Œä»¥åŠå¦‚ä½•å¼€å‘è¿™äº›åŠŸèƒ½ã€‚



## Web æœåŠ¡çš„æ ¸å¿ƒåŠŸèƒ½

Web æœåŠ¡æœ‰å¾ˆå¤šåŠŸèƒ½ï¼Œä¸ºäº†ä¾¿äºä½ ç†è§£ï¼Œæˆ‘å°†è¿™äº›åŠŸèƒ½åˆ†æˆäº†åŸºç¡€åŠŸèƒ½å’Œé«˜çº§åŠŸèƒ½ä¸¤å¤§ç±»ï¼Œå¹¶æ€»ç»“åœ¨äº†ä¸‹é¢è¿™å¼ å›¾ä¸­ï¼š

![img](http://sm.nsddd.top/sm202302222250672.jpeg)

ä¸‹é¢ï¼Œæˆ‘å°±æŒ‰å›¾ä¸­çš„é¡ºåºï¼Œæ¥ä¸²è®²ä¸‹è¿™äº›åŠŸèƒ½ã€‚

è¦å®ç°ä¸€ä¸ª Web æœåŠ¡ï¼Œé¦–å…ˆæˆ‘ä»¬è¦é€‰æ‹©é€šä¿¡åè®®å’Œé€šä¿¡æ ¼å¼ã€‚åœ¨ Go é¡¹ç›®å¼€å‘ä¸­ï¼Œæœ‰ `HTTP+JSON` å’Œ `gRPC+Protobuf` ä¸¤ç§ç»„åˆå¯é€‰ã€‚å› ä¸º iam-apiserver ä¸»è¦æä¾›çš„æ˜¯ REST é£æ ¼çš„ API æ¥å£ï¼Œæ‰€ä»¥é€‰æ‹©çš„æ˜¯ `HTTP+JSON` ç»„åˆã€‚

> âš ï¸ ä¸ä¸€æ ·çš„æ˜¯ï¼šKubernetes é€‰æ‹©çš„é€šä¿¡åè®®æ˜¯ gRPCï¼Œé€šä¿¡æ ¼å¼åˆ™ä½¿ç”¨ Protocol Buffersï¼ˆç®€ç§° protobufï¼‰ã€‚
>
> è€Œ Protocol Buffers åˆ™æ˜¯ä¸€ç§è½»é‡çº§çš„æ•°æ®åºåˆ—åŒ–æ ¼å¼ï¼Œå®ƒå¯ä»¥å°†ç»“æ„åŒ–æ•°æ®åºåˆ—åŒ–ä¸ºäºŒè¿›åˆ¶æ ¼å¼ï¼ŒåŒæ—¶æä¾›æ–¹ä¾¿çš„è¯­è¨€æ— å…³æ€§ã€‚è¿™ç§æ ¼å¼ä¸ä»…å¯ä»¥ç”¨äº gRPC ä¸­çš„æ¶ˆæ¯ä¼ é€’ï¼Œä¹Ÿå¯ä»¥ç”¨äºå…¶ä»–æ•°æ®ä¼ è¾“æ ¼å¼ï¼Œä¾‹å¦‚å­˜å‚¨å’Œä¼ è¾“æ•°æ®ã€‚ä¸å…¶ä»–æ ¼å¼ç›¸æ¯”ï¼ŒProtocol Buffers å¯ä»¥ç”Ÿæˆæ›´å°ã€æ›´å¿«çš„æ•°æ®ç»“æ„ï¼ŒåŒæ—¶ä¹Ÿæ¯” JSON å’Œ XML ç­‰æ ¼å¼æ›´æ˜“äºé˜…è¯»å’Œç†è§£ã€‚

**Web æœåŠ¡æœ€æ ¸å¿ƒçš„åŠŸèƒ½æ˜¯è·¯ç”±åŒ¹é…ã€‚**è·¯ç”±åŒ¹é…å…¶å®å°±æ˜¯æ ¹æ®(HTTPæ–¹æ³•, è¯·æ±‚è·¯å¾„)åŒ¹é…åˆ°å¤„ç†è¿™ä¸ªè¯·æ±‚çš„å‡½æ•°ï¼Œæœ€ç»ˆç”±è¯¥å‡½æ•°å¤„ç†è¿™æ¬¡è¯·æ±‚ï¼Œå¹¶è¿”å›ç»“æœï¼Œè¿‡ç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š

![img](http://sm.nsddd.top/sm202302222256592.jpeg)

ä¸€æ¬¡ HTTP è¯·æ±‚ç»è¿‡è·¯ç”±åŒ¹é…ï¼Œæœ€ç»ˆå°†è¯·æ±‚äº¤ç”±`Delete(c *gin.Context)`å‡½æ•°æ¥å¤„ç†ã€‚å˜é‡cä¸­å­˜æ”¾äº†è¿™æ¬¡è¯·æ±‚çš„å‚æ•°ï¼Œåœ¨ Delete å‡½æ•°ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥è¿›è¡Œå‚æ•°è§£æã€å‚æ•°æ ¡éªŒã€é€»è¾‘å¤„ç†ï¼Œæœ€ç»ˆè¿”å›ç»“æœã€‚

å¯¹äºå¤§å‹ç³»ç»Ÿï¼Œå¯èƒ½ä¼šæœ‰å¾ˆå¤šä¸ª API æ¥å£ï¼ŒAPI æ¥å£éšç€éœ€æ±‚çš„æ›´æ–°è¿­ä»£ï¼Œå¯èƒ½ä¼šæœ‰å¤šä¸ªç‰ˆæœ¬ï¼Œä¸ºäº†ä¾¿äºç®¡ç†ï¼Œæˆ‘ä»¬éœ€è¦**å¯¹è·¯ç”±è¿›è¡Œåˆ†ç»„**ã€‚

æœ‰æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦åœ¨ä¸€ä¸ªæœåŠ¡è¿›ç¨‹ä¸­ï¼ŒåŒæ—¶å¼€å¯ HTTP æœåŠ¡çš„ 80 ç«¯å£å’Œ HTTPS çš„ 443 ç«¯å£ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥åšåˆ°ï¼š

+ å¯¹å†…çš„æœåŠ¡ï¼Œè®¿é—® 80 ç«¯å£ï¼Œç®€åŒ–æœåŠ¡è®¿é—®å¤æ‚åº¦ï¼›
+ å¯¹å¤–çš„æœåŠ¡ï¼Œè®¿é—®æ›´ä¸ºå®‰å…¨çš„ HTTPS æœåŠ¡

æ˜¾ç„¶ï¼Œæˆ‘ä»¬æ²¡å¿…è¦ä¸ºç›¸åŒåŠŸèƒ½å¯åŠ¨å¤šä¸ªæœåŠ¡è¿›ç¨‹ï¼Œæ‰€ä»¥è¿™æ—¶å€™å°±éœ€è¦ Web æœåŠ¡èƒ½å¤Ÿæ”¯æŒ**ä¸€è¿›ç¨‹å¤šæœåŠ¡**çš„åŠŸèƒ½ã€‚

æˆ‘ä»¬å¼€å‘ Web æœåŠ¡æœ€æ ¸å¿ƒçš„è¯‰æ±‚æ˜¯ï¼šè¾“å…¥ä¸€äº›å‚æ•°ï¼Œæ ¡éªŒé€šè¿‡åï¼Œè¿›è¡Œä¸šåŠ¡é€»è¾‘å¤„ç†ï¼Œç„¶åè¿”å›ç»“æœã€‚æ‰€ä»¥ Web æœåŠ¡è¿˜åº”è¯¥èƒ½å¤Ÿè¿›è¡Œ**å‚æ•°è§£æ**ã€**å‚æ•°æ ¡éªŒ**ã€**é€»è¾‘å¤„ç†**ã€**è¿”å›ç»“æœ**ã€‚è¿™äº›éƒ½æ˜¯ Web æœåŠ¡çš„ä¸šåŠ¡å¤„ç†åŠŸèƒ½ã€‚

ä¸Šé¢è¿™äº›æ˜¯ Web æœåŠ¡çš„åŸºæœ¬åŠŸèƒ½ï¼Œæ­¤å¤–ï¼Œæˆ‘ä»¬è¿˜éœ€è¦æ”¯æŒä¸€äº›é«˜çº§åŠŸèƒ½ã€‚

åœ¨è¿›è¡Œ HTTP è¯·æ±‚æ—¶ï¼Œç»å¸¸éœ€è¦é’ˆå¯¹æ¯ä¸€æ¬¡è¯·æ±‚éƒ½è®¾ç½®ä¸€äº›é€šç”¨çš„æ“ä½œï¼Œæ¯”å¦‚æ·»åŠ  Headerã€æ·»åŠ  RequestIDã€ç»Ÿè®¡è¯·æ±‚æ¬¡æ•°ç­‰ï¼Œè¿™å°±è¦æ±‚æˆ‘ä»¬çš„ Web æœåŠ¡èƒ½å¤Ÿæ”¯æŒ**ä¸­é—´ä»¶**ç‰¹æ€§ã€‚

ä¸ºäº†ä¿è¯ç³»ç»Ÿå®‰å…¨ï¼Œå¯¹äºæ¯ä¸€ä¸ªè¯·æ±‚ï¼Œæˆ‘ä»¬éƒ½éœ€è¦è¿›è¡Œ**è®¤è¯**ã€‚**Web æœåŠ¡ä¸­ï¼Œé€šå¸¸æœ‰ä¸¤ç§è®¤è¯æ–¹å¼ï¼Œä¸€ç§æ˜¯åŸºäºç”¨æˆ·åå’Œå¯†ç ï¼Œä¸€ç§æ˜¯åŸºäº Tokenã€‚** è®¤è¯é€šè¿‡ä¹‹åï¼Œå°±å¯ä»¥ç»§ç»­å¤„ç†è¯·æ±‚äº†ã€‚

ä¸ºäº†æ–¹ä¾¿å®šä½å’Œè·Ÿè¸ªæŸä¸€æ¬¡è¯·æ±‚ï¼Œéœ€è¦æ”¯æŒ **RequestID**ï¼Œå®šä½å’Œè·Ÿè¸ª RequestID ä¸»è¦æ˜¯ä¸ºäº†æ’éšœã€‚

æœ€åï¼Œå½“å‰çš„è½¯ä»¶æ¶æ„ä¸­ï¼Œå¾ˆå¤šé‡‡ç”¨äº†å‰åç«¯åˆ†ç¦»çš„æ¶æ„ã€‚åœ¨å‰åç«¯åˆ†ç¦»çš„æ¶æ„ä¸­ï¼Œå‰ç«¯è®¿é—®åœ°å€å’Œåç«¯è®¿é—®åœ°å€å¾€å¾€æ˜¯ä¸åŒçš„ï¼Œæµè§ˆå™¨ä¸ºäº†å®‰å…¨ï¼Œä¼šé’ˆå¯¹è¿™ç§æƒ…å†µè®¾ç½®è·¨åŸŸè¯·æ±‚ï¼Œæ‰€ä»¥ Web æœåŠ¡éœ€è¦èƒ½å¤Ÿå¤„ç†æµè§ˆå™¨çš„**è·¨åŸŸ**è¯·æ±‚ã€‚

åˆ°è¿™é‡Œï¼Œæˆ‘å°±æŠŠ Web æœåŠ¡çš„åŸºç¡€åŠŸèƒ½å’Œé«˜çº§åŠŸèƒ½ä¸²è®²äº†ä¸€éã€‚å½“ç„¶ï¼Œä¸Šé¢åªä»‹ç»äº† Web æœåŠ¡çš„æ ¸å¿ƒåŠŸèƒ½ï¼Œè¿˜æœ‰å¾ˆå¤šå…¶ä»–çš„åŠŸèƒ½ï¼Œä½ å¯ä»¥é€šè¿‡å­¦ä¹ [Gin çš„å®˜æ–¹æ–‡æ¡£](https://github.com/gin-gonic/gin)æ¥äº†è§£ã€‚

ä½ å¯ä»¥çœ‹åˆ°ï¼ŒWeb æœåŠ¡æœ‰å¾ˆå¤šæ ¸å¿ƒåŠŸèƒ½ï¼Œè¿™äº›åŠŸèƒ½æˆ‘ä»¬å¯ä»¥åŸºäº net/http åŒ…è‡ªå·±å°è£…ã€‚ä½†åœ¨å®é™…çš„é¡¹ç›®å¼€å‘ä¸­ï¼Œ æˆ‘ä»¬æ›´å¤šä¼šé€‰æ‹©ä½¿ç”¨åŸºäº net/http åŒ…è¿›è¡Œå°è£…çš„ä¼˜ç§€å¼€æº Web æ¡†æ¶ã€‚æœ¬å®æˆ˜é¡¹ç›®é€‰æ‹©äº† Gin æ¡†æ¶ã€‚

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä¸»è¦çœ‹ä¸‹ Gin æ¡†æ¶æ˜¯å¦‚ä½•å®ç°ä»¥ä¸Šæ ¸å¿ƒåŠŸèƒ½çš„ï¼Œè¿™äº›åŠŸèƒ½æˆ‘ä»¬åœ¨å®é™…çš„å¼€å‘ä¸­å¯ä»¥ç›´æ¥æ‹¿æ¥ä½¿ç”¨ã€‚



## ä¸ºä»€ä¹ˆé€‰æ‹© Gin æ¡†æ¶ï¼Ÿ

ä¼˜ç§€çš„ Web æ¡†æ¶æœ‰å¾ˆå¤šï¼Œæˆ‘ä»¬ä¸ºä»€ä¹ˆè¦é€‰æ‹© Gin å‘¢ï¼Ÿåœ¨å›ç­”è¿™ä¸ªé—®é¢˜ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹ä¸‹é€‰æ‹© Web æ¡†æ¶æ—¶çš„å…³æ³¨ç‚¹ã€‚

åœ¨é€‰æ‹© Web æ¡†æ¶æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥å…³æ³¨å¦‚ä¸‹å‡ ç‚¹ï¼š

+ è·¯ç”±åŠŸèƒ½ï¼›

+ æ˜¯å¦å…·å¤‡ middleware/filter èƒ½åŠ›ï¼›

+ HTTP å‚æ•°ï¼ˆpathã€queryã€formã€headerã€bodyï¼‰è§£æå’Œè¿”å›ï¼›

+ æ€§èƒ½å’Œç¨³å®šæ€§ï¼›

+ ä½¿ç”¨å¤æ‚åº¦ï¼›

+ ç¤¾åŒºæ´»è·ƒåº¦ã€‚


æŒ‰ GitHub Star æ•°æ¥æ’åï¼Œå½“å‰æ¯”è¾ƒç«çš„ Go Web æ¡†æ¶æœ‰ Ginã€Beegoã€Echoã€Revel ã€Martiniã€‚ç»è¿‡è°ƒç ”ï¼Œæˆ‘ä»ä¸­é€‰æ‹©äº† Gin æ¡†æ¶ï¼ŒåŸå› æ˜¯ Gin å…·æœ‰å¦‚ä¸‹ç‰¹æ€§ï¼š

1. è½»é‡çº§ï¼Œä»£ç è´¨é‡é«˜ï¼Œæ€§èƒ½æ¯”è¾ƒé«˜ï¼›

2. é¡¹ç›®ç›®å‰å¾ˆæ´»è·ƒï¼Œå¹¶æœ‰å¾ˆå¤šå¯ç”¨çš„ Middlewareï¼›

3. ä½œä¸ºä¸€ä¸ª Web æ¡†æ¶ï¼ŒåŠŸèƒ½é½å…¨ï¼Œä½¿ç”¨èµ·æ¥ç®€å•ã€‚

4. é‚£æ¥ä¸‹æ¥ï¼Œæˆ‘å°±å…ˆè¯¦ç»†ä»‹ç»ä¸‹ Gin æ¡†æ¶ã€‚


Ginæ˜¯ç”¨ Go è¯­è¨€ç¼–å†™çš„ Web æ¡†æ¶ï¼ŒåŠŸèƒ½å®Œå–„ï¼Œä½¿ç”¨ç®€å•ï¼Œæ€§èƒ½å¾ˆé«˜ã€‚Gin æ ¸å¿ƒçš„è·¯ç”±åŠŸèƒ½æ˜¯é€šè¿‡ä¸€ä¸ªå®šåˆ¶ç‰ˆçš„[HttpRouter](https://github.com/julienschmidt/httprouter)æ¥å®ç°çš„ï¼Œå…·æœ‰å¾ˆé«˜çš„è·¯ç”±æ€§èƒ½ã€‚

**Gin æœ‰å¾ˆå¤šåŠŸèƒ½ï¼Œè¿™é‡Œæˆ‘ç»™ä½ åˆ—å‡ºäº†å®ƒçš„ä¸€äº›æ ¸å¿ƒåŠŸèƒ½ï¼š**

1. æ”¯æŒ HTTP æ–¹æ³•ï¼šGETã€POSTã€PUTã€PATCHã€DELETEã€OPTIONSã€‚

2. æ”¯æŒä¸åŒä½ç½®çš„ HTTP å‚æ•°ï¼šè·¯å¾„å‚æ•°ï¼ˆpathï¼‰ã€æŸ¥è¯¢å­—ç¬¦ä¸²å‚æ•°ï¼ˆqueryï¼‰ã€è¡¨å•å‚æ•°ï¼ˆformï¼‰ã€HTTP å¤´å‚æ•°ï¼ˆheaderï¼‰ã€æ¶ˆæ¯ä½“å‚æ•°ï¼ˆbodyï¼‰ã€‚

3. æ”¯æŒ HTTP è·¯ç”±å’Œè·¯ç”±åˆ†ç»„ã€‚

4. æ”¯æŒ middleware å’Œè‡ªå®šä¹‰ middlewareã€‚

5. æ”¯æŒè‡ªå®šä¹‰ Logã€‚

6. æ”¯æŒ binding å’Œ validationï¼Œæ”¯æŒè‡ªå®šä¹‰ validatorã€‚å¯ä»¥ bind å¦‚ä¸‹å‚æ•°ï¼šqueryã€pathã€bodyã€headerã€formã€‚

7. æ”¯æŒé‡å®šå‘ã€‚

8. æ”¯æŒ basic auth middlewareã€‚

9. æ”¯æŒè‡ªå®šä¹‰ HTTP é…ç½®ã€‚

10. æ”¯æŒä¼˜é›…å…³é—­ã€‚

11. æ”¯æŒ HTTP2ã€‚

12. æ”¯æŒè®¾ç½®å’Œè·å– cookieã€‚



## Gin æ˜¯å¦‚ä½•æ”¯æŒ Web æœåŠ¡åŸºç¡€åŠŸèƒ½çš„ï¼Ÿ

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å…ˆé€šè¿‡ä¸€ä¸ªå…·ä½“çš„ä¾‹å­ï¼Œçœ‹ä¸‹ Gin æ˜¯å¦‚ä½•æ”¯æŒ Web æœåŠ¡åŸºç¡€åŠŸèƒ½çš„ï¼Œåé¢å†è¯¦ç»†ä»‹ç»è¿™äº›åŠŸèƒ½çš„ç”¨æ³•ã€‚

æˆ‘ä»¬åˆ›å»ºä¸€ä¸ª webfeature ç›®å½•ï¼Œç”¨æ¥å­˜æ”¾ç¤ºä¾‹ä»£ç ã€‚å› ä¸ºè¦æ¼”ç¤º HTTPS çš„ç”¨æ³•ï¼Œæ‰€ä»¥éœ€è¦åˆ›å»ºè¯ä¹¦æ–‡ä»¶ã€‚å…·ä½“å¯ä»¥åˆ†ä¸ºä¸¤æ­¥ã€‚

ç¬¬ä¸€æ­¥ï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤åˆ›å»ºè¯ä¹¦ï¼š

```javascript
cat << 'EOF' > ca.pem
-----BEGIN CERTIFICATE-----
MIICSjCCAbOgAwIBAgIJAJHGGR4dGioHMA0GCSqGSIb3DQEBCwUAMFYxCzAJBgNV
BAYTAkFVMRMwEQYDVQQIEwpTb21lLVN0YXRlMSEwHwYDVQQKExhJbnRlcm5ldCBX
aWRnaXRzIFB0eSBMdGQxDzANBgNVBAMTBnRlc3RjYTAeFw0xNDExMTEyMjMxMjla
Fw0yNDExMDgyMjMxMjlaMFYxCzAJBgNVBAYTAkFVMRMwEQYDVQQIEwpTb21lLVN0
YXRlMSEwHwYDVQQKExhJbnRlcm5ldCBXaWRnaXRzIFB0eSBMdGQxDzANBgNVBAMT
BnRlc3RjYTCBnzANBgkqhkiG9w0BAQEFAAOBjQAwgYkCgYEAwEDfBV5MYdlHVHJ7
+L4nxrZy7mBfAVXpOc5vMYztssUI7mL2/iYujiIXM+weZYNTEpLdjyJdu7R5gGUu
g1jSVK/EPHfc74O7AyZU34PNIP4Sh33N+/A5YexrNgJlPY+E3GdVYi4ldWJjgkAd
Qah2PH5ACLrIIC6tRka9hcaBlIECAwEAAaMgMB4wDAYDVR0TBAUwAwEB/zAOBgNV
HQ8BAf8EBAMCAgQwDQYJKoZIhvcNAQELBQADgYEAHzC7jdYlzAVmddi/gdAeKPau
sPBG/C2HCWqHzpCUHcKuvMzDVkY/MP2o6JIW2DBbY64bO/FceExhjcykgaYtCH/m
oIU63+CFOTtR7otyQAWHqXa7q4SbCDlG7DyRFxqG0txPtGvy12lgldA2+RgcigQG
Dfcog5wrJytaQ6UA0wE=
-----END CERTIFICATE-----
EOF

cat << 'EOF' > server.key
-----BEGIN PRIVATE KEY-----
MIICdQIBADANBgkqhkiG9w0BAQEFAASCAl8wggJbAgEAAoGBAOHDFScoLCVJpYDD
M4HYtIdV6Ake/sMNaaKdODjDMsux/4tDydlumN+fm+AjPEK5GHhGn1BgzkWF+slf
3BxhrA/8dNsnunstVA7ZBgA/5qQxMfGAq4wHNVX77fBZOgp9VlSMVfyd9N8YwbBY
AckOeUQadTi2X1S6OgJXgQ0m3MWhAgMBAAECgYAn7qGnM2vbjJNBm0VZCkOkTIWm
V10okw7EPJrdL2mkre9NasghNXbE1y5zDshx5Nt3KsazKOxTT8d0Jwh/3KbaN+YY
tTCbKGW0pXDRBhwUHRcuRzScjli8Rih5UOCiZkhefUTcRb6xIhZJuQy71tjaSy0p
dHZRmYyBYO2YEQ8xoQJBAPrJPhMBkzmEYFtyIEqAxQ/o/A6E+E4w8i+KM7nQCK7q
K4JXzyXVAjLfyBZWHGM2uro/fjqPggGD6QH1qXCkI4MCQQDmdKeb2TrKRh5BY1LR
81aJGKcJ2XbcDu6wMZK4oqWbTX2KiYn9GB0woM6nSr/Y6iy1u145YzYxEV/iMwff
DJULAkB8B2MnyzOg0pNFJqBJuH29bKCcHa8gHJzqXhNO5lAlEbMK95p/P2Wi+4Hd
aiEIAF1BF326QJcvYKmwSmrORp85AkAlSNxRJ50OWrfMZnBgzVjDx3xG6KsFQVk2
ol6VhqL6dFgKUORFUWBvnKSyhjJxurlPEahV6oo6+A+mPhFY8eUvAkAZQyTdupP3
XEFQKctGz+9+gKkemDp7LBBMEMBXrGTLPhpEfcjv/7KPdnFHYmhYeBTBnuVmTVWe
F98XJ7tIFfJq
-----END PRIVATE KEY-----
EOF

cat << 'EOF' > server.pem
-----BEGIN CERTIFICATE-----
MIICnDCCAgWgAwIBAgIBBzANBgkqhkiG9w0BAQsFADBWMQswCQYDVQQGEwJBVTET
MBEGA1UECBMKU29tZS1TdGF0ZTEhMB8GA1UEChMYSW50ZXJuZXQgV2lkZ2l0cyBQ
dHkgTHRkMQ8wDQYDVQQDEwZ0ZXN0Y2EwHhcNMTUxMTA0MDIyMDI0WhcNMjUxMTAx
MDIyMDI0WjBlMQswCQYDVQQGEwJVUzERMA8GA1UECBMISWxsaW5vaXMxEDAOBgNV
BAcTB0NoaWNhZ28xFTATBgNVBAoTDEV4YW1wbGUsIENvLjEaMBgGA1UEAxQRKi50
ZXN0Lmdvb2dsZS5jb20wgZ8wDQYJKoZIhvcNAQEBBQADgY0AMIGJAoGBAOHDFSco
LCVJpYDDM4HYtIdV6Ake/sMNaaKdODjDMsux/4tDydlumN+fm+AjPEK5GHhGn1Bg
zkWF+slf3BxhrA/8dNsnunstVA7ZBgA/5qQxMfGAq4wHNVX77fBZOgp9VlSMVfyd
9N8YwbBYAckOeUQadTi2X1S6OgJXgQ0m3MWhAgMBAAGjazBpMAkGA1UdEwQCMAAw
CwYDVR0PBAQDAgXgME8GA1UdEQRIMEaCECoudGVzdC5nb29nbGUuZnKCGHdhdGVy
em9vaS50ZXN0Lmdvb2dsZS5iZYISKi50ZXN0LnlvdXR1YmUuY29thwTAqAEDMA0G
CSqGSIb3DQEBCwUAA4GBAJFXVifQNub1LUP4JlnX5lXNlo8FxZ2a12AFQs+bzoJ6
hM044EDjqyxUqSbVePK0ni3w1fHQB5rY9yYC5f8G7aqqTY1QOhoUk8ZTSTRpnkTh
y4jjdvTZeLDVBlueZUTDRmy2feY5aZIU18vFDK08dTG0A87pppuv1LNIR3loveU8
-----END CERTIFICATE-----
EOF
```



**ç¬¬äºŒæ­¥ï¼Œåˆ›å»º main.go æ–‡ä»¶ï¼š**

```javascript
package main
import (
  "fmt"
  "log"
  "net/http"
  "sync"
  "time"
  "github.com/gin-gonic/gin"
  "golang.org/x/sync/errgroup"
)
type Product struct {
  Username    string    `json:"username" binding:"required"`
  Name        string    `json:"name" binding:"required"`
  Category    string    `json:"category" binding:"required"`
  Price       int       `json:"price" binding:"gte=0"`
  Description string    `json:"description"`
  CreatedAt   time.Time `json:"createdAt"`
}
type productHandler struct {
  sync.RWMutex
  products map[string]Product
}
func newProductHandler() *productHandler {
  return &productHandler{
    products: make(map[string]Product),
  }
}
func (u *productHandler) Create(c *gin.Context) {
  u.Lock()
  defer u.Unlock()
  // 1. å‚æ•°è§£æ
  var product Product
  if err := c.ShouldBindJSON(&product); err != nil {
    c.JSON(http.StatusBadRequest, gin.H{"error": err.Error()})
    return
  }
  // 2. å‚æ•°æ ¡éªŒ
  if _, ok := u.products[product.Name]; ok {
    c.JSON(http.StatusBadRequest, gin.H{"error": fmt.Sprintf("product %s already exist", product.Name)})
    return
  }
  product.CreatedAt = time.Now()
  // 3. é€»è¾‘å¤„ç†
  u.products[product.Name] = product
  log.Printf("Register product %s success", product.Name)
  // 4. è¿”å›ç»“æœ
  c.JSON(http.StatusOK, product)
}
func (u *productHandler) Get(c *gin.Context) {
  u.Lock()
  defer u.Unlock()
  product, ok := u.products[c.Param("name")]
  if !ok {
    c.JSON(http.StatusNotFound, gin.H{"error": fmt.Errorf("can not found product %s", c.Param("name"))})
    return
  }
  c.JSON(http.StatusOK, product)
}
func router() http.Handler {
  router := gin.Default()
  productHandler := newProductHandler()
  // è·¯ç”±åˆ†ç»„ã€ä¸­é—´ä»¶ã€è®¤è¯
  v1 := router.Group("/v1")
  {
    productv1 := v1.Group("/products")
    {
      // è·¯ç”±åŒ¹é…
      productv1.POST("", productHandler.Create)
      productv1.GET(":name", productHandler.Get)
    }
  }
  return router
}
func main() {
  var eg errgroup.Group
  // ä¸€è¿›ç¨‹å¤šç«¯å£
  insecureServer := &http.Server{
    Addr:         ":8080",
    Handler:      router(),
    ReadTimeout:  5 * time.Second,
    WriteTimeout: 10 * time.Second,
  }
  secureServer := &http.Server{
    Addr:         ":8443",
    Handler:      router(),
    ReadTimeout:  5 * time.Second,
    WriteTimeout: 10 * time.Second,
  }
  eg.Go(func() error {
    err := insecureServer.ListenAndServe()
    if err != nil && err != http.ErrServerClosed {
      log.Fatal(err)
    }
    return err
  })
  eg.Go(func() error {
    err := secureServer.ListenAndServeTLS("server.pem", "server.key")
    if err != nil && err != http.ErrServerClosed {
      log.Fatal(err)
    }
    return err
  })
  if err := eg.Wait(); err != nil {
    log.Fatal(err)
  }
}
```

è¿è¡Œä»¥ä¸Šä»£ç ï¼š

```javascript
$ go run main.go
```

æ‰“å¼€å¦å¤–ä¸€ä¸ªç»ˆç«¯ï¼Œè¯·æ±‚ HTTP æ¥å£ï¼š

```javascript
$ go run main.go
```

ç¤ºä¾‹ä»£ç å­˜æ”¾åœ°å€ä¸ºwebfeatureã€‚

å¦å¤–ï¼ŒGin é¡¹ç›®ä»“åº“ä¸­ä¹ŸåŒ…å«äº†å¾ˆå¤šä½¿ç”¨ç¤ºä¾‹ï¼Œå¦‚æœä½ æƒ³è¯¦ç»†äº†è§£ï¼Œå¯ä»¥å‚è€ƒ gin examplesã€‚

ä¸‹é¢ï¼Œæˆ‘æ¥è¯¦ç»†ä»‹ç»ä¸‹ Gin æ˜¯å¦‚ä½•æ”¯æŒ Web æœåŠ¡åŸºç¡€åŠŸèƒ½çš„ã€‚



### HTTP/HTTPS æ”¯æŒ

å› ä¸º Gin æ˜¯åŸºäº net/http åŒ…å°è£…çš„ä¸€ä¸ª Web æ¡†æ¶ï¼Œæ‰€ä»¥å®ƒå¤©ç„¶å°±æ”¯æŒ HTTP/HTTPSã€‚åœ¨ä¸Šè¿°ä»£ç ä¸­ï¼Œé€šè¿‡ä»¥ä¸‹æ–¹å¼å¼€å¯ä¸€ä¸ª HTTP æœåŠ¡ï¼š

```javascript
insecureServer := &http.Server{
  Addr:         ":8080",
  Handler:      router(),
  ReadTimeout:  5 * time.Second,
  WriteTimeout: 10 * time.Second,
}
...
err := insecureServer.ListenAndServe()
```

é€šè¿‡ä»¥ä¸‹æ–¹å¼å¼€å¯ä¸€ä¸ª HTTPS æœåŠ¡ï¼š

```javascript
secureServer := &http.Server{
  Addr:         ":8443",
  Handler:      router(),
  ReadTimeout:  5 * time.Second,
  WriteTimeout: 10 * time.Second,
}
...
err := secureServer.ListenAndServeTLS("server.pem", "server.key")
```



### JSON æ•°æ®æ ¼å¼æ”¯æŒ

Gin æ”¯æŒå¤šç§æ•°æ®é€šä¿¡æ ¼å¼ï¼Œä¾‹å¦‚ application/jsonã€application/xmlã€‚å¯ä»¥é€šè¿‡c.ShouldBindJSONå‡½æ•°ï¼Œå°† Body ä¸­çš„ JSON æ ¼å¼æ•°æ®è§£æåˆ°æŒ‡å®šçš„ Struct ä¸­ï¼Œé€šè¿‡c.JSONå‡½æ•°è¿”å› JSON æ ¼å¼çš„æ•°æ®ã€‚

### è·¯ç”±åŒ¹é…

Gin æ”¯æŒä¸¤ç§è·¯ç”±åŒ¹é…è§„åˆ™ã€‚

**ç¬¬ä¸€ç§åŒ¹é…è§„åˆ™æ˜¯ç²¾ç¡®åŒ¹é…ã€‚**ä¾‹å¦‚ï¼Œè·¯ç”±ä¸º `/products/:name`ï¼ŒåŒ¹é…æƒ…å†µå¦‚ä¸‹è¡¨æ‰€ç¤ºï¼š

![img](https://static001.geekbang.org/resource/image/11/df/11be05d7fe7f935e01725e2635f315df.jpg?wh=2248x1418)

**ç¬¬äºŒç§åŒ¹é…è§„åˆ™æ˜¯æ¨¡ç³ŠåŒ¹é…ã€‚**ä¾‹å¦‚ï¼Œè·¯ç”±ä¸º /products/*nameï¼ŒåŒ¹é…æƒ…å†µå¦‚ä¸‹è¡¨æ‰€ç¤ºï¼š

![img](https://static001.geekbang.org/resource/image/b5/7b/b5ccd9924e53dd90a64af6002967b67b.jpg?wh=2248x1636)

### è·¯ç”±åˆ†ç»„

Gin é€šè¿‡ Group å‡½æ•°å®ç°äº†è·¯ç”±åˆ†ç»„çš„åŠŸèƒ½ã€‚è·¯ç”±åˆ†ç»„æ˜¯ä¸€ä¸ªéå¸¸å¸¸ç”¨çš„åŠŸèƒ½ï¼Œå¯ä»¥å°†ç›¸åŒç‰ˆæœ¬çš„è·¯ç”±åˆ†ä¸ºä¸€ç»„ï¼Œä¹Ÿå¯ä»¥å°†ç›¸åŒ RESTful èµ„æºçš„è·¯ç”±åˆ†ä¸ºä¸€ç»„ã€‚ä¾‹å¦‚ï¼š

```javascript
v1 := router.Group("/v1", gin.BasicAuth(gin.Accounts{"foo": "bar", "colin": "colin404"}))
{
    productv1 := v1.Group("/products")
    {
        // è·¯ç”±åŒ¹é…
        productv1.POST("", productHandler.Create)
        productv1.GET(":name", productHandler.Get)
    }
    orderv1 := v1.Group("/orders")
    {
        // è·¯ç”±åŒ¹é…
        orderv1.POST("", orderHandler.Create)
        orderv1.GET(":name", orderHandler.Get)
    }
}
v2 := router.Group("/v2", gin.BasicAuth(gin.Accounts{"foo": "bar", "colin": "colin404"}))
{
    productv2 := v2.Group("/products")
    {
        // è·¯ç”±åŒ¹é…
        productv2.POST("", productHandler.Create)
        productv2.GET(":name", productHandler.Get)
    }
}
```

é€šè¿‡å°†è·¯ç”±åˆ†ç»„ï¼Œå¯ä»¥å¯¹ç›¸åŒåˆ†ç»„çš„è·¯ç”±åšç»Ÿä¸€å¤„ç†ã€‚æ¯”å¦‚ä¸Šé¢é‚£ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä»£ç 

```javascript
v1 := router.Group("/v1", gin.BasicAuth(gin.Accounts{"foo": "bar", "colin": "colin404"}))
```

ç»™æ‰€æœ‰å±äº v1 åˆ†ç»„çš„è·¯ç”±éƒ½æ·»åŠ  gin.BasicAuth ä¸­é—´ä»¶ï¼Œä»¥å®ç°è®¤è¯åŠŸèƒ½ã€‚ä¸­é—´ä»¶å’Œè®¤è¯ï¼Œè¿™é‡Œä½ å…ˆä¸ç”¨æ·±ç©¶ï¼Œä¸‹é¢è®²é«˜çº§åŠŸèƒ½çš„æ—¶å€™ä¼šä»‹ç»åˆ°ã€‚



### ä¸€è¿›ç¨‹å¤šæœåŠ¡

æˆ‘ä»¬å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼å®ç°ä¸€è¿›ç¨‹å¤šæœåŠ¡ï¼š

```javascript
var eg errgroup.Group
insecureServer := &http.Server{...}
secureServer := &http.Server{...}
eg.Go(func() error {
  err := insecureServer.ListenAndServe()
  if err != nil && err != http.ErrServerClosed {
    log.Fatal(err)
  }
  return err
})
eg.Go(func() error {
  err := secureServer.ListenAndServeTLS("server.pem", "server.key")
  if err != nil && err != http.ErrServerClosed {
    log.Fatal(err)
  }
  return err
}
if err := eg.Wait(); err != nil {
  log.Fatal(err)
})
```

ä¸Šè¿°ä»£ç å®ç°äº†ä¸¤ä¸ªç›¸åŒçš„æœåŠ¡ï¼Œåˆ†åˆ«ç›‘å¬åœ¨ä¸åŒçš„ç«¯å£ã€‚è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä¸ºäº†ä¸é˜»å¡å¯åŠ¨ç¬¬äºŒä¸ªæœåŠ¡ï¼Œæˆ‘ä»¬éœ€è¦æŠŠ ListenAndServe å‡½æ•°æ”¾åœ¨ goroutine ä¸­æ‰§è¡Œï¼Œå¹¶ä¸”è°ƒç”¨ eg.Wait() æ¥é˜»å¡ç¨‹åºè¿›ç¨‹ï¼Œä»è€Œè®©ä¸¤ä¸ª HTTP æœåŠ¡åœ¨ goroutine ä¸­æŒç»­ç›‘å¬ç«¯å£ï¼Œå¹¶æä¾›æœåŠ¡ã€‚



### å‚æ•°è§£æã€å‚æ•°æ ¡éªŒã€é€»è¾‘å¤„ç†ã€è¿”å›ç»“æœ

æ­¤å¤–ï¼ŒWeb æœåŠ¡è¿˜åº”è¯¥å…·æœ‰å‚æ•°è§£æã€å‚æ•°æ ¡éªŒã€é€»è¾‘å¤„ç†ã€è¿”å›ç»“æœ 4 ç±»åŠŸèƒ½ï¼Œå› ä¸ºè¿™äº›åŠŸèƒ½è”ç³»ç´§å¯†ï¼Œæˆ‘ä»¬æ”¾åœ¨ä¸€èµ·æ¥è¯´ã€‚

åœ¨ productHandler çš„ Create æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡`c.ShouldBindJSON`æ¥è§£æå‚æ•°ï¼Œæ¥ä¸‹æ¥è‡ªå·±ç¼–å†™æ ¡éªŒä»£ç ï¼Œç„¶åå°† product ä¿¡æ¯ä¿å­˜åœ¨å†…å­˜ä¸­ï¼ˆä¹Ÿå°±æ˜¯ä¸šåŠ¡é€»è¾‘å¤„ç†ï¼‰ï¼Œæœ€åé€šè¿‡c.JSONè¿”å›åˆ›å»ºçš„ product ä¿¡æ¯ã€‚ä»£ç å¦‚ä¸‹ï¼š

```javascript
func (u *productHandler) Create(c *gin.Context) {
  u.Lock()
  defer u.Unlock()
  // 1. å‚æ•°è§£æ
  var product Product
  if err := c.ShouldBindJSON(&product); err != nil {
    c.JSON(http.StatusBadRequest, gin.H{"error": err.Error()})
    return
  }
  // 2. å‚æ•°æ ¡éªŒ
  if _, ok := u.products[product.Name]; ok {
    c.JSON(http.StatusBadRequest, gin.H{"error": fmt.Sprintf("product %s already exist", product.Name)})
    return
  }
  product.CreatedAt = time.Now()
  // 3. é€»è¾‘å¤„ç†
  u.products[product.Name] = product
  log.Printf("Register product %s success", product.Name)
  // 4. è¿”å›ç»“æœ
  c.JSON(http.StatusOK, product)
}
```

é‚£è¿™ä¸ªæ—¶å€™ï¼Œä½ å¯èƒ½ä¼šé—®ï¼šHTTP çš„è¯·æ±‚å‚æ•°å¯ä»¥å­˜åœ¨ä¸åŒçš„ä½ç½®ï¼ŒGin æ˜¯å¦‚ä½•è§£æçš„å‘¢ï¼Ÿè¿™é‡Œï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹ä¸‹ HTTP æœ‰å“ªäº›å‚æ•°ç±»å‹ã€‚HTTP å…·æœ‰ä»¥ä¸‹ 5 ç§å‚æ•°ç±»å‹ï¼š

1. è·¯å¾„å‚æ•°ï¼ˆpathï¼‰ã€‚ä¾‹å¦‚`gin.Default().GET("/user/:name", nil)`ï¼Œ name å°±æ˜¯è·¯å¾„å‚æ•°ã€‚

2. æŸ¥è¯¢å­—ç¬¦ä¸²å‚æ•°ï¼ˆqueryï¼‰ã€‚ä¾‹å¦‚`/welcome?firstname=Lingfei&lastname=Kong`ï¼Œfirstname å’Œ lastname å°±æ˜¯æŸ¥è¯¢å­—ç¬¦ä¸²å‚æ•°ã€‚

3. è¡¨å•å‚æ•°ï¼ˆformï¼‰ã€‚ä¾‹å¦‚`curl -X POST -F 'username=colin' -F 'password=colin1234' http://mydomain.com/login`ï¼Œusername å’Œ password å°±æ˜¯è¡¨å•å‚æ•°ã€‚

4. HTTP å¤´å‚æ•°ï¼ˆheaderï¼‰ã€‚ä¾‹å¦‚`curl -X POST -H 'Content-Type: application/json' -d '{"username":"colin","password":"colin1234"}' http://mydomain.com/login`ï¼ŒContent-Type å°±æ˜¯ HTTP å¤´å‚æ•°ã€‚

5. æ¶ˆæ¯ä½“å‚æ•°ï¼ˆbodyï¼‰ã€‚ä¾‹å¦‚`curl -X POST -H 'Content-Type: application/json' -d '{"username":"colin","password":"colin1234"}' http://mydomain.com/login`ï¼Œusername å’Œ password å°±æ˜¯æ¶ˆæ¯ä½“å‚æ•°ã€‚


Gin æä¾›äº†ä¸€äº›å‡½æ•°ï¼Œæ¥åˆ†åˆ«è¯»å–è¿™äº› HTTP å‚æ•°ï¼Œæ¯ç§ç±»åˆ«ä¼šæä¾›ä¸¤ç§å‡½æ•°ï¼Œä¸€ç§å‡½æ•°å¯ä»¥ç›´æ¥è¯»å–æŸä¸ªå‚æ•°çš„å€¼ï¼Œå¦å¤–ä¸€ç§å‡½æ•°ä¼šæŠŠåŒç±» HTTP å‚æ•°ç»‘å®šåˆ°ä¸€ä¸ª Go ç»“æ„ä½“ä¸­ã€‚æ¯”å¦‚ï¼Œæœ‰å¦‚ä¸‹è·¯å¾„å‚æ•°ï¼š

```javascript
gin.Default().GET("/:name/:id", nil)
```

æˆ‘ä»¬å¯ä»¥ç›´æ¥è¯»å–æ¯ä¸ªå‚æ•°ï¼š

```javascript
name := c.Param("name")
action := c.Param("action")
```

ä¹Ÿå¯ä»¥å°†æ‰€æœ‰çš„è·¯å¾„å‚æ•°ï¼Œç»‘å®šåˆ°ç»“æ„ä½“ä¸­ï¼š

```javascript
type Person struct {
    ID string `uri:"id" binding:"required,uuid"`
    Name string `uri:"name" binding:"required"`
}
if err := c.ShouldBindUri(&person); err != nil {
    // normal code
    return
}
```

Gin åœ¨ç»‘å®šå‚æ•°æ—¶ï¼Œæ˜¯é€šè¿‡ç»“æ„ä½“çš„ tag æ¥åˆ¤æ–­è¦ç»‘å®šå“ªç±»å‚æ•°åˆ°ç»“æ„ä½“ä¸­çš„ã€‚è¿™é‡Œè¦æ³¨æ„ï¼Œä¸åŒçš„ HTTP å‚æ•°æœ‰ä¸åŒçš„ç»“æ„ä½“ tagã€‚

1. è·¯å¾„å‚æ•°ï¼šuriã€‚

2. æŸ¥è¯¢å­—ç¬¦ä¸²å‚æ•°ï¼šformã€‚

3. è¡¨å•å‚æ•°ï¼šformã€‚

4. HTTP å¤´å‚æ•°ï¼šheaderã€‚

5. æ¶ˆæ¯ä½“å‚æ•°ï¼šä¼šæ ¹æ® Content-Typeï¼Œè‡ªåŠ¨é€‰æ‹©ä½¿ç”¨ json æˆ–è€… xmlï¼Œä¹Ÿå¯ä»¥è°ƒç”¨ ShouldBindJSON æˆ–è€… ShouldBindXML ç›´æ¥æŒ‡å®šä½¿ç”¨å“ªä¸ª tagã€‚


é’ˆå¯¹æ¯ç§å‚æ•°ç±»å‹ï¼ŒGin éƒ½æœ‰å¯¹åº”çš„å‡½æ•°æ¥è·å–å’Œç»‘å®šè¿™äº›å‚æ•°ã€‚è¿™äº›å‡½æ•°éƒ½æ˜¯åŸºäºå¦‚ä¸‹ä¸¤ä¸ªå‡½æ•°è¿›è¡Œå°è£…çš„ï¼š

```
ShouldBindWith(obj interface{}, b binding.Binding) error
```

éå¸¸é‡è¦çš„ä¸€ä¸ªå‡½æ•°ï¼Œå¾ˆå¤š ShouldBindXXX å‡½æ•°åº•å±‚éƒ½æ˜¯è°ƒç”¨ ShouldBindWith å‡½æ•°æ¥å®Œæˆå‚æ•°ç»‘å®šçš„ã€‚è¯¥å‡½æ•°ä¼šæ ¹æ®ä¼ å…¥çš„ç»‘å®šå¼•æ“ï¼Œå°†å‚æ•°ç»‘å®šåˆ°ä¼ å…¥çš„ç»“æ„ä½“æŒ‡é’ˆä¸­ï¼Œ**å¦‚æœç»‘å®šå¤±è´¥ï¼Œåªè¿”å›é”™è¯¯å†…å®¹ï¼Œä½†ä¸ç»ˆæ­¢ HTTP è¯·æ±‚ã€‚**ShouldBindWith æ”¯æŒå¤šç§ç»‘å®šå¼•æ“ï¼Œä¾‹å¦‚ binding.JSONã€binding.Queryã€binding.Uriã€binding.Header ç­‰ï¼Œæ›´è¯¦ç»†çš„ä¿¡æ¯ä½ å¯ä»¥å‚è€ƒ binding.goã€‚

```
MustBindWith(obj interface{}, b binding.Binding) error
```

è¿™æ˜¯å¦ä¸€ä¸ªéå¸¸é‡è¦çš„å‡½æ•°ï¼Œå¾ˆå¤š BindXXX å‡½æ•°åº•å±‚éƒ½æ˜¯è°ƒç”¨ MustBindWith å‡½æ•°æ¥å®Œæˆå‚æ•°ç»‘å®šçš„ã€‚è¯¥å‡½æ•°ä¼šæ ¹æ®ä¼ å…¥çš„ç»‘å®šå¼•æ“ï¼Œå°†å‚æ•°ç»‘å®šåˆ°ä¼ å…¥çš„ç»“æ„ä½“æŒ‡é’ˆä¸­ï¼Œ**å¦‚æœç»‘å®šå¤±è´¥ï¼Œè¿”å›é”™è¯¯å¹¶ç»ˆæ­¢è¯·æ±‚ï¼Œè¿”å› HTTP 400 é”™è¯¯ã€‚**MustBindWith æ‰€æ”¯æŒçš„ç»‘å®šå¼•æ“è·Ÿ ShouldBindWith å‡½æ•°ä¸€æ ·ã€‚

Gin åŸºäº ShouldBindWith å’Œ MustBindWith è¿™ä¸¤ä¸ªå‡½æ•°ï¼Œåˆè¡ç”Ÿå‡ºå¾ˆå¤šæ–°çš„ Bind å‡½æ•°ã€‚è¿™äº›å‡½æ•°å¯ä»¥æ»¡è¶³ä¸åŒåœºæ™¯ä¸‹è·å– HTTP å‚æ•°çš„éœ€æ±‚ã€‚Gin æä¾›çš„å‡½æ•°å¯ä»¥è·å– 5 ä¸ªç±»åˆ«çš„ HTTP å‚æ•°ã€‚

1. è·¯å¾„å‚æ•°ï¼šShouldBindUriã€BindUriï¼›

2. æŸ¥è¯¢å­—ç¬¦ä¸²å‚æ•°ï¼šShouldBindQueryã€BindQueryï¼›

3. è¡¨å•å‚æ•°ï¼šShouldBindï¼›

4. HTTP å¤´å‚æ•°ï¼šShouldBindHeaderã€BindHeaderï¼›

5. æ¶ˆæ¯ä½“å‚æ•°ï¼šShouldBindJSONã€BindJSON ç­‰ã€‚


æ¯ä¸ªç±»åˆ«çš„ Bind å‡½æ•°ï¼Œè¯¦ç»†ä¿¡æ¯ä½ å¯ä»¥å‚è€ƒGin æä¾›çš„ Bind å‡½æ•°ã€‚

è¿™é‡Œè¦æ³¨æ„ï¼ŒGin å¹¶æ²¡æœ‰æä¾›ç±»ä¼¼ ShouldBindFormã€BindForm è¿™ç±»å‡½æ•°æ¥ç»‘å®šè¡¨å•å‚æ•°ï¼Œä½†æˆ‘ä»¬å¯ä»¥é€šè¿‡ ShouldBind æ¥ç»‘å®šè¡¨å•å‚æ•°ã€‚å½“ HTTP æ–¹æ³•ä¸º GET æ—¶ï¼ŒShouldBind åªç»‘å®š Query ç±»å‹çš„å‚æ•°ï¼›å½“ HTTP æ–¹æ³•ä¸º POST æ—¶ï¼Œä¼šå…ˆæ£€æŸ¥ content-type æ˜¯å¦æ˜¯ json æˆ–è€… xmlï¼Œå¦‚æœä¸æ˜¯ï¼Œåˆ™ç»‘å®š Form ç±»å‹çš„å‚æ•°ã€‚

æ‰€ä»¥ï¼ŒShouldBind å¯ä»¥ç»‘å®š Form ç±»å‹çš„å‚æ•°ï¼Œä½†å‰ææ˜¯ HTTP æ–¹æ³•æ˜¯ POSTï¼Œå¹¶ä¸” content-type ä¸æ˜¯ application/jsonã€application/xmlã€‚

åœ¨ Go é¡¹ç›®å¼€å‘ä¸­ï¼Œæˆ‘å»ºè®®ä½¿ç”¨ ShouldBindXXXï¼Œè¿™æ ·å¯ä»¥ç¡®ä¿æˆ‘ä»¬è®¾ç½®çš„ HTTP Chainï¼ˆChain å¯ä»¥ç†è§£ä¸ºä¸€ä¸ª HTTP è¯·æ±‚çš„ä¸€ç³»åˆ—å¤„ç†æ’ä»¶ï¼‰èƒ½å¤Ÿç»§ç»­è¢«æ‰§è¡Œã€‚



## Gin æ˜¯å¦‚ä½•æ”¯æŒ Web æœåŠ¡é«˜çº§åŠŸèƒ½çš„ï¼Ÿ

ä¸Šé¢ä»‹ç»äº† Web æœåŠ¡çš„åŸºç¡€åŠŸèƒ½ï¼Œè¿™é‡Œæˆ‘å†æ¥ä»‹ç»ä¸‹é«˜çº§åŠŸèƒ½ã€‚Web æœåŠ¡å¯ä»¥å…·å¤‡å¤šä¸ªé«˜çº§åŠŸèƒ½ï¼Œä½†æ¯”è¾ƒæ ¸å¿ƒçš„é«˜çº§åŠŸèƒ½æ˜¯ä¸­é—´ä»¶ã€è®¤è¯ã€RequestIDã€è·¨åŸŸå’Œä¼˜é›…å…³åœã€‚

### ä¸­é—´ä»¶

Gin æ”¯æŒä¸­é—´ä»¶ï¼ŒHTTP è¯·æ±‚åœ¨è½¬å‘åˆ°å®é™…çš„å¤„ç†å‡½æ•°ä¹‹å‰ï¼Œä¼šè¢«ä¸€ç³»åˆ—åŠ è½½çš„ä¸­é—´ä»¶è¿›è¡Œå¤„ç†ã€‚åœ¨ä¸­é—´ä»¶ä¸­ï¼Œå¯ä»¥è§£æ HTTP è¯·æ±‚åšä¸€äº›é€»è¾‘å¤„ç†ï¼Œä¾‹å¦‚ï¼šè·¨åŸŸå¤„ç†æˆ–è€…ç”Ÿæˆ X-Request-ID å¹¶ä¿å­˜åœ¨ context ä¸­ï¼Œä»¥ä¾¿è¿½è¸ªæŸä¸ªè¯·æ±‚ã€‚å¤„ç†å®Œä¹‹åï¼Œå¯ä»¥é€‰æ‹©ä¸­æ–­å¹¶è¿”å›è¿™æ¬¡è¯·æ±‚ï¼Œä¹Ÿå¯ä»¥é€‰æ‹©å°†è¯·æ±‚ç»§ç»­è½¬äº¤ç»™ä¸‹ä¸€ä¸ªä¸­é—´ä»¶å¤„ç†ã€‚å½“æ‰€æœ‰çš„ä¸­é—´ä»¶éƒ½å¤„ç†å®Œä¹‹åï¼Œè¯·æ±‚æ‰ä¼šè½¬ç»™è·¯ç”±å‡½æ•°è¿›è¡Œå¤„ç†ã€‚å…·ä½“æµç¨‹å¦‚ä¸‹å›¾ï¼š

![img](https://static001.geekbang.org/resource/image/f0/80/f0783cb9ee8cffa969f846ebe8eae880.jpg?wh=2248x1655)

é€šè¿‡ä¸­é—´ä»¶ï¼Œå¯ä»¥å®ç°å¯¹æ‰€æœ‰è¯·æ±‚éƒ½åšç»Ÿä¸€çš„å¤„ç†ï¼Œæé«˜å¼€å‘æ•ˆç‡ï¼Œå¹¶ä½¿æˆ‘ä»¬çš„ä»£ç æ›´ç®€æ´ã€‚ä½†æ˜¯ï¼Œå› ä¸ºæ‰€æœ‰çš„è¯·æ±‚éƒ½éœ€è¦ç»è¿‡ä¸­é—´ä»¶çš„å¤„ç†ï¼Œå¯èƒ½ä¼šå¢åŠ è¯·æ±‚å»¶æ—¶ã€‚å¯¹äºä¸­é—´ä»¶ç‰¹æ€§ï¼Œæˆ‘æœ‰å¦‚ä¸‹å»ºè®®ï¼š

ä¸­é—´ä»¶åšæˆå¯åŠ è½½çš„ï¼Œé€šè¿‡é…ç½®æ–‡ä»¶æŒ‡å®šç¨‹åºå¯åŠ¨æ—¶åŠ è½½å“ªäº›ä¸­é—´ä»¶ã€‚

åªå°†ä¸€äº›é€šç”¨çš„ã€å¿…è¦çš„åŠŸèƒ½åšæˆä¸­é—´ä»¶ã€‚

åœ¨ç¼–å†™ä¸­é—´ä»¶æ—¶ï¼Œä¸€å®šè¦ä¿è¯ä¸­é—´ä»¶çš„ä»£ç è´¨é‡å’Œæ€§èƒ½ã€‚

åœ¨ Gin ä¸­ï¼Œå¯ä»¥é€šè¿‡ gin.Engine çš„ Use æ–¹æ³•æ¥åŠ è½½ä¸­é—´ä»¶ã€‚ä¸­é—´ä»¶å¯ä»¥åŠ è½½åˆ°ä¸åŒçš„ä½ç½®ä¸Šï¼Œè€Œä¸”ä¸åŒçš„ä½ç½®ä½œç”¨èŒƒå›´ä¹Ÿä¸åŒï¼Œä¾‹å¦‚ï¼š

```javascript
router := gin.New()
router.Use(gin.Logger(), gin.Recovery()) // ä¸­é—´ä»¶ä½œç”¨äºæ‰€æœ‰çš„HTTPè¯·æ±‚
v1 := router.Group("/v1").Use(gin.BasicAuth(gin.Accounts{"foo": "bar", "colin": "colin404"})) // ä¸­é—´ä»¶ä½œç”¨äºv1 group
v1.POST("/login", Login).Use(gin.BasicAuth(gin.Accounts{"foo": "bar", "colin": "colin404"})) //ä¸­é—´ä»¶åªä½œç”¨äº/v1/login APIæ¥å£
```

Gin æ¡†æ¶æœ¬èº«æ”¯æŒäº†ä¸€äº›ä¸­é—´ä»¶ã€‚

1. **gin.Logger()ï¼š**Logger ä¸­é—´ä»¶ä¼šå°†æ—¥å¿—å†™åˆ° gin.DefaultWriterï¼Œgin.DefaultWriter é»˜è®¤ä¸º os.Stdoutã€‚
2. **gin.Recovery()ï¼š**Recovery ä¸­é—´ä»¶å¯ä»¥ä»ä»»ä½• panic æ¢å¤ï¼Œå¹¶ä¸”å†™å…¥ä¸€ä¸ª 500 çŠ¶æ€ç ã€‚

3. **gin.CustomRecovery(handle gin.RecoveryFunc)ï¼š**ç±»ä¼¼ Recovery ä¸­é—´ä»¶ï¼Œä½†æ˜¯åœ¨æ¢å¤æ—¶è¿˜ä¼šè°ƒç”¨ä¼ å…¥çš„ handle æ–¹æ³•è¿›è¡Œå¤„ç†ã€‚

4. **gin.BasicAuth()ï¼š**HTTP è¯·æ±‚åŸºæœ¬è®¤è¯ï¼ˆä½¿ç”¨ç”¨æˆ·åå’Œå¯†ç è¿›è¡Œè®¤è¯ï¼‰ã€‚

å¦å¤–ï¼ŒGin è¿˜æ”¯æŒè‡ªå®šä¹‰ä¸­é—´ä»¶ã€‚ä¸­é—´ä»¶å…¶å®æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå‡½æ•°ç±»å‹ä¸º gin.HandlerFuncï¼ŒHandlerFunc åº•å±‚ç±»å‹ä¸º func(*Context)ã€‚å¦‚ä¸‹æ˜¯ä¸€ä¸ª Logger ä¸­é—´ä»¶çš„å®ç°ï¼š

```javascript
package main
import (
  "log"
  "time"
  "github.com/gin-gonic/gin"
)
func Logger() gin.HandlerFunc {
  return func(c *gin.Context) {
    t := time.Now()
    // è®¾ç½®å˜é‡example
    c.Set("example", "12345")
    // è¯·æ±‚ä¹‹å‰
    c.Next()
    // è¯·æ±‚ä¹‹å
    latency := time.Since(t)
    log.Print(latency)
    // è®¿é—®æˆ‘ä»¬å‘é€çš„çŠ¶æ€
    status := c.Writer.Status()
    log.Println(status)
  }
}
func main() {
  r := gin.New()
  r.Use(Logger())
  r.GET("/test", func(c *gin.Context) {
    example := c.MustGet("example").(string)
    // it would print: "12345"
    log.Println(example)
  })
  // Listen and serve on 0.0.0.0:8080
  r.Run(":8080")
}
```

å¦å¤–ï¼Œè¿˜æœ‰å¾ˆå¤šå¼€æºçš„ä¸­é—´ä»¶å¯ä¾›æˆ‘ä»¬é€‰æ‹©ï¼Œæˆ‘æŠŠä¸€äº›å¸¸ç”¨çš„æ€»ç»“åœ¨äº†è¡¨æ ¼é‡Œï¼š

![img](https://static001.geekbang.org/resource/image/67/10/67137697a09d9f37bd87a81bf322f510.jpg?wh=1832x1521)

### è®¤è¯ã€RequestIDã€è·¨åŸŸ

è®¤è¯ã€RequestIDã€è·¨åŸŸè¿™ä¸‰ä¸ªé«˜çº§åŠŸèƒ½ï¼Œéƒ½å¯ä»¥é€šè¿‡ Gin çš„ä¸­é—´ä»¶æ¥å®ç°ï¼Œä¾‹å¦‚ï¼š

```javascript
router := gin.New()
// è®¤è¯
router.Use(gin.BasicAuth(gin.Accounts{"foo": "bar", "colin": "colin404"}))
// RequestID
router.Use(requestid.New(requestid.Config{
    Generator: func() string {
        return "test"
    },
}))
// è·¨åŸŸ
// CORS for https://foo.com and https://github.com origins, allowing:
// - PUT and PATCH methods
// - Origin header
// - Credentials share
// - Preflight requests cached for 12 hours
router.Use(cors.New(cors.Config{
    AllowOrigins:     []string{"https://foo.com"},
    AllowMethods:     []string{"PUT", "PATCH"},
    AllowHeaders:     []string{"Origin"},
    ExposeHeaders:    []string{"Content-Length"},
    AllowCredentials: true,
    AllowOriginFunc: func(origin string) bool {
        return origin == "https://github.com"
    },
    MaxAge: 12 * time.Hour,
}))
```

### ä¼˜é›…å…³åœ

Go é¡¹ç›®ä¸Šçº¿åï¼Œæˆ‘ä»¬è¿˜éœ€è¦ä¸æ–­è¿­ä»£æ¥ä¸°å¯Œé¡¹ç›®åŠŸèƒ½ã€ä¿®å¤ Bug ç­‰ï¼Œè¿™ä¹Ÿå°±æ„å‘³ç€ï¼Œæˆ‘ä»¬è¦ä¸æ–­åœ°é‡å¯ Go æœåŠ¡ã€‚å¯¹äº HTTP æœåŠ¡æ¥è¯´ï¼Œå¦‚æœè®¿é—®é‡å¤§ï¼Œé‡å¯æœåŠ¡çš„æ—¶å€™å¯èƒ½è¿˜æœ‰å¾ˆå¤šè¿æ¥æ²¡æœ‰æ–­å¼€ï¼Œè¯·æ±‚æ²¡æœ‰å®Œæˆã€‚å¦‚æœè¿™æ—¶å€™ç›´æ¥å…³é—­æœåŠ¡ï¼Œè¿™äº›è¿æ¥ä¼šç›´æ¥æ–­æ‰ï¼Œè¯·æ±‚å¼‚å¸¸ç»ˆæ­¢ï¼Œè¿™å°±ä¼šå¯¹ç”¨æˆ·ä½“éªŒå’Œäº§å“å£ç¢‘é€ æˆå¾ˆå¤§å½±å“ã€‚å› æ­¤ï¼Œè¿™ç§å…³é—­æ–¹å¼ä¸æ˜¯ä¸€ç§ä¼˜é›…çš„å…³é—­æ–¹å¼ã€‚

è¿™æ—¶å€™ï¼Œæˆ‘ä»¬æœŸæœ› HTTP æœåŠ¡å¯ä»¥åœ¨å¤„ç†å®Œæ‰€æœ‰è¯·æ±‚åï¼Œæ­£å¸¸åœ°å…³é—­è¿™äº›è¿æ¥ï¼Œä¹Ÿå°±æ˜¯ä¼˜é›…åœ°å…³é—­æœåŠ¡ã€‚æˆ‘ä»¬æœ‰ä¸¤ç§æ–¹æ³•æ¥ä¼˜é›…å…³é—­ HTTP æœåŠ¡ï¼Œåˆ†åˆ«æ˜¯å€ŸåŠ©ç¬¬ä¸‰æ–¹çš„ Go åŒ…å’Œè‡ªå·±ç¼–ç å®ç°ã€‚

æ–¹æ³•ä¸€ï¼šå€ŸåŠ©ç¬¬ä¸‰æ–¹çš„ Go åŒ…

å¦‚æœä½¿ç”¨ç¬¬ä¸‰æ–¹çš„ Go åŒ…æ¥å®ç°ä¼˜é›…å…³é—­ï¼Œç›®å‰ç”¨å¾—æ¯”è¾ƒå¤šçš„åŒ…æ˜¯fvbock/endlessã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ fvbock/endless æ¥æ›¿æ¢æ‰ net/http çš„ ListenAndServe æ–¹æ³•ï¼Œä¾‹å¦‚ï¼š

```javascript
router := gin.Default()
router.GET("/", handler)
// [...]
endless.ListenAndServe(":4242", router)
```

æ–¹æ³•äºŒï¼šç¼–ç å®ç°

å€ŸåŠ©ç¬¬ä¸‰æ–¹åŒ…çš„å¥½å¤„æ˜¯å¯ä»¥ç¨å¾®å‡å°‘ä¸€äº›ç¼–ç å·¥ä½œé‡ï¼Œä½†ç¼ºç‚¹æ˜¯å¼•å…¥äº†ä¸€ä¸ªæ–°çš„ä¾èµ–åŒ…ï¼Œå› æ­¤æˆ‘æ›´å€¾å‘äºè‡ªå·±ç¼–ç å®ç°ã€‚Go 1.8 ç‰ˆæœ¬æˆ–è€…æ›´æ–°çš„ç‰ˆæœ¬ï¼Œhttp.Server å†…ç½®çš„ Shutdown æ–¹æ³•ï¼Œå·²ç»å®ç°äº†ä¼˜é›…å…³é—­ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªç¤ºä¾‹ï¼š

```javascript
// +build go1.8
package main
import (
  "context"
  "log"
  "net/http"
  "os"
  "os/signal"
  "syscall"
  "time"
  "github.com/gin-gonic/gin"
)
func main() {
  router := gin.Default()
  router.GET("/", func(c *gin.Context) {
    time.Sleep(5 * time.Second)
    c.String(http.StatusOK, "Welcome Gin Server")
  })
  srv := &http.Server{
    Addr:    ":8080",
    Handler: router,
  }
  // Initializing the server in a goroutine so that
  // it won't block the graceful shutdown handling below
  go func() {
    if err := srv.ListenAndServe(); err != nil && err != http.ErrServerClosed {
      log.Fatalf("listen: %s\n", err)
    }
  }()
  // Wait for interrupt signal to gracefully shutdown the server with
  // a timeout of 5 seconds.
  quit := make(chan os.Signal, 1)
  // kill (no param) default send syscall.SIGTERM
  // kill -2 is syscall.SIGINT
  // kill -9 is syscall.SIGKILL but can't be catch, so don't need add it
  signal.Notify(quit, syscall.SIGINT, syscall.SIGTERM)
  <-quit
  log.Println("Shutting down server...")
  // The context is used to inform the server it has 5 seconds to finish
  // the request it is currently handling
  ctx, cancel := context.WithTimeout(context.Background(), 5*time.Second)
  defer cancel()
  if err := srv.Shutdown(ctx); err != nil {
    log.Fatal("Server forced to shutdown:", err)
  }
  log.Println("Server exiting")
}
```

ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œéœ€è¦æŠŠ srv.ListenAndServe æ”¾åœ¨ goroutine ä¸­æ‰§è¡Œï¼Œè¿™æ ·æ‰ä¸ä¼šé˜»å¡åˆ° srv.Shutdown å‡½æ•°ã€‚å› ä¸ºæˆ‘ä»¬æŠŠ srv.ListenAndServe æ”¾åœ¨äº† goroutine ä¸­ï¼Œæ‰€ä»¥éœ€è¦ä¸€ç§å¯ä»¥è®©æ•´ä¸ªè¿›ç¨‹å¸¸é©»çš„æœºåˆ¶ã€‚

è¿™é‡Œï¼Œæˆ‘ä»¬å€ŸåŠ©äº†æœ‰ç¼“å†² channelï¼Œå¹¶ä¸”è°ƒç”¨ signal.Notify å‡½æ•°å°†è¯¥ channel ç»‘å®šåˆ° SIGINTã€SIGTERM ä¿¡å·ä¸Šã€‚è¿™æ ·ï¼Œæ”¶åˆ° SIGINTã€SIGTERM ä¿¡å·åï¼Œquilt é€šé“ä¼šè¢«å†™å…¥å€¼ï¼Œä»è€Œç»“æŸé˜»å¡çŠ¶æ€ï¼Œç¨‹åºç»§ç»­è¿è¡Œï¼Œæ‰§è¡Œ srv.Shutdown(ctx)ï¼Œä¼˜é›…å…³åœ HTTP æœåŠ¡ã€‚

## æ€»ç»“

ä»Šå¤©æˆ‘ä»¬ä¸»è¦å­¦ä¹ äº† Web æœåŠ¡çš„æ ¸å¿ƒåŠŸèƒ½ï¼Œä»¥åŠå¦‚ä½•å¼€å‘è¿™äº›åŠŸèƒ½ã€‚åœ¨å®é™…çš„é¡¹ç›®å¼€å‘ä¸­ï¼Œ æˆ‘ä»¬ä¸€èˆ¬ä¼šä½¿ç”¨åŸºäº net/http åŒ…è¿›è¡Œå°è£…çš„ä¼˜ç§€å¼€æº Web æ¡†æ¶ã€‚

å½“å‰æ¯”è¾ƒç«çš„ Go Web æ¡†æ¶æœ‰ Ginã€Beegoã€Echoã€Revelã€Martiniã€‚ä½ å¯ä»¥æ ¹æ®éœ€è¦è¿›è¡Œé€‰æ‹©ã€‚æˆ‘æ¯”è¾ƒæ¨è Ginï¼ŒGin ä¹Ÿæ˜¯ç›®å‰æ¯”è¾ƒå—æ¬¢è¿çš„ Web æ¡†æ¶ã€‚Gin Web æ¡†æ¶æ”¯æŒ Web æœåŠ¡çš„å¾ˆå¤šåŸºç¡€åŠŸèƒ½ï¼Œä¾‹å¦‚ HTTP/HTTPSã€JSON æ ¼å¼çš„æ•°æ®ã€è·¯ç”±åˆ†ç»„å’ŒåŒ¹é…ã€ä¸€è¿›ç¨‹å¤šæœåŠ¡ç­‰ã€‚

å¦å¤–ï¼ŒGin è¿˜æ”¯æŒ Web æœåŠ¡çš„ä¸€äº›é«˜çº§åŠŸèƒ½ï¼Œä¾‹å¦‚ ä¸­é—´ä»¶ã€è®¤è¯ã€RequestIDã€è·¨åŸŸå’Œä¼˜é›…å…³åœç­‰ã€‚



## è¯¾åç»ƒä¹ 

ä½¿ç”¨ Gin æ¡†æ¶ç¼–å†™ä¸€ä¸ªç®€å•çš„ Web æœåŠ¡ï¼Œè¦æ±‚è¯¥ Web æœåŠ¡å¯ä»¥è§£æå‚æ•°ã€æ ¡éªŒå‚æ•°ï¼Œå¹¶è¿›è¡Œä¸€äº›ç®€å•çš„ä¸šåŠ¡é€»è¾‘å¤„ç†ï¼Œæœ€ç»ˆè¿”å›å¤„ç†ç»“æœã€‚æ¬¢è¿åœ¨ç•™è¨€åŒºåˆ†äº«ä½ çš„æˆæœï¼Œæˆ–è€…é‡åˆ°çš„é—®é¢˜ã€‚

æ€è€ƒä¸‹ï¼Œå¦‚ä½•ç»™ iam-apiserver çš„ /healthz æ¥å£æ·»åŠ ä¸€ä¸ªé™æµä¸­é—´ä»¶ï¼Œç”¨æ¥é™åˆ¶è¯·æ±‚ /healthz çš„é¢‘ç‡ã€‚

æ¬¢è¿ä½ åœ¨ç•™è¨€åŒºä¸æˆ‘äº¤æµè®¨è®ºï¼Œæˆ‘ä»¬ä¸‹ä¸€è®²è§ã€‚



## END é“¾æ¥

<ul><li><div><a href = '15.md' style='float:left'>â¬†ï¸ä¸Šä¸€èŠ‚ğŸ”—  </a><a href = '17.md' style='float: right'>  ï¸ä¸‹ä¸€èŠ‚ğŸ”—</a></div></li></ul>

+ [â“‚ï¸å›åˆ°ç›®å½•ğŸ ](../README.md)

+ [**ğŸ«µå‚ä¸è´¡çŒ®ğŸ’â¤ï¸â€ğŸ”¥ğŸ’–**](https://nsddd.top/archives/contributors))

+ âœ´ï¸ç‰ˆæƒå£°æ˜ &copy; ï¼šæœ¬ä¹¦æ‰€æœ‰å†…å®¹éµå¾ª[CC-BY-SA 3.0åè®®ï¼ˆç½²å-ç›¸åŒæ–¹å¼å…±äº«ï¼‰&copy;](http://zh.wikipedia.org/wiki/Wikipedia:CC-by-sa-3.0åè®®æ–‡æœ¬) 

