# 1. æ•°æ®æ ¼å¼

### 1.1.1. æ•°æ®æ ¼å¼ä»‹ç»

- æ˜¯ç³»ç»Ÿä¸­æ•°æ®äº¤äº’ä¸å¯ç¼ºå°‘çš„å†…å®¹
- è¿™é‡Œä¸»è¦ä»‹ç»JSONã€XMLã€MSGPack

### 1.1.2. JSON

- jsonæ˜¯å®Œå…¨ç‹¬ç«‹äºè¯­è¨€çš„æ–‡æœ¬æ ¼å¼ï¼Œæ˜¯k-vçš„å½¢å¼ name:zs
- åº”ç”¨åœºæ™¯ï¼šå‰åç«¯äº¤äº’ï¼Œç³»ç»Ÿé—´æ•°æ®äº¤äº’

![img](https://www.topgoer.com/static/changyongbiaozhunku/1.png)

- jsonä½¿ç”¨goè¯­è¨€å†…ç½®çš„encoding/json æ ‡å‡†åº“
- ç¼–ç jsonä½¿ç”¨json.Marshal()å‡½æ•°å¯ä»¥å¯¹ä¸€ç»„æ•°æ®è¿›è¡ŒJSONæ ¼å¼çš„ç¼–ç 

```
    func Marshal(v interface{}) ([]byte, error)
```

ç¤ºä¾‹è¿‡ç»“æ„ä½“ç”Ÿæˆjson

```go
package main

import (
    "encoding/json"
    "fmt"
)

type Person struct {
    Name  string
    Hobby string
}

func main() {
    p := Person{"5lmh.com", "å¥³"}
    // ç¼–ç json
    b, err := json.Marshal(p)
    if err != nil {
        fmt.Println("json err ", err)
    }
    fmt.Println(string(b))

    // æ ¼å¼åŒ–è¾“å‡º
    b, err = json.MarshalIndent(p, "", "     ")
    if err != nil {
        fmt.Println("json err ", err)
    }
    fmt.Println(string(b))
}
```

#### struct tag

```
    type Person struct {
        //"-"æ˜¯å¿½ç•¥çš„æ„æ€
        Name  string `json:"-"`
        Hobby string `json:"hobby" `
    }
```

ç¤ºä¾‹é€šè¿‡mapç”Ÿæˆjson

```go
package main

import (
    "encoding/json"
    "fmt"
)

func main() {
    student := make(map[string]interface{})
    student["name"] = "5lmh.com"
    student["age"] = 18
    student["sex"] = "man"
    b, err := json.Marshal(student)
    if err != nil {
        fmt.Println(err)
    }
    fmt.Println(b)
}
```

- è§£ç jsonä½¿ç”¨json.Unmarshal()å‡½æ•°å¯ä»¥å¯¹ä¸€ç»„æ•°æ®è¿›è¡ŒJSONæ ¼å¼çš„è§£ç 

```
    func Unmarshal(data []byte, v interface{}) error
```

ç¤ºä¾‹è§£æåˆ°ç»“æ„ä½“

```go
package main

import (
    "encoding/json"
    "fmt"
)

type Person struct {
    Age       int    `json:"age,string"`
    Name      string `json:"name"`
    Niubility bool   `json:"niubility"`
}

func main() {
    // å‡æ•°æ®
    b := []byte(`{"age":"18","name":"5lmh.com","marry":false}`)
    var p Person
    err := json.Unmarshal(b, &p)
    if err != nil {
        fmt.Println(err)
    }
    fmt.Println(p)
}
```

ç¤ºä¾‹è§£æåˆ°interface

```go
package main

import (
    "encoding/json"
    "fmt"
)

func main() {
    // å‡æ•°æ®
    // intå’Œfloat64éƒ½å½“float64
    b := []byte(`{"age":1.3,"name":"5lmh.com","marry":false}`)

    // å£°æ˜æ¥å£
    var i interface{}
    err := json.Unmarshal(b, &i)
    if err != nil {
        fmt.Println(err)
    }
    // è‡ªåŠ¨è½¬åˆ°map
    fmt.Println(i)
    // å¯ä»¥åˆ¤æ–­ç±»å‹
    m := i.(map[string]interface{})
    for k, v := range m {
        switch vv := v.(type) {
        case float64:
            fmt.Println(k, "æ˜¯float64ç±»å‹", vv)
        case string:
            fmt.Println(k, "æ˜¯stringç±»å‹", vv)
        default:
            fmt.Println("å…¶ä»–")
        }
    }
}
```

### 1.1.3. XML

- æ˜¯å¯æ‰©å±•æ ‡è®°è¯­è¨€ï¼ŒåŒ…å«å£°æ˜ã€æ ¹æ ‡ç­¾ã€å­å…ƒç´ å’Œå±æ€§
- åº”ç”¨åœºæ™¯ï¼šé…ç½®æ–‡ä»¶ä»¥åŠwebService

ç¤ºä¾‹ï¼š

```
    <?xml version="1.0" encoding="UTF-8" ?>
    <servers version="1">
        <server>
            <serverName>Shanghai_VPN</serverName>
            <serverIP>127.0.0.1</serverIP>
        </server>
        <server>
            <serverName>Beijing_VPN</serverName>
            <serverIP>127.0.0.2</serverIP>
        </server>
    </servers>
package main

import (
   "encoding/xml"
   "fmt"
   "io/ioutil"
)

// æŠ½å–å•ä¸ªserverå¯¹è±¡
type Server struct {
   ServerName string `xml:"serverName"`
   ServerIP   string `xml:"serverIP"`
}

type Servers struct {
   Name    xml.Name `xml:"servers"`
   Version int   `xml:"version"`
   Servers []Server `xml:"server"`
}

func main() {
   data, err := ioutil.ReadFile("D:/my.xml")
   if err != nil {
      fmt.Println(err)
      return
   }
   var servers Servers
   err = xml.Unmarshal(data, &servers)
   if err != nil {
      fmt.Println(err)
      return
   }
   fmt.Printf("xml: %#v\n", servers)
}
```

### 1.1.4. MSGPack

- MSGPackæ˜¯äºŒè¿›åˆ¶çš„jsonï¼Œæ€§èƒ½æ›´å¿«ï¼Œæ›´çœç©ºé—´
- éœ€è¦å®‰è£…ç¬¬ä¸‰æ–¹åŒ…ï¼šgo get -u github.com/vmihailenco/msgpack

```go
package main

import (
   "fmt"
   "github.com/vmihailenco/msgpack"
   "io/ioutil"
   "math/rand"
)

type Person struct {
   Name string
   Age  int
   Sex  string
}

// äºŒè¿›åˆ¶å†™å‡º
func writerJson(filename string) (err error) {
   var persons []*Person
   // å‡æ•°æ®
   for i := 0; i < 10; i++ {
      p := &Person{
         Name: fmt.Sprintf("name%d", i),
         Age:  rand.Intn(100),
         Sex:  "male",
      }
      persons = append(persons, p)
   }
   // äºŒè¿›åˆ¶jsonåºåˆ—åŒ–
   data, err := msgpack.Marshal(persons)
   if err != nil {
      fmt.Println(err)
      return
   }
   err = ioutil.WriteFile(filename, data, 0666)
   if err != nil {
      fmt.Println(err)
      return
   }
   return
}

// äºŒè¿›åˆ¶è¯»å–
func readJson(filename string) (err error) {
   var persons []*Person
   // è¯»æ–‡ä»¶
   data, err := ioutil.ReadFile(filename)
   if err != nil {
      fmt.Println(err)
      return
   }
   // ååºåˆ—åŒ–
   err = msgpack.Unmarshal(data, &persons)
   if err != nil {
      fmt.Println(err)
      return
   }
   for _, v := range persons {
      fmt.Printf("%#v\n", v)
   }
   return
}

func main() {
   //err := writerJson("D:/person.dat")
   //if err != nil {
   // fmt.Println(err)
   // return
   //}
   err := readJson("D:/person.dat")
   if err != nil {
      fmt.Println(err)
      return
   }
}
```

## END é“¾æ¥
<ul><li><div><a href = '62.md' style='float:left'>â¬†ï¸ä¸Šä¸€èŠ‚ğŸ”—</a><a href = '64.md' style='float: right'>â¬‡ï¸ä¸‹ä¸€èŠ‚ğŸ”—</a></div></li></ul>

+ [â“‚ï¸å›åˆ°é¦–é¡µğŸ ](../README.md)

+ [**ğŸ«µå‚ä¸è´¡çŒ®ğŸ’â¤ï¸â€ğŸ”¥ğŸ’–**](https://nsddd.top/archives/contributors))

+ âœ´ï¸ç‰ˆæƒå£°æ˜ &copy; :æœ¬ä¹¦æ‰€æœ‰å†…å®¹éµå¾ª[CC-BY-SA 3.0åè®®ï¼ˆç½²å-ç›¸åŒæ–¹å¼å…±äº«ï¼‰&copy;](http://zh.wikipedia.org/wiki/Wikipedia:CC-by-sa-3.0åè®®æ–‡æœ¬) 

