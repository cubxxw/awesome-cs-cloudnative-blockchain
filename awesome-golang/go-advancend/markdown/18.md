+ [author](https://github.com/3293172751)
# ç¬¬18èŠ‚ go æ¨¡ç³Šæµ‹è¯•
+ [å›åˆ°ç›®å½•](../README.md)
+ [ä¸Šä¸€èŠ‚](17.md)
> â¤ï¸ğŸ’•ğŸ’•Goè¯­è¨€é«˜çº§ç¯‡ç« ,åœ¨æ­¤ä¹‹å‰å»ºè®®æ‚¨å…ˆäº†è§£åŸºç¡€å’Œè¿›é˜¶ç¯‡ã€‚Myblog:[http://nsddd.top](http://nsddd.top/)
###  **[Goè¯­è¨€åŸºç¡€ç¯‡](https://github.com/cubxxw/awesome-cs-cloudnative-blockchain/blob/master/TOC.md)**
###  **[Goè¯­è¨€100ç¯‡è¿›é˜¶](https://github.com/cubxxw/awesome-cs-cloudnative-blockchain/blob/master/Gomd_super/README.md)**
---
[TOC]

## Why you need itï¼Ÿ

::: tip
å¯¹æµ‹è¯•è¿›è¡Œä¸€éƒ¨åˆ†çš„å¢å¼ºï¼Œæˆ‘ä»¬å¹³å¸¸å†™ä»£ç åè‚¯å®šéœ€è¦ä¸€éƒ¨åˆ†çš„å•å…ƒæµ‹è¯•ï¼Œåœ¨åŸæœ‰åŸºç¡€ä¸Šå¢å¼ºã€‚

:::



## æµ‹è¯•æº

ğŸ’¡ç®€å•çš„ä¸€ä¸ªæ¡ˆä¾‹å¦‚ä¸‹ï¼š

```go
package main

import "fmt"

func reverse[T string](s T) T {
	b := []byte(s)
	for i, j := 0, len(b)-1; i < j; i, j = i+1, j-1 {
		b[i], b[j] = b[j], b[i]
	}
	return T(b)
}

func main() {
	fmt.Println("åè½¬ä¹‹å‰ï¼š", "hello")
	fmt.Println("åè½¬ä¹‹åï¼š", reverse("hello"))

	fmt.Println("åè½¬ä¹‹å‰ï¼š", "hello welcome to golang")
	fmt.Println("åè½¬ä¹‹åï¼š", reverse("hello welcome to golang"))
}

```

ğŸš€ ç¼–è¯‘ç»“æœå¦‚ä¸‹ï¼š

```bash
[Running] go run "c:\Users\smile\Desktop\test\fuzz-demo\reverse.go"
åè½¬ä¹‹å‰ï¼š hello
åè½¬ä¹‹åï¼š olleh
åè½¬ä¹‹å‰ï¼š hello welcome to golang
åè½¬ä¹‹åï¼š gnalog ot emoclew olleh
```



## éœ€è¦æµ‹è¯•

**æˆ‘ä»¬æµ‹è¯•è¿‡ä¸Šé¢çš„å­—ç¬¦ä¸²æ˜¯æ²¡æœ‰é—®é¢˜çš„ï¼Œä½†æ˜¯æ€ä¹ˆçŸ¥é“æµ‹è¯•å…¶ä»–çš„å†…å®¹ä¼šä¸ä¼šå‡ºç°é—®é¢˜å‘¢ï¼Ÿ**

æˆ‘ä»¬éœ€è¦å•å…ƒæµ‹è¯•ï¼š`reverse_test.go`

```go
package main

import "fmt"

func Reverse[T string](s T) T {
	b := []byte(s)
	for i, j := 0, len(b)-1; i < j; i, j = i+1, j-1 {
		b[i], b[j] = b[j], b[i]
	}
	return T(b)
}

func main() {
	fmt.Println("åè½¬ä¹‹å‰ï¼š", "hello")
	fmt.Println("åè½¬ä¹‹åï¼š", Reverse("hello"))

	fmt.Println("åè½¬ä¹‹å‰ï¼š", "hello welcome to golang")
	fmt.Println("åè½¬ä¹‹åï¼š", Reverse("hello welcome to golang"))
}

```

ğŸš€ ç¼–è¯‘ç»“æœå¦‚ä¸‹ï¼š

::: details è¡¥å……
æŒ‰ç†è¯´æˆ‘ä»¬åªéœ€è¦ `go test`  å°±å¯ä»¥æ‰§è¡Œæµ‹è¯•ç”¨ä¾‹ï¼Œä½†æ˜¯æˆ‘ä»¬æŠ¥é”™ï¼š

```bash
directory . is contained in a module that is not one of the workspace modules listed in go.work. You can add the module to the workspace using go work use .
# ç›®å½•ä¸­ã€‚åŒ…å«åœ¨ä¸æ˜¯go.workä¸­åˆ—å‡ºçš„å·¥ä½œç©ºé—´æ¨¡å—ä¹‹ä¸€çš„æ¨¡å—ä¸­ã€‚æ‚¨å¯ä»¥ä½¿ç”¨go work useå°†æ¨¡å—æ·»åŠ åˆ°å·¥ä½œåŒºã€‚
```

æˆ‘ä»¬å¦‚æœè¦ä½¿ç”¨ `go work` ä¸‹çš„æµ‹è¯•ï¼Œæˆ‘ä»¬éœ€è¦åŠ å…¥åˆ°å·¥ä½œåŒºï¼š

```
 go work use .\fuzz-demo\
```

**âš ï¸ å¦‚æœæ˜¯å·¥ä½œåŒºï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥åœ¨å·¥ä½œåŒºæµ‹è¯•ï¼š**

```bash
go test mszlu.com/fuzz-demo
```

:::

```bash
PS C:\Users\smile\Desktop\test\fuzz-demo> go test        
--- FAIL: TestReverse (0.00s)
    reverse_test.go:27: reverse("abc!def12321fedcba") == "abcdef12321fed!cba", want "abc!def12321fedcba"
FAIL
exit status 1
FAIL    nsddd.top/fuzz-demo     0.235s
```

æ˜¯çš„ï¼Œæˆ‘ç•™ä¸‹äº†ä¸€ä¸ªå°bugï¼Œæˆ‘ä»¬è¯•ç€è§£å†³å®ƒï¼š

```bash
{"abc!def12321fedcba", "abcdef12321fed!cba"},
```

ğŸš€ ç¼–è¯‘ç»“æœå¦‚ä¸‹ï¼š

```bash
PS C:\Users\smile\Desktop\test\fuzz-demo> go test
PASS
ok      nsddd.top/fuzz-demo     0.274s
```

:::



## é—®é¢˜

å³ä½¿æˆ‘ä»¬çœ‹èµ·æ¥ä¸‡æ— ä¸€å¤±ï¼Œä½†æ˜¯å®é™…ä¸Šè¿˜æ˜¯æœ‰ä¸ªé—®é¢˜ï¼Œå½“æˆ‘ä»¬è¾“å…¥ä¸­æ–‡çš„æ—¶å€™ï¼Œæˆ‘ä»¬çŸ¥é“æ­¤æ—¶çš„`byte[]` æ˜¯å¾ˆå¼±é¸¡çš„~

ğŸ’¡ç®€å•çš„ä¸€ä¸ªæ¡ˆä¾‹å¦‚ä¸‹ï¼š

```bash
package main

import (
	"fmt"
	"testing"
)

func test() {
	fmt.Println("è¿™æ˜¯fuzz-demoçš„reverse_test.go")
}

func TestReverse(t *testing.T) {
	testcases := []struct { //å®šä¹‰ä¸€ä¸ªç»“æ„ä½“æ•°ç»„
		in, want string //åˆ†åˆ«æ˜¯è¾“å…¥å’ŒæœŸæœ›è¾“å‡º
	}{
		{"hello", "olleh"},
		{"hello welcome to golang", "gnalog ot emoclew olleh"},
		{"", ""},
		{"a", "a"},
		{"ab", "ba"},
		{"abc!", "!cba"},
		{"abc!def12321fedcba", "abcdef12321fed!cba"},
		{"æˆ‘æ˜¯ä¸­å›½äºº", "äººä¸­å›½æ˜¯æˆ‘"},
	}
	for _, c := range testcases {
		got := reverse(c.in)
		if got != c.want {
			t.Errorf("reverse(%q) == %q, want %q", c.in, got, c.want)
		}
	}
}
```

ğŸ’¡ç®€å•çš„ä¸€ä¸ªæ¡ˆä¾‹å¦‚ä¸‹ï¼š

```bash
PS C:\Users\smile\Desktop\test\fuzz-demo> go test
--- FAIL: TestReverse (0.00s)
    reverse_test.go:28: reverse("æˆ‘æ˜¯ä¸­å›½äºº") == "\xba\xbaä½›å­¸ä¯˜æ‘ˆ\xe6", want "äººä¸­å›½æ˜¯æˆ‘"
FAIL
exit status 1
FAIL    nsddd.top/fuzz-demo     0.264s
```



::: danger 
å½“ç„¶ï¼Œæˆ‘ä»¬çš„ç›®çš„ä¸ä»…ä»…æ˜¯ä¸ºäº†è§£å†³å®ƒï¼Œè€Œæ˜¯è¯´æ˜æˆ‘ä»¬çš„æµ‹è¯•æ–¹æ³•æˆ–è®¸å¯ä»¥æ”¹è¿›ï¼›

æˆ‘ä»¬å¯èƒ½å†™ä¸äº†é‚£ä¹ˆå¤šçš„æµ‹è¯•ç”¨ä¾‹ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ¨¡ç³Šæµ‹è¯•äº†

:::



## æ¨¡ç³Šæµ‹è¯•

ğŸ’¡ç®€å•çš„ä¸€ä¸ªæ¡ˆä¾‹å¦‚ä¸‹ï¼š

```go
package main

import (
	"fmt"
	"testing"
	"unicode/utf8"
)

func test() {
	fmt.Println("è¿™æ˜¯fuzz-demoçš„reverse_test.go")
}

func TestReverse(t *testing.T) {
	testcases := []struct { //å®šä¹‰ä¸€ä¸ªç»“æ„ä½“æ•°ç»„
		in, want string //åˆ†åˆ«æ˜¯è¾“å…¥å’ŒæœŸæœ›è¾“å‡º
	}{
		{"hello", "olleh"},
		{"hello welcome to golang", "gnalog ot emoclew olleh"},
		{"", ""},
		{"a", "a"},
		{"ab", "ba"},
		{"abc!", "!cba"},
		{"abc!def12321fedcba", "abcdef12321fed!cba"},
		// {"æˆ‘æ˜¯ä¸­å›½äºº", "äººä¸­å›½æ˜¯æˆ‘"},
	}
	for _, c := range testcases {
		got := Reverse(c.in)
		if got != c.want {
			t.Errorf("reverse(%q) == %q, want %q", c.in, got, c.want)
		}
	}
}

func FuzzReverse(f *testing.F) {
	// ...è¿™æ˜¯æ¨¡ç³Šæµ‹è¯•çš„ä»£ç 
	// æ·»åŠ æµ‹è¯•é›†
	testcases := []string{"hello", "hello world", "hello welcome to golang", " ", "123124"}
	for _, c := range testcases {
		//æ·»åŠ æµ‹è¯•é›†
		f.Add(c)
	}

	f.Fuzz(func(t *testing.T, a string) {
		got := Reverse(a)
		inRevers := Reverse(got) //åè½¬ä¸¤æ¬¡ï¼Œåº”è¯¥å’ŒåŸæ¥çš„ä¸€æ ·(a == inRevers)
		if got == inRevers {
			t.Errorf("reverse(%q) == %q, want %q", a, got, a)
		}
		if utf8.ValidString(a) && !utf8.ValidString(got) {
			t.Errorf("Reverse produced invalid UTF-8 string: %q", got)
		}
	})
}

```

ğŸš€ ç¼–è¯‘ç»“æœå¦‚ä¸‹ï¼š

::: tip æ‰§è¡Œæ–¹æ³•
æ‰§è¡Œæ‰€æœ‰ Fuzz å¼€å¤´çš„æ¨¡ç³Šæµ‹è¯•ï¼š

```bash
 go test -fuzz=Fuzz  # æ‰§è¡Œæ‰€æœ‰ Fuzz å¼€å¤´çš„æ¨¡ç³Šæµ‹è¯•
```

:::

```
PS C:\Users\smile\Desktop\test\fuzz-demo> go test -fuzz=Fuzz
--- FAIL: TestReverse (0.00s)
    reverse_test.go:29: reverse("æˆ‘æ˜¯ä¸­å›½äºº") == "\xba\xbaä½›å­¸ä¯˜æ‘ˆ\xe6", want "äººä¸­å›½æ˜¯æˆ‘"
FAIL
exit status 1
FAIL    nsddd.top/fuzz-demo     0.268s
```



## END é“¾æ¥

+ [å›åˆ°ç›®å½•](../README.md)
+ [ä¸Šä¸€èŠ‚](17.md)
+ [ä¸‹ä¸€èŠ‚](19.md)
---
+ [å‚ä¸è´¡çŒ®â¤ï¸ğŸ’•ğŸ’•](https://github.com/cubxxw/awesome-cs-cloudnative-blockchain/blob/master/Git/git-contributor.md)