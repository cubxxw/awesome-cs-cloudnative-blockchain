+ [author](https://github.com/3293172751)

# ç¬¬20èŠ‚ Golangäº‘åŸç”Ÿéƒ¨ç½²

+ [å›åˆ°ç›®å½•](../README.md)
+ [ä¸Šä¸€èŠ‚](19.md)
> â¤ï¸ğŸ’•ğŸ’•Goè¯­è¨€é«˜çº§ç¯‡ç« ,åœ¨æ­¤ä¹‹å‰å»ºè®®æ‚¨å…ˆäº†è§£åŸºç¡€å’Œè¿›é˜¶ç¯‡ã€‚Myblog:[http://nsddd.top](http://nsddd.top/)
###  **[Goè¯­è¨€åŸºç¡€ç¯‡](https://github.com/cubxxw/awesome-cs-cloudnative-blockchain/blob/master/TOC.md)**
###  **[Goè¯­è¨€100ç¯‡è¿›é˜¶](https://github.com/cubxxw/awesome-cs-cloudnative-blockchain/blob/master/Gomd_super/README.md)**
---
[TOC]

## å¼€å§‹

**æˆ‘ä»¬ä½¿ç”¨ `beego` æ•™ç¨‹ä¸­å­¦åˆ°çš„ `bee` å‘½ä»¤æ„å»ºä¸€ä¸ª dockerfileï¼Œå½“ç„¶ä¹Ÿå¯ä»¥è‡ªå·±å†™ï¼š**

### dockerize å‘½ä»¤

è¿™ä¸ªå‘½ä»¤å¯ä»¥é€šè¿‡ç”Ÿæˆ`Dockerfile`æ–‡ä»¶æ¥å®ç°`docker`åŒ–ä½ çš„åº”ç”¨ã€‚

**ä¾‹å­:**

ç”Ÿæˆä¸€ä¸ªä»¥`1.9.2`ç‰ˆæœ¬Goç¯å¢ƒä¸ºåŸºç¡€é•œåƒçš„Dockerfile,å¹¶æš´éœ²9000ç«¯å£:

```
bee dockerize -image="library/golang:1.9.2" -expose=8080
```

æ›´å¤šå¸®åŠ©ä¿¡æ¯å¯æ‰§è¡Œ`bee help dockerize`.

::: tip æ‰“å¼€ dockerfile æ–‡ä»¶ï¼š

```dockerfile
FROM library/golang:1.9.2

# Godep for vendoring
RUN go get github.com/tools/godep

# Recompile the standard library without CGO
RUN CGO_ENABLED=0 go install -a std

ENV APP_DIR $GOPATHD:\æ–‡æ¡£\æœ€è¿‘çš„\awesome-golang\docs\code\beego
RUN mkdir -p $APP_DIR

# Set the entrypoint
ENTRYPOINT (cd $APP_DIR && ./D:\æ–‡æ¡£\æœ€è¿‘çš„\awesome-golang\docs\code\beego)
ADD . $APP_DIR

# Compile the binary and statically link
RUN cd $APP_DIR && CGO_ENABLED=0 godep go build -ldflags '-d -w -s'

EXPOSE 8080
```

:::



#### éƒ¨ç½²dockerfile

```
docker build -t mybeego:1.0 .
```



## æ–¹å¼äºŒï¼šæµ‹è¯•é¡¹ç›®

**æ‹‰å–é•œåƒï¼š**

```bash
git clone https://gitee.com/nickdemo/helloworld.git
```



**æ„å»ºé•œåƒï¼š**

::: tip 

+ `go env -w `ï¼šè®¾ç½®é•œåƒ
+ `WORKDIR`ï¼šè®¾ç½®å·¥ä½œç›®å½•ï¼ˆæŒ‡å®šåˆ›å»ºå®¹å™¨åï¼Œç»ˆç«¯ **é»˜è®¤ç™»é™†è¿›æ¥çš„å·¥ä½œç›®å½•**ï¼‰

```dockerfile
FROM golang:1.18
ADD ./ /go/src/helloworld/
WORKDIR /go/src/helloworld
RUN go env -w GOPROXY=https://proxy.golang.com.cn,https://goproxy.cn,direct
RUN CGO_ENABLED=0 GOOS=linux GOARCH=amd64 go build -o app .

FROM alpine:latest
ENV env1=env1value
ENV env2=env2value
MAINTAINER nick
WORKDIR /app/
COPY --from=0 /go/src/helloworld/app ./
EXPOSE 80
ENTRYPOINT ["./app"]
CMD ["--param1=p1","--param2=p2"]
```



#### éƒ¨ç½²dockerfile

+ `â€“no-cache`ï¼šä¸ä½¿ç”¨ç¼“å­˜

```
docker build -t helloworld:1.0 .
```



## æ¨é€é•œåƒ

nameï¼šhello-world

```bash
docker push 3293172751/hello-world:tagname
```



**tagï¼š**

```bash
docker  tag helloworld:1.0 3293172751/hello-world:1.0
```



**push:**

```
docker push  3293172751/hello-world:1.0
```





## å®šä¹‰ k8s åº”ç”¨ç¨‹åºè½½ä½“ Pod

+ `restartPolicy`
  + Alwaysï¼šé™¤æ­£å¸¸é€€å‡ºå¤–ï¼Œéƒ½ä¼šé‡å¯æˆ‘ä»¬çš„å®¹å™¨
  + Neverï¼šä»»ä½•æƒ…å†µä¸‹ï¼Œå®¹å™¨å…³é—­éƒ½ä¸ä¼šé‡å¯
  + Onfailureï¼šç¨‹åºå¼‚å¸¸é€€å‡º
+ `imagePullPolicy`
  + Alwaysï¼šæ¯æ¬¡éƒ¨ç½²éƒ½é‡æ–°æ‹‰å–é•œåƒ
  + Neverï¼šåªä½¿ç”¨æœ¬åœ°é•œåƒ
  + ifNotPresentï¼šå¦‚æœæœ¬åœ°å­˜åœ¨ï¼Œåˆ™ä¸æ‹‰å–
+ `command`ï¼šå¯åŠ¨å‘½ä»¤
+ `resources`ï¼šå¯¹èµ„æºçš„é™ç”¨

```yaml
apiVersion v1
kind Pod 
metadata
  name: myhello-pod-demo
  namespace: default
  labels:
  	name: myhello-pod-demo
  	env: dev
spec:
  restartPolicy: Always
  containers:
  - name: myhello
  	image: 
  	imagePullPolicy: ifNotPresent
  	ports:
  	- containerPort: 80
  	command: ["./app"]
  	args: ["--param1=k8s-p1","--param2=k8s-p2"]
  	resources:
  	  limits:
  	    memory: 200Mi
  	  requests:
  	  	cpu: 100m
  	  	memory: 200Mi
 env: 
 - name: env1
   value: "k8s-env1"
 - name: env2
   value: "k8s-env2"
```





## END é“¾æ¥
+ [å›åˆ°ç›®å½•](../README.md)
+ [ä¸Šä¸€èŠ‚](19.md)
+ [ä¸‹ä¸€èŠ‚](21.md)
---
+ [å‚ä¸è´¡çŒ®â¤ï¸ğŸ’•ğŸ’•](https://github.com/cubxxw/awesome-cs-cloudnative-blockchain/blob/master/Git/git-contributor.md)