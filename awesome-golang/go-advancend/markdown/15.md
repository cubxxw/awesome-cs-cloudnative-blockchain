+ [author](https://github.com/3293172751)

# ç¬¬15èŠ‚ Cobra

+ [å›åˆ°ç›®å½•](../README.md)
+ [ä¸Šä¸€èŠ‚](14.md)
> â¤ï¸ğŸ’•ğŸ’•Goè¯­è¨€é«˜çº§ç¯‡ç« ,åœ¨æ­¤ä¹‹å‰å»ºè®®æ‚¨å…ˆäº†è§£åŸºç¡€å’Œè¿›é˜¶ç¯‡ã€‚Myblog:[http://nsddd.top](http://nsddd.top/)
###  **[Goè¯­è¨€åŸºç¡€ç¯‡](https://github.com/cubxxw/awesome-cs-cloudnative-blockchain/blob/master/TOC.md)**
###  **[Goè¯­è¨€100ç¯‡è¿›é˜¶](https://github.com/cubxxw/awesome-cs-cloudnative-blockchain/blob/master/Gomd_super/README.md)**
---
[TOC]

## cobra ç®€ä»‹

::: tip

+ cobra æ˜¯ä¸€ä¸ªç”¨äºç”Ÿæˆå‘½ä»¤è¡Œå·¥å…·çš„æ¡†æ¶ ï¼ˆæœ¬èº«ä¹Ÿæ˜¯ä¸€ä¸ªå‘½ä»¤è¡Œå·¥å…·ï¼‰
+ éå¸¸ç®€å•ï¼Œæ˜“ç”¨
+ ä½¿ç”¨å®ƒçš„é¡¹ç›®å¾ˆå¤š ï¼ˆkubernetesã€etcdã€hugoã€dockerâ€¦â€¦)

**å¼€æºåœ°å€ï¼šhttps://github.com/spf13/cobra**

:::



## Cobra å®‰è£…

+ `-u` ï¼šupdate

```
go get -u github.com/spf13/cobra@latest
```



##  é¡¹ç›®ä¸­å¯¼å…¥

```bash
import "github.com/spf13/cobra"
```



## cobra-cli

`cobra-cli`æ˜¯ä¸€ä¸ªå‘½ä»¤è¡Œç¨‹åºï¼Œç”¨äºç”Ÿæˆ Cobra åº”ç”¨ç¨‹åºå’Œå‘½ä»¤æ–‡ä»¶ã€‚å®ƒå°†å¼•å¯¼æ‚¨çš„åº”ç”¨ç¨‹åºè„šæ‰‹æ¶ä»¥å¿«é€Ÿå¼€å‘åŸºäº Cobra çš„åº”ç”¨ç¨‹åºã€‚è¿™æ˜¯å°† Cobra åˆå¹¶åˆ°æ‚¨çš„åº”ç”¨ç¨‹åºä¸­çš„æœ€ç®€å•æ–¹æ³•ã€‚

å®ƒå¯ä»¥é€šè¿‡è¿è¡Œæ¥å®‰è£…ï¼š

```go
go install github.com/spf13/cobra-cli@latest
```





## cobra é¡¹ç›®åˆ›å»º

å»ºè®®ä½¿ç”¨Go Module æ¨¡å¼ï¼Œé¦–å…ˆï¼Œåˆ›å»ºä¸€ä¸ªGo Moduleé¡¹ç›®ï¼Œåç§°é‡‡ç”¨ `clid`

```go
mkdir clid; cd clid 
go mod init clid
```



**ä¸€èˆ¬ä½¿ç”¨ä¸Šé¢çš„æ–¹æ³•æœ‰ç‚¹éº»çƒ¦ï¼Œé‚£ä¹ˆå¯ä»¥å¸®åŠ©ä½ ç”Ÿæˆå¼€æºåè®®å’Œä¸€äº›ä¸œè¥¿ï¼š**

```bash
cobra init clid  -a xiongxinwei -l MIT 
```

::: warning ğŸ“œ å¯¹ä¸Šé¢çš„è§£é‡Š

+ é»˜è®¤ä½¿ç”¨çš„  [Apache License 2.0 ](https://github.com/kubecub/cub/blob/main/LICENSE)Â© åè®®
+ å¯ä»¥æŒ‡å®šä½œè€… `-a`
+ å¯ä»¥æŒ‡å®šåè®® `-l`  (MIT / Apache)

:::



## ç¼–è¯‘

æˆ‘ä»¬åˆ›å»ºå®Œä¹‹åæ˜¯å¯ä»¥ç›´æ¥ç”¨ `go build` ç¼–è¯‘é¡¹ç›®çš„ï¼š

::: details ç¼–è¯‘ä¿¡æ¯å±•å¼€

```bash
PS D:clid> go build
PS D:clid> ls

    Directory: D:clid

Mode                 LastWriteTime         Length Name
----                 -------------         ------ ----
d----          2022/11/15     9:32                cmd
-a---          2022/11/15     9:49        4336640 clid.exe
-a---          2022/11/15     9:04            177 go.mod
-a---          2022/11/15     9:04            896 go.sum
-a---          2022/11/15     9:32          11358 LICENSE
-a---          2022/11/15     9:49            622 main.go

PS D:clid> .\clid.exe
A longer description that spans multiple lines and likely contains
examples and usage of using your application. For example:

Cobra is a CLI library for Go that empowers applications.
This application is a tool to generate the needed files
to quickly create a Cobra application.
```

:::



### main.go

æˆ‘ä»¬è§‚å¯Ÿ`main.go`

```go
/*
Copyright Â© 2022 xiongxinwei

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
*/
package main

import "go-advancend-code/cobra/cmd"

func main() {
	cmd.Execute()
}
```

> å¾ˆç®€å•çš„ä¸€ä¸ªå‡½æ•°ï¼Œå°±åªæœ‰ `cmd.Execute()`
>
> `Execute`å°†æ‰€æœ‰å­å‘½ä»¤æ·»åŠ åˆ°æ ¹å‘½ä»¤å¹¶é€‚å½“è®¾ç½®æ ‡å¿—ã€‚å®ƒç”±`main.main()`è°ƒç”¨ã€‚å®ƒåªéœ€è¦åœ¨`rootCmd`ä¸Šå‘ç”Ÿä¸€æ¬¡ã€‚

*é‚£ä¹ˆæˆ‘ä»¬å¯ä»¥å»çœ‹ `root.go`æ–‡ä»¶äº†*



### root.go

**`cmd/root.go` ç›®å½•ï¼š**

è¿™ä¸ªç›®å½•æ˜¯ä¼šå½±å“åˆ°é¡¹ç›®çš„åè®®çš„~

```go
/*
Copyright Â© 2022 xiongxinwei

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
*/
package cmd

import (
	"os"

	"github.com/spf13/cobra"
)



// rootCmd represents the base command when called without any subcommands
var rootCmd = &cobra.Command{
	Use:   "cobra",
	Short: "A brief description of your application",
	Long: 
    `A longer description that spans multiple lines and likely contains
examples and usage of using your application. For example:

Cobra is a CLI library for Go that empowers applications.
This application is a tool to generate the needed files
to quickly create a Cobra application.`,
	// Uncomment the following line if your bare application
	// has an action associated with it:
	// Run: func(cmd *cobra.Command, args []string) { },
}

// Execute adds all child commands to the root command and sets flags appropriately.
// This is called by main.main(). It only needs to happen once to the rootCmd.
func Execute() {
	err := rootCmd.Execute()
	if err != nil {
		os.Exit(1)
	}
}

func init() {
	// Here you will define your flags and configuration settings.
	// Cobra supports persistent flags, which, if defined here,
	// will be global for your application.

	// rootCmd.PersistentFlags().StringVar(&cfgFile, "config", "", "config file (default is $HOME/.cobra.yaml)")

	// Cobra also supports local flags, which will only run
	// when this action is called directly.
	rootCmd.Flags().BoolP("toggle", "t", false, "Help message for toggle")
}

```

::: tip
æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä¸Šé¢æœ‰ `run` ã€`short`ã€`Long`

æ˜¯çš„ï¼Œæˆ‘ä»¬å¯ä»¥ä¿®æ”¹è¿™äº›ä¿¡æ¯æ¥è°ƒæ•´è¾“å‡ºä¿¡æ¯

:::



ä¿®æ”¹ `long` ï¼š

```go
var rootCmd = &cobra.Command{
	Use:   "cobra",
	Short: "A brief description of your application",
	Long:  `ä¸€ä¸ªå¸®åŠ©ä¿¡æ¯`,
}
```

 ğŸš€ ç¼–è¯‘ç»“æœå¦‚ä¸‹ï¼š

```bash
PS D:clid> go run .\main.go
ä¸€ä¸ªå¸®åŠ©ä¿¡æ¯
```



## ä¸ºå‘½ä»¤åŠ ä¸Šä¸€ä¸ªå­å‘½ä»¤

**æ·»åŠ ä¸€ä¸ªåå« `test` çš„å­å‘½ä»¤**

```
cobra add test -a xiongxinwei -l MIT
```



**æ•ˆæœ** å¯ä»¥çœ‹å‡ºæ¥ `cmd`ç›®å½•ä¸‹å¤šäº†ä¸€ä¸ª `test.go` ï¼š

```bash
PS D:clid> pwd

Path
----
D:clid

PS D:clid> ls cmd

    Directory: D:clid\cmd

Mode                 LastWriteTime         Length Name
----                 -------------         ------ ----
-a---          2022/11/15     9:52           1973 root.go

PS D:clid> cobra add test
test created at D:clid
PS D:clid> ls cmd       

    Directory: D:clid\cmd

Mode                 LastWriteTime         Length Name
----                 -------------         ------ ----
-a---          2022/11/15     9:52           1973 root.go
-a---          2022/11/15     9:58           1064 test.go
```



**ä¿®æ”¹åŸºæœ¬ä¿¡æ¯è¿è¡Œï¼š**

```go
// testCmd represents the test command
var testCmd = &cobra.Command{
	Use:   "æµ‹è¯•use",
	Short: "æµ‹è¯•short",
	Long:  `æµ‹è¯•longä¿¡æ¯`,
	Run: func(cmd *cobra.Command, args []string) {
		fmt.Println("æµ‹è¯•run")
	},
}
```

ğŸš€ ç¼–è¯‘ç»“æœå¦‚ä¸‹ï¼š

```bash
PS D:clid> go run .\main.go
ä¸€ä¸ªå¸®åŠ©ä¿¡æ¯

Usage:
  cobra [command]

Available Commands:
  completion  Generate the autocompletion script for the specified shell
  help        Help about any command
  æµ‹è¯•use       æµ‹è¯•short

Flags:
  -h, --help     help for cobra
  -t, --toggle   Help message for toggle

Use "cobra [command] --help" for more information about a command.

```

å°è¯•ï¼š

```bash
.\clid.exe æµ‹è¯•use
æµ‹è¯•run
```

å†ä¸€æ¬¡å°è¯•ï¼š

```bash
PS D:clid> .\clid.exe æµ‹è¯•use -h
æµ‹è¯•longä¿¡æ¯

Usage:
  cobra æµ‹è¯•use [flags]

Flags:
  -h, --help   help for æµ‹è¯•use
```



::: warning so
æ‰€ä»¥æˆ‘ä»¬çªç„¶æ˜ç™½äº†ï¼ŒåŸæ¥è¿™ä¸ªå‘½ä»¤ä¸»è¦æ˜¯åŸºäº ä¸»å‘½ä»¤ `root.go` ä¸‹é¢çš„ï¼Œ`root.go` å°±æ˜¯ `cobra`

æˆ‘ä»¬å°±å¯ä»¥åŸºäºæ­¤è®¾ç½®ä¸€ç³»åˆ—å­å‘½ä»¤

:::



### ç»‘å®šçˆ¶å‘½ä»¤

æ¯ä¸ªå­å‘½ä»¤éƒ½æœ‰ä¸€ä¸ª `init` å‡½æ•°ï¼Œå°±æ˜¯ç”¨æ¥ç»‘å®šçš„~

```go
func init() {
	rootCmd.AddCommand(testCmd)
}
```



**åˆ›å»ºä¸€ä¸ª `version` å‘½ä»¤**

```
cobra add version -a xiongxinwei -l MIT
```



**ä¿®æ”¹ï¼š**

```go
/*
Copyright Â© 2022 xiongxinwei

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in
all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
THE SOFTWARE.
*/
package cmd

import (
	"fmt"

	"github.com/spf13/cobra"
)

// versionCmd represents the version command
var versionCmd = &cobra.Command{
	Use:   "version",
	Short: "A brief description of your command",
	Long: `A longer description that spans multiple lines and likely contains examples
and usage of using your command. For example:

Cobra is a CLI library for Go that empowers applications.
This application is a tool to generate the needed files
to quickly create a Cobra application.`,
	Run: func(cmd *cobra.Command, args []string) {
		fmt.Println("version called")
	},
}

func init() {
	// rootCmd.AddCommand(versionCmd)

	testCmd.AddCommand(versionCmd)

}

```

ğŸš€ ç¼–è¯‘ç»“æœå¦‚ä¸‹ï¼š

```go
PS D:clid> go build               
PS D:clid> .\clid.exe test  
æµ‹è¯•run
PS D:clid> .\clid.exe version
Error: unknown command "version" for "cobra"
Run 'cobra --help' for usage.
PS D:clid> .\clid.exe test version
version called
```

> **å¯ä»¥çœ‹åˆ°ç»‘å®šåˆ° `test` ä¸Šé¢äº†ï¼Œå½“ç„¶ä½ å¯ä»¥å–æ¶ˆæ³¨é‡Šï¼ŒåŒæ—¶ç»‘å®šä¸¤ä¸ª~**
>
> ```powershell
> PS D:\æ–‡æ¡£\æœ€è¿‘çš„\awesome-golang\docs\go-advancend\code\cobra\clid> .\clid.exe test version
> version called
> PS D:\æ–‡æ¡£\æœ€è¿‘çš„\awesome-golang\docs\go-advancend\code\cobra\clid> .\clid.exe version
> version called
> PS D:\æ–‡æ¡£\æœ€è¿‘çš„\awesome-golang\docs\go-advancend\code\cobra\clid> .\clid.exe test
> æµ‹è¯•run
> ```



## ä¸ºå‘½ä»¤æ·»åŠ é€‰é¡¹

è¿™ä¸ªæˆ‘ä»¬å°±éœ€è¦å» `init()` å‡½æ•°ä¸­æ·»åŠ æ–¹æ³•äº†ï¼š

```go
/*
Copyright Â© 2022 xiongxinwei

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in
all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
THE SOFTWARE.
*/
package cmd

import (
	"fmt"

	"github.com/spf13/cobra"
)

// versionCmd represents the version command
var versionCmd = &cobra.Command{
	Use:   "version",
	Short: "å…³äºç‰ˆæœ¬ä¿¡æ¯çŸ­æè¿°",
	Long:  `å…³äºç‰ˆæœ¬ä¿¡æ¯é•¿æè¿°`,
	Run: func(cmd *cobra.Command, args []string) {
		fmt.Println("version called")
		author, _ := cmd.Flags().GetString("author")
		fmt.Println("ä½œè€…æ˜¯ï¼š", author)

	},
}

func init() {
	rootCmd.AddCommand(versionCmd)

	testCmd.AddCommand(versionCmd)

	// æ·»åŠ å‚æ•°
	versionCmd.Flags().StringP("author", "n", "default", "name") //åç§°ï¼Œç®€å†™ï¼Œé»˜è®¤å€¼ï¼Œæè¿°

}

```

ğŸš€ ç¼–è¯‘ç»“æœå¦‚ä¸‹ï¼š

```bash
PS D:\æ–‡æ¡£\æœ€è¿‘çš„\awesome-golang\docs\go-advancend\code\cobra\clid> go build
PS D:\æ–‡æ¡£\æœ€è¿‘çš„\awesome-golang\docs\go-advancend\code\cobra\clid> .\clid.exe version -help
Error: unknown shorthand flag: 'e' in -elp
Usage:
  cobra test version [flags]

Flags:
  -n, --author string   name (default "default")
  -h, --help            help for version

PS D:\æ–‡æ¡£\æœ€è¿‘çš„\awesome-golang\docs\go-advancend\code\cobra\clid> .\clid.exe version
version called
ä½œè€…æ˜¯ï¼š default
PS D:\æ–‡æ¡£\æœ€è¿‘çš„\awesome-golang\docs\go-advancend\code\cobra\clid> .\clid.exe test version
version called
ä½œè€…æ˜¯ï¼š default
PS D:\æ–‡æ¡£\æœ€è¿‘çš„\awesome-golang\docs\go-advancend\code\cobra\clid> .\clid.exe test -h     
æµ‹è¯•longä¿¡æ¯

Usage:
  cobra test [flags]
  cobra test [command]

Available Commands:
  version     å…³äºç‰ˆæœ¬ä¿¡æ¯çŸ­æè¿°

Flags:
  -h, --help   help for test

Use "cobra test [command] --help" for more information about a command.
```



**æŒ‡å®šå‚æ•°ï¼š**

```
PS D:\æ–‡æ¡£\æœ€è¿‘çš„\awesome-golang\docs\go-advancend\code\cobra\clid> .\clid.exe  version -n ç‹è‰ºæ¡¦     
version called
ä½œè€…æ˜¯ï¼š ç‹è‰ºæ¡¦
```



## è¡¥å…… runå‚æ•°çš„åŒ¿åå‡½æ•°

```go
// versionCmd represents the version command
var versionCmd = &cobra.Command{
	Use:   "version",
	Short: "å…³äºç‰ˆæœ¬ä¿¡æ¯çŸ­æè¿°",
	Long:  `å…³äºç‰ˆæœ¬ä¿¡æ¯é•¿æè¿°`,
	Run: func(cmd *cobra.Command, args []string) {
		fmt.Println("version called")
		author, _ := cmd.Flags().GetString("author")
		fmt.Println("ä½œè€…æ˜¯ï¼š", author)

	},
}
```

+ `cmd` æ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼Œå¯ä»¥é€šè¿‡`cmd`æ¥è·å–å‚æ•°
+ `args` æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œå¯ä»¥é€šè¿‡`args`æ¥è·å–å‚æ•°



ğŸ’¡ç®€å•çš„ä¸€ä¸ªæ¡ˆä¾‹å¦‚ä¸‹ï¼š

```go
/*
Copyright Â© 2022 xiongxinwei

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in
all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
THE SOFTWARE.
*/
package cmd

import (
	"fmt"
	"strconv"

	"github.com/spf13/cobra"
)

// versionCmd represents the version command
var versionCmd = &cobra.Command{
	Use:   "version",
	Short: "å…³äºç‰ˆæœ¬ä¿¡æ¯çŸ­æè¿°",
	Long:  `å…³äºç‰ˆæœ¬ä¿¡æ¯é•¿æè¿°`,
	Run: func(cmd *cobra.Command, args []string) {
		fmt.Println("version called")
		author, _ := cmd.Flags().GetString("author")
		fmt.Println("ä½œè€…æ˜¯ï¼š", author)

		var x int
		//string è½¬æ¢ä¸º int
		for _, v := range args {
			tmp, _ := strconv.Atoi(v)
			x += tmp
		}
		fmt.Println("x is ", x)
	},
}

func init() {
	rootCmd.AddCommand(versionCmd)

	testCmd.AddCommand(versionCmd)

	// æ·»åŠ å‚æ•°
	versionCmd.Flags().StringP("author", "n", "default", "name") //åç§°ï¼Œç®€å†™ï¼Œé»˜è®¤å€¼ï¼Œæè¿°

}

```



ğŸš€ ç¼–è¯‘ç»“æœå¦‚ä¸‹ï¼š

```bash
PS D:\æ–‡æ¡£\æœ€è¿‘çš„\awesome-golang\docs\go-advancend\code\cobra\clid> .\clid.exe version -n è€ç‹ 123 12 412 543 12
version called
ä½œè€…æ˜¯ï¼š è€ç‹
x is  1102
```





## END é“¾æ¥

+ [å›åˆ°ç›®å½•](../README.md)
+ [ä¸Šä¸€èŠ‚](14.md)
+ [ä¸‹ä¸€èŠ‚](16.md)
---
+ [å‚ä¸è´¡çŒ®â¤ï¸ğŸ’•ğŸ’•](https://github.com/cubxxw/awesome-cs-cloudnative-blockchain/blob/master/Git/git-contributor.md)