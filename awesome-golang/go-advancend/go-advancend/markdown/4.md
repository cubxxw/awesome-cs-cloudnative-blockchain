+ [author](https://github.com/3293172751)

# ç¬¬4èŠ‚ æµç¨‹æ„å»ºå’Œåˆ†æ

+ [å›åˆ°ç›®å½•](../README.md)
+ [ä¸Šä¸€èŠ‚](3.md)
> â¤ï¸ğŸ’•ğŸ’•Goè¯­è¨€é«˜çº§ç¯‡ç« ,åœ¨æ­¤ä¹‹å‰å»ºè®®æ‚¨å…ˆäº†è§£åŸºç¡€å’Œè¿›é˜¶ç¯‡ã€‚Myblog:[http://nsddd.top](http://nsddd.top/)
###  **[Goè¯­è¨€åŸºç¡€ç¯‡](https://github.com/3293172751/Block_Chain/blob/master/TOC.md)**
###  **[Goè¯­è¨€100ç¯‡è¿›é˜¶](https://github.com/3293172751/Block_Chain/blob/master/Gomd_super/README.md)**
---
[TOC]

### åˆ›å»ºä¸€ä¸ªgo-modå’Œä»“åº“

```
PS C:\Users\smile\Desktop\log-monitoring> go mod init github.com/3293172751/log-monitoring/tree/master
go: creating new go.mod: module github.com/3293172751/log-monitoring/tree/master
```



### ç¨‹åºæ¡†æ¶

```go
package main

type LogProcess struct {
	rc chan string   //å¤šä¸ªgoroutineä¹‹é—´çš„æ•°æ®åŒæ­¥å’Œé€šä¿¡ï¼ˆchannels)
	wc chan string   //å†™å…¥æ¨¡å—åŒæ­¥æ•°æ®
	//ç³»ç»Ÿåˆ†ä¸ºä¸‰ä¸ªæ¨¡å—
	// + å®æ—¶è¯»å–  -- æ–‡ä»¶è·¯å¾„
	// + è§£æ
	// + å†™å…¥  -- å†™å…¥çš„æ—¶å€™éœ€è¦ip
	path       string //è¯»å–æ–‡ä»¶çš„è·¯å¾„
	influxDBsn string //å†™å…¥çš„ä¿¡æ¯
}

func (l *LogProcess) ReadFromFile() {
	//è¯»å–æ¨¡å—
}

func (l *LogProcess) Process() {
	//è§£ææ¨¡å—
}

func (l *LogProcess) WriteToInfluxDB() {
	//å†™å…¥æ¨¡å—
}

func main() {
	logprocess := &LogProcess{
		rc: make(chan string),
		wc: make(chan string),
		path:       "log/access.log",
		influxDBsn: "username&password..",
	}

	//ä½¿ç”¨goroutinueæé«˜ç¨‹åºçš„æ€§èƒ½
    go (*lp)logprocess.ReadFromFile()    //è°ƒç”¨è¯»å–æ¨¡å—
	go logprocess.Process()         //è°ƒç”¨è§£ææ¨¡å—
	go logprocess.WriteToInfluxDB() //è°ƒç”¨å†™å…¥æ¨¡å—

    //ç¨‹åºæ‰§è¡Œå®Œåå°±è‡ªåŠ¨é€€å‡ºäº†
	time.Sleep(1 * time.Second)
}
```



**ä½¿ç”¨`*LogProcess`å¼•ç”¨ç±»å‹åŸå› ï¼š**

```
func (l *LogProcess) Process() {
	//è§£ææ¨¡å—
}
logprocess := &LogProcess{}
```

+ ä¸ç”¨æ‹·è´ï¼Œå¯¹äºæ€§èƒ½æœ‰å¾ˆå¤§çš„æå‡
+ ç”¨å¼•ç”¨å°±å¯ä»¥ç”¨`l`å‚æ•°ç›´æ¥ä¿®æ”¹ç»“æ„ä½“çš„æ•°å€¼

 

### ç¨‹åºæµ‹è¯•

```go
func (l *LogProcess) ReadFromFile() {
	//è¯»å–æ¨¡å—
	line := "message"
	l.rc <- line //æ•°æ®çš„æµå‘
}

func (l *LogProcess) Process() {
	//è§£ææ¨¡å—
	data := <-l.rc
	l.wc <- strings.ToUpper(data)
	//å¤„ç†æ•°æ®--å°†dataä¸­çš„æ‰€æœ‰å­—ç¬¦ä¿®æ”¹ä¸ºå…¶å¤§å†™æ ¼å¼ã€‚å¯¹äºéASCIIå­—ç¬¦ï¼Œå®ƒçš„å¤§å†™æ ¼å¼éœ€è¦æŸ¥è¡¨è½¬æ¢
}

func (l *LogProcess) WriteToInfluxDB() {
	//å†™å…¥æ¨¡å—
	fmt.Println(<-l.wc)
}
```

**ç¼–è¯‘ç»“æœ**

```
[Running] go run "c:\Users\smile\Desktop\log-monitoring\log_process.go"
MESSAGE
```



### ç¨‹åºä¼˜åŒ–

**æˆ‘ä»¬åªèƒ½å¾€`WriteToInfluxDB()`ä¸­å†™å…¥æ•°æ®ï¼Œå¦‚æœæœ‰æ›´å¤šçš„æ•°æ®ï¼ˆé˜Ÿåˆ—æˆ–è€…æ ‡å‡†è¾“å‡ºä¸­ï¼‰ï¼Œæ­¤æ—¶éœ€è¦ç”¨åˆ°æ¥å£æ¨¡å¼ï¼ŒæŠŠå†™å…¥å’Œè¯»å‡ºæ¨¡å—æŠ½è±¡å‡ºæ¥**

**ç”¨æ¥çº¦æŸå®ç°ç±»çš„åŠŸèƒ½ã€‚**

```go
package main

import (
	"fmt"
	"strings"
	"time"
)

type Reader interface {
	Read(rc chan string)
}

type Writer interface {
	Writer(wc chan string)
}

type LogProcess struct {
	rc chan string //å¤šä¸ªgoroutineä¹‹é—´çš„æ•°æ®åŒæ­¥å’Œé€šä¿¡ï¼ˆchannels)
	wc chan string //å†™å…¥æ¨¡å—åŒæ­¥æ•°æ®
	//ç³»ç»Ÿåˆ†ä¸ºä¸‰ä¸ªæ¨¡å—
	// + å®æ—¶è¯»å–  -- æ–‡ä»¶è·¯å¾„
	// + è§£æ
	// + å†™å…¥  -- å†™å…¥çš„æ—¶å€™éœ€è¦
	read  Reader //æ¥å£å®šä¹‰
	write Writer
}

type ReadFromFile struct {
	path string //è¯»å–æ–‡ä»¶çš„è·¯å¾„
}

type WriteToInfluxDB struct {
	influxDBsn string //å†™å…¥çš„ä¿¡æ¯
}

func (r *ReadFromFile) Read(rc chan string) {
	//è¯»å–æ¨¡å—
	line := "messAge"
	rc <- line //æ•°æ®çš„æµå‘
}

func (l *LogProcess) Process() {
	//è§£ææ¨¡å—
	data := <-l.rc
	l.wc <- strings.ToUpper(data)
	//å¤„ç†æ•°æ®--å°†dataä¸­çš„æ‰€æœ‰å­—ç¬¦ä¿®æ”¹ä¸ºå…¶å¤§å†™æ ¼å¼ã€‚å¯¹äºéASCIIå­—ç¬¦ï¼Œå®ƒçš„å¤§å†™æ ¼å¼éœ€è¦æŸ¥è¡¨è½¬æ¢
}

func (w *WriteToInfluxDB) Writer(wc chan string) {
	//å†™å…¥æ¨¡å—
	fmt.Println(<-wc)
}

func main() {
	r := &ReadFromFile{
		path: "log/access.log",
	}
	w := &WriteToInfluxDB{
		influxDBsn: "username&password..",
	}
	logprocess := &LogProcess{
		rc:    make(chan string),
		wc:    make(chan string),
		read:  r,
		write: w,
	}

	//ä½¿ç”¨goroutinueæé«˜ç¨‹åºçš„æ€§èƒ½
	go logprocess.read.Read(logprocess.rc)    //è°ƒç”¨è¯»å–æ¨¡å—
	go logprocess.Process()                   //è°ƒç”¨è§£ææ¨¡å—
	go logprocess.write.Writer(logprocess.wc) //è°ƒç”¨å†™å…¥æ¨¡å—

	//ç¨‹åºæ‰§è¡Œå®Œåå°±è‡ªåŠ¨é€€å‡ºäº†,éœ€è¦ç­‰å¾…
	time.Sleep(1 * time.Second)
}

```

**ç¨‹åºç¼–è¯‘**

```
[Running] go run "c:\Users\smile\Desktop\log-monitoring\log_process.go"
MESSAGE
```

**ä¸ºä»€ä¹ˆæˆ‘ä»¬å®šä¹‰äº†ä¸¤ä¸ªæ¥å£å°±æå‡äº†å®ƒçš„å¯æ‰©å±•æ€§å‘¢ï¼Ÿ**

> çœ‹èµ·æ¥ç¨‹åºè™½ç„¶æ›´åŠ å¤æ‚äº†ï¼Œä½†æ˜¯æˆ‘ä»¬å¦‚æœåæœŸæ·»åŠ æ–°çš„è¯»å–å†™å…¥æ¨¡å—ï¼Œåªéœ€è¦å¯¹æ¥å£ä¿®æ”¹



## END é“¾æ¥
+ [å›åˆ°ç›®å½•](../README.md)
+ [ä¸Šä¸€èŠ‚](3.md)
+ [ä¸‹ä¸€èŠ‚](5.md)
---
+ [å‚ä¸è´¡çŒ®â¤ï¸ğŸ’•ğŸ’•](https://github.com/3293172751/Block_Chain/blob/master/Git/git-contributor.md)