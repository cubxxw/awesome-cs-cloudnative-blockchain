+ [author](https://github.com/3293172751)

# ç¬¬17èŠ‚ å¤šæ¨¡å—å·¥ä½œåŒºï¼ˆWorkspacesï¼‰

+ [å›åˆ°ç›®å½•](../README.md)
+ [ä¸Šä¸€èŠ‚](16.md)
> â¤ï¸ğŸ’•ğŸ’•Goè¯­è¨€é«˜çº§ç¯‡ç« ,åœ¨æ­¤ä¹‹å‰å»ºè®®æ‚¨å…ˆäº†è§£åŸºç¡€å’Œè¿›é˜¶ç¯‡ã€‚Myblog:[http://nsddd.top](http://nsddd.top/)
###  **[Goè¯­è¨€åŸºç¡€ç¯‡](https://github.com/3293172751/Block_Chain/blob/master/TOC.md)**
###  **[Goè¯­è¨€100ç¯‡è¿›é˜¶](https://github.com/3293172751/Block_Chain/blob/master/Gomd_super/README.md)**
---
[TOC]

## Why you need itï¼Ÿ

::: tip
åœ¨å‚ä¸sealoså·¥ç¨‹çš„æ—¶å€™ï¼Œå®ƒä»¬ç”¨åˆ°äº†Goè¯­è¨€æ–°ç‰¹æ€§ï¼šWorkspaces

+ [https://github.com/labring/sealos/blob/main/DEVELOPGUIDE.md](https://github.com/labring/sealos/blob/main/DEVELOPGUIDE.md)

ç”±äºsealosä½¿ç”¨çš„æ˜¯go1.18çš„workspaceç‰¹æ€§ï¼Œæ·»åŠ æ–°æ¨¡å—åï¼Œéœ€è¦`go work usr -r .`åœ¨rootç›®å½•ä¸‹è¿è¡Œæ›´æ–°åŒæ­¥çš„workspaceã€‚

æˆ‘ä»¬è¿™ç¯‡æ¥å­¦ä¹ å’Œä½¿ç”¨è¿™ä¸ªæ–°ç‰¹æ€§

:::



Go å¤šæ¨¡å—å·¥ä½œåŒºèƒ½å¤Ÿä½¿å¼€å‘è€…èƒ½å¤Ÿæ›´å®¹æ˜“åœ°åŒæ—¶å¤„ç†å¤šä¸ªæ¨¡å—çš„å·¥ä½œï¼Œå¦‚:

> æ–¹ä¾¿è¿›è¡Œä¾èµ–çš„ä»£ç è°ƒè¯•(æ‰“æ–­ç‚¹ã€ä¿®æ”¹ä»£ç )ã€æ’æŸ¥ä¾èµ–ä»£ç  bug
> æ–¹ä¾¿åŒæ—¶è¿›è¡Œå¤šä¸ªä»“åº“/æ¨¡å—å¹¶è¡Œå¼€å‘è°ƒè¯•



## ç®€å•ä¸Šæ‰‹

å½“å‰ç›®å½•ç»“æ„

![image-20221120151919161](http://sm.nsddd.top/smimage-20221120151919161.png)



### æ–‡ä»¶å†…å®¹

**modåŒ…å†…å®¹ï¼š**

```go
module nsddd.top/mszlu-common

go 1.19

-----------

module nsddd.top/fly-fish

go 1.19
```



**å¯¹åº”æ–‡ä»¶ï¼š**

`mszlu-common/utils.go`

```go
package utils

import (
	"fmt"
)

func Print() {
	fmt.Println("è¿™æ˜¯utils.go")

	//è°ƒç”¨fly-fishçš„main.go
 
}

```



`fly-fish/main.go`

```go
package main

import "fmt"

func main() {
	fmt.Println("è¿™æ˜¯fly-fishçš„main.go")
}

```



### å¦‚ä½•è°ƒç”¨

æˆ‘ä»¬å¸Œæœ›è°ƒç”¨å¦ä¸€ä¸ª mod æ¨¡å—çš„å‡½æ•°ï¼Œæˆ‘ä»¬ä½¿ç”¨work

```bash
go work init ./fly-fish
```

**ä½¿ç”¨`fly-fish`**



æˆ‘ä»¬å†åŠ å…¥ä¸€ä¸ªå·¥ä½œåŒºï¼š

```bash
go work use ./mszlu-common
```



**æ­¤æ—¶å·¥ä½œç›®å½•æ–‡ä»¶ï¼š`go.work`**

```go
go 1.19

use (
	./fly-fish
	./mszlu-common
)
```



### è°ƒç”¨ utils

`fly-fish/main.go`

```go
package main

import (
	"fmt"

	utils "nsddd.top/mszlu-common"
)

func main() {
	fmt.Println("è¿™æ˜¯fly-fishçš„main.go")
	utils.Print()
}

```

ğŸš€ ç¼–è¯‘ç»“æœå¦‚ä¸‹ï¼š

```bash
[Running] go run "c:\Users\smile\Desktop\test\fly-fish\main.go"
è¿™æ˜¯fly-fishçš„main.go
è¿™æ˜¯utils.go
```







## `go work` æ”¯æŒå‘½ä»¤

+ é€šå¸¸æƒ…å†µä¸‹ï¼Œå»ºè®®ä¸è¦æäº¤ **go.work** æ–‡ä»¶åˆ° git ä¸Šï¼Œå› ä¸ºå®ƒä¸»è¦ç”¨äºæœ¬åœ°ä»£ç å¼€å‘ã€‚
+ æ¨èåœ¨: `$GOPATH` è·¯å¾„ä¸‹æ‰§è¡Œï¼Œç”Ÿæˆ **go.work** æ–‡ä»¶
+ `go work init` åˆå§‹åŒ–å·¥ä½œåŒºæ–‡ä»¶ï¼Œç”¨äºç”Ÿæˆ **go.work** å·¥ä½œåŒºæ–‡ä»¶

> åˆå§‹åŒ–å¹¶å†™å…¥ä¸€ä¸ªæ–°çš„ **go.work** åˆ°å½“å‰è·¯å¾„ä¸‹ï¼Œå¯ä»¥æŒ‡å®šéœ€è¦æ·»åŠ çš„ä»£ç æ¨¡å—
> ç¤ºä¾‹: `go work init ./hello` å°†æœ¬åœ°ä»“åº“ **hello** æ·»åŠ åˆ°å·¥ä½œåŒº
> **hello** ä»“åº“å¿…é¡»æ˜¯ go mod ä¾èµ–ç®¡ç†çš„ä»“åº“(**./hello/go.mod** æ–‡ä»¶å¿…é¡»å­˜åœ¨)

+ `go work use` æ·»åŠ æ–°çš„æ¨¡å—åˆ°å·¥ä½œåŒº

> å‘½ä»¤ç¤ºä¾‹:
> `go work use ./example` æ·»åŠ ä¸€ä¸ªæ¨¡å—åˆ°å·¥ä½œåŒº
> `go work use ./example ./example1` æ·»åŠ å¤šä¸ªæ¨¡å—åˆ°å·¥ä½œåŒº
> `go work use -r ./example` é€’å½’ **./example** ç›®å½•åˆ°å½“å‰å·¥ä½œåŒº
> åˆ é™¤å‘½ä»¤ä½¿ç”¨ `go work edit -dropuse=./example` åŠŸèƒ½

+ `go work edit` ç”¨äºç¼–è¾‘ **go.work** æ–‡ä»¶

> å¯ä»¥ä½¿ç”¨ `edit` å‘½ä»¤ç¼–è¾‘å’Œæ‰‹åŠ¨ç¼–è¾‘ `go.work` æ–‡ä»¶æ•ˆæœæ˜¯ç›¸åŒçš„ ç¤ºä¾‹:
> `go work edit -fmt go.work` é‡æ–°æ ¼å¼åŒ– **go.work** æ–‡ä»¶
> `go work edit -replace=github.com/link1st/example=./example go.work` æ›¿æ¢ä»£ç æ¨¡å—
> `go work edit -dropreplace=github.com/link1st/example` åˆ é™¤æ›¿æ¢ä»£ç æ¨¡å—
> `go work edit -use=./example go.work` æ·»åŠ æ–°çš„æ¨¡å—åˆ°å·¥ä½œåŒº
> `go work edit -dropuse=./example go.work` ä»å·¥ä½œåŒºä¸­åˆ é™¤æ¨¡å—

+ `go work sync` å°†å·¥ä½œåŒºçš„æ„å»ºåˆ—è¡¨åŒæ­¥åˆ°å·¥ä½œåŒºçš„æ¨¡å—
+ `go env GOWORK`

> æŸ¥çœ‹ç¯å¢ƒå˜é‡ï¼ŒæŸ¥çœ‹å½“å‰å·¥ä½œåŒºæ–‡ä»¶è·¯å¾„ å¯ä»¥æ’æŸ¥å·¥ä½œåŒºæ–‡ä»¶æ˜¯å¦è®¾ç½®æ­£ç¡®ï¼Œ**go.work** è·¯å¾„æ‰¾ä¸åˆ°å¯ä»¥ä½¿ç”¨ GOWORK æŒ‡å®š

```
> go env GOWORK
$GOPATH/src/link1st/link1st/workspaces/go.work
```



### **go.work** æ–‡ä»¶ç»“æ„

+ æ–‡ä»¶ç»“æ„å’Œ **go.mod** æ–‡ä»¶ç»“æ„ç±»ä¼¼ï¼Œæ”¯æŒ Go ç‰ˆæœ¬å·ã€æŒ‡å®šå·¥ä½œåŒºå’Œéœ€è¦æ›¿æ¢çš„ä»“åº“
+ æ–‡ä»¶ç»“æ„ç¤ºä¾‹:

```
go 1.18

use (
    ./hello
    ./example
)

replace (
    github.com/link1st/example => ./example1
)
```

#### `use` æŒ‡å®šä½¿ç”¨çš„æ¨¡å—ç›®å½•

+ å¯ä»¥ä½¿ç”¨ `go work use hello` æ·»åŠ æ¨¡å—ï¼Œä¹Ÿå¯ä»¥æ‰‹åŠ¨ä¿®æ”¹ **go.work** å·¥ä½œåŒºæ·»åŠ æ–°çš„æ¨¡å—
+ åœ¨å·¥ä½œåŒºä¸­æ·»åŠ äº†æ¨¡å—è·¯å¾„ï¼Œç¼–è¯‘çš„æ—¶å€™ä¼šè‡ªåŠ¨ä½¿ç”¨ **use** ä¸­çš„æœ¬åœ°ä»£ç è¿›è¡Œä»£ç ç¼–è¯‘ï¼Œå’Œ `replaces` åŠŸèƒ½ç±»ä¼¼ã€‚

```
# å•æ¨¡å—ç»“æ„
use ./hello

# å¤šæ¨¡å—ç»“æ„
use (
    ./hello
    ./example
)
```

#### `replaces` æ›¿æ¢ä¾èµ–ä»“åº“åœ°å€

+ `replaces` å‘½ä»¤ä¸ **go.mod** æŒ‡ä»¤ç›¸åŒï¼Œç”¨äºæ›¿æ¢é¡¹ç›®ä¸­ä¾èµ–çš„ä»“åº“åœ°å€
+ éœ€è¦æ³¨æ„çš„æ˜¯ `replaces` å’Œ `use` ä¸èƒ½åŒæ—¶æŒ‡å®šç›¸åŒçš„æœ¬åœ°è·¯å¾„

> åŒæ—¶æŒ‡å®šæŠ¥é”™ä¿¡æ¯:
> go: workspace module github.com/link1st/example is replaced at all versions in the go.work file. To fix, remove the replacement from the go.work file or specify the version at which to replace the module.

+ é”™è¯¯ç¤ºä¾‹

> åŒæ—¶åœ¨ `use` å’Œ `replace` æŒ‡å®šç›¸åŒçš„æœ¬åœ°è·¯å¾„

```
go 1.18

use (
    ./hello
    ./example
)

replace (
    github.com/link1st/example => ./example
)
```

#### **go.work** æ–‡ä»¶ä¼˜å…ˆçº§é«˜äº **go.mod** ä¸­å®šä¹‰

+ åœ¨åŒæ—¶ä½¿ç”¨ **go.work** å’Œ **go.mod** `replace` åŠŸèƒ½çš„çš„æ—¶å€™åˆ†åˆ«æŒ‡å®šä¸åŒçš„ä»£ç ä»“åº“è·¯å¾„ï¼Œ**go.work** ä¼˜å…ˆçº§é«˜äº **go.mod** ä¸­å®šä¹‰

> **go.mod** ä¸­å®šä¹‰æ›¿æ¢ä¸ºæœ¬åœ°ä»“åº“ **example**

```
replace (
    github.com/link1st/example => ./example1
)
```

> **go.work** ä¸­å®šä¹‰æ›¿æ¢ä¸ºæœ¬åœ°ä»“åº“ **example1**

```
replace (
    github.com/link1st/example => ./example1
)
```

+ åœ¨ä»£ç æ„å»ºæ—¶å€™ä½¿ç”¨çš„æ˜¯ **go.work** æŒ‡å®šçš„ **example1** ä»“åº“çš„ä»£ç ï¼Œ**go.work** ä¼˜å…ˆçº§åˆ«æ›´é«˜

### å¦‚ä½•ä½¿ç”¨

+ åœ¨ Go 1.18 `go run` å’Œ `go build` éƒ½ä¼šé»˜è®¤ä½¿ç”¨å·¥ä½œåŒºåŠŸèƒ½
+ `GOWORK` ä¹Ÿå¯ä»¥æŒ‡å®šé…ç½® **go.work** æ–‡ä»¶ä½ç½®

```
export GOWORK="~/go/src/test/go.18/workspace/go.work"
```

### å¦‚ä½•ç¦ç”¨å·¥ä½œåŒº

+ Go å…¨å±€å˜é‡ `GOWORK` è®¾ç½® `off` åˆ™å¯ä»¥ç¦ç”¨å·¥ä½œåŒºåŠŸèƒ½

> ```
> export GOWORK=off
> ```

## å¼€å‘æµç¨‹æ¼”ç¤º

+ æ¼”ç¤ºå¦‚ä½•ä½¿ç”¨å¤šæ¨¡å—å·¥ä½œåŒºåŠŸèƒ½ã€‚åœ¨ç°åœ¨å¾®æœåŠ¡ç››è¡Œçš„å¹´ä»£ï¼Œä¸€ä¸ªäººä¼šç»´æŠ¤å¤šä¸ªä»£ç ä»“åº“ï¼Œå¾ˆå¤šçš„æ—¶å€™æ˜¯å¤šä¸ªä»“åº“è¿›è¡ŒåŒæ—¶å¼€å‘
+ å‡è®¾æˆ‘ä»¬ç°åœ¨è¿›è¡Œ **hello** ä»“åº“å¼€å‘ï¼Œå®ç°çš„åŠŸèƒ½æ˜¯ï¼Œå®ç°å°†è¾“å…¥çš„å­—ç¬¦ä¸²åè½¬å¹¶è¾“å‡ºï¼Œå­—ç¬¦ä¸²åè½¬åŠŸèƒ½ä¾èµ–äº **github.com/link1st/example** (ä¸‹æ–‡ç»Ÿç§° **example**)å…¬å…±ä»“åº“å®ç°
+ æ–°å»º **hello** é¡¹ç›®

```
mkdir hello
cd hello
# ä»£ç ä»“åº“å¯åŠ¨ go mod ä¾èµ–ç®¡ç†ï¼Œç”Ÿæˆ go.mod æ–‡ä»¶
go mod init github.com/link1st/link1st/workspaces/hello
# ä¸‹è½½ä¾èµ–åŒ…
go get github.com/link1st/example
# ç¼–å†™ main æ–‡ä»¶
vim main.go
```

+ **main.go** ä»£ç 

```
// Package main main æ–‡ä»¶ï¼Œgo å¤šæ¨¡å—å·¥ä½œåŒºæ¼”ç¤ºä»£ç 
// å®ç°å°†è¾“å…¥çš„å­—ç¬¦ä¸²åè½¬è¾“å‡ºå¹¶è¾“å‡º
package main

import (
    "flag"
    "fmt"

    "github.com/link1st/example/stringutil"
)

var (
    str = ""
)

func init() {
    flag.StringVar(&str, "str", str, "è¾“å…¥å­—ç¬¦")
    flag.Parse()
}

func main() {
    if str == "" {
        fmt.Println("ç¤ºä¾‹: go run main.go -str hello")
        fmt.Println("str å‚æ•°å¿…å¡«")
        flag.Usage()
        return
    }

    // è°ƒç”¨å…¬å…±ä»“åº“ï¼Œè¿›è¡Œå­—ç¬¦ä¸²åè½¬
    str = stringutil.Reversal(str)
    // è¾“å‡ºåè½¬åçš„å­—ç¬¦ä¸²
    fmt.Println(str)
    return
}
```

+ è¿è¡Œä»£ç  `go run main.go -str "hello world"` æˆ– `go run github.com/link1st/link1st/workspaces/hello -str "hello world"` å¯ä»¥çœ‹åˆ°è¾“å‡ºäº† **hello world** åè½¬ä»¥åçš„å­—ç¬¦ä¸²

```
> go run main.go -str "hello world"
dlrow olleh
```

+ åˆ°è¿™é‡Œï¼Œæœ€åˆçš„åŠŸèƒ½å·²ç»å®Œæˆï¼Œä½†æ˜¯åç»­éœ€æ±‚å˜åŠ¨ï¼Œä¸ä»…éœ€è¦è¾“å‡ºåè½¬ä»¥åçš„å­—ç¬¦ä¸²ï¼Œè¿˜éœ€è¦å°†å­—ç¬¦ä¸²å¤§å†™
+ æˆ‘ä»¬åˆ™éœ€è¦å» **example** ä»“åº“ä¸­æ·»åŠ å¼€å‘ **å°†å­—ç¬¦ä¸²å¤§å†™çš„åŠŸèƒ½**

```
# å›åˆ°å·¥ä½œæ ¹ç›®å½•ï¼Œå°† common ä»£ç ä¸‹è½½åˆ°æœ¬åœ°è¿›è¡Œæ·»åŠ æ–°çš„åŠŸèƒ½
# ä¸‹è½½ä¾èµ–çš„ example åŒ…
git clone git@github.com:link1st/example.git
# åœ¨ example åŒ…ä¸­æ·»åŠ  å­—ç¬¦ä¸²å¤§å­¦çš„åŠŸèƒ½
```

+ **vim example/stringutil/to_upper.go** ä»£ç å¦‚ä¸‹

```
// Package stringutil stringutil
package stringutil

import (
    "unicode"
)

// ToUpper å°†å­—ç¬¦ä¸²è¿›è¡Œå¤§å†™
func ToUpper(s string) string {
    r := []rune(s)
    for i := range r {
        r[i] = unicode.ToUpper(r[i])
    }
    return string(r)
}
```

+ ç”±äºä»£ç è¿˜åœ¨æœ¬åœ°è°ƒè¯•ï¼Œæœªæäº¤ git ä»“åº“ä¸­ï¼Œè¿™ä¸ªæ—¶å€™å°±éœ€è¦ç”¨åˆ° Go å¤šæ¨¡å—å·¥ä½œåŒºçš„åŠŸèƒ½äº†ã€‚
+ è¿›å…¥é¡¹ç›®æ ¹ç›®å½•ï¼Œåˆå§‹åŒ–æˆ‘ä»¬ç°åœ¨æ­£åœ¨å¼€å‘çš„æ¨¡å—

```
# åˆå§‹åŒ– go.work æ–‡ä»¶
go work init  ./hello ./example
# æŸ¥çœ‹ go.work æ–‡ä»¶å†…å®¹
cat go.work
```

+ æ–‡ä»¶ç»“æ„å¦‚ä¸‹

```
go 1.18

use (
    ./example
    ./hello
)
```

+ å›åˆ° **hello** é¡¹ç›®ï¼Œ`vim main.go` å°†å­—ç¬¦ä¸²å¤§å†™çš„åŠŸèƒ½æ·»åŠ ä¸Šã€‚

```
func main() {
    ...

    // è°ƒç”¨å…¬å…±ä»“åº“ï¼Œè¿›è¡Œå­—ç¬¦ä¸²åè½¬
    str = stringutil.Reversal(str)
    // å¢åŠ å­—ç¬¦å¤§å†™çš„åŠŸèƒ½
    str = stringutil.ToUpper(str)
    // è¾“å‡ºåè½¬åçš„å­—ç¬¦ä¸²
    fmt.Println(str)
    
    ...
}
```

+ è¿è¡Œä»£ç 

> å¯ä»¥çœ‹åˆ°è¾“å‡ºäº†åè½¬å¹¶ **å¤§å†™** çš„å­—ç¬¦ä¸²ï¼Œå¤§å†™çš„å‡½æ•°åŠŸèƒ½åªåœ¨æœ¬åœ°ï¼Œæœªæäº¤åˆ° git ä¸Šï¼Œè¿™æ ·æˆ‘ä»¬å°±å®ç°äº†å¯ä»¥åŒæ—¶åœ¨ä¸¤ä¸ªæ¨¡å—ä¸Šå¹¶è¡Œå¼€å‘

```
go run main.go -str "hello world"
DLROW OLLEH
```

+ åˆ°è¿™é‡Œï¼Œæ¼”ç¤ºçš„ä»£ç å·²ç»å…¨éƒ¨å®Œæˆ

## æ€»ç»“

+ ä½¿ç”¨ Go å¤šæ¨¡å—å·¥ä½œåŒºçš„åŠŸèƒ½ï¼Œå¯ä»¥è®©æˆ‘ä»¬è½»æ¾åœ¨å¤šä¸ªæ¨¡å—ä¹‹é—´åˆ‡æ¢å·¥ä½œï¼Œæ›´èƒ½é€‚åº”ç°ä»£å¾®æœåŠ¡æ¶æ„å¼€å‘ã€‚



## å‚è€ƒæ–‡çŒ®

[Go 1.18 æ–°ç‰¹æ€§å¤šæ¨¡å—å·¥ä½œåŒºæ•™ç¨‹](https://github.com/link1st/link1st/tree/master/workspaces)

[Go 1.18 is released!](https://go.dev/blog/go1.18)

[Tutorial: Getting started with multi-module workspaces](https://go.dev/doc/tutorial/workspaces)

[go-1.18-features](https://sebastian-holstein.de/post/2021-11-08-go-1.18-features/)



## END é“¾æ¥
+ [å›åˆ°ç›®å½•](../README.md)
+ [ä¸Šä¸€èŠ‚](16.md)
+ [ä¸‹ä¸€èŠ‚](18.md)
---
+ [å‚ä¸è´¡çŒ®â¤ï¸ğŸ’•ğŸ’•](https://github.com/3293172751/Block_Chain/blob/master/Git/git-contributor.md)