<template><div><ul>
<li><a href="https://github.com/3293172751" target="_blank" rel="noopener noreferrer">author<ExternalLinkIcon/></a></li>
</ul>
<h1 id="ç¬¬6èŠ‚-è§£ææ¨¡å—çš„å®ç°" tabindex="-1"><a class="header-anchor" href="#ç¬¬6èŠ‚-è§£ææ¨¡å—çš„å®ç°" aria-hidden="true">#</a> ç¬¬6èŠ‚ è§£ææ¨¡å—çš„å®ç°</h1>
<ul>
<li><RouterLink to="/go-advancend/">å›åˆ°ç›®å½•</RouterLink></li>
<li><RouterLink to="/go-advancend/markdown/5.html">ä¸Šä¸€èŠ‚</RouterLink></li>
</ul>
<blockquote>
<p>â¤ï¸ğŸ’•ğŸ’•Goè¯­è¨€é«˜çº§ç¯‡ç« ,åœ¨æ­¤ä¹‹å‰å»ºè®®æ‚¨å…ˆäº†è§£åŸºç¡€å’Œè¿›é˜¶ç¯‡ã€‚Myblog:<a href="http://nsddd.top/" target="_blank" rel="noopener noreferrer">http://nsddd.top<ExternalLinkIcon/></a></p>
<h3 id="goè¯­è¨€åŸºç¡€ç¯‡" tabindex="-1"><a class="header-anchor" href="#goè¯­è¨€åŸºç¡€ç¯‡" aria-hidden="true">#</a> <strong><a href="https://github.com/3293172751/Block_Chain/blob/master/TOC.md" target="_blank" rel="noopener noreferrer">Goè¯­è¨€åŸºç¡€ç¯‡<ExternalLinkIcon/></a></strong></h3>
<h3 id="goè¯­è¨€100ç¯‡è¿›é˜¶" tabindex="-1"><a class="header-anchor" href="#goè¯­è¨€100ç¯‡è¿›é˜¶" aria-hidden="true">#</a> <strong><a href="https://github.com/3293172751/Block_Chain/blob/master/Gomd_super/README.md" target="_blank" rel="noopener noreferrer">Goè¯­è¨€100ç¯‡è¿›é˜¶<ExternalLinkIcon/></a></strong></h3>
</blockquote>
<hr>
<p>[TOC]</p>
<h3 id="è§£ææ¨¡å—çš„åŠŸèƒ½" tabindex="-1"><a class="header-anchor" href="#è§£ææ¨¡å—çš„åŠŸèƒ½" aria-hidden="true">#</a> è§£ææ¨¡å—çš„åŠŸèƒ½</h3>
<ol>
<li>ä»Read Channelä¸­è¯»å–æ¯è¡Œæ—¥å¿—æ•°æ®</li>
<li>æ­£åˆ™è¡¨è¾¾å¼æå–æ‰€éœ€è¦çš„ç›‘æ§æ•°æ®ï¼ˆpathï¼Œstatus,methodç­‰ï¼‰
<ul>
<li><a href="https://github.com/3293172751/Block_Chain/blob/master/Gomd_super/zhenze.md" target="_blank" rel="noopener noreferrer">æ­£åˆ™è¡¨è¾¾å¼æ•™ç¨‹<ExternalLinkIcon/></a></li>
</ul>
</li>
<li>å†™å…¥åˆ°write channel</li>
</ol>
<h3 id="è§£ææ¨¡å—çš„å®ç°" tabindex="-1"><a class="header-anchor" href="#è§£ææ¨¡å—çš„å®ç°" aria-hidden="true">#</a> è§£ææ¨¡å—çš„å®ç°</h3>
<div class="language-go ext-go line-numbers-mode"><pre v-pre class="language-go"><code><span class="token keyword">func</span> <span class="token punctuation">(</span>l <span class="token operator">*</span>LogProcess<span class="token punctuation">)</span> <span class="token function">Process</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">//è§£ææ¨¡å—</span>
	<span class="token comment">/* è¾“å…¥æ•°æ®ï¼š
	[07/July/2022:18:01:41 +0000] http "GET /foo?query=t HTTP/1.0" 200 2133 "-"
	"KeepAliveClient" "-" 1.005 1.854
	*/</span>
	<span class="token comment">//å¤„ç†æ•°æ®--å°†dataä¸­çš„æ‰€æœ‰å­—ç¬¦ä¿®æ”¹ä¸ºå…¶å¤§å†™æ ¼å¼ã€‚å¯¹äºéASCIIå­—ç¬¦ï¼Œå®ƒçš„å¤§å†™æ ¼å¼éœ€è¦æŸ¥è¡¨è½¬æ¢</span>
	r <span class="token operator">:=</span> regexp<span class="token punctuation">.</span><span class="token function">MustCompile</span><span class="token punctuation">(</span><span class="token string">`\[([^\]]+)\]\s+(.*?)\s+\"(.*?)\"\s+(\d{3})\s+(\d+)\s+\"([^"]+
	)\"\s+\"(.*?)\"\s+\"([\d\.-]+)\"\s+([\d\.-]+)\s+([\d\.-]+)`</span><span class="token punctuation">)</span>

	loc<span class="token punctuation">,</span> err <span class="token operator">:=</span> time<span class="token punctuation">.</span><span class="token function">LoadLocation</span><span class="token punctuation">(</span><span class="token string">"Asia/Shanghai"</span><span class="token punctuation">)</span> <span class="token comment">//æˆ‘ä»¬ç”¨çš„æ˜¯ä¸Šæµ·æ—¶åŒº</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>                                <span class="token comment">//å¯ä»¥å¿½ç•¥errä¸€èˆ¬ä¸ä¼šæœ‰é”™</span>
		<span class="token function">panic</span><span class="token punctuation">(</span>fmt<span class="token punctuation">.</span><span class="token function">Sprintf</span><span class="token punctuation">(</span><span class="token string">"time error:%s"</span><span class="token punctuation">,</span> err<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">for</span> v <span class="token operator">:=</span> <span class="token keyword">range</span> l<span class="token punctuation">.</span>rc <span class="token punctuation">{</span>
		ret <span class="token operator">:=</span> r<span class="token punctuation">.</span><span class="token function">FindStringSubmatch</span><span class="token punctuation">(</span><span class="token function">string</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">//åŒ¹é…æ•°æ®å†…å®¹ï¼Œæ­£åˆ™æ‹¬å·å†…å®¹åŒ¹é…åˆ°è¿”å›åˆ°</span>
		<span class="token comment">//fmt.Println(ret)</span>
		<span class="token keyword">if</span> <span class="token function">len</span><span class="token punctuation">(</span>ret<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">14</span> <span class="token punctuation">{</span> <span class="token comment">//æ­£åˆ™è¡¨è¾¾å¼æœ‰åä¸‰ä¸ªæ‹¬å·</span>
			log<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"FindStringSubmatch fail:"</span><span class="token punctuation">,</span> <span class="token function">string</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">)</span>
			<span class="token keyword">continue</span> <span class="token comment">//ç»§ç»­ä¸‹ä¸€æ¬¡åŒ¹é…</span>
		<span class="token punctuation">}</span>

		message <span class="token operator">:=</span> <span class="token operator">&amp;</span>Message<span class="token punctuation">{</span><span class="token punctuation">}</span>
		t<span class="token punctuation">,</span> err <span class="token operator">:=</span> time<span class="token punctuation">.</span><span class="token function">ParseInLocation</span><span class="token punctuation">(</span><span class="token string">"09/Jan/2006:15:04:05 +0000"</span><span class="token punctuation">,</span> ret<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">,</span> loc<span class="token punctuation">)</span>
		<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
			<span class="token function">panic</span><span class="token punctuation">(</span>fmt<span class="token punctuation">.</span><span class="token function">Sprintf</span><span class="token punctuation">(</span><span class="token string">"parseninlocation error:%s"</span><span class="token punctuation">,</span> ret<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
		message<span class="token punctuation">.</span>TimeLocal <span class="token operator">=</span> t
		byteSent<span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">:=</span> strconv<span class="token punctuation">.</span><span class="token function">Atoi</span><span class="token punctuation">(</span>ret<span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">//å°†stringç±»å‹è½¬åŒ–ä¸ºint</span>
		<span class="token comment">// if err != nil {</span>
		<span class="token comment">// 	panic(fmt.Sprintf("parseninlocation error:%s", err.Error(), ret[4]))</span>
		<span class="token comment">// }</span>
		message<span class="token punctuation">.</span>BytesSent <span class="token operator">=</span> byteSent

		<span class="token comment">//ç¬¬å…­ä¸ªæ‹¬å·åŒ¹é…çš„æ˜¯GET /foo?query=t HTTP/1.0</span>
		reqSli <span class="token operator">:=</span> strings<span class="token punctuation">.</span><span class="token function">Split</span><span class="token punctuation">(</span>ret<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">" "</span><span class="token punctuation">)</span> <span class="token comment">//æŒ‰ç…§ç©ºæ ¼åˆ‡å‰²ç¬¬å…­ä¸ªå­—æ®µ</span>
		<span class="token keyword">if</span> <span class="token function">len</span><span class="token punctuation">(</span>reqSli<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">3</span> <span class="token punctuation">{</span>
			log<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"strings.split fail"</span><span class="token punctuation">,</span> ret<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">//é•¿åº¦ä¸æ˜¯3è¯´æ˜æŠ¥é”™äº†</span>
			<span class="token keyword">continue</span>
		<span class="token punctuation">}</span>

		message<span class="token punctuation">.</span>Method <span class="token operator">=</span> reqSli<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>

		u<span class="token punctuation">,</span> err <span class="token operator">:=</span> url<span class="token punctuation">.</span><span class="token function">Parse</span><span class="token punctuation">(</span>reqSli<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
		<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
			log<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"url parse fail"</span><span class="token punctuation">,</span> ret<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
			<span class="token keyword">continue</span>
		<span class="token punctuation">}</span>
		message<span class="token punctuation">.</span>Path <span class="token operator">=</span> u<span class="token punctuation">.</span>Path <span class="token comment">//æ­¤æ—¶å¯ä»¥ç›´æ¥ä»ç»“æ„ä½“ä¸­å–åˆ°path</span>

		message<span class="token punctuation">.</span>Scheme <span class="token operator">=</span> ret<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span> <span class="token comment">//HTTP/1.0åè®®å¯ä»¥ç›´æ¥èµ‹å€¼ç»™mess</span>
		message<span class="token punctuation">.</span>Status <span class="token operator">=</span> ret<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span>

		<span class="token comment">//UpstreamTime, RequestTime    float64   //ç›‘æ§æ•°æ®  1.005 1.854åœ¨åäºŒåˆ°åä¸‰</span>
		upstreamTime<span class="token punctuation">,</span> err <span class="token operator">:=</span> strconv<span class="token punctuation">.</span><span class="token function">ParseFloat</span><span class="token punctuation">(</span>ret<span class="token punctuation">[</span><span class="token number">12</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">)</span> <span class="token comment">//è½¬åŒ–ä¸ºfloat64</span>
		<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
			fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"err = "</span><span class="token punctuation">,</span> err<span class="token punctuation">,</span> ret<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
			<span class="token keyword">continue</span>
		<span class="token punctuation">}</span>
		requestTime<span class="token punctuation">,</span> err <span class="token operator">:=</span> strconv<span class="token punctuation">.</span><span class="token function">ParseFloat</span><span class="token punctuation">(</span>ret<span class="token punctuation">[</span><span class="token number">13</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">)</span> <span class="token comment">//è½¬åŒ–ä¸ºfloat64</span>
		<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
			fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"err = "</span><span class="token punctuation">,</span> err<span class="token punctuation">,</span> ret<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
			<span class="token keyword">continue</span>
		<span class="token punctuation">}</span>
		message<span class="token punctuation">.</span>UpstreamTime <span class="token operator">=</span> upstreamTime
		message<span class="token punctuation">.</span>RequestTime <span class="token operator">=</span> requestTime

		l<span class="token punctuation">.</span>wc <span class="token operator">&lt;-</span> message <span class="token comment">//dataæ˜¯byteç±»å‹ï¼Œéœ€è¦è½¬åŒ–ä¸ºstringç±»å‹</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="end-é“¾æ¥" tabindex="-1"><a class="header-anchor" href="#end-é“¾æ¥" aria-hidden="true">#</a> END é“¾æ¥</h2>
<ul>
<li><RouterLink to="/go-advancend/">å›åˆ°ç›®å½•</RouterLink></li>
<li><RouterLink to="/go-advancend/markdown/5.html">ä¸Šä¸€èŠ‚</RouterLink></li>
<li><RouterLink to="/go-advancend/markdown/7.html">ä¸‹ä¸€èŠ‚</RouterLink></li>
</ul>
<hr>
<ul>
<li><a href="https://github.com/3293172751/Block_Chain/blob/master/Git/git-contributor.md" target="_blank" rel="noopener noreferrer">å‚ä¸è´¡çŒ®â¤ï¸ğŸ’•ğŸ’•<ExternalLinkIcon/></a></li>
</ul>
</div></template>


