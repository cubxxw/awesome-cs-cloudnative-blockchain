+ [author](https://github.com/3293172751)

# ç¬¬14èŠ‚ winå¥—æ¥å­—é€šä¿¡

+ [å›åˆ°ç›®å½•](../README.md)
+ [å›åˆ°é¡¹ç›®é¦–é¡µ](../../README.md)
+ [ä¸Šä¸€èŠ‚](13.md)
> â¤ï¸ğŸ’•ğŸ’•è®¡ç®—æœºç½‘ç»œ--TCP/IP å­¦ä¹ ã€‚Myblog:[http://nsddd.top](http://nsddd.top/)
---
[TOC]

##  windowå¥—æ¥å­—é€šä¿¡

**æˆ‘ä»¬åœ¨è¿›è¡Œå¥—æ¥å­—é€šä¿¡å³ä½¿æ˜¯ä¸åŒçš„è¯­è¨€ï¼Œä¸åŒçš„å¹³å°æµç¨‹éƒ½æ˜¯ä¸€æ ·çš„ï¼Œåªæ˜¯æŸäº›å‚æ•°çš„ç±»å‹æœ‰æ‰€åŒºåˆ«ã€‚**

> å¥—æ¥å­—é€šä¿¡ä¸åŒè¯­è¨€ä¹‹é—´çš„æµç¨‹éƒ½æ˜¯ä¸€æ ·çš„ï¼Œä½†æ˜¯ä¸åŒçš„ç¼–ç¨‹è¯­è¨€è°ƒç”¨çš„æ¥å£å¯èƒ½æ˜¯æœ‰æ‰€åŒºåˆ«ã€‚è¶Šé«˜çº§çš„è¯­è¨€è°ƒç”¨æµç¨‹å°±è¶Šæ˜¯ç®€å•ã€‚

åœ¨ Window ä¸­ä¹Ÿæä¾›äº†å¥—æ¥å­—é€šä¿¡çš„ APIï¼Œè¿™äº› API å‡½æ•°ä¸ Linux å¹³å°çš„ API å‡½æ•°å‡ ä¹ç›¸åŒï¼Œä»¥è‡³äºå¾ˆå¤šäººè®¤ä¸ºå¥—æ¥å­—é€šä¿¡çš„ API å‡½æ•°åº“åªæœ‰ä¸€å¥—ï¼Œä¸‹é¢æ¥çœ‹ä¸€ä¸‹è¿™äº› Windows å¹³å°çš„å¥—æ¥å­—å‡½æ•°ï¼š



## åˆå§‹åŒ–å¥—æ¥å­—ç¯å¢ƒ

ä½¿ç”¨ Windows ä¸­çš„å¥—æ¥å­—å‡½æ•°éœ€è¦é¢å¤–åŒ…å«å¯¹åº”çš„å¤´æ–‡ä»¶ä»¥åŠåŠ è½½å“åº”çš„åŠ¨æ€åº“ï¼š

```
include <winsock2.h>

//ä½¿ç”¨åˆ°çš„å¥—æ¥å­—åº“
ws2_32.dll
```

åœ¨ Windows ä½¿ç”¨å¥—æ¥å­—éœ€è¦å…ˆåŠ è½½å¥—æ¥å­—åº“ï¼ˆå¥—æ¥å­—ç¯å¢ƒï¼‰ï¼Œæœ€åéœ€è¦é‡Šæ”¾å¥—æ¥å­—èµ„æºã€‚

```
//åˆå§‹åŒ–winsockåº“
/è¿”å›å€¼ï¼ŒæˆåŠŸè¿”å›0ï¼Œå¤±è´¥è¿”å›SOCKET_ERROR
WSAStartup(WORD wVersionRequested, LPWSADATA lpWSAData);
```

- å‚æ•°:
  - wVersionRequested: ä½¿ç”¨çš„ Windows Socket çš„ç‰ˆæœ¬ï¼Œä¸€èˆ¬ä½¿ç”¨çš„ç‰ˆæœ¬æ˜¯ 2.2
    - åˆå§‹åŒ–è¿™ä¸ª `MAKEWORD(2, 2);` å‚æ•°
  - lpWSADataï¼šä¸€ä¸ª WSADATA ç»“æ„æŒ‡é’ˆï¼Œè¿™æ˜¯ä¸€ä¸ªä¼ å…¥å‚æ•°
    - åˆ›å»ºä¸€ä¸ª WSADATA ç±»å‹çš„å˜é‡ï¼Œå°†åœ°å€ä¼ é€’ç»™è¯¥å‡½æ•°çš„ç¬¬äºŒä¸ªå‚æ•°

æ³¨é”€ Winsock ç›¸å…³åº“ï¼Œå‡½æ•°è°ƒç”¨æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› SOCKET_ERRORã€‚

```
int WSACleanup (void);
```

ä½¿ç”¨ä¸¾ä¾‹ï¼š

```
WSAData wsa;

WSAStartup(MAKEWORD(2, 2), &wsa);

WSACleanup();
```



## å¥—æ¥å­—é€šä¿¡å‡½æ•°

åŸºäº Linux çš„å¥—æ¥å­—é€šä¿¡æµç¨‹æ˜¯æœ€å…¨é¢çš„ä¸€å¥—é€šä¿¡æµç¨‹ï¼Œå¦‚æœæ˜¯åœ¨æŸä¸ªæ¡†æ¶ä¸­è¿›è¡Œå¥—æ¥å­—é€šä¿¡ï¼Œé€šä¿¡æµç¨‹åªä¼šæ›´ç®€å•ï¼Œç›´æ¥ä½¿ç”¨ window çš„å¥—æ¥å­— api è¿›è¡Œå¥—æ¥å­—é€šä¿¡ï¼Œå’Œ Linux å¹³å°ä¸Šçš„é€šä¿¡æµç¨‹å®Œå…¨ç›¸åŒã€‚

### ç»“æ„ä½“

```c
typedef struct in_addr {
ã€€ã€€union {
ã€€ã€€	struct{ unsigned char s_b1,s_b2, s_b3,s_b4;} S_un_b;
ã€€ã€€	struct{ unsigned short s_w1, s_w2;} S_un_w;
ã€€ã€€	unsigned long S_addr;	
ã€€ã€€} S_un;
}IN_ADDR;

struct sockaddr_in {
ã€€ã€€short int sin_family; 
ã€€ã€€unsigned short int sin_port; 
ã€€ã€€struct in_addr sin_addr; 
ã€€ã€€unsigned char sin_zero[8]; 
};

typedef unsigned short  uint16_t;
typedef unsigned int    uint32_t;
typedef uint16_t in_port_t;
typedef uint32_t in_addr_t;
typedef unsigned short int sa_family_t;

struct in_addr
{
    in_addr_t s_addr;
};  

struct sockaddr_in
{
    sa_family_t sin_family;     
    in_port_t sin_port;         
    struct in_addr sin_addr;    
    
    unsigned char sin_zero[sizeof (struct sockaddr) - sizeof(sin_family) -
                      sizeof (in_port_t) - sizeof (struct in_addr)];
};
```



### å¤§å°ç«¯è½¬æ¢å‡½æ•°

```c
u_short htons (u_short hostshort );
u_long htonl ( u_long hostlong);


u_short ntohs (u_short netshort );
u_long ntohl ( u_long netlong);

// Linuxå‡½æ•°ï¼Œwindowä¸Šæ²¡æœ‰è¿™ä¸¤ä¸ªå‡½æ•°
inet_ntop(); 
inet_pton();

unsigned long inet_addr (const char FAR * cp);	
in_addr_t     inet_addr (const char *cp);			

char* inet_ntoa(struct in_addr in);
```



### å¥—æ¥å­—å‡½æ•°

```
windowçš„apiä¸­å¥—æ¥å­—å¯¹åº”çš„ç±»å‹æ˜¯ SOCKET ç±»å‹, linuxä¸­æ˜¯ int ç±»å‹, æœ¬è´¨æ˜¯ä¸€æ ·çš„
```



```c
SOCKET socket(int af,int type,int protocal);
/*å‚æ•°:
    - af: åœ°å€æ—åè®®
        - ipv4: AF_INET (windows/linux)
        - PF_INET (windows)
        - AF_INET == PF_INET
   - type: å’Œlinuxä¸€æ ·
       	- SOCK_STREAM
        - SOCK_DGRAM
   - protocal: ä¸€èˆ¬å†™0 å³å¯
       - åœ¨windowsä¸Šçš„å¦ä¸€ç§å†™æ³•
           - IPPROTO_TCP, ä½¿ç”¨æŒ‡å®šçš„æµå¼åè®®ä¸­çš„tcpåè®®
           - IPPROTO_UDP, ä½¿ç”¨æŒ‡å®šçš„æŠ¥å¼åè®®ä¸­çš„udpåè®®
*/
int bind(SOCKET s,const struct sockaddr FAR* name, int namelen);

int listen(SOCKET s,int backlog);

SOCKET accept ( SOCKET s, struct sockaddr FAR* addr, int FAR* addrlen );

int connect (SOCKET s,const struct sockaddr FAR* name,int namelen );

::connect(sock, (struct sockaddr*)&addr, sizeof(addr));

int recv (SOCKET s,char FAR* buf,int len,int flags);

int send (SOCKET s,const char FAR * buf, int len,int flags);

int closesocket (SOCKET s);		

int recvfrom(SOCKET s,char FAR *buf,int len,int flags,
         struct sockaddr FAR *from,int FAR *fromlen);

int sendto(SOCKET s,const char FAR *buf,int len,int flags,
       const struct sockaddr FAR *to,int tolen);
```



## END é“¾æ¥

+ [å›åˆ°ç›®å½•](../README.md)
+ [ä¸Šä¸€èŠ‚](13.md)
+ [ä¸‹ä¸€èŠ‚](15.md)
---
+ [å‚ä¸è´¡çŒ®â¤ï¸ğŸ’•ğŸ’•](https://github.com/3293172751/CS_COURSE/blob/master/Git/git-contributor.md)
